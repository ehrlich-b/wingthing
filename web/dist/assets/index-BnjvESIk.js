(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var aa=Object.defineProperty,Xl=Object.getOwnPropertyDescriptor,Gl=(t,e)=>{for(var s in e)aa(t,s,{get:e[s],enumerable:!0})},se=(t,e,s,i)=>{for(var r=i>1?void 0:i?Xl(e,s):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(i?o(e,s,r):o(r))||r);return i&&r&&aa(e,s,r),r},R=(t,e)=>(s,i)=>e(s,i,t),Rn="Terminal input",or={get:()=>Rn,set:t=>Rn=t},An="Too much output to announce, navigate to rows manually to read",ar={get:()=>An,set:t=>An=t};function Jl(t){return t.replace(/\r?\n/g,"\r")}function Zl(t,e){return e?"\x1B[200~"+t+"\x1B[201~":t}function Ql(t,e){t.clipboardData&&t.clipboardData.setData("text/plain",e.selectionText),t.preventDefault()}function eh(t,e,s,i){if(t.stopPropagation(),t.clipboardData){let r=t.clipboardData.getData("text/plain");la(r,e,s,i)}}function la(t,e,s,i){t=Jl(t),t=Zl(t,s.decPrivateModes.bracketedPasteMode&&i.rawOptions.ignoreBracketedPasteMode!==!0),s.triggerDataEvent(t,!0),e.value=""}function ha(t,e,s){let i=s.getBoundingClientRect(),r=t.clientX-i.left-10,n=t.clientY-i.top-10;e.style.width="20px",e.style.height="20px",e.style.left=`${r}px`,e.style.top=`${n}px`,e.style.zIndex="1000",e.focus()}function Dn(t,e,s,i,r){ha(t,e,s),r&&i.rightClickSelect(t),e.value=i.selectionText,e.select()}function xt(t){return t>65535?(t-=65536,String.fromCharCode((t>>10)+55296)+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)}function Di(t,e=0,s=t.length){let i="";for(let r=e;r<s;++r){let n=t[r];n>65535?(n-=65536,i+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):i+=String.fromCharCode(n)}return i}var th=class{constructor(){this._interim=0}clear(){this._interim=0}decode(t,e){let s=t.length;if(!s)return 0;let i=0,r=0;if(this._interim){let n=t.charCodeAt(r++);56320<=n&&n<=57343?e[i++]=(this._interim-55296)*1024+n-56320+65536:(e[i++]=this._interim,e[i++]=n),this._interim=0}for(let n=r;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return this._interim=o,i;let a=t.charCodeAt(n);56320<=a&&a<=57343?e[i++]=(o-55296)*1024+a-56320+65536:(e[i++]=o,e[i++]=a);continue}o!==65279&&(e[i++]=o)}return i}},sh=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(t,e){let s=t.length;if(!s)return 0;let i=0,r,n,o,a,h=0,l=0;if(this.interim[0]){let u=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;let f=0,p;for(;(p=this.interim[++f]&63)&&f<4;)_<<=6,_|=p;let m=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,S=m-f;for(;l<S;){if(l>=s)return 0;if(p=t[l++],(p&192)!==128){l--,u=!0;break}else this.interim[f++]=p,_<<=6,_|=p&63}u||(m===2?_<128?l--:e[i++]=_:m===3?_<2048||_>=55296&&_<=57343||_===65279||(e[i++]=_):_<65536||_>1114111||(e[i++]=_)),this.interim.fill(0)}let c=s-4,d=l;for(;d<s;){for(;d<c&&!((r=t[d])&128)&&!((n=t[d+1])&128)&&!((o=t[d+2])&128)&&!((a=t[d+3])&128);)e[i++]=r,e[i++]=n,e[i++]=o,e[i++]=a,d+=4;if(r=t[d++],r<128)e[i++]=r;else if((r&224)===192){if(d>=s)return this.interim[0]=r,i;if(n=t[d++],(n&192)!==128){d--;continue}if(h=(r&31)<<6|n&63,h<128){d--;continue}e[i++]=h}else if((r&240)===224){if(d>=s)return this.interim[0]=r,i;if(n=t[d++],(n&192)!==128){d--;continue}if(d>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=t[d++],(o&192)!==128){d--;continue}if(h=(r&15)<<12|(n&63)<<6|o&63,h<2048||h>=55296&&h<=57343||h===65279)continue;e[i++]=h}else if((r&248)===240){if(d>=s)return this.interim[0]=r,i;if(n=t[d++],(n&192)!==128){d--;continue}if(d>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=t[d++],(o&192)!==128){d--;continue}if(d>=s)return this.interim[0]=r,this.interim[1]=n,this.interim[2]=o,i;if(a=t[d++],(a&192)!==128){d--;continue}if(h=(r&7)<<18|(n&63)<<12|(o&63)<<6|a&63,h<65536||h>1114111)continue;e[i++]=h}}return i}},ca="",Bt=" ",Fs=class da{constructor(){this.fg=0,this.bg=0,this.extended=new gi}static toColorRGB(e){return[e>>>16&255,e>>>8&255,e&255]}static fromColorRGB(e){return(e[0]&255)<<16|(e[1]&255)<<8|e[2]&255}clone(){let e=new da;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},gi=class ua{constructor(e=0,s=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=s}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(e){this._ext&=-67108864,this._ext|=e&67108863}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){let e=(this._ext&3758096384)>>29;return e<0?e^4294967288:e}set underlineVariantOffset(e){this._ext&=536870911,this._ext|=e<<29&3758096384}clone(){return new ua(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},Ge=class fa extends Fs{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new gi,this.combinedData=""}static fromCharData(e){let s=new fa;return s.setFromCharData(e),s}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?xt(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(e){this.fg=e[0],this.bg=0;let s=!1;if(e[1].length>2)s=!0;else if(e[1].length===2){let i=e[1].charCodeAt(0);if(55296<=i&&i<=56319){let r=e[1].charCodeAt(1);56320<=r&&r<=57343?this.content=(i-55296)*1024+r-56320+65536|e[2]<<22:s=!0}else s=!0}else this.content=e[1].charCodeAt(0)|e[2]<<22;s&&(this.combinedData=e[1],this.content=2097152|e[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Mn="di$target",lr="di$dependencies",Wi=new Map;function ih(t){return t[lr]||[]}function ke(t){if(Wi.has(t))return Wi.get(t);let e=function(s,i,r){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");rh(e,s,r)};return e._id=t,Wi.set(t,e),e}function rh(t,e,s){e[Mn]===e?e[lr].push({id:t,index:s}):(e[lr]=[{id:t,index:s}],e[Mn]=e)}var Te=ke("BufferService"),_a=ke("CoreMouseService"),Gt=ke("CoreService"),nh=ke("CharsetService"),tn=ke("InstantiationService"),pa=ke("LogService"),Oe=ke("OptionsService"),ma=ke("OscLinkService"),oh=ke("UnicodeService"),Ws=ke("DecorationService"),hr=class{constructor(e,s,i){this._bufferService=e,this._optionsService=s,this._oscLinkService=i}provideLinks(e,s){var d;let i=this._bufferService.buffer.lines.get(e-1);if(!i){s(void 0);return}let r=[],n=this._optionsService.rawOptions.linkHandler,o=new Ge,a=i.getTrimmedLength(),h=-1,l=-1,c=!1;for(let u=0;u<a;u++)if(!(l===-1&&!i.hasContent(u))){if(i.loadCell(u,o),o.hasExtendedAttrs()&&o.extended.urlId)if(l===-1){l=u,h=o.extended.urlId;continue}else c=o.extended.urlId!==h;else l!==-1&&(c=!0);if(c||l!==-1&&u===a-1){let _=(d=this._oscLinkService.getLinkData(h))==null?void 0:d.uri;if(_){let f={start:{x:l+1,y:e},end:{x:u+(!c&&u===a-1?1:0),y:e}},p=!1;if(!(n!=null&&n.allowNonHttpProtocols))try{let m=new URL(_);["http:","https:"].includes(m.protocol)||(p=!0)}catch{p=!0}p||r.push({text:_,range:f,activate:(m,S)=>n?n.activate(m,S,f):ah(m,S),hover:(m,S)=>{var y;return(y=n==null?void 0:n.hover)==null?void 0:y.call(n,m,S,f)},leave:(m,S)=>{var y;return(y=n==null?void 0:n.leave)==null?void 0:y.call(n,m,S,f)}})}c=!1,o.hasExtendedAttrs()&&o.extended.urlId?(l=u,h=o.extended.urlId):(l=-1,h=-1)}}s(r)}};hr=se([R(0,Te),R(1,Oe),R(2,ma)],hr);function ah(t,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}var Mi=ke("CharSizeService"),wt=ke("CoreBrowserService"),sn=ke("MouseService"),yt=ke("RenderService"),lh=ke("SelectionService"),ga=ke("CharacterJoinerService"),os=ke("ThemeService"),va=ke("LinkProviderService"),hh=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(t){setTimeout(()=>{throw t.stack?In.isErrorNoTelemetry(t)?new In(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.listeners.push(t),()=>{this._removeListener(t)}}emit(t){this.listeners.forEach(e=>{e(t)})}_removeListener(t){this.listeners.splice(this.listeners.indexOf(t),1)}setUnexpectedErrorHandler(t){this.unexpectedErrorHandler=t}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(t){this.unexpectedErrorHandler(t),this.emit(t)}onUnexpectedExternalError(t){this.unexpectedErrorHandler(t)}},ch=new hh;function li(t){dh(t)||ch.onUnexpectedError(t)}var cr="Canceled";function dh(t){return t instanceof uh?!0:t instanceof Error&&t.name===cr&&t.message===cr}var uh=class extends Error{constructor(){super(cr),this.name=this.message}};function fh(t){return new Error(`Illegal argument: ${t}`)}var In=class dr extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof dr)return e;let s=new dr;return s.message=e.message,s.stack=e.stack,s}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},ur=class Sa extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,Sa.prototype)}};function Fe(t,e=0){return t[t.length-(1+e)]}var _h;(t=>{function e(n){return n<0}t.isLessThan=e;function s(n){return n<=0}t.isLessThanOrEqual=s;function i(n){return n>0}t.isGreaterThan=i;function r(n){return n===0}t.isNeitherLessOrGreaterThan=r,t.greaterThan=1,t.lessThan=-1,t.neitherLessOrGreaterThan=0})(_h||(_h={}));function ph(t,e){let s=this,i=!1,r;return function(){return i||(i=!0,e||(r=t.apply(s,arguments))),r}}var wa;(t=>{function e(C){return C&&typeof C=="object"&&typeof C[Symbol.iterator]=="function"}t.is=e;let s=Object.freeze([]);function i(){return s}t.empty=i;function*r(C){yield C}t.single=r;function n(C){return e(C)?C:r(C)}t.wrap=n;function o(C){return C||s}t.from=o;function*a(C){for(let L=C.length-1;L>=0;L--)yield C[L]}t.reverse=a;function h(C){return!C||C[Symbol.iterator]().next().done===!0}t.isEmpty=h;function l(C){return C[Symbol.iterator]().next().value}t.first=l;function c(C,L){let A=0;for(let z of C)if(L(z,A++))return!0;return!1}t.some=c;function d(C,L){for(let A of C)if(L(A))return A}t.find=d;function*u(C,L){for(let A of C)L(A)&&(yield A)}t.filter=u;function*_(C,L){let A=0;for(let z of C)yield L(z,A++)}t.map=_;function*f(C,L){let A=0;for(let z of C)yield*L(z,A++)}t.flatMap=f;function*p(...C){for(let L of C)yield*L}t.concat=p;function m(C,L,A){let z=A;for(let j of C)z=L(z,j);return z}t.reduce=m;function*S(C,L,A=C.length){for(L<0&&(L+=C.length),A<0?A+=C.length:A>C.length&&(A=C.length);L<A;L++)yield C[L]}t.slice=S;function y(C,L=Number.POSITIVE_INFINITY){let A=[];if(L===0)return[A,C];let z=C[Symbol.iterator]();for(let j=0;j<L;j++){let W=z.next();if(W.done)return[A,t.empty()];A.push(W.value)}return[A,{[Symbol.iterator](){return z}}]}t.consume=y;async function w(C){let L=[];for await(let A of C)L.push(A);return Promise.resolve(L)}t.asyncToArray=w})(wa||(wa={}));function jt(t){if(wa.is(t)){let e=[];for(let s of t)if(s)try{s.dispose()}catch(i){e.push(i)}if(e.length===1)throw e[0];if(e.length>1)throw new AggregateError(e,"Encountered errors while disposing of store");return Array.isArray(t)?[]:t}else if(t)return t.dispose(),t}function mh(...t){return J(()=>jt(t))}function J(t){return{dispose:ph(()=>{t()})}}var ya=class ba{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{jt(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?ba.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}delete(e){if(e){if(e===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),void 0)}};ya.DISABLE_DISPOSED_WARNING=!1;var Lt=ya,O=class{constructor(){this._store=new Lt,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};O.None=Object.freeze({dispose(){}});var rs=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var s;this._isDisposed||e===this._value||((s=this._value)==null||s.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,(e=this._value)==null||e.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}},mt=typeof window=="object"?window:globalThis,fr=class _r{constructor(e){this.element=e,this.next=_r.Undefined,this.prev=_r.Undefined}};fr.Undefined=new fr(void 0);var Z=fr,Tn=class{constructor(){this._first=Z.Undefined,this._last=Z.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Z.Undefined}clear(){let e=this._first;for(;e!==Z.Undefined;){let s=e.next;e.prev=Z.Undefined,e.next=Z.Undefined,e=s}this._first=Z.Undefined,this._last=Z.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,s){let i=new Z(e);if(this._first===Z.Undefined)this._first=i,this._last=i;else if(s){let n=this._last;this._last=i,i.prev=n,n.next=i}else{let n=this._first;this._first=i,i.next=n,n.prev=i}this._size+=1;let r=!1;return()=>{r||(r=!0,this._remove(i))}}shift(){if(this._first!==Z.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Z.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Z.Undefined&&e.next!==Z.Undefined){let s=e.prev;s.next=e.next,e.next.prev=s}else e.prev===Z.Undefined&&e.next===Z.Undefined?(this._first=Z.Undefined,this._last=Z.Undefined):e.next===Z.Undefined?(this._last=this._last.prev,this._last.next=Z.Undefined):e.prev===Z.Undefined&&(this._first=this._first.next,this._first.prev=Z.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Z.Undefined;)yield e.element,e=e.next}},gh=globalThis.performance&&typeof globalThis.performance.now=="function",vh=class Ca{static create(e){return new Ca(e)}constructor(e){this._now=gh&&e===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},Pe;(t=>{t.None=()=>O.None;function e(P,v){return d(P,()=>{},0,void 0,!0,void 0,v)}t.defer=e;function s(P){return(v,b=null,k)=>{let B=!1,D;return D=P(x=>{if(!B)return D?D.dispose():B=!0,v.call(b,x)},null,k),B&&D.dispose(),D}}t.once=s;function i(P,v,b){return l((k,B=null,D)=>P(x=>k.call(B,v(x)),null,D),b)}t.map=i;function r(P,v,b){return l((k,B=null,D)=>P(x=>{v(x),k.call(B,x)},null,D),b)}t.forEach=r;function n(P,v,b){return l((k,B=null,D)=>P(x=>v(x)&&k.call(B,x),null,D),b)}t.filter=n;function o(P){return P}t.signal=o;function a(...P){return(v,b=null,k)=>{let B=mh(...P.map(D=>D(x=>v.call(b,x))));return c(B,k)}}t.any=a;function h(P,v,b,k){let B=b;return i(P,D=>(B=v(B,D),B),k)}t.reduce=h;function l(P,v){let b,k={onWillAddFirstListener(){b=P(B.fire,B)},onDidRemoveLastListener(){b==null||b.dispose()}},B=new E(k);return v==null||v.add(B),B.event}function c(P,v){return v instanceof Array?v.push(P):v&&v.add(P),P}function d(P,v,b=100,k=!1,B=!1,D,x){let I,N,Y,X=0,ie,re={leakWarningThreshold:D,onWillAddFirstListener(){I=P(ce=>{X++,N=v(N,ce),k&&!Y&&(Le.fire(N),N=void 0),ie=()=>{let Ne=N;N=void 0,Y=void 0,(!k||X>1)&&Le.fire(Ne),X=0},typeof b=="number"?(clearTimeout(Y),Y=setTimeout(ie,b)):Y===void 0&&(Y=0,queueMicrotask(ie))})},onWillRemoveListener(){B&&X>0&&(ie==null||ie())},onDidRemoveLastListener(){ie=void 0,I.dispose()}},Le=new E(re);return x==null||x.add(Le),Le.event}t.debounce=d;function u(P,v=0,b){return t.debounce(P,(k,B)=>k?(k.push(B),k):[B],v,void 0,!0,void 0,b)}t.accumulate=u;function _(P,v=(k,B)=>k===B,b){let k=!0,B;return n(P,D=>{let x=k||!v(D,B);return k=!1,B=D,x},b)}t.latch=_;function f(P,v,b){return[t.filter(P,v,b),t.filter(P,k=>!v(k),b)]}t.split=f;function p(P,v=!1,b=[],k){let B=b.slice(),D=P(N=>{B?B.push(N):I.fire(N)});k&&k.add(D);let x=()=>{B==null||B.forEach(N=>I.fire(N)),B=null},I=new E({onWillAddFirstListener(){D||(D=P(N=>I.fire(N)),k&&k.add(D))},onDidAddFirstListener(){B&&(v?setTimeout(x):x())},onDidRemoveLastListener(){D&&D.dispose(),D=null}});return k&&k.add(I),I.event}t.buffer=p;function m(P,v){return(b,k,B)=>{let D=v(new y);return P(function(x){let I=D.evaluate(x);I!==S&&b.call(k,I)},void 0,B)}}t.chain=m;let S=Symbol("HaltChainable");class y{constructor(){this.steps=[]}map(v){return this.steps.push(v),this}forEach(v){return this.steps.push(b=>(v(b),b)),this}filter(v){return this.steps.push(b=>v(b)?b:S),this}reduce(v,b){let k=b;return this.steps.push(B=>(k=v(k,B),k)),this}latch(v=(b,k)=>b===k){let b=!0,k;return this.steps.push(B=>{let D=b||!v(B,k);return b=!1,k=B,D?B:S}),this}evaluate(v){for(let b of this.steps)if(v=b(v),v===S)break;return v}}function w(P,v,b=k=>k){let k=(...I)=>x.fire(b(...I)),B=()=>P.on(v,k),D=()=>P.removeListener(v,k),x=new E({onWillAddFirstListener:B,onDidRemoveLastListener:D});return x.event}t.fromNodeEventEmitter=w;function C(P,v,b=k=>k){let k=(...I)=>x.fire(b(...I)),B=()=>P.addEventListener(v,k),D=()=>P.removeEventListener(v,k),x=new E({onWillAddFirstListener:B,onDidRemoveLastListener:D});return x.event}t.fromDOMEventEmitter=C;function L(P){return new Promise(v=>s(P)(v))}t.toPromise=L;function A(P){let v=new E;return P.then(b=>{v.fire(b)},()=>{v.fire(void 0)}).finally(()=>{v.dispose()}),v.event}t.fromPromise=A;function z(P,v){return P(b=>v.fire(b))}t.forward=z;function j(P,v,b){return v(b),P(k=>v(k))}t.runAndSubscribe=j;class W{constructor(v,b){this._observable=v,this._counter=0,this._hasChanged=!1;let k={onWillAddFirstListener:()=>{v.addObserver(this)},onDidRemoveLastListener:()=>{v.removeObserver(this)}};this.emitter=new E(k),b&&b.add(this.emitter)}beginUpdate(v){this._counter++}handlePossibleChange(v){}handleChange(v,b){this._hasChanged=!0}endUpdate(v){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function xe(P,v){return new W(P,v).emitter.event}t.fromObservable=xe;function F(P){return(v,b,k)=>{let B=0,D=!1,x={beginUpdate(){B++},endUpdate(){B--,B===0&&(P.reportChanges(),D&&(D=!1,v.call(b)))},handlePossibleChange(){},handleChange(){D=!0}};P.addObserver(x),P.reportChanges();let I={dispose(){P.removeObserver(x)}};return k instanceof Lt?k.add(I):Array.isArray(k)&&k.push(I),I}}t.fromObservableLight=F})(Pe||(Pe={}));var pr=class mr{constructor(e){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${e}_${mr._idPool++}`,mr.all.add(this)}start(e){this._stopWatch=new vh,this.listenerCount=e}stop(){if(this._stopWatch){let e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}};pr.all=new Set,pr._idPool=0;var Sh=pr,wh=-1,ka=class xa{constructor(e,s,i=(xa._idPool++).toString(16).padStart(3,"0")){this._errorHandler=e,this.threshold=s,this.name=i,this._warnCountdown=0}dispose(){var e;(e=this._stacks)==null||e.clear()}check(e,s){let i=this.threshold;if(i<=0||s<i)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${s} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new Ch(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(e.value)||0;this._stacks.set(e.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,s=0;for(let[i,r]of this._stacks)(!e||s<r)&&(e=[i,r],s=r);return e}};ka._idPool=1;var yh=ka,bh=class Ea{constructor(e){this.value=e}static create(){let e=new Error;return new Ea(e.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Ch=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},kh=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},xh=0,$i=class{constructor(e){this.value=e,this.id=xh++}},Eh=2,Bh,E=class{constructor(e){var s,i,r,n;this._size=0,this._options=e,this._leakageMon=(s=this._options)!=null&&s.leakWarningThreshold?new yh((e==null?void 0:e.onListenerError)??li,((i=this._options)==null?void 0:i.leakWarningThreshold)??wh):void 0,this._perfMon=(r=this._options)!=null&&r._profName?new Sh(this._options._profName):void 0,this._deliveryQueue=(n=this._options)==null?void 0:n.deliveryQueue}dispose(){var e,s,i,r;this._disposed||(this._disposed=!0,((e=this._deliveryQueue)==null?void 0:e.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(i=(s=this._options)==null?void 0:s.onDidRemoveLastListener)==null||i.call(s),(r=this._leakageMon)==null||r.dispose())}get event(){return this._event??(this._event=(e,s,i)=>{var a,h,l,c,d;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let u=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(u);let _=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],f=new kh(`${u}. HINT: Stack shows most frequent listener (${_[1]}-times)`,_[0]);return(((a=this._options)==null?void 0:a.onListenerError)||li)(f),O.None}if(this._disposed)return O.None;s&&(e=e.bind(s));let r=new $i(e),n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=bh.create(),n=this._leakageMon.check(r.stack,this._size+1)),this._listeners?this._listeners instanceof $i?(this._deliveryQueue??(this._deliveryQueue=new Ph),this._listeners=[this._listeners,r]):this._listeners.push(r):((l=(h=this._options)==null?void 0:h.onWillAddFirstListener)==null||l.call(h,this),this._listeners=r,(d=(c=this._options)==null?void 0:c.onDidAddFirstListener)==null||d.call(c,this)),this._size++;let o=J(()=>{n==null||n(),this._removeListener(r)});return i instanceof Lt?i.add(o):Array.isArray(i)&&i.push(o),o}),this._event}_removeListener(e){var n,o,a,h;if((o=(n=this._options)==null?void 0:n.onWillRemoveListener)==null||o.call(n,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(h=(a=this._options)==null?void 0:a.onDidRemoveLastListener)==null||h.call(a,this),this._size=0;return}let s=this._listeners,i=s.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,s[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*Eh<=s.length){let l=0;for(let c=0;c<s.length;c++)s[c]?s[l++]=s[c]:r&&(this._deliveryQueue.end--,l<this._deliveryQueue.i&&this._deliveryQueue.i--);s.length=l}}_deliver(e,s){var r;if(!e)return;let i=((r=this._options)==null?void 0:r.onListenerError)||li;if(!i){e.value(s);return}try{e.value(s)}catch(n){i(n)}}_deliverQueue(e){let s=e.current._listeners;for(;e.i<e.end;)this._deliver(s[e.i++],e.value);e.reset()}fire(e){var s,i,r,n;if((s=this._deliveryQueue)!=null&&s.current&&(this._deliverQueue(this._deliveryQueue),(i=this._perfMon)==null||i.stop()),(r=this._perfMon)==null||r.start(this._size),this._listeners)if(this._listeners instanceof $i)this._deliver(this._listeners,e);else{let o=this._deliveryQueue;o.enqueue(this,e,this._listeners.length),this._deliverQueue(o)}(n=this._perfMon)==null||n.stop()}hasListeners(){return this._size>0}},Ph=class{constructor(){this.i=-1,this.end=0}enqueue(t,e,s){this.i=0,this.end=s,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},gr=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new E,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new E,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(e){return this.mapWindowIdToZoomLevel.get(this.getWindowId(e))??0}setZoomLevel(e,s){if(this.getZoomLevel(s)===e)return;let i=this.getWindowId(s);this.mapWindowIdToZoomLevel.set(i,e),this._onDidChangeZoomLevel.fire(i)}getZoomFactor(e){return this.mapWindowIdToZoomFactor.get(this.getWindowId(e))??1}setZoomFactor(e,s){this.mapWindowIdToZoomFactor.set(this.getWindowId(s),e)}setFullscreen(e,s){if(this.isFullscreen(s)===e)return;let i=this.getWindowId(s);this.mapWindowIdToFullScreen.set(i,e),this._onDidChangeFullscreen.fire(i)}isFullscreen(e){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(e))}getWindowId(e){return e.vscodeWindowId}};gr.INSTANCE=new gr;var rn=gr;function Lh(t,e,s){typeof e=="string"&&(e=t.matchMedia(e)),e.addEventListener("change",s)}rn.INSTANCE.onDidChangeZoomLevel;function Rh(t){return rn.INSTANCE.getZoomFactor(t)}rn.INSTANCE.onDidChangeFullscreen;var as=typeof navigator=="object"?navigator.userAgent:"",vr=as.indexOf("Firefox")>=0,Ah=as.indexOf("AppleWebKit")>=0,nn=as.indexOf("Chrome")>=0,Dh=!nn&&as.indexOf("Safari")>=0;as.indexOf("Electron/")>=0;as.indexOf("Android")>=0;var Ui=!1;if(typeof mt.matchMedia=="function"){let t=mt.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),e=mt.matchMedia("(display-mode: fullscreen)");Ui=t.matches,Lh(mt,t,({matches:s})=>{Ui&&e.matches||(Ui=s)})}var ss="en",Sr=!1,wr=!1,hi=!1,Ba=!1,Ys,ci=ss,On=ss,Mh,Je,Yt=globalThis,Be,ia;typeof Yt.vscode<"u"&&typeof Yt.vscode.process<"u"?Be=Yt.vscode.process:typeof process<"u"&&typeof((ia=process==null?void 0:process.versions)==null?void 0:ia.node)=="string"&&(Be=process);var ra,Ih=typeof((ra=Be==null?void 0:Be.versions)==null?void 0:ra.electron)=="string",Th=Ih&&(Be==null?void 0:Be.type)==="renderer",na;if(typeof Be=="object"){Sr=Be.platform==="win32",wr=Be.platform==="darwin",hi=Be.platform==="linux",hi&&Be.env.SNAP&&Be.env.SNAP_REVISION,Be.env.CI||Be.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ys=ss,ci=ss;let t=Be.env.VSCODE_NLS_CONFIG;if(t)try{let e=JSON.parse(t);Ys=e.userLocale,On=e.osLocale,ci=e.resolvedLanguage||ss,Mh=(na=e.languagePack)==null?void 0:na.translationsConfigFile}catch{}Ba=!0}else typeof navigator=="object"&&!Th?(Je=navigator.userAgent,Sr=Je.indexOf("Windows")>=0,wr=Je.indexOf("Macintosh")>=0,(Je.indexOf("Macintosh")>=0||Je.indexOf("iPad")>=0||Je.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0,hi=Je.indexOf("Linux")>=0,(Je==null?void 0:Je.indexOf("Mobi"))>=0,ci=globalThis._VSCODE_NLS_LANGUAGE||ss,Ys=navigator.language.toLowerCase(),On=Ys):console.error("Unable to resolve platform.");var Pa=Sr,ht=wr,Oh=hi,Nn=Ba,ct=Je,bt=ci,Nh;(t=>{function e(){return bt}t.value=e;function s(){return bt.length===2?bt==="en":bt.length>=3?bt[0]==="e"&&bt[1]==="n"&&bt[2]==="-":!1}t.isDefaultVariant=s;function i(){return bt==="en"}t.isDefault=i})(Nh||(Nh={}));var Hh=typeof Yt.postMessage=="function"&&!Yt.importScripts;(()=>{if(Hh){let t=[];Yt.addEventListener("message",s=>{if(s.data&&s.data.vscodeScheduleAsyncWork)for(let i=0,r=t.length;i<r;i++){let n=t[i];if(n.id===s.data.vscodeScheduleAsyncWork){t.splice(i,1),n.callback();return}}});let e=0;return s=>{let i=++e;t.push({id:i,callback:s}),Yt.postMessage({vscodeScheduleAsyncWork:i},"*")}}return t=>setTimeout(t)})();var zh=!!(ct&&ct.indexOf("Chrome")>=0);ct&&ct.indexOf("Firefox")>=0;!zh&&ct&&ct.indexOf("Safari")>=0;ct&&ct.indexOf("Edg/")>=0;ct&&ct.indexOf("Android")>=0;var Qt=typeof navigator=="object"?navigator:{};Nn||document.queryCommandSupported&&document.queryCommandSupported("copy")||Qt&&Qt.clipboard&&Qt.clipboard.writeText,Nn||Qt&&Qt.clipboard&&Qt.clipboard.readText;var on=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(t,e){this._keyCodeToStr[t]=e,this._strToKeyCode[e.toLowerCase()]=t}keyCodeToStr(t){return this._keyCodeToStr[t]}strToKeyCode(t){return this._strToKeyCode[t.toLowerCase()]||0}},Ki=new on,Hn=new on,zn=new on,Fh=new Array(230),La;(t=>{function e(a){return Ki.keyCodeToStr(a)}t.toString=e;function s(a){return Ki.strToKeyCode(a)}t.fromString=s;function i(a){return Hn.keyCodeToStr(a)}t.toUserSettingsUS=i;function r(a){return zn.keyCodeToStr(a)}t.toUserSettingsGeneral=r;function n(a){return Hn.strToKeyCode(a)||zn.strToKeyCode(a)}t.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return Ki.keyCodeToStr(a)}t.toElectronAccelerator=o})(La||(La={}));var Wh=class Ra{constructor(e,s,i,r,n){this.ctrlKey=e,this.shiftKey=s,this.altKey=i,this.metaKey=r,this.keyCode=n}equals(e){return e instanceof Ra&&this.ctrlKey===e.ctrlKey&&this.shiftKey===e.shiftKey&&this.altKey===e.altKey&&this.metaKey===e.metaKey&&this.keyCode===e.keyCode}getHashCode(){let e=this.ctrlKey?"1":"0",s=this.shiftKey?"1":"0",i=this.altKey?"1":"0",r=this.metaKey?"1":"0";return`K${e}${s}${i}${r}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new $h([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},$h=class{constructor(e){if(e.length===0)throw fh("chords");this.chords=e}getHashCode(){let e="";for(let s=0,i=this.chords.length;s<i;s++)s!==0&&(e+=";"),e+=this.chords[s].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let s=0;s<this.chords.length;s++)if(!this.chords[s].equals(e.chords[s]))return!1;return!0}};function Uh(t){if(t.charCode){let s=String.fromCharCode(t.charCode).toUpperCase();return La.fromString(s)}let e=t.keyCode;if(e===3)return 7;if(vr)switch(e){case 59:return 85;case 60:if(Oh)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(ht)return 57;break}else if(Ah&&(ht&&e===93||!ht&&e===92))return 57;return Fh[e]||0}var Kh=ht?256:2048,qh=512,Yh=1024,Vh=ht?2048:256,Fn=class{constructor(e){var i;this._standardKeyboardEventBrand=!0;let s=e;this.browserEvent=s,this.target=s.target,this.ctrlKey=s.ctrlKey,this.shiftKey=s.shiftKey,this.altKey=s.altKey,this.metaKey=s.metaKey,this.altGraphKey=(i=s.getModifierState)==null?void 0:i.call(s,"AltGraph"),this.keyCode=Uh(s),this.code=s.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let s=0;return this.ctrlKey&&(s|=Kh),this.altKey&&(s|=qh),this.shiftKey&&(s|=Yh),this.metaKey&&(s|=Vh),s|=e,s}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new Wh(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},Wn=new WeakMap;function jh(t){if(!t.parent||t.parent===t)return null;try{let e=t.location,s=t.parent.location;if(e.origin!=="null"&&s.origin!=="null"&&e.origin!==s.origin)return null}catch{return null}return t.parent}var Xh=class{static getSameOriginWindowChain(t){let e=Wn.get(t);if(!e){e=[],Wn.set(t,e);let s=t,i;do i=jh(s),i?e.push({window:new WeakRef(s),iframeElement:s.frameElement||null}):e.push({window:new WeakRef(s),iframeElement:null}),s=i;while(s)}return e.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(t,e){if(!e||t===e)return{top:0,left:0};let s=0,i=0,r=this.getSameOriginWindowChain(t);for(let n of r){let o=n.window.deref();if(s+=(o==null?void 0:o.scrollY)??0,i+=(o==null?void 0:o.scrollX)??0,o===e||!n.iframeElement)break;let a=n.iframeElement.getBoundingClientRect();s+=a.top,i+=a.left}return{top:s,left:i}}},Vs=class{constructor(e,s){this.timestamp=Date.now(),this.browserEvent=s,this.leftButton=s.button===0,this.middleButton=s.button===1,this.rightButton=s.button===2,this.buttons=s.buttons,this.target=s.target,this.detail=s.detail||1,s.type==="dblclick"&&(this.detail=2),this.ctrlKey=s.ctrlKey,this.shiftKey=s.shiftKey,this.altKey=s.altKey,this.metaKey=s.metaKey,typeof s.pageX=="number"?(this.posx=s.pageX,this.posy=s.pageY):(this.posx=s.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=s.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let i=Xh.getPositionOfChildWindowRelativeToAncestorWindow(e,s.view);this.posx-=i.left,this.posy-=i.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},$n=class{constructor(t,e=0,s=0){var r;this.browserEvent=t||null,this.target=t?t.target||t.targetNode||t.srcElement:null,this.deltaY=s,this.deltaX=e;let i=!1;if(nn){let n=navigator.userAgent.match(/Chrome\/(\d+)/);i=(n?parseInt(n[1]):123)<=122}if(t){let n=t,o=t,a=((r=t.view)==null?void 0:r.devicePixelRatio)||1;if(typeof n.wheelDeltaY<"u")i?this.deltaY=n.wheelDeltaY/(120*a):this.deltaY=n.wheelDeltaY/120;else if(typeof o.VERTICAL_AXIS<"u"&&o.axis===o.VERTICAL_AXIS)this.deltaY=-o.detail/3;else if(t.type==="wheel"){let h=t;h.deltaMode===h.DOM_DELTA_LINE?vr&&!ht?this.deltaY=-t.deltaY/3:this.deltaY=-t.deltaY:this.deltaY=-t.deltaY/40}if(typeof n.wheelDeltaX<"u")Dh&&Pa?this.deltaX=-(n.wheelDeltaX/120):i?this.deltaX=n.wheelDeltaX/(120*a):this.deltaX=n.wheelDeltaX/120;else if(typeof o.HORIZONTAL_AXIS<"u"&&o.axis===o.HORIZONTAL_AXIS)this.deltaX=-t.detail/3;else if(t.type==="wheel"){let h=t;h.deltaMode===h.DOM_DELTA_LINE?vr&&!ht?this.deltaX=-t.deltaX/3:this.deltaX=-t.deltaX:this.deltaX=-t.deltaX/40}this.deltaY===0&&this.deltaX===0&&t.wheelDelta&&(i?this.deltaY=t.wheelDelta/(120*a):this.deltaY=t.wheelDelta/120)}}preventDefault(){var t;(t=this.browserEvent)==null||t.preventDefault()}stopPropagation(){var t;(t=this.browserEvent)==null||t.stopPropagation()}},Aa=Object.freeze(function(t,e){let s=setTimeout(t.bind(e),0);return{dispose(){clearTimeout(s)}}}),Gh;(t=>{function e(s){return s===t.None||s===t.Cancelled||s instanceof Jh?!0:!s||typeof s!="object"?!1:typeof s.isCancellationRequested=="boolean"&&typeof s.onCancellationRequested=="function"}t.isCancellationToken=e,t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Pe.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Aa})})(Gh||(Gh={}));var Jh=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Aa:(this._emitter||(this._emitter=new E),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},an=class{constructor(e,s){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof s=="number"&&this.setIfNotSet(e,s)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,s){if(this._isDisposed)throw new ur("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},s)}setIfNotSet(e,s){if(this._isDisposed)throw new ur("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},s))}},Zh=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){var t;(t=this.disposable)==null||t.dispose(),this.disposable=void 0}cancelAndSet(t,e,s=globalThis){if(this.isDisposed)throw new ur("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let i=s.setInterval(()=>{t()},e);this.disposable=J(()=>{s.clearInterval(i),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},Qh;(t=>{async function e(i){let r,n=await Promise.all(i.map(o=>o.then(a=>a,a=>{r||(r=a)})));if(typeof r<"u")throw r;return n}t.settled=e;function s(i){return new Promise(async(r,n)=>{try{await i(r,n)}catch(o){n(o)}})}t.withAsyncBody=s})(Qh||(Qh={}));var Un=class Ke{static fromArray(e){return new Ke(s=>{s.emitMany(e)})}static fromPromise(e){return new Ke(async s=>{s.emitMany(await e)})}static fromPromises(e){return new Ke(async s=>{await Promise.all(e.map(async i=>s.emitOne(await i)))})}static merge(e){return new Ke(async s=>{await Promise.all(e.map(async i=>{for await(let r of i)s.emitOne(r)}))})}constructor(e,s){this._state=0,this._results=[],this._error=null,this._onReturn=s,this._onStateChanged=new E,queueMicrotask(async()=>{let i={emitOne:r=>this.emitOne(r),emitMany:r=>this.emitMany(r),reject:r=>this.reject(r)};try{await Promise.resolve(e(i)),this.resolve()}catch(r){this.reject(r)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(e<this._results.length)return{done:!1,value:this._results[e++]};if(this._state===1)return{done:!0,value:void 0};await Pe.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>{var s;return(s=this._onReturn)==null||s.call(this),{done:!0,value:void 0}}}}static map(e,s){return new Ke(async i=>{for await(let r of e)i.emitOne(s(r))})}map(e){return Ke.map(this,e)}static filter(e,s){return new Ke(async i=>{for await(let r of e)s(r)&&i.emitOne(r)})}filter(e){return Ke.filter(this,e)}static coalesce(e){return Ke.filter(e,s=>!!s)}coalesce(){return Ke.coalesce(this)}static async toPromise(e){let s=[];for await(let i of e)s.push(i);return s}toPromise(){return Ke.toPromise(this)}emitOne(e){this._state===0&&(this._results.push(e),this._onStateChanged.fire())}emitMany(e){this._state===0&&(this._results=this._results.concat(e),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(e){this._state===0&&(this._state=2,this._error=e,this._onStateChanged.fire())}};Un.EMPTY=Un.fromArray([]);var{getWindow:lt,getWindowId:ec,onDidRegisterWindow:tc}=(function(){let t=new Map,e={window:mt,disposables:new Lt};t.set(mt.vscodeWindowId,e);let s=new E,i=new E,r=new E;function n(o,a){return(typeof o=="number"?t.get(o):void 0)??(a?e:void 0)}return{onDidRegisterWindow:s.event,onWillUnregisterWindow:r.event,onDidUnregisterWindow:i.event,registerWindow(o){if(t.has(o.vscodeWindowId))return O.None;let a=new Lt,h={window:o,disposables:a.add(new Lt)};return t.set(o.vscodeWindowId,h),a.add(J(()=>{t.delete(o.vscodeWindowId),i.fire(o)})),a.add(M(o,ge.BEFORE_UNLOAD,()=>{r.fire(o)})),s.fire(h),a},getWindows(){return t.values()},getWindowsCount(){return t.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return t.has(o)},getWindowById:n,getWindow(o){var l;let a=o;if((l=a==null?void 0:a.ownerDocument)!=null&&l.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h!=null&&h.view?h.view.window:mt},getDocument(o){return lt(o).document}}})(),sc=class{constructor(e,s,i,r){this._node=e,this._type=s,this._handler=i,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function M(t,e,s,i){return new sc(t,e,s,i)}var Kn=function(t,e,s,i){return M(t,e,s,i)},ln,ic=class extends Zh{constructor(t){super(),this.defaultTarget=t&&lt(t)}cancelAndSet(t,e,s){return super.cancelAndSet(t,e,s??this.defaultTarget)}},qn=class{constructor(t,e=0){this._runner=t,this.priority=e,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(t){li(t)}}static sort(t,e){return e.priority-t.priority}};(function(){let t=new Map,e=new Map,s=new Map,i=new Map,r=n=>{s.set(n,!1);let o=t.get(n)??[];for(e.set(n,o),t.set(n,[]),i.set(n,!0);o.length>0;)o.sort(qn.sort),o.shift().execute();i.set(n,!1)};ln=(n,o,a=0)=>{let h=ec(n),l=new qn(o,a),c=t.get(h);return c||(c=[],t.set(h,c)),c.push(l),s.get(h)||(s.set(h,!0),n.requestAnimationFrame(()=>r(h))),l}})();function rc(t){let e=t.getBoundingClientRect(),s=lt(t);return{left:e.left+s.scrollX,top:e.top+s.scrollY,width:e.width,height:e.height}}var ge={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},nc=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let s=He(e);this._maxWidth!==s&&(this._maxWidth=s,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let s=He(e);this._width!==s&&(this._width=s,this.domNode.style.width=this._width)}setHeight(e){let s=He(e);this._height!==s&&(this._height=s,this.domNode.style.height=this._height)}setTop(e){let s=He(e);this._top!==s&&(this._top=s,this.domNode.style.top=this._top)}setLeft(e){let s=He(e);this._left!==s&&(this._left=s,this.domNode.style.left=this._left)}setBottom(e){let s=He(e);this._bottom!==s&&(this._bottom=s,this.domNode.style.bottom=this._bottom)}setRight(e){let s=He(e);this._right!==s&&(this._right=s,this.domNode.style.right=this._right)}setPaddingTop(e){let s=He(e);this._paddingTop!==s&&(this._paddingTop=s,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let s=He(e);this._paddingLeft!==s&&(this._paddingLeft=s,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let s=He(e);this._paddingBottom!==s&&(this._paddingBottom=s,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let s=He(e);this._paddingRight!==s&&(this._paddingRight=s,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let s=He(e);this._fontSize!==s&&(this._fontSize=s,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let s=He(e);this._lineHeight!==s&&(this._lineHeight=s,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let s=He(e);this._letterSpacing!==s&&(this._letterSpacing=s,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,s){this.domNode.classList.toggle(e,s),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,s){this.domNode.setAttribute(e,s)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function He(t){return typeof t=="number"?`${t}px`:t}function ks(t){return new nc(t)}var Da=class{constructor(){this._hooks=new Lt,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,s){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let i=this._onStopCallback;this._onStopCallback=null,e&&i&&i(s)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,s,i,r,n){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=r,this._onStopCallback=n;let o=e;try{e.setPointerCapture(s),this._hooks.add(J(()=>{try{e.releasePointerCapture(s)}catch{}}))}catch{o=lt(e)}this._hooks.add(M(o,ge.POINTER_MOVE,a=>{if(a.buttons!==i){this.stopMonitoring(!0);return}a.preventDefault(),this._pointerMoveCallback(a)})),this._hooks.add(M(o,ge.POINTER_UP,a=>this.stopMonitoring(!0)))}};function oc(t,e,s){let i=null,r=null;if(typeof s.value=="function"?(i="value",r=s.value,r.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof s.get=="function"&&(i="get",r=s.get),!r)throw new Error("not supported");let n=`$memoize$${e}`;s[i]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:r.apply(this,o)}),this[n]}}var ot;(t=>(t.Tap="-xterm-gesturetap",t.Change="-xterm-gesturechange",t.Start="-xterm-gesturestart",t.End="-xterm-gesturesend",t.Contextmenu="-xterm-gesturecontextmenu"))(ot||(ot={}));var vs=class Ae extends O{constructor(){super(),this.dispatched=!1,this.targets=new Tn,this.ignoreTargets=new Tn,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(Pe.runAndSubscribe(tc,({window:e,disposables:s})=>{s.add(M(e.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),s.add(M(e.document,"touchend",i=>this.onTouchEnd(e,i))),s.add(M(e.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:mt,disposables:this._store}))}static addTarget(e){if(!Ae.isTouchDevice())return O.None;Ae.INSTANCE||(Ae.INSTANCE=new Ae);let s=Ae.INSTANCE.targets.push(e);return J(s)}static ignoreTarget(e){if(!Ae.isTouchDevice())return O.None;Ae.INSTANCE||(Ae.INSTANCE=new Ae);let s=Ae.INSTANCE.ignoreTargets.push(e);return J(s)}static isTouchDevice(){return"ontouchstart"in mt||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(e){let s=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,r=e.targetTouches.length;i<r;i++){let n=e.targetTouches.item(i);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:s,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[s],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(ot.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}onTouchEnd(e,s){let i=Date.now(),r=Object.keys(this.activeTouches).length;for(let n=0,o=s.changedTouches.length;n<o;n++){let a=s.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let h=this.activeTouches[a.identifier],l=Date.now()-h.initialTimeStamp;if(l<Ae.HOLD_DELAY&&Math.abs(h.initialPageX-Fe(h.rollingPageX))<30&&Math.abs(h.initialPageY-Fe(h.rollingPageY))<30){let c=this.newGestureEvent(ot.Tap,h.initialTarget);c.pageX=Fe(h.rollingPageX),c.pageY=Fe(h.rollingPageY),this.dispatchEvent(c)}else if(l>=Ae.HOLD_DELAY&&Math.abs(h.initialPageX-Fe(h.rollingPageX))<30&&Math.abs(h.initialPageY-Fe(h.rollingPageY))<30){let c=this.newGestureEvent(ot.Contextmenu,h.initialTarget);c.pageX=Fe(h.rollingPageX),c.pageY=Fe(h.rollingPageY),this.dispatchEvent(c)}else if(r===1){let c=Fe(h.rollingPageX),d=Fe(h.rollingPageY),u=Fe(h.rollingTimestamps)-h.rollingTimestamps[0],_=c-h.rollingPageX[0],f=d-h.rollingPageY[0],p=[...this.targets].filter(m=>h.initialTarget instanceof Node&&m.contains(h.initialTarget));this.inertia(e,p,i,Math.abs(_)/u,_>0?1:-1,c,Math.abs(f)/u,f>0?1:-1,d)}this.dispatchEvent(this.newGestureEvent(ot.End,h.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(s.preventDefault(),s.stopPropagation(),this.dispatched=!1)}newGestureEvent(e,s){let i=document.createEvent("CustomEvent");return i.initEvent(e,!1,!0),i.initialTarget=s,i.tapCount=0,i}dispatchEvent(e){if(e.type===ot.Tap){let s=new Date().getTime(),i=0;s-this._lastSetTapCountTime>Ae.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=s,e.tapCount=i}else(e.type===ot.Change||e.type===ot.Contextmenu)&&(this._lastSetTapCountTime=0);if(e.initialTarget instanceof Node){for(let i of this.ignoreTargets)if(i.contains(e.initialTarget))return;let s=[];for(let i of this.targets)if(i.contains(e.initialTarget)){let r=0,n=e.initialTarget;for(;n&&n!==i;)r++,n=n.parentElement;s.push([r,i])}s.sort((i,r)=>i[0]-r[0]);for(let[i,r]of s)r.dispatchEvent(e),this.dispatched=!0}}inertia(e,s,i,r,n,o,a,h,l){this.handle=ln(e,()=>{let c=Date.now(),d=c-i,u=0,_=0,f=!0;r+=Ae.SCROLL_FRICTION*d,a+=Ae.SCROLL_FRICTION*d,r>0&&(f=!1,u=n*r*d),a>0&&(f=!1,_=h*a*d);let p=this.newGestureEvent(ot.Change);p.translationX=u,p.translationY=_,s.forEach(m=>m.dispatchEvent(p)),f||this.inertia(e,s,c,r,n,o+u,a,h,l+_)})}onTouchMove(e){let s=Date.now();for(let i=0,r=e.changedTouches.length;i<r;i++){let n=e.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],a=this.newGestureEvent(ot.Change,o.initialTarget);a.translationX=n.pageX-Fe(o.rollingPageX),a.translationY=n.pageY-Fe(o.rollingPageY),a.pageX=n.pageX,a.pageY=n.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(s)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}};vs.SCROLL_FRICTION=-.005,vs.HOLD_DELAY=700,vs.CLEAR_TAP_COUNT_TIME=400,se([oc],vs,"isTouchDevice",1);var ac=vs,hn=class extends O{onclick(e,s){this._register(M(e,ge.CLICK,i=>s(new Vs(lt(e),i))))}onmousedown(e,s){this._register(M(e,ge.MOUSE_DOWN,i=>s(new Vs(lt(e),i))))}onmouseover(e,s){this._register(M(e,ge.MOUSE_OVER,i=>s(new Vs(lt(e),i))))}onmouseleave(e,s){this._register(M(e,ge.MOUSE_LEAVE,i=>s(new Vs(lt(e),i))))}onkeydown(e,s){this._register(M(e,ge.KEY_DOWN,i=>s(new Fn(i))))}onkeyup(e,s){this._register(M(e,ge.KEY_UP,i=>s(new Fn(i))))}oninput(e,s){this._register(M(e,ge.INPUT,s))}onblur(e,s){this._register(M(e,ge.BLUR,s))}onfocus(e,s){this._register(M(e,ge.FOCUS,s))}onchange(e,s){this._register(M(e,ge.CHANGE,s))}ignoreGesture(e){return ac.ignoreTarget(e)}},Yn=11,lc=class extends hn{constructor(t){super(),this._onActivate=t.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=t.bgWidth+"px",this.bgDomNode.style.height=t.bgHeight+"px",typeof t.top<"u"&&(this.bgDomNode.style.top="0px"),typeof t.left<"u"&&(this.bgDomNode.style.left="0px"),typeof t.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof t.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=t.className,this.domNode.style.position="absolute",this.domNode.style.width=Yn+"px",this.domNode.style.height=Yn+"px",typeof t.top<"u"&&(this.domNode.style.top=t.top+"px"),typeof t.left<"u"&&(this.domNode.style.left=t.left+"px"),typeof t.bottom<"u"&&(this.domNode.style.bottom=t.bottom+"px"),typeof t.right<"u"&&(this.domNode.style.right=t.right+"px"),this._pointerMoveMonitor=this._register(new Da),this._register(Kn(this.bgDomNode,ge.POINTER_DOWN,e=>this._arrowPointerDown(e))),this._register(Kn(this.domNode,ge.POINTER_DOWN,e=>this._arrowPointerDown(e))),this._pointerdownRepeatTimer=this._register(new ic),this._pointerdownScheduleRepeatTimer=this._register(new an)}_arrowPointerDown(t){if(!t.target||!(t.target instanceof Element))return;let e=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,lt(t))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(e,200),this._pointerMoveMonitor.startMonitoring(t.target,t.pointerId,t.buttons,s=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),t.preventDefault()}},hc=class yr{constructor(e,s,i,r,n,o,a){this._forceIntegerValues=e,this._scrollStateBrand=void 0,this._forceIntegerValues&&(s=s|0,i=i|0,r=r|0,n=n|0,o=o|0,a=a|0),this.rawScrollLeft=r,this.rawScrollTop=a,s<0&&(s=0),r+s>i&&(r=i-s),r<0&&(r=0),n<0&&(n=0),a+n>o&&(a=o-n),a<0&&(a=0),this.width=s,this.scrollWidth=i,this.scrollLeft=r,this.height=n,this.scrollHeight=o,this.scrollTop=a}equals(e){return this.rawScrollLeft===e.rawScrollLeft&&this.rawScrollTop===e.rawScrollTop&&this.width===e.width&&this.scrollWidth===e.scrollWidth&&this.scrollLeft===e.scrollLeft&&this.height===e.height&&this.scrollHeight===e.scrollHeight&&this.scrollTop===e.scrollTop}withScrollDimensions(e,s){return new yr(this._forceIntegerValues,typeof e.width<"u"?e.width:this.width,typeof e.scrollWidth<"u"?e.scrollWidth:this.scrollWidth,s?this.rawScrollLeft:this.scrollLeft,typeof e.height<"u"?e.height:this.height,typeof e.scrollHeight<"u"?e.scrollHeight:this.scrollHeight,s?this.rawScrollTop:this.scrollTop)}withScrollPosition(e){return new yr(this._forceIntegerValues,this.width,this.scrollWidth,typeof e.scrollLeft<"u"?e.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof e.scrollTop<"u"?e.scrollTop:this.rawScrollTop)}createScrollEvent(e,s){let i=this.width!==e.width,r=this.scrollWidth!==e.scrollWidth,n=this.scrollLeft!==e.scrollLeft,o=this.height!==e.height,a=this.scrollHeight!==e.scrollHeight,h=this.scrollTop!==e.scrollTop;return{inSmoothScrolling:s,oldWidth:e.width,oldScrollWidth:e.scrollWidth,oldScrollLeft:e.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:e.height,oldScrollHeight:e.scrollHeight,oldScrollTop:e.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:i,scrollWidthChanged:r,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:h}}},cc=class extends O{constructor(t){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new E),this.onScroll=this._onScroll.event,this._smoothScrollDuration=t.smoothScrollDuration,this._scheduleAtNextAnimationFrame=t.scheduleAtNextAnimationFrame,this._state=new hc(t.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(t){this._smoothScrollDuration=t}validateScrollPosition(t){return this._state.withScrollPosition(t)}getScrollDimensions(){return this._state}setScrollDimensions(t,e){var i;let s=this._state.withScrollDimensions(t,e);this._setState(s,!!this._smoothScrolling),(i=this._smoothScrolling)==null||i.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(t){let e=this._state.withScrollPosition(t);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(e,!1)}setScrollPositionSmooth(t,e){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(t);if(this._smoothScrolling){t={scrollLeft:typeof t.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:t.scrollLeft,scrollTop:typeof t.scrollTop>"u"?this._smoothScrolling.to.scrollTop:t.scrollTop};let s=this._state.withScrollPosition(t);if(this._smoothScrolling.to.scrollLeft===s.scrollLeft&&this._smoothScrolling.to.scrollTop===s.scrollTop)return;let i;e?i=new jn(this._smoothScrolling.from,s,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,s,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{let s=this._state.withScrollPosition(t);this._smoothScrolling=jn.start(this._state,s,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let t=this._smoothScrolling.tick(),e=this._state.withScrollPosition(t);if(this._setState(e,!0),!!this._smoothScrolling){if(t.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(t,e){let s=this._state;s.equals(t)||(this._state=t,this._onScroll.fire(this._state.createScrollEvent(s,e)))}},Vn=class{constructor(t,e,s){this.scrollLeft=t,this.scrollTop=e,this.isDone=s}};function qi(t,e){let s=e-t;return function(i){return t+s*fc(i)}}function dc(t,e,s){return function(i){return i<s?t(i/s):e((i-s)/(1-s))}}var jn=class br{constructor(e,s,i,r){this.from=e,this.to=s,this.duration=r,this.startTime=i,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(e,s,i){if(Math.abs(e-s)>2.5*i){let r,n;return e<s?(r=e+.75*i,n=s-.75*i):(r=e-.75*i,n=s+.75*i),dc(qi(e,r),qi(n,s),.33)}return qi(e,s)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(e){this.to=e.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(e){let s=(e-this.startTime)/this.duration;if(s<1){let i=this.scrollLeft(s),r=this.scrollTop(s);return new Vn(i,r,!1)}return new Vn(this.to.scrollLeft,this.to.scrollTop,!0)}combine(e,s,i){return br.start(e,s,i)}static start(e,s,i){i=i+10;let r=Date.now()-10;return new br(e,s,r,i)}};function uc(t){return Math.pow(t,3)}function fc(t){return 1-uc(1-t)}var _c=class extends O{constructor(t,e,s){super(),this._visibility=t,this._visibleClassName=e,this._invisibleClassName=s,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new an)}setVisibility(t){this._visibility!==t&&(this._visibility=t,this._updateShouldBeVisible())}setShouldBeVisible(t){this._rawShouldBeVisible=t,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let t=this._applyVisibilitySetting();this._shouldBeVisible!==t&&(this._shouldBeVisible=t,this.ensureVisibility())}setIsNeeded(t){this._isNeeded!==t&&(this._isNeeded=t,this.ensureVisibility())}setDomNode(t){this._domNode=t,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var t;(t=this._domNode)==null||t.setClassName(this._visibleClassName)},0))}_hide(t){var e;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(e=this._domNode)==null||e.setClassName(this._invisibleClassName+(t?" fade":"")))}},pc=140,Ma=class extends hn{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new _c(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new Da),this._shouldRender=!0,this.domNode=ks(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(M(this.domNode.domNode,ge.POINTER_DOWN,s=>this._domNodePointerDown(s)))}_createArrow(e){let s=this._register(new lc(e));this.domNode.domNode.appendChild(s.bgDomNode),this.domNode.domNode.appendChild(s.domNode)}_createSlider(e,s,i,r){this.slider=ks(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(s),typeof i=="number"&&this.slider.setWidth(i),typeof r=="number"&&this.slider.setHeight(r),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(M(this.slider.domNode,ge.POINTER_DOWN,n=>{n.button===0&&(n.preventDefault(),this._sliderPointerDown(n))})),this.onclick(this.slider.domNode,n=>{n.leftButton&&n.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let s=this.domNode.domNode.getClientRects()[0].top,i=s+this._scrollbarState.getSliderPosition(),r=s+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),n=this._sliderPointerPosition(e);i<=n&&n<=r?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let s,i;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")s=e.offsetX,i=e.offsetY;else{let n=rc(this.domNode.domNode);s=e.pageX-n.left,i=e.pageY-n.top}let r=this._pointerDownRelativePosition(s,i);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(r):this._scrollbarState.getDesiredScrollPositionFromOffset(r)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let s=this._sliderPointerPosition(e),i=this._sliderOrthogonalPointerPosition(e),r=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,n=>{let o=this._sliderOrthogonalPointerPosition(n),a=Math.abs(o-i);if(Pa&&a>pc){this._setDesiredScrollPositionNow(r.getScrollPosition());return}let h=this._sliderPointerPosition(n)-s;this._setDesiredScrollPositionNow(r.getDesiredScrollPositionFromDelta(h))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let s={};this.writeScrollPosition(s,e),this._scrollable.setScrollPositionNow(s)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},Ia=class Cr{constructor(e,s,i,r,n,o){this._scrollbarSize=Math.round(s),this._oppositeScrollbarSize=Math.round(i),this._arrowSize=Math.round(e),this._visibleSize=r,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new Cr(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(e){let s=Math.round(e);return this._visibleSize!==s?(this._visibleSize=s,this._refreshComputedValues(),!0):!1}setScrollSize(e){let s=Math.round(e);return this._scrollSize!==s?(this._scrollSize=s,this._refreshComputedValues(),!0):!1}setScrollPosition(e){let s=Math.round(e);return this._scrollPosition!==s?(this._scrollPosition=s,this._refreshComputedValues(),!0):!1}setScrollbarSize(e){this._scrollbarSize=Math.round(e)}setOppositeScrollbarSize(e){this._oppositeScrollbarSize=Math.round(e)}static _computeValues(e,s,i,r,n){let o=Math.max(0,i-e),a=Math.max(0,o-2*s),h=r>0&&r>i;if(!h)return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let l=Math.round(Math.max(20,Math.floor(i*a/r))),c=(a-l)/(r-i),d=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(l),computedSliderRatio:c,computedSliderPosition:Math.round(d)}}_refreshComputedValues(){let e=Cr._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=e.computedAvailableSize,this._computedIsNeeded=e.computedIsNeeded,this._computedSliderSize=e.computedSliderSize,this._computedSliderRatio=e.computedSliderRatio,this._computedSliderPosition=e.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(e){if(!this._computedIsNeeded)return 0;let s=e-this._arrowSize-this._computedSliderSize/2;return Math.round(s/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(e){if(!this._computedIsNeeded)return 0;let s=e-this._arrowSize,i=this._scrollPosition;return s<this._computedSliderPosition?i-=this._visibleSize:i+=this._visibleSize,i}getDesiredScrollPositionFromDelta(e){if(!this._computedIsNeeded)return 0;let s=this._computedSliderPosition+e;return Math.round(s/this._computedSliderRatio)}},mc=class extends Ma{constructor(t,e,s){let i=t.getScrollDimensions(),r=t.getCurrentScrollPosition();if(super({lazyRender:e.lazyRender,host:s,scrollbarState:new Ia(e.horizontalHasArrows?e.arrowSize:0,e.horizontal===2?0:e.horizontalScrollbarSize,e.vertical===2?0:e.verticalScrollbarSize,i.width,i.scrollWidth,r.scrollLeft),visibility:e.horizontal,extraScrollbarClassName:"horizontal",scrollable:t,scrollByPage:e.scrollByPage}),e.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((e.horizontalScrollbarSize-e.horizontalSliderSize)/2),0,void 0,e.horizontalSliderSize)}_updateSlider(t,e){this.slider.setWidth(t),this.slider.setLeft(e)}_renderDomNode(t,e){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(t){return this._shouldRender=this._onElementScrollSize(t.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(t.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(t.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(t,e){return t}_sliderPointerPosition(t){return t.pageX}_sliderOrthogonalPointerPosition(t){return t.pageY}_updateScrollbarSize(t){this.slider.setHeight(t)}writeScrollPosition(t,e){t.scrollLeft=e}updateOptions(t){this.updateScrollbarSize(t.horizontal===2?0:t.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(t.vertical===2?0:t.verticalScrollbarSize),this._visibilityController.setVisibility(t.horizontal),this._scrollByPage=t.scrollByPage}},gc=class extends Ma{constructor(t,e,s){let i=t.getScrollDimensions(),r=t.getCurrentScrollPosition();if(super({lazyRender:e.lazyRender,host:s,scrollbarState:new Ia(e.verticalHasArrows?e.arrowSize:0,e.vertical===2?0:e.verticalScrollbarSize,0,i.height,i.scrollHeight,r.scrollTop),visibility:e.vertical,extraScrollbarClassName:"vertical",scrollable:t,scrollByPage:e.scrollByPage}),e.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((e.verticalScrollbarSize-e.verticalSliderSize)/2),e.verticalSliderSize,void 0)}_updateSlider(t,e){this.slider.setHeight(t),this.slider.setTop(e)}_renderDomNode(t,e){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(t){return this._shouldRender=this._onElementScrollSize(t.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(t.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(t.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(t,e){return e}_sliderPointerPosition(t){return t.pageY}_sliderOrthogonalPointerPosition(t){return t.pageX}_updateScrollbarSize(t){this.slider.setWidth(t)}writeScrollPosition(t,e){t.scrollTop=e}updateOptions(t){this.updateScrollbarSize(t.vertical===2?0:t.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(t.vertical),this._scrollByPage=t.scrollByPage}},vc=500,Xn=50,Sc=class{constructor(t,e,s){this.timestamp=t,this.deltaX=e,this.deltaY=s,this.score=0}},kr=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let e=1,s=0,i=1,r=this._rear;do{let n=r===this._front?e:Math.pow(2,-i);if(e-=n,s+=this._memory[r].score*n,r===this._front)break;r=(this._capacity+r-1)%this._capacity,i++}while(!0);return s<=.5}acceptStandardWheelEvent(e){if(nn){let s=lt(e.browserEvent),i=Rh(s);this.accept(Date.now(),e.deltaX*i,e.deltaY*i)}else this.accept(Date.now(),e.deltaX,e.deltaY)}accept(e,s,i){let r=null,n=new Sc(e,s,i);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(r=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,r)}_computeScore(e,s){if(Math.abs(e.deltaX)>0&&Math.abs(e.deltaY)>0)return 1;let i=.5;if((!this._isAlmostInt(e.deltaX)||!this._isAlmostInt(e.deltaY))&&(i+=.25),s){let r=Math.abs(e.deltaX),n=Math.abs(e.deltaY),o=Math.abs(s.deltaX),a=Math.abs(s.deltaY),h=Math.max(Math.min(r,o),1),l=Math.max(Math.min(n,a),1),c=Math.max(r,o),d=Math.max(n,a);c%h===0&&d%l===0&&(i-=.5)}return Math.min(Math.max(i,0),1)}_isAlmostInt(e){return Math.abs(Math.round(e)-e)<.01}};kr.INSTANCE=new kr;var wc=kr,yc=class extends hn{constructor(e,s,i){super(),this._onScroll=this._register(new E),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new E),this.onWillScroll=this._onWillScroll.event,this._options=Cc(s),this._scrollable=i,this._register(this._scrollable.onScroll(n=>{this._onWillScroll.fire(n),this._onDidScroll(n),this._onScroll.fire(n)}));let r={onMouseWheel:n=>this._onMouseWheel(n),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new gc(this._scrollable,this._options,r)),this._horizontalScrollbar=this._register(new mc(this._scrollable,this._options,r)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=ks(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=ks(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=ks(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,n=>this._onMouseOver(n)),this.onmouseleave(this._listenOnDomNode,n=>this._onMouseLeave(n)),this._hideTimeout=this._register(new an),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=jt(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,ht&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new $n(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=jt(this._mouseWheelToDispose),e)){let s=i=>{this._onMouseWheel(new $n(i))};this._mouseWheelToDispose.push(M(this._listenOnDomNode,ge.MOUSE_WHEEL,s,{passive:!1}))}}_onMouseWheel(e){var n;if((n=e.browserEvent)!=null&&n.defaultPrevented)return;let s=wc.INSTANCE;s.acceptStandardWheelEvent(e);let i=!1;if(e.deltaY||e.deltaX){let o=e.deltaY*this._options.mouseWheelScrollSensitivity,a=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&a+o===0?a=o=0:Math.abs(o)>=Math.abs(a)?a=0:o=0),this._options.flipAxes&&([o,a]=[a,o]);let h=!ht&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||h)&&!a&&(a=o,o=0),e.browserEvent&&e.browserEvent.altKey&&(a=a*this._options.fastScrollSensitivity,o=o*this._options.fastScrollSensitivity);let l=this._scrollable.getFutureScrollPosition(),c={};if(o){let d=Xn*o,u=l.scrollTop-(d<0?Math.floor(d):Math.ceil(d));this._verticalScrollbar.writeScrollPosition(c,u)}if(a){let d=Xn*a,u=l.scrollLeft-(d<0?Math.floor(d):Math.ceil(d));this._horizontalScrollbar.writeScrollPosition(c,u)}c=this._scrollable.validateScrollPosition(c),(l.scrollLeft!==c.scrollLeft||l.scrollTop!==c.scrollTop)&&(this._options.mouseWheelSmoothScroll&&s.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(c):this._scrollable.setScrollPositionNow(c),i=!0)}let r=i;!r&&this._options.alwaysConsumeMouseWheel&&(r=!0),!r&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(r=!0),r&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),s=e.scrollTop>0,i=e.scrollLeft>0,r=i?" left":"",n=s?" top":"",o=i||s?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${r}`),this._topShadowDomNode.setClassName(`shadow${n}`),this._topLeftShadowDomNode.setClassName(`shadow${o}${n}${r}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),vc)}},bc=class extends yc{constructor(t,e,s){super(t,e,s)}setScrollPosition(t){t.reuseAnimation?this._scrollable.setScrollPositionSmooth(t,t.reuseAnimation):this._scrollable.setScrollPositionNow(t)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function Cc(t){let e={lazyRender:typeof t.lazyRender<"u"?t.lazyRender:!1,className:typeof t.className<"u"?t.className:"",useShadows:typeof t.useShadows<"u"?t.useShadows:!0,handleMouseWheel:typeof t.handleMouseWheel<"u"?t.handleMouseWheel:!0,flipAxes:typeof t.flipAxes<"u"?t.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof t.consumeMouseWheelIfScrollbarIsNeeded<"u"?t.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof t.alwaysConsumeMouseWheel<"u"?t.alwaysConsumeMouseWheel:!1,scrollYToX:typeof t.scrollYToX<"u"?t.scrollYToX:!1,mouseWheelScrollSensitivity:typeof t.mouseWheelScrollSensitivity<"u"?t.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof t.fastScrollSensitivity<"u"?t.fastScrollSensitivity:5,scrollPredominantAxis:typeof t.scrollPredominantAxis<"u"?t.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof t.mouseWheelSmoothScroll<"u"?t.mouseWheelSmoothScroll:!0,arrowSize:typeof t.arrowSize<"u"?t.arrowSize:11,listenOnDomNode:typeof t.listenOnDomNode<"u"?t.listenOnDomNode:null,horizontal:typeof t.horizontal<"u"?t.horizontal:1,horizontalScrollbarSize:typeof t.horizontalScrollbarSize<"u"?t.horizontalScrollbarSize:10,horizontalSliderSize:typeof t.horizontalSliderSize<"u"?t.horizontalSliderSize:0,horizontalHasArrows:typeof t.horizontalHasArrows<"u"?t.horizontalHasArrows:!1,vertical:typeof t.vertical<"u"?t.vertical:1,verticalScrollbarSize:typeof t.verticalScrollbarSize<"u"?t.verticalScrollbarSize:10,verticalHasArrows:typeof t.verticalHasArrows<"u"?t.verticalHasArrows:!1,verticalSliderSize:typeof t.verticalSliderSize<"u"?t.verticalSliderSize:0,scrollByPage:typeof t.scrollByPage<"u"?t.scrollByPage:!1};return e.horizontalSliderSize=typeof t.horizontalSliderSize<"u"?t.horizontalSliderSize:e.horizontalScrollbarSize,e.verticalSliderSize=typeof t.verticalSliderSize<"u"?t.verticalSliderSize:e.verticalScrollbarSize,ht&&(e.className+=" mac"),e}var xr=class extends O{constructor(e,s,i,r,n,o,a,h){super(),this._bufferService=i,this._optionsService=a,this._renderService=h,this._onRequestScrollLines=this._register(new E),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let l=this._register(new cc({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:c=>ln(r.window,c)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{l.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new bc(s,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},l)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(n.onProtocolChange(c=>{this._scrollableElement.updateOptions({handleMouseWheel:!(c&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(Pe.runAndSubscribe(o.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=o.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(J(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=r.mainDocument.createElement("style"),s.appendChild(this._styleElement),this._register(J(()=>this._styleElement.remove())),this._register(Pe.runAndSubscribe(o.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${o.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${o.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${o.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(c=>this._handleScroll(c)))}scrollLines(e){let s=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:s.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,s){s&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!s,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:((e=this._optionsService.rawOptions.overviewRuler)==null?void 0:e.width)||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let s=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),i=s-this._bufferService.buffer.ydisp;i!==0&&(this._latestYDisp=s,this._onRequestScrollLines.fire(i)),this._isHandlingScroll=!1}};xr=se([R(2,Te),R(3,wt),R(4,_a),R(5,os),R(6,Oe),R(7,yt)],xr);var Er=class extends O{constructor(e,s,i,r,n){super(),this._screenElement=e,this._bufferService=s,this._coreBrowserService=i,this._decorationService=r,this._renderService=n,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(o=>this._removeDecoration(o))),this._register(J(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var r;let s=this._coreBrowserService.mainDocument.createElement("div");s.classList.add("xterm-decoration"),s.classList.toggle("xterm-decoration-top-layer",((r=e==null?void 0:e.options)==null?void 0:r.layer)==="top"),s.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,s.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let i=e.options.x??0;return i&&i>this._bufferService.cols&&(s.style.display="none"),this._refreshXPosition(e,s),s}_refreshStyle(e){let s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i),e.onDispose(()=>{this._decorationElements.delete(e),i.remove()})),i.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,i.style.top=`${s*this._renderService.dimensions.css.cell.height}px`,i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(i)}}_refreshXPosition(e,s=e.element){if(!s)return;let i=e.options.x??0;(e.options.anchor||"left")==="right"?s.style.right=i?`${i*this._renderService.dimensions.css.cell.width}px`:"":s.style.left=i?`${i*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))==null||s.remove(),this._decorationElements.delete(e),e.dispose()}};Er=se([R(1,Te),R(2,wt),R(3,Ws),R(4,yt)],Er);var kc=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(t){if(t.options.overviewRulerOptions){for(let e of this._zones)if(e.color===t.options.overviewRulerOptions.color&&e.position===t.options.overviewRulerOptions.position){if(this._lineIntersectsZone(e,t.marker.line))return;if(this._lineAdjacentToZone(e,t.marker.line,t.options.overviewRulerOptions.position)){this._addLineToZone(e,t.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=t.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=t.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=t.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=t.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:t.options.overviewRulerOptions.color,position:t.options.overviewRulerOptions.position,startBufferLine:t.marker.line,endBufferLine:t.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(t){this._linePadding=t}_lineIntersectsZone(t,e){return e>=t.startBufferLine&&e<=t.endBufferLine}_lineAdjacentToZone(t,e,s){return e>=t.startBufferLine-this._linePadding[s||"full"]&&e<=t.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(t,e){t.startBufferLine=Math.min(t.startBufferLine,e),t.endBufferLine=Math.max(t.endBufferLine,e)}},it={full:0,left:0,center:0,right:0},Ct={full:0,left:0,center:0,right:0},ls={full:0,left:0,center:0,right:0},vi=class extends O{constructor(e,s,i,r,n,o,a,h){var c;super(),this._viewportElement=e,this._screenElement=s,this._bufferService=i,this._decorationService=r,this._renderService=n,this._optionsService=o,this._themeService=a,this._coreBrowserService=h,this._colorZoneStore=new kc,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(c=this._viewportElement.parentElement)==null||c.insertBefore(this._canvas,this._viewportElement),this._register(J(()=>{var d;return(d=this._canvas)==null?void 0:d.remove()}));let l=this._canvas.getContext("2d");if(l)this._ctx=l;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){var e;return((e=this._optionsService.options.overviewRuler)==null?void 0:e.width)||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),s=Math.ceil((this._canvas.width-1)/3);Ct.full=this._canvas.width,Ct.left=e,Ct.center=s,Ct.right=e,this._refreshDrawHeightConstants(),ls.full=1,ls.left=1,ls.center=1+Ct.left,ls.right=1+Ct.left+Ct.center}_refreshDrawHeightConstants(){it.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,s=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);it.left=s,it.center=s,it.right=s}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*it.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*it.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*it.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*it.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let s of this._decorationService.decorations)this._colorZoneStore.addDecoration(s);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let s of e)s.position!=="full"&&this._renderColorZone(s);for(let s of e)s.position==="full"&&this._renderColorZone(s);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(ls[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-it[e.position||"full"]/2),Ct[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+it[e.position||"full"]))}_queueRefresh(e,s){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=s||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};vi=se([R(2,Te),R(3,Ws),R(4,yt),R(5,Oe),R(6,os),R(7,wt)],vi);var g;(t=>(t.NUL="\0",t.SOH="",t.STX="",t.ETX="",t.EOT="",t.ENQ="",t.ACK="",t.BEL="\x07",t.BS="\b",t.HT="	",t.LF=`
`,t.VT="\v",t.FF="\f",t.CR="\r",t.SO="",t.SI="",t.DLE="",t.DC1="",t.DC2="",t.DC3="",t.DC4="",t.NAK="",t.SYN="",t.ETB="",t.CAN="",t.EM="",t.SUB="",t.ESC="\x1B",t.FS="",t.GS="",t.RS="",t.US="",t.SP=" ",t.DEL=""))(g||(g={}));var di;(t=>(t.PAD="",t.HOP="",t.BPH="",t.NBH="",t.IND="",t.NEL="",t.SSA="",t.ESA="",t.HTS="",t.HTJ="",t.VTS="",t.PLD="",t.PLU="",t.RI="",t.SS2="",t.SS3="",t.DCS="",t.PU1="",t.PU2="",t.STS="",t.CCH="",t.MW="",t.SPA="",t.EPA="",t.SOS="",t.SGCI="",t.SCI="",t.CSI="",t.ST="",t.OSC="",t.PM="",t.APC=""))(di||(di={}));var Ta;(t=>t.ST=`${g.ESC}\\`)(Ta||(Ta={}));var Br=class{constructor(e,s,i,r,n,o){this._textarea=e,this._compositionView=s,this._bufferService=i,this._optionsService=r,this._coreService=n,this._renderService=o,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let s={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let i;s.start+=this._dataAlreadySent.length,this._isComposing?i=this._textarea.value.substring(s.start,this._compositionPosition.start):i=this._textarea.value.substring(s.start),i.length>0&&this._coreService.triggerDataEvent(i,!0)}},0)}else{this._isSendingComposition=!1;let s=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(s,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let s=this._textarea.value,i=s.replace(e,"");this._dataAlreadySent=i,s.length>e.length?this._coreService.triggerDataEvent(i,!0):s.length<e.length?this._coreService.triggerDataEvent(`${g.DEL}`,!0):s.length===e.length&&s!==e&&this._coreService.triggerDataEvent(s,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let s=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),i=this._renderService.dimensions.css.cell.height,r=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,n=s*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=n+"px",this._compositionView.style.top=r+"px",this._compositionView.style.height=i+"px",this._compositionView.style.lineHeight=i+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let o=this._compositionView.getBoundingClientRect();this._textarea.style.left=n+"px",this._textarea.style.top=r+"px",this._textarea.style.width=Math.max(o.width,1)+"px",this._textarea.style.height=Math.max(o.height,1)+"px",this._textarea.style.lineHeight=o.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};Br=se([R(2,Te),R(3,Oe),R(4,Gt),R(5,yt)],Br);var ve=0,Se=0,we=0,ee=0,Gn={css:"#00000000",rgba:0},le;(t=>{function e(r,n,o,a){return a!==void 0?`#${Tt(r)}${Tt(n)}${Tt(o)}${Tt(a)}`:`#${Tt(r)}${Tt(n)}${Tt(o)}`}t.toCss=e;function s(r,n,o,a=255){return(r<<24|n<<16|o<<8|a)>>>0}t.toRgba=s;function i(r,n,o,a){return{css:t.toCss(r,n,o,a),rgba:t.toRgba(r,n,o,a)}}t.toColor=i})(le||(le={}));var V;(t=>{function e(h,l){if(ee=(l.rgba&255)/255,ee===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,d=l.rgba>>16&255,u=l.rgba>>8&255,_=h.rgba>>24&255,f=h.rgba>>16&255,p=h.rgba>>8&255;ve=_+Math.round((c-_)*ee),Se=f+Math.round((d-f)*ee),we=p+Math.round((u-p)*ee);let m=le.toCss(ve,Se,we),S=le.toRgba(ve,Se,we);return{css:m,rgba:S}}t.blend=e;function s(h){return(h.rgba&255)===255}t.isOpaque=s;function i(h,l,c){let d=ui.ensureContrastRatio(h.rgba,l.rgba,c);if(d)return le.toColor(d>>24&255,d>>16&255,d>>8&255)}t.ensureContrastRatio=i;function r(h){let l=(h.rgba|255)>>>0;return[ve,Se,we]=ui.toChannels(l),{css:le.toCss(ve,Se,we),rgba:l}}t.opaque=r;function n(h,l){return ee=Math.round(l*255),[ve,Se,we]=ui.toChannels(h.rgba),{css:le.toCss(ve,Se,we,ee),rgba:le.toRgba(ve,Se,we,ee)}}t.opacity=n;function o(h,l){return ee=h.rgba&255,n(h,ee*l/255)}t.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}t.toColorRGB=a})(V||(V={}));var Q;(t=>{let e,s;try{let r=document.createElement("canvas");r.width=1,r.height=1;let n=r.getContext("2d",{willReadFrequently:!0});n&&(e=n,e.globalCompositeOperation="copy",s=e.createLinearGradient(0,0,1,1))}catch{}function i(r){if(r.match(/#[\da-f]{3,8}/i))switch(r.length){case 4:return ve=parseInt(r.slice(1,2).repeat(2),16),Se=parseInt(r.slice(2,3).repeat(2),16),we=parseInt(r.slice(3,4).repeat(2),16),le.toColor(ve,Se,we);case 5:return ve=parseInt(r.slice(1,2).repeat(2),16),Se=parseInt(r.slice(2,3).repeat(2),16),we=parseInt(r.slice(3,4).repeat(2),16),ee=parseInt(r.slice(4,5).repeat(2),16),le.toColor(ve,Se,we,ee);case 7:return{css:r,rgba:(parseInt(r.slice(1),16)<<8|255)>>>0};case 9:return{css:r,rgba:parseInt(r.slice(1),16)>>>0}}let n=r.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return ve=parseInt(n[1]),Se=parseInt(n[2]),we=parseInt(n[3]),ee=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),le.toColor(ve,Se,we,ee);if(!e||!s)throw new Error("css.toColor: Unsupported css format");if(e.fillStyle=s,e.fillStyle=r,typeof e.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(e.fillRect(0,0,1,1),[ve,Se,we,ee]=e.getImageData(0,0,1,1).data,ee!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:le.toRgba(ve,Se,we,ee),css:r}}t.toColor=i})(Q||(Q={}));var Me;(t=>{function e(i){return s(i>>16&255,i>>8&255,i&255)}t.relativeLuminance=e;function s(i,r,n){let o=i/255,a=r/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),d=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+d*.0722}t.relativeLuminance2=s})(Me||(Me={}));var ui;(t=>{function e(o,a){if(ee=(a&255)/255,ee===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,d=o>>24&255,u=o>>16&255,_=o>>8&255;return ve=d+Math.round((h-d)*ee),Se=u+Math.round((l-u)*ee),we=_+Math.round((c-_)*ee),le.toRgba(ve,Se,we)}t.blend=e;function s(o,a,h){let l=Me.relativeLuminance(o>>8),c=Me.relativeLuminance(a>>8);if(dt(l,c)<h){if(c<l){let _=i(o,a,h),f=dt(l,Me.relativeLuminance(_>>8));if(f<h){let p=r(o,a,h),m=dt(l,Me.relativeLuminance(p>>8));return f>m?_:p}return _}let d=r(o,a,h),u=dt(l,Me.relativeLuminance(d>>8));if(u<h){let _=i(o,a,h),f=dt(l,Me.relativeLuminance(_>>8));return u>f?d:_}return d}}t.ensureContrastRatio=s;function i(o,a,h){let l=o>>24&255,c=o>>16&255,d=o>>8&255,u=a>>24&255,_=a>>16&255,f=a>>8&255,p=dt(Me.relativeLuminance2(u,_,f),Me.relativeLuminance2(l,c,d));for(;p<h&&(u>0||_>0||f>0);)u-=Math.max(0,Math.ceil(u*.1)),_-=Math.max(0,Math.ceil(_*.1)),f-=Math.max(0,Math.ceil(f*.1)),p=dt(Me.relativeLuminance2(u,_,f),Me.relativeLuminance2(l,c,d));return(u<<24|_<<16|f<<8|255)>>>0}t.reduceLuminance=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,d=o>>8&255,u=a>>24&255,_=a>>16&255,f=a>>8&255,p=dt(Me.relativeLuminance2(u,_,f),Me.relativeLuminance2(l,c,d));for(;p<h&&(u<255||_<255||f<255);)u=Math.min(255,u+Math.ceil((255-u)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),f=Math.min(255,f+Math.ceil((255-f)*.1)),p=dt(Me.relativeLuminance2(u,_,f),Me.relativeLuminance2(l,c,d));return(u<<24|_<<16|f<<8|255)>>>0}t.increaseLuminance=r;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}t.toChannels=n})(ui||(ui={}));function Tt(t){let e=t.toString(16);return e.length<2?"0"+e:e}function dt(t,e){return t<e?(e+.05)/(t+.05):(t+.05)/(e+.05)}var xc=class extends Fs{constructor(t,e,s){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=e,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Si=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new Ge}register(e){let s={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(s),s.id}deregister(e){for(let s=0;s<this._characterJoiners.length;s++)if(this._characterJoiners[s].id===e)return this._characterJoiners.splice(s,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let s=this._bufferService.buffer.lines.get(e);if(!s||s.length===0)return[];let i=[],r=s.translateToString(!0),n=0,o=0,a=0,h=s.getFg(0),l=s.getBg(0);for(let c=0;c<s.getTrimmedLength();c++)if(s.loadCell(c,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==h||this._workCell.bg!==l){if(c-n>1){let d=this._getJoinedRanges(r,a,o,s,n);for(let u=0;u<d.length;u++)i.push(d[u])}n=c,a=o,h=this._workCell.fg,l=this._workCell.bg}o+=this._workCell.getChars().length||Bt.length}if(this._bufferService.cols-n>1){let c=this._getJoinedRanges(r,a,o,s,n);for(let d=0;d<c.length;d++)i.push(c[d])}return i}_getJoinedRanges(e,s,i,r,n){let o=e.substring(s,i),a=[];try{a=this._characterJoiners[0].handler(o)}catch(h){console.error(h)}for(let h=1;h<this._characterJoiners.length;h++)try{let l=this._characterJoiners[h].handler(o);for(let c=0;c<l.length;c++)Si._mergeRanges(a,l[c])}catch(l){console.error(l)}return this._stringRangesToCellRanges(a,r,n),a}_stringRangesToCellRanges(e,s,i){let r=0,n=!1,o=0,a=e[r];if(a){for(let h=i;h<this._bufferService.cols;h++){let l=s.getWidth(h),c=s.getString(h).length||Bt.length;if(l!==0){if(!n&&a[0]<=o&&(a[0]=h,n=!0),a[1]<=o){if(a[1]=h,a=e[++r],!a)break;a[0]<=o?(a[0]=h,n=!0):n=!1}o+=c}}a&&(a[1]=this._bufferService.cols)}}static _mergeRanges(e,s){let i=!1;for(let r=0;r<e.length;r++){let n=e[r];if(i){if(s[1]<=n[0])return e[r-1][1]=s[1],e;if(s[1]<=n[1])return e[r-1][1]=Math.max(s[1],n[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(s[1]<=n[0])return e.splice(r,0,s),e;if(s[1]<=n[1])return n[0]=Math.min(s[0],n[0]),e;s[0]<n[1]&&(n[0]=Math.min(s[0],n[0]),i=!0);continue}}return i?e[e.length-1][1]=s[1]:e.push(s),e}};Si=se([R(0,Te)],Si);function Ec(t){return 57508<=t&&t<=57558}function Bc(t){return 9472<=t&&t<=9631}function Pc(t){return Ec(t)||Bc(t)}function Lc(){return{css:{canvas:js(),cell:js()},device:{canvas:js(),cell:js(),char:{width:0,height:0,left:0,top:0}}}}function js(){return{width:0,height:0}}var Pr=class{constructor(t,e,s,i,r,n,o){this._document=t,this._characterJoinerService=e,this._optionsService=s,this._coreBrowserService=i,this._coreService=r,this._decorationService=n,this._themeService=o,this._workCell=new Ge,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(t,e,s){this._selectionStart=t,this._selectionEnd=e,this._columnSelectMode=s}createRow(t,e,s,i,r,n,o,a,h,l,c){let d=[],u=this._characterJoinerService.getJoinedCharacters(e),_=this._themeService.colors,f=t.getNoBgTrimmedLength();s&&f<n+1&&(f=n+1);let p,m=0,S="",y=0,w=0,C=0,L=0,A=!1,z=0,j=!1,W=0,xe=0,F=[],P=l!==-1&&c!==-1;for(let v=0;v<f;v++){t.loadCell(v,this._workCell);let b=this._workCell.getWidth();if(b===0)continue;let k=!1,B=v>=xe,D=v,x=this._workCell;if(u.length>0&&v===u[0][0]&&B){let $=u.shift(),Zt=this._isCellInSelection($[0],e);for(y=$[0]+1;y<$[1];y++)B&&(B=Zt===this._isCellInSelection(y,e));B&&(B=!s||n<$[0]||n>=$[1]),B?(k=!0,x=new xc(this._workCell,t.translateToString(!0,$[0],$[1]),$[1]-$[0]),D=$[1]-1,b=x.getWidth()):xe=$[1]}let I=this._isCellInSelection(v,e),N=s&&v===n,Y=P&&v>=l&&v<=c,X=!1;this._decorationService.forEachDecorationAtCell(v,e,void 0,$=>{X=!0});let ie=x.getChars()||Bt;if(ie===" "&&(x.isUnderline()||x.isOverline())&&(ie=""),W=b*a-h.get(ie,x.isBold(),x.isItalic()),!p)p=this._document.createElement("span");else if(m&&(I&&j||!I&&!j&&x.bg===w)&&(I&&j&&_.selectionForeground||x.fg===C)&&x.extended.ext===L&&Y===A&&W===z&&!N&&!k&&!X&&B){x.isInvisible()?S+=Bt:S+=ie,m++;continue}else m&&(p.textContent=S),p=this._document.createElement("span"),m=0,S="";if(w=x.bg,C=x.fg,L=x.extended.ext,A=Y,z=W,j=I,k&&n>=v&&n<=D&&(n=v),!this._coreService.isCursorHidden&&N&&this._coreService.isCursorInitialized){if(F.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&F.push("xterm-cursor-blink"),F.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(r)switch(r){case"outline":F.push("xterm-cursor-outline");break;case"block":F.push("xterm-cursor-block");break;case"bar":F.push("xterm-cursor-bar");break;case"underline":F.push("xterm-cursor-underline");break}}if(x.isBold()&&F.push("xterm-bold"),x.isItalic()&&F.push("xterm-italic"),x.isDim()&&F.push("xterm-dim"),x.isInvisible()?S=Bt:S=x.getChars()||Bt,x.isUnderline()&&(F.push(`xterm-underline-${x.extended.underlineStyle}`),S===" "&&(S=""),!x.isUnderlineColorDefault()))if(x.isUnderlineColorRGB())p.style.textDecorationColor=`rgb(${Fs.toColorRGB(x.getUnderlineColor()).join(",")})`;else{let $=x.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&x.isBold()&&$<8&&($+=8),p.style.textDecorationColor=_.ansi[$].css}x.isOverline()&&(F.push("xterm-overline"),S===" "&&(S="")),x.isStrikethrough()&&F.push("xterm-strikethrough"),Y&&(p.style.textDecoration="underline");let re=x.getFgColor(),Le=x.getFgColorMode(),ce=x.getBgColor(),Ne=x.getBgColorMode(),tt=!!x.isInverse();if(tt){let $=re;re=ce,ce=$;let Zt=Le;Le=Ne,Ne=Zt}let H,Re,It=!1;this._decorationService.forEachDecorationAtCell(v,e,void 0,$=>{$.options.layer!=="top"&&It||($.backgroundColorRGB&&(Ne=50331648,ce=$.backgroundColorRGB.rgba>>8&16777215,H=$.backgroundColorRGB),$.foregroundColorRGB&&(Le=50331648,re=$.foregroundColorRGB.rgba>>8&16777215,Re=$.foregroundColorRGB),It=$.options.layer==="top")}),!It&&I&&(H=this._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque,ce=H.rgba>>8&16777215,Ne=50331648,It=!0,_.selectionForeground&&(Le=50331648,re=_.selectionForeground.rgba>>8&16777215,Re=_.selectionForeground)),It&&F.push("xterm-decoration-top");let st;switch(Ne){case 16777216:case 33554432:st=_.ansi[ce],F.push(`xterm-bg-${ce}`);break;case 50331648:st=le.toColor(ce>>16,ce>>8&255,ce&255),this._addStyle(p,`background-color:#${Jn((ce>>>0).toString(16),"0",6)}`);break;case 0:default:tt?(st=_.foreground,F.push("xterm-bg-257")):st=_.background}switch(H||x.isDim()&&(H=V.multiplyOpacity(st,.5)),Le){case 16777216:case 33554432:x.isBold()&&re<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(re+=8),this._applyMinimumContrast(p,st,_.ansi[re],x,H,void 0)||F.push(`xterm-fg-${re}`);break;case 50331648:let $=le.toColor(re>>16&255,re>>8&255,re&255);this._applyMinimumContrast(p,st,$,x,H,Re)||this._addStyle(p,`color:#${Jn(re.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(p,st,_.foreground,x,H,Re)||tt&&F.push("xterm-fg-257")}F.length&&(p.className=F.join(" "),F.length=0),!N&&!k&&!X&&B?m++:p.textContent=S,W!==this.defaultSpacing&&(p.style.letterSpacing=`${W}px`),d.push(p),v=D}return p&&m&&(p.textContent=S),d}_applyMinimumContrast(t,e,s,i,r,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||Pc(i.getCode()))return!1;let o=this._getContrastCache(i),a;if(!r&&!n&&(a=o.getColor(e.rgba,s.rgba)),a===void 0){let h=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);a=V.ensureContrastRatio(r||e,n||s,h),o.setColor((r||e).rgba,(n||s).rgba,a??null)}return a?(this._addStyle(t,`color:${a.css}`),!0):!1}_getContrastCache(t){return t.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(t,e){t.setAttribute("style",`${t.getAttribute("style")||""}${e};`)}_isCellInSelection(t,e){let s=this._selectionStart,i=this._selectionEnd;return!s||!i?!1:this._columnSelectMode?s[0]<=i[0]?t>=s[0]&&e>=s[1]&&t<i[0]&&e<=i[1]:t<s[0]&&e>=s[1]&&t>=i[0]&&e<=i[1]:e>s[1]&&e<i[1]||s[1]===i[1]&&e===s[1]&&t>=s[0]&&t<i[0]||s[1]<i[1]&&e===i[1]&&t<i[0]||s[1]<i[1]&&e===s[1]&&t>=s[0]}};Pr=se([R(1,ga),R(2,Oe),R(3,wt),R(4,Gt),R(5,Ws),R(6,os)],Pr);function Jn(t,e,s){for(;t.length<s;)t=e+t;return t}var Rc=class{constructor(t,e){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=t.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let s=t.createElement("span");s.classList.add("xterm-char-measure-element");let i=t.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontWeight="bold";let r=t.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontStyle="italic";let n=t.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[s,i,r,n],this._container.appendChild(s),this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(n),e.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(t,e,s,i){t===this._font&&e===this._fontSize&&s===this._weight&&i===this._weightBold||(this._font=t,this._fontSize=e,this._weight=s,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${s}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${s}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(t,e,s){let i=0;if(!e&&!s&&t.length===1&&(i=t.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];let o=this._measure(t,0);return o>0&&(this._flat[i]=o),o}let r=t;e&&(r+="B"),s&&(r+="I");let n=this._holey.get(r);if(n===void 0){let o=0;e&&(o|=1),s&&(o|=2),n=this._measure(t,o),n>0&&this._holey.set(r,n)}return n}_measure(t,e){let s=this._measureElements[e];return s.textContent=t.repeat(32),s.offsetWidth/32}},Ac=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,s,i,r=!1){if(this.selectionStart=s,this.selectionEnd=i,!s||!i||s[0]===i[0]&&s[1]===i[1]){this.clear();return}let n=e.buffers.active.ydisp,o=s[1]-n,a=i[1]-n,h=Math.max(o,0),l=Math.min(a,e.rows-1);if(h>=e.rows||l<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=o,this.viewportEndRow=a,this.viewportCappedStartRow=h,this.viewportCappedEndRow=l,this.startCol=s[0],this.endCol=i[0]}isCellSelected(e,s,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?s>=this.startCol&&i>=this.viewportCappedStartRow&&s<this.endCol&&i<=this.viewportCappedEndRow:s<this.startCol&&i>=this.viewportCappedStartRow&&s>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&s>=this.startCol&&s<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&s<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&s>=this.startCol):!1}};function Dc(){return new Ac}var Yi="xterm-dom-renderer-owner-",Ue="xterm-rows",Xs="xterm-fg-",Zn="xterm-bg-",hs="xterm-focus",Gs="xterm-selection",Mc=1,Lr=class extends O{constructor(e,s,i,r,n,o,a,h,l,c,d,u,_,f){super(),this._terminal=e,this._document=s,this._element=i,this._screenElement=r,this._viewportElement=n,this._helperContainer=o,this._linkifier2=a,this._charSizeService=l,this._optionsService=c,this._bufferService=d,this._coreService=u,this._coreBrowserService=_,this._themeService=f,this._terminalClass=Mc++,this._rowElements=[],this._selectionRenderModel=Dc(),this.onRequestRedraw=this._register(new E).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(Ue),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(Gs),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Lc(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(p=>this._injectCss(p))),this._injectCss(this._themeService.colors),this._rowFactory=h.createInstance(Pr,document),this._element.classList.add(Yi+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(p=>this._handleLinkHover(p))),this._register(this._linkifier2.onHideLinkUnderline(p=>this._handleLinkLeave(p))),this._register(J(()=>{this._element.classList.remove(Yi+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Rc(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let i of this._rowElements)i.style.width=`${this.dimensions.css.canvas.width}px`,i.style.height=`${this.dimensions.css.cell.height}px`,i.style.lineHeight=`${this.dimensions.css.cell.height}px`,i.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let s=`${this._terminalSelector} .${Ue} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=s,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let s=`${this._terminalSelector} .${Ue} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;s+=`${this._terminalSelector} .${Ue} .xterm-dim { color: ${V.multiplyOpacity(e.foreground,.5).css};}`,s+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let i=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,n=`blink_block_${this._terminalClass}`;s+=`@keyframes ${i} { 50% {  border-bottom-style: hidden; }}`,s+=`@keyframes ${r} { 50% {  box-shadow: none; }}`,s+=`@keyframes ${n} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,s+=`${this._terminalSelector} .${Ue}.${hs} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${Ue}.${hs} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${Ue}.${hs} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${n} 1s step-end infinite;}${this._terminalSelector} .${Ue} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${Ue} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${Ue} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${Ue} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${Ue} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,s+=`${this._terminalSelector} .${Gs} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Gs} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Gs} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[o,a]of e.ansi.entries())s+=`${this._terminalSelector} .${Xs}${o} { color: ${a.css}; }${this._terminalSelector} .${Xs}${o}.xterm-dim { color: ${V.multiplyOpacity(a,.5).css}; }${this._terminalSelector} .${Zn}${o} { background-color: ${a.css}; }`;s+=`${this._terminalSelector} .${Xs}257 { color: ${V.opaque(e.background).css}; }${this._terminalSelector} .${Xs}257.xterm-dim { color: ${V.multiplyOpacity(V.opaque(e.background),.5).css}; }${this._terminalSelector} .${Zn}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=s}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,s){for(let i=this._rowElements.length;i<=s;i++){let r=this._document.createElement("div");this._rowContainer.appendChild(r),this._rowElements.push(r)}for(;this._rowElements.length>s;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,s){this._refreshRowElements(e,s),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(hs),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(hs),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,s,i){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,s,i),this.renderRows(0,this._bufferService.rows-1),!e||!s||(this._selectionRenderModel.update(this._terminal,e,s,i),!this._selectionRenderModel.hasSelection))return;let r=this._selectionRenderModel.viewportStartRow,n=this._selectionRenderModel.viewportEndRow,o=this._selectionRenderModel.viewportCappedStartRow,a=this._selectionRenderModel.viewportCappedEndRow,h=this._document.createDocumentFragment();if(i){let l=e[0]>s[0];h.appendChild(this._createSelectionElement(o,l?s[0]:e[0],l?e[0]:s[0],a-o+1))}else{let l=r===o?e[0]:0,c=o===n?s[0]:this._bufferService.cols;h.appendChild(this._createSelectionElement(o,l,c));let d=a-o-1;if(h.appendChild(this._createSelectionElement(o+1,0,this._bufferService.cols,d)),o!==a){let u=n===a?s[0]:this._bufferService.cols;h.appendChild(this._createSelectionElement(a,0,u))}}this._selectionContainer.appendChild(h)}_createSelectionElement(e,s,i,r=1){let n=this._document.createElement("div"),o=s*this.dimensions.css.cell.width,a=this.dimensions.css.cell.width*(i-s);return o+a>this.dimensions.css.canvas.width&&(a=this.dimensions.css.canvas.width-o),n.style.height=`${r*this.dimensions.css.cell.height}px`,n.style.top=`${e*this.dimensions.css.cell.height}px`,n.style.left=`${o}px`,n.style.width=`${a}px`,n}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,s){let i=this._bufferService.buffer,r=i.ybase+i.y,n=Math.min(i.x,this._bufferService.cols-1),o=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,a=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,h=this._optionsService.rawOptions.cursorInactiveStyle;for(let l=e;l<=s;l++){let c=l+i.ydisp,d=this._rowElements[l],u=i.lines.get(c);if(!d||!u)break;d.replaceChildren(...this._rowFactory.createRow(u,c,c===r,a,h,n,o,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${Yi}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,s,i,r,n,o){i<0&&(e=0),r<0&&(s=0);let a=this._bufferService.rows-1;i=Math.max(Math.min(i,a),0),r=Math.max(Math.min(r,a),0),n=Math.min(n,this._bufferService.cols);let h=this._bufferService.buffer,l=h.ybase+h.y,c=Math.min(h.x,n-1),d=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,_=this._optionsService.rawOptions.cursorInactiveStyle;for(let f=i;f<=r;++f){let p=f+h.ydisp,m=this._rowElements[f],S=h.lines.get(p);if(!m||!S)break;m.replaceChildren(...this._rowFactory.createRow(S,p,p===l,u,_,c,d,this.dimensions.css.cell.width,this._widthCache,o?f===i?e:0:-1,o?(f===r?s:n)-1:-1))}}};Lr=se([R(7,tn),R(8,Mi),R(9,Oe),R(10,Te),R(11,Gt),R(12,wt),R(13,os)],Lr);var Rr=class extends O{constructor(e,s,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this._register(new E),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new Tc(this._optionsService))}catch{this._measureStrategy=this._register(new Ic(e,s,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};Rr=se([R(2,Oe)],Rr);var Oa=class extends O{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(t,e){t!==void 0&&t>0&&e!==void 0&&e>0&&(this._result.width=t,this._result.height=e)}},Ic=class extends Oa{constructor(t,e,s){super(),this._document=t,this._parentElement=e,this._optionsService=s,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},Tc=class extends Oa{constructor(t){super(),this._optionsService=t,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let e=this._ctx.measureText("W");if(!("width"in e&&"fontBoundingBoxAscent"in e&&"fontBoundingBoxDescent"in e))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let t=this._ctx.measureText("W");return this._validateAndSet(t.width,t.fontBoundingBoxAscent+t.fontBoundingBoxDescent),this._result}},Oc=class extends O{constructor(t,e,s){super(),this._textarea=t,this._window=e,this.mainDocument=s,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new Nc(this._window)),this._onDprChange=this._register(new E),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new E),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(i=>this._screenDprMonitor.setWindow(i))),this._register(Pe.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(M(this._textarea,"focus",()=>this._isFocused=!0)),this._register(M(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(t){this._window!==t&&(this._window=t,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},Nc=class extends O{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new rs),this._onDprChange=this._register(new E),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(J(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=M(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var e;this._outerListener&&((e=this._resolutionMediaMatchList)==null||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},Hc=class extends O{constructor(){super(),this.linkProviders=[],this._register(J(()=>this.linkProviders.length=0))}registerLinkProvider(t){return this.linkProviders.push(t),{dispose:()=>{let e=this.linkProviders.indexOf(t);e!==-1&&this.linkProviders.splice(e,1)}}}};function cn(t,e,s){let i=s.getBoundingClientRect(),r=t.getComputedStyle(s),n=parseInt(r.getPropertyValue("padding-left")),o=parseInt(r.getPropertyValue("padding-top"));return[e.clientX-i.left-n,e.clientY-i.top-o]}function zc(t,e,s,i,r,n,o,a,h){if(!n)return;let l=cn(t,e,s);if(l)return l[0]=Math.ceil((l[0]+(h?o/2:0))/o),l[1]=Math.ceil(l[1]/a),l[0]=Math.min(Math.max(l[0],1),i+(h?1:0)),l[1]=Math.min(Math.max(l[1],1),r),l}var Ar=class{constructor(e,s){this._renderService=e,this._charSizeService=s}getCoords(e,s,i,r,n){return zc(window,e,s,i,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,n)}getMouseReportCoords(e,s){let i=cn(window,e,s);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};Ar=se([R(0,yt),R(1,Mi)],Ar);var Fc=class{constructor(t,e){this._renderCallback=t,this._coreBrowserService=e,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(t){return this._refreshCallbacks.push(t),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(t,e,s){this._rowCount=s,t=t!==void 0?t:0,e=e!==void 0?e:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,t):t,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,e):e,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let t=Math.max(this._rowStart,0),e=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,e),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let t of this._refreshCallbacks)t(0);this._refreshCallbacks=[]}},Na={};Gl(Na,{getSafariVersion:()=>$c,isChromeOS:()=>Wa,isFirefox:()=>Ha,isIpad:()=>Uc,isIphone:()=>Kc,isLegacyEdge:()=>Wc,isLinux:()=>dn,isMac:()=>wi,isNode:()=>Ii,isSafari:()=>za,isWindows:()=>Fa});var Ii=typeof process<"u"&&"title"in process,$s=Ii?"node":navigator.userAgent,Us=Ii?"node":navigator.platform,Ha=$s.includes("Firefox"),Wc=$s.includes("Edge"),za=/^((?!chrome|android).)*safari/i.test($s);function $c(){if(!za)return 0;let t=$s.match(/Version\/(\d+)/);return t===null||t.length<2?0:parseInt(t[1])}var wi=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Us),Uc=Us==="iPad",Kc=Us==="iPhone",Fa=["Windows","Win16","Win32","WinCE"].includes(Us),dn=Us.indexOf("Linux")>=0,Wa=/\bCrOS\b/.test($s),$a=class{constructor(){this._tasks=[],this._i=0}enqueue(t){this._tasks.push(t),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(t){this._idleCallback=void 0;let e=0,s=0,i=t.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(e=performance.now(),this._tasks[this._i]()||this._i++,e=Math.max(1,performance.now()-e),s=Math.max(e,s),r=t.timeRemaining(),s*1.5>r){i-e<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-e))}ms`),this._start();return}i=r}this.clear()}},qc=class extends $a{_requestCallback(t){return setTimeout(()=>t(this._createDeadline(16)))}_cancelCallback(t){clearTimeout(t)}_createDeadline(t){let e=performance.now()+t;return{timeRemaining:()=>Math.max(0,e-performance.now())}}},Yc=class extends $a{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},yi=!Ii&&"requestIdleCallback"in window?Yc:qc,Vc=class{constructor(){this._queue=new yi}set(t){this._queue.clear(),this._queue.enqueue(t)}flush(){this._queue.flush()}},Dr=class extends O{constructor(t,e,s,i,r,n,o,a,h){super(),this._rowCount=t,this._optionsService=s,this._charSizeService=i,this._coreService=r,this._coreBrowserService=a,this._renderer=this._register(new rs),this._pausedResizeTask=new Vc,this._observerDisposable=this._register(new rs),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new E),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new E),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new E),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new E),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new Fc((l,c)=>this._renderRows(l,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new jc(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(J(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>{var l;return(l=this._renderer.value)==null?void 0:l.clear()})),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,e),this._register(this._coreBrowserService.onWindowChange(l=>this._registerIntersectionObserver(l,e)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(t,e){if("IntersectionObserver"in t){let s=new t.IntersectionObserver(i=>this._handleIntersectionChange(i[i.length-1]),{threshold:0});s.observe(e),this._observerDisposable.value=J(()=>s.disconnect())}}_handleIntersectionChange(t){this._isPaused=t.isIntersecting===void 0?t.intersectionRatio===0:!t.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(t,e,s=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(t,e);return}let i=this._syncOutputHandler.flush();i&&(t=Math.min(t,i.start),e=Math.max(e,i.end)),s||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(t,e,this._rowCount)}_renderRows(t,e){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(t,e);return}t=Math.min(t,this._rowCount-1),e=Math.min(e,this._rowCount-1),this._renderer.value.renderRows(t,e),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:t,end:e}),this._onRender.fire({start:t,end:e}),this._isNextRenderRedrawOnly=!0}}resize(t,e){this._rowCount=e,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(t){this._renderer.value=t,this._renderer.value&&(this._renderer.value.onRequestRedraw(e=>this.refreshRows(e.start,e.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(t){return this._renderDebouncer.addRefreshCallback(t)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var t,e;this._renderer.value&&((e=(t=this._renderer.value).clearTextureAtlas)==null||e.call(t),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(t,e){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var s;return(s=this._renderer.value)==null?void 0:s.handleResize(t,e)}):this._renderer.value.handleResize(t,e),this._fullRefresh())}handleCharSizeChanged(){var t;(t=this._renderer.value)==null||t.handleCharSizeChanged()}handleBlur(){var t;(t=this._renderer.value)==null||t.handleBlur()}handleFocus(){var t;(t=this._renderer.value)==null||t.handleFocus()}handleSelectionChanged(t,e,s){var i;this._selectionState.start=t,this._selectionState.end=e,this._selectionState.columnSelectMode=s,(i=this._renderer.value)==null||i.handleSelectionChanged(t,e,s)}handleCursorMove(){var t;(t=this._renderer.value)==null||t.handleCursorMove()}clear(){var t;(t=this._renderer.value)==null||t.clear()}};Dr=se([R(2,Oe),R(3,Mi),R(4,Gt),R(5,Ws),R(6,Te),R(7,wt),R(8,os)],Dr);var jc=class{constructor(t,e,s){this._coreBrowserService=t,this._coreService=e,this._onTimeout=s,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(t,e){this._isBuffering?(this._start=Math.min(this._start,t),this._end=Math.max(this._end,e)):(this._start=t,this._end=e,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let t={start:this._start,end:this._end};return this._isBuffering=!1,t}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function Xc(t,e,s,i){let r=s.buffer.x,n=s.buffer.y;if(!s.buffer.hasScrollback)return Zc(r,n,t,e,s,i)+Ti(n,e,s,i)+Qc(r,n,t,e,s,i);let o;if(n===e)return o=r>t?"D":"C",Ns(Math.abs(r-t),Os(o,i));o=n>e?"D":"C";let a=Math.abs(n-e),h=Jc(n>e?t:r,s)+(a-1)*s.cols+1+Gc(n>e?r:t);return Ns(h,Os(o,i))}function Gc(t,e){return t-1}function Jc(t,e){return e.cols-t}function Zc(t,e,s,i,r,n){return Ti(e,i,r,n).length===0?"":Ns(Ka(t,e,t,e-Xt(e,r),!1,r).length,Os("D",n))}function Ti(t,e,s,i){let r=t-Xt(t,s),n=e-Xt(e,s),o=Math.abs(r-n)-ed(t,e,s);return Ns(o,Os(Ua(t,e),i))}function Qc(t,e,s,i,r,n){let o;Ti(e,i,r,n).length>0?o=i-Xt(i,r):o=e;let a=i,h=td(t,e,s,i,r,n);return Ns(Ka(t,o,s,a,h==="C",r).length,Os(h,n))}function ed(t,e,s){var o;let i=0,r=t-Xt(t,s),n=e-Xt(e,s);for(let a=0;a<Math.abs(r-n);a++){let h=Ua(t,e)==="A"?-1:1;(o=s.buffer.lines.get(r+h*a))!=null&&o.isWrapped&&i++}return i}function Xt(t,e){let s=0,i=e.buffer.lines.get(t),r=i==null?void 0:i.isWrapped;for(;r&&t>=0&&t<e.rows;)s++,i=e.buffer.lines.get(--t),r=i==null?void 0:i.isWrapped;return s}function td(t,e,s,i,r,n){let o;return Ti(s,i,r,n).length>0?o=i-Xt(i,r):o=e,t<s&&o<=i||t>=s&&o<i?"C":"D"}function Ua(t,e){return t>e?"A":"B"}function Ka(t,e,s,i,r,n){let o=t,a=e,h="";for(;(o!==s||a!==i)&&a>=0&&a<n.buffer.lines.length;)o+=r?1:-1,r&&o>n.cols-1?(h+=n.buffer.translateBufferLineToString(a,!1,t,o),o=0,t=0,a++):!r&&o<0&&(h+=n.buffer.translateBufferLineToString(a,!1,0,t+1),o=n.cols-1,t=o,a--);return h+n.buffer.translateBufferLineToString(a,!1,t,o)}function Os(t,e){let s=e?"O":"[";return g.ESC+s+t}function Ns(t,e){t=Math.floor(t);let s="";for(let i=0;i<t;i++)s+=e;return s}var sd=class{constructor(t){this._bufferService=t,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?t%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)-1]:[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[t,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[Math.max(t,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let t=this.selectionStart,e=this.selectionEnd;return!t||!e?!1:t[1]>e[1]||t[1]===e[1]&&t[0]>e[0]}handleTrim(t){return this.selectionStart&&(this.selectionStart[1]-=t),this.selectionEnd&&(this.selectionEnd[1]-=t),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function Qn(t,e){if(t.start.y>t.end.y)throw new Error(`Buffer range end (${t.end.x}, ${t.end.y}) cannot be before start (${t.start.x}, ${t.start.y})`);return e*(t.end.y-t.start.y)+(t.end.x-t.start.x+1)}var Vi=50,id=15,rd=50,nd=500,od="",ad=new RegExp(od,"g"),Mr=class extends O{constructor(t,e,s,i,r,n,o,a,h){super(),this._element=t,this._screenElement=e,this._linkifier=s,this._bufferService=i,this._coreService=r,this._mouseService=n,this._optionsService=o,this._renderService=a,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new Ge,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new E),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new E),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new E),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new E),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=l=>this._handleMouseMove(l),this._mouseUpListener=l=>this._handleMouseUp(l),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(l=>this._handleTrim(l)),this._register(this._bufferService.buffers.onBufferActivate(l=>this._handleBufferActivate(l))),this.enable(),this._model=new sd(this._bufferService),this._activeSelectionMode=0,this._register(J(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(l=>{l.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let t=this._model.finalSelectionStart,e=this._model.finalSelectionEnd;return!t||!e?!1:t[0]!==e[0]||t[1]!==e[1]}get selectionText(){let t=this._model.finalSelectionStart,e=this._model.finalSelectionEnd;if(!t||!e)return"";let s=this._bufferService.buffer,i=[];if(this._activeSelectionMode===3){if(t[0]===e[0])return"";let r=t[0]<e[0]?t[0]:e[0],n=t[0]<e[0]?e[0]:t[0];for(let o=t[1];o<=e[1];o++){let a=s.translateBufferLineToString(o,!0,r,n);i.push(a)}}else{let r=t[1]===e[1]?e[0]:void 0;i.push(s.translateBufferLineToString(t[1],!0,t[0],r));for(let n=t[1]+1;n<=e[1]-1;n++){let o=s.lines.get(n),a=s.translateBufferLineToString(n,!0);o!=null&&o.isWrapped?i[i.length-1]+=a:i.push(a)}if(t[1]!==e[1]){let n=s.lines.get(e[1]),o=s.translateBufferLineToString(e[1],!0,0,e[0]);n&&n.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(r=>r.replace(ad," ")).join(Fa?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(t){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),dn&&t&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(t){let e=this._getMouseBufferCoords(t),s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i||!e?!1:this._areCoordsInSelection(e,s,i)}isCellInSelection(t,e){let s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i?!1:this._areCoordsInSelection([t,e],s,i)}_areCoordsInSelection(t,e,s){return t[1]>e[1]&&t[1]<s[1]||e[1]===s[1]&&t[1]===e[1]&&t[0]>=e[0]&&t[0]<s[0]||e[1]<s[1]&&t[1]===s[1]&&t[0]<s[0]||e[1]<s[1]&&t[1]===e[1]&&t[0]>=e[0]}_selectWordAtCursor(t,e){var r,n;let s=(n=(r=this._linkifier.currentLink)==null?void 0:r.link)==null?void 0:n.range;if(s)return this._model.selectionStart=[s.start.x-1,s.start.y-1],this._model.selectionStartLength=Qn(s,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let i=this._getMouseBufferCoords(t);return i?(this._selectWordAt(i,e),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(t,e){this._model.clearSelection(),t=Math.max(t,0),e=Math.min(e,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,t],this._model.selectionEnd=[this._bufferService.cols,e],this.refresh(),this._onSelectionChange.fire()}_handleTrim(t){this._model.handleTrim(t)&&this.refresh()}_getMouseBufferCoords(t){let e=this._mouseService.getCoords(t,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(e)return e[0]--,e[1]--,e[1]+=this._bufferService.buffer.ydisp,e}_getMouseEventScrollAmount(t){let e=cn(this._coreBrowserService.window,t,this._screenElement)[1],s=this._renderService.dimensions.css.canvas.height;return e>=0&&e<=s?0:(e>s&&(e-=s),e=Math.min(Math.max(e,-Vi),Vi),e/=Vi,e/Math.abs(e)+Math.round(e*(id-1)))}shouldForceSelection(t){return wi?t.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:t.shiftKey}handleMouseDown(t){if(this._mouseDownTimeStamp=t.timeStamp,!(t.button===2&&this.hasSelection)&&t.button===0){if(!this._enabled){if(!this.shouldForceSelection(t))return;t.stopPropagation()}t.preventDefault(),this._dragScrollAmount=0,this._enabled&&t.shiftKey?this._handleIncrementalClick(t):t.detail===1?this._handleSingleClick(t):t.detail===2?this._handleDoubleClick(t):t.detail===3&&this._handleTripleClick(t),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),rd)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(t){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(t))}_handleSingleClick(t){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(t)?3:0,this._model.selectionStart=this._getMouseBufferCoords(t),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let e=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);e&&e.length!==this._model.selectionStart[0]&&e.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(t){this._selectWordAtCursor(t,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(t){let e=this._getMouseBufferCoords(t);e&&(this._activeSelectionMode=2,this._selectLineAt(e[1]))}shouldColumnSelect(t){return t.altKey&&!(wi&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(t){if(t.stopImmediatePropagation(),!this._model.selectionStart)return;let e=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(t),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(t),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let s=this._bufferService.buffer;if(this._model.selectionEnd[1]<s.lines.length){let i=s.lines.get(this._model.selectionEnd[1]);i&&i.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!e||e[0]!==this._model.selectionEnd[0]||e[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let t=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(t.ydisp+this._bufferService.rows,t.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=t.ydisp),this.refresh()}}_handleMouseUp(t){let e=t.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&e<nd&&t.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let s=this._mouseService.getCoords(t,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(s&&s[0]!==void 0&&s[1]!==void 0){let i=Xc(s[0]-1,s[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let t=this._model.finalSelectionStart,e=this._model.finalSelectionEnd,s=!!t&&!!e&&(t[0]!==e[0]||t[1]!==e[1]);if(!s){this._oldHasSelection&&this._fireOnSelectionChange(t,e,s);return}!t||!e||(!this._oldSelectionStart||!this._oldSelectionEnd||t[0]!==this._oldSelectionStart[0]||t[1]!==this._oldSelectionStart[1]||e[0]!==this._oldSelectionEnd[0]||e[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(t,e,s)}_fireOnSelectionChange(t,e,s){this._oldSelectionStart=t,this._oldSelectionEnd=e,this._oldHasSelection=s,this._onSelectionChange.fire()}_handleBufferActivate(t){this.clearSelection(),this._trimListener.dispose(),this._trimListener=t.activeBuffer.lines.onTrim(e=>this._handleTrim(e))}_convertViewportColToCharacterIndex(t,e){let s=e;for(let i=0;e>=i;i++){let r=t.loadCell(i,this._workCell).getChars().length;this._workCell.getWidth()===0?s--:r>1&&e!==i&&(s+=r-1)}return s}setSelection(t,e,s){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[t,e],this._model.selectionStartLength=s,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(t){this._isClickInSelection(t)||(this._selectWordAtCursor(t,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(t,e,s=!0,i=!0){if(t[0]>=this._bufferService.cols)return;let r=this._bufferService.buffer,n=r.lines.get(t[1]);if(!n)return;let o=r.translateBufferLineToString(t[1],!1),a=this._convertViewportColToCharacterIndex(n,t[0]),h=a,l=t[0]-a,c=0,d=0,u=0,_=0;if(o.charAt(a)===" "){for(;a>0&&o.charAt(a-1)===" ";)a--;for(;h<o.length&&o.charAt(h+1)===" ";)h++}else{let m=t[0],S=t[0];n.getWidth(m)===0&&(c++,m--),n.getWidth(S)===2&&(d++,S++);let y=n.getString(S).length;for(y>1&&(_+=y-1,h+=y-1);m>0&&a>0&&!this._isCharWordSeparator(n.loadCell(m-1,this._workCell));){n.loadCell(m-1,this._workCell);let w=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,m--):w>1&&(u+=w-1,a-=w-1),a--,m--}for(;S<n.length&&h+1<o.length&&!this._isCharWordSeparator(n.loadCell(S+1,this._workCell));){n.loadCell(S+1,this._workCell);let w=this._workCell.getChars().length;this._workCell.getWidth()===2?(d++,S++):w>1&&(_+=w-1,h+=w-1),h++,S++}}h++;let f=a+l-c+u,p=Math.min(this._bufferService.cols,h-a+c+d-u-_);if(!(!e&&o.slice(a,h).trim()==="")){if(s&&f===0&&n.getCodePoint(0)!==32){let m=r.lines.get(t[1]-1);if(m&&n.isWrapped&&m.getCodePoint(this._bufferService.cols-1)!==32){let S=this._getWordAt([this._bufferService.cols-1,t[1]-1],!1,!0,!1);if(S){let y=this._bufferService.cols-S.start;f-=y,p+=y}}}if(i&&f+p===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let m=r.lines.get(t[1]+1);if(m!=null&&m.isWrapped&&m.getCodePoint(0)!==32){let S=this._getWordAt([0,t[1]+1],!1,!1,!0);S&&(p+=S.length)}}return{start:f,length:p}}}_selectWordAt(t,e){let s=this._getWordAt(t,e);if(s){for(;s.start<0;)s.start+=this._bufferService.cols,t[1]--;this._model.selectionStart=[s.start,t[1]],this._model.selectionStartLength=s.length}}_selectToWordAt(t){let e=this._getWordAt(t,!0);if(e){let s=t[1];for(;e.start<0;)e.start+=this._bufferService.cols,s--;if(!this._model.areSelectionValuesReversed())for(;e.start+e.length>this._bufferService.cols;)e.length-=this._bufferService.cols,s++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?e.start:e.start+e.length,s]}}_isCharWordSeparator(t){return t.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(t.getChars())>=0}_selectLineAt(t){let e=this._bufferService.buffer.getWrappedRangeForLine(t),s={start:{x:0,y:e.first},end:{x:this._bufferService.cols-1,y:e.last}};this._model.selectionStart=[0,e.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=Qn(s,this._bufferService.cols)}};Mr=se([R(3,Te),R(4,Gt),R(5,sn),R(6,Oe),R(7,yt),R(8,wt)],Mr);var eo=class{constructor(){this._data={}}set(t,e,s){this._data[t]||(this._data[t]={}),this._data[t][e]=s}get(t,e){return this._data[t]?this._data[t][e]:void 0}clear(){this._data={}}},to=class{constructor(){this._color=new eo,this._css=new eo}setCss(t,e,s){this._css.set(t,e,s)}getCss(t,e){return this._css.get(t,e)}setColor(t,e,s){this._color.set(t,e,s)}getColor(t,e){return this._color.get(t,e)}clear(){this._color.clear(),this._css.clear()}},de=Object.freeze((()=>{let t=[Q.toColor("#2e3436"),Q.toColor("#cc0000"),Q.toColor("#4e9a06"),Q.toColor("#c4a000"),Q.toColor("#3465a4"),Q.toColor("#75507b"),Q.toColor("#06989a"),Q.toColor("#d3d7cf"),Q.toColor("#555753"),Q.toColor("#ef2929"),Q.toColor("#8ae234"),Q.toColor("#fce94f"),Q.toColor("#729fcf"),Q.toColor("#ad7fa8"),Q.toColor("#34e2e2"),Q.toColor("#eeeeec")],e=[0,95,135,175,215,255];for(let s=0;s<216;s++){let i=e[s/36%6|0],r=e[s/6%6|0],n=e[s%6];t.push({css:le.toCss(i,r,n),rgba:le.toRgba(i,r,n)})}for(let s=0;s<24;s++){let i=8+s*10;t.push({css:le.toCss(i,i,i),rgba:le.toRgba(i,i,i)})}return t})()),Nt=Q.toColor("#ffffff"),Ss=Q.toColor("#000000"),so=Q.toColor("#ffffff"),io=Ss,cs={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},ld=Nt,Ir=class extends O{constructor(t){super(),this._optionsService=t,this._contrastCache=new to,this._halfContrastCache=new to,this._onChangeColors=this._register(new E),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:Nt,background:Ss,cursor:so,cursorAccent:io,selectionForeground:void 0,selectionBackgroundTransparent:cs,selectionBackgroundOpaque:V.blend(Ss,cs),selectionInactiveBackgroundTransparent:cs,selectionInactiveBackgroundOpaque:V.blend(Ss,cs),scrollbarSliderBackground:V.opacity(Nt,.2),scrollbarSliderHoverBackground:V.opacity(Nt,.4),scrollbarSliderActiveBackground:V.opacity(Nt,.5),overviewRulerBorder:Nt,ansi:de.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(t={}){let e=this._colors;if(e.foreground=U(t.foreground,Nt),e.background=U(t.background,Ss),e.cursor=V.blend(e.background,U(t.cursor,so)),e.cursorAccent=V.blend(e.background,U(t.cursorAccent,io)),e.selectionBackgroundTransparent=U(t.selectionBackground,cs),e.selectionBackgroundOpaque=V.blend(e.background,e.selectionBackgroundTransparent),e.selectionInactiveBackgroundTransparent=U(t.selectionInactiveBackground,e.selectionBackgroundTransparent),e.selectionInactiveBackgroundOpaque=V.blend(e.background,e.selectionInactiveBackgroundTransparent),e.selectionForeground=t.selectionForeground?U(t.selectionForeground,Gn):void 0,e.selectionForeground===Gn&&(e.selectionForeground=void 0),V.isOpaque(e.selectionBackgroundTransparent)&&(e.selectionBackgroundTransparent=V.opacity(e.selectionBackgroundTransparent,.3)),V.isOpaque(e.selectionInactiveBackgroundTransparent)&&(e.selectionInactiveBackgroundTransparent=V.opacity(e.selectionInactiveBackgroundTransparent,.3)),e.scrollbarSliderBackground=U(t.scrollbarSliderBackground,V.opacity(e.foreground,.2)),e.scrollbarSliderHoverBackground=U(t.scrollbarSliderHoverBackground,V.opacity(e.foreground,.4)),e.scrollbarSliderActiveBackground=U(t.scrollbarSliderActiveBackground,V.opacity(e.foreground,.5)),e.overviewRulerBorder=U(t.overviewRulerBorder,ld),e.ansi=de.slice(),e.ansi[0]=U(t.black,de[0]),e.ansi[1]=U(t.red,de[1]),e.ansi[2]=U(t.green,de[2]),e.ansi[3]=U(t.yellow,de[3]),e.ansi[4]=U(t.blue,de[4]),e.ansi[5]=U(t.magenta,de[5]),e.ansi[6]=U(t.cyan,de[6]),e.ansi[7]=U(t.white,de[7]),e.ansi[8]=U(t.brightBlack,de[8]),e.ansi[9]=U(t.brightRed,de[9]),e.ansi[10]=U(t.brightGreen,de[10]),e.ansi[11]=U(t.brightYellow,de[11]),e.ansi[12]=U(t.brightBlue,de[12]),e.ansi[13]=U(t.brightMagenta,de[13]),e.ansi[14]=U(t.brightCyan,de[14]),e.ansi[15]=U(t.brightWhite,de[15]),t.extendedAnsi){let s=Math.min(e.ansi.length-16,t.extendedAnsi.length);for(let i=0;i<s;i++)e.ansi[i+16]=U(t.extendedAnsi[i],de[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(t){this._restoreColor(t),this._onChangeColors.fire(this.colors)}_restoreColor(t){if(t===void 0){for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e];return}switch(t){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[t]=this._restoreColors.ansi[t]}}modifyColors(t){t(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};Ir=se([R(0,Oe)],Ir);function U(t,e){if(t!==void 0)try{return Q.toColor(t)}catch{}return e}var hd=class{constructor(...t){this._entries=new Map;for(let[e,s]of t)this.set(e,s)}set(t,e){let s=this._entries.get(t);return this._entries.set(t,e),s}forEach(t){for(let[e,s]of this._entries.entries())t(e,s)}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}},cd=class{constructor(){this._services=new hd,this._services.set(tn,this)}setService(t,e){this._services.set(t,e)}getService(t){return this._services.get(t)}createInstance(t,...e){let s=ih(t).sort((n,o)=>n.index-o.index),i=[];for(let n of s){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${t.name} depends on UNKNOWN service ${n.id._id}.`);i.push(o)}let r=s.length>0?s[0].index:e.length;if(e.length!==r)throw new Error(`[createInstance] First service dependency of ${t.name} at position ${r+1} conflicts with ${e.length} static arguments`);return new t(...e,...i)}},dd={trace:0,debug:1,info:2,warn:3,error:4,off:5},ud="xterm.js: ",Tr=class extends O{constructor(t){super(),this._optionsService=t,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=dd[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(t){for(let e=0;e<t.length;e++)typeof t[e]=="function"&&(t[e]=t[e]())}_log(t,e,s){this._evalLazyOptionalParams(s),t.call(console,(this._optionsService.options.logger?"":ud)+e,...s)}trace(t,...e){var s;this._logLevel<=0&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.trace.bind(this._optionsService.options.logger))??console.log,t,e)}debug(t,...e){var s;this._logLevel<=1&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.debug.bind(this._optionsService.options.logger))??console.log,t,e)}info(t,...e){var s;this._logLevel<=2&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.info.bind(this._optionsService.options.logger))??console.info,t,e)}warn(t,...e){var s;this._logLevel<=3&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.warn.bind(this._optionsService.options.logger))??console.warn,t,e)}error(t,...e){var s;this._logLevel<=4&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.error.bind(this._optionsService.options.logger))??console.error,t,e)}};Tr=se([R(0,Oe)],Tr);var ro=class extends O{constructor(t){super(),this._maxLength=t,this.onDeleteEmitter=this._register(new E),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new E),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new E),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(t){if(this._maxLength===t)return;let e=new Array(t);for(let s=0;s<Math.min(t,this.length);s++)e[s]=this._array[this._getCyclicIndex(s)];this._array=e,this._maxLength=t,this._startIndex=0}get length(){return this._length}set length(t){if(t>this._length)for(let e=this._length;e<t;e++)this._array[e]=void 0;this._length=t}get(t){return this._array[this._getCyclicIndex(t)]}set(t,e){this._array[this._getCyclicIndex(t)]=e}push(t){this._array[this._getCyclicIndex(this._length)]=t,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(t,e,...s){if(e){for(let i=t;i<this._length-e;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+e)];this._length-=e,this.onDeleteEmitter.fire({index:t,amount:e})}for(let i=this._length-1;i>=t;i--)this._array[this._getCyclicIndex(i+s.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<s.length;i++)this._array[this._getCyclicIndex(t+i)]=s[i];if(s.length&&this.onInsertEmitter.fire({index:t,amount:s.length}),this._length+s.length>this._maxLength){let i=this._length+s.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=s.length}trimStart(t){t>this._length&&(t=this._length),this._startIndex+=t,this._length-=t,this.onTrimEmitter.fire(t)}shiftElements(t,e,s){if(!(e<=0)){if(t<0||t>=this._length)throw new Error("start argument out of range");if(t+s<0)throw new Error("Cannot shift elements in list beyond index 0");if(s>0){for(let r=e-1;r>=0;r--)this.set(t+r+s,this.get(t+r));let i=t+e+s-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<e;i++)this.set(t+i+s,this.get(t+i))}}_getCyclicIndex(t){return(this._startIndex+t)%this._maxLength}},T=3,ae=Object.freeze(new Fs),Js=0,ji=2,ws=class qa{constructor(e,s,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(e*T);let r=s||Ge.fromCharData([0,ca,1,0]);for(let n=0;n<e;++n)this.setCell(n,r);this.length=e}get(e){let s=this._data[e*T+0],i=s&2097151;return[this._data[e*T+1],s&2097152?this._combined[e]:i?xt(i):"",s>>22,s&2097152?this._combined[e].charCodeAt(this._combined[e].length-1):i]}set(e,s){this._data[e*T+1]=s[0],s[1].length>1?(this._combined[e]=s[1],this._data[e*T+0]=e|2097152|s[2]<<22):this._data[e*T+0]=s[1].charCodeAt(0)|s[2]<<22}getWidth(e){return this._data[e*T+0]>>22}hasWidth(e){return this._data[e*T+0]&12582912}getFg(e){return this._data[e*T+1]}getBg(e){return this._data[e*T+2]}hasContent(e){return this._data[e*T+0]&4194303}getCodePoint(e){let s=this._data[e*T+0];return s&2097152?this._combined[e].charCodeAt(this._combined[e].length-1):s&2097151}isCombined(e){return this._data[e*T+0]&2097152}getString(e){let s=this._data[e*T+0];return s&2097152?this._combined[e]:s&2097151?xt(s&2097151):""}isProtected(e){return this._data[e*T+2]&536870912}loadCell(e,s){return Js=e*T,s.content=this._data[Js+0],s.fg=this._data[Js+1],s.bg=this._data[Js+2],s.content&2097152&&(s.combinedData=this._combined[e]),s.bg&268435456&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){s.content&2097152&&(this._combined[e]=s.combinedData),s.bg&268435456&&(this._extendedAttrs[e]=s.extended),this._data[e*T+0]=s.content,this._data[e*T+1]=s.fg,this._data[e*T+2]=s.bg}setCellFromCodepoint(e,s,i,r){r.bg&268435456&&(this._extendedAttrs[e]=r.extended),this._data[e*T+0]=s|i<<22,this._data[e*T+1]=r.fg,this._data[e*T+2]=r.bg}addCodepointToCell(e,s,i){let r=this._data[e*T+0];r&2097152?this._combined[e]+=xt(s):r&2097151?(this._combined[e]=xt(r&2097151)+xt(s),r&=-2097152,r|=2097152):r=s|1<<22,i&&(r&=-12582913,r|=i<<22),this._data[e*T+0]=r}insertCells(e,s,i){if(e%=this.length,e&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,i),s<this.length-e){let r=new Ge;for(let n=this.length-e-s-1;n>=0;--n)this.setCell(e+s+n,this.loadCell(e+n,r));for(let n=0;n<s;++n)this.setCell(e+n,i)}else for(let r=e;r<this.length;++r)this.setCell(r,i);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(e,s,i){if(e%=this.length,s<this.length-e){let r=new Ge;for(let n=0;n<this.length-e-s;++n)this.setCell(e+n,this.loadCell(e+s+n,r));for(let n=this.length-s;n<this.length;++n)this.setCell(n,i)}else for(let r=e;r<this.length;++r)this.setCell(r,i);e&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,i),this.getWidth(e)===0&&!this.hasContent(e)&&this.setCellFromCodepoint(e,0,1,i)}replaceCells(e,s,i,r=!1){if(r){for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodepoint(s,0,1,i);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,i),e++;return}for(e&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s,0,1,i);e<s&&e<this.length;)this.setCell(e++,i)}resize(e,s){if(e===this.length)return this._data.length*4*ji<this._data.buffer.byteLength;let i=e*T;if(e>this.length){if(this._data.buffer.byteLength>=i*4)this._data=new Uint32Array(this._data.buffer,0,i);else{let r=new Uint32Array(i);r.set(this._data),this._data=r}for(let r=this.length;r<e;++r)this.setCell(r,s)}else{this._data=this._data.subarray(0,i);let r=Object.keys(this._combined);for(let o=0;o<r.length;o++){let a=parseInt(r[o],10);a>=e&&delete this._combined[a]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let a=parseInt(n[o],10);a>=e&&delete this._extendedAttrs[a]}}return this.length=e,i*4*ji<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*ji<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,e);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,e)}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(let s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(let s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){let e=new qa(0);e._data=new Uint32Array(this._data),e.length=this.length;for(let s in this._combined)e._combined[s]=this._combined[s];for(let s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(this._data[e*T+0]&4194303)return e+(this._data[e*T+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(this._data[e*T+0]&4194303||this._data[e*T+2]&50331648)return e+(this._data[e*T+0]>>22);return 0}copyCellsFrom(e,s,i,r,n){let o=e._data;if(n)for(let h=r-1;h>=0;h--){for(let l=0;l<T;l++)this._data[(i+h)*T+l]=o[(s+h)*T+l];o[(s+h)*T+2]&268435456&&(this._extendedAttrs[i+h]=e._extendedAttrs[s+h])}else for(let h=0;h<r;h++){for(let l=0;l<T;l++)this._data[(i+h)*T+l]=o[(s+h)*T+l];o[(s+h)*T+2]&268435456&&(this._extendedAttrs[i+h]=e._extendedAttrs[s+h])}let a=Object.keys(e._combined);for(let h=0;h<a.length;h++){let l=parseInt(a[h],10);l>=s&&(this._combined[l-s+i]=e._combined[l])}}translateToString(e,s,i,r){s=s??0,i=i??this.length,e&&(i=Math.min(i,this.getTrimmedLength())),r&&(r.length=0);let n="";for(;s<i;){let o=this._data[s*T+0],a=o&2097151,h=o&2097152?this._combined[s]:a?xt(a):Bt;if(n+=h,r)for(let l=0;l<h.length;++l)r.push(s);s+=o>>22||1}return r&&r.push(s),n}};function fd(t,e,s,i,r,n){let o=[];for(let a=0;a<t.length-1;a++){let h=a,l=t.get(++h);if(!l.isWrapped)continue;let c=[t.get(a)];for(;h<t.length&&l.isWrapped;)c.push(l),l=t.get(++h);if(!n&&i>=a&&i<h){a+=c.length-1;continue}let d=0,u=Hs(c,d,e),_=1,f=0;for(;_<c.length;){let m=Hs(c,_,e),S=m-f,y=s-u,w=Math.min(S,y);c[d].copyCellsFrom(c[_],f,u,w,!1),u+=w,u===s&&(d++,u=0),f+=w,f===m&&(_++,f=0),u===0&&d!==0&&c[d-1].getWidth(s-1)===2&&(c[d].copyCellsFrom(c[d-1],s-1,u++,1,!1),c[d-1].setCell(s-1,r))}c[d].replaceCells(u,s,r);let p=0;for(let m=c.length-1;m>0&&(m>d||c[m].getTrimmedLength()===0);m--)p++;p>0&&(o.push(a+c.length-p),o.push(p)),a+=c.length-1}return o}function _d(t,e){let s=[],i=0,r=e[i],n=0;for(let o=0;o<t.length;o++)if(r===o){let a=e[++i];t.onDeleteEmitter.fire({index:o-n,amount:a}),o+=a-1,n+=a,r=e[++i]}else s.push(o);return{layout:s,countRemoved:n}}function pd(t,e){let s=[];for(let i=0;i<e.length;i++)s.push(t.get(e[i]));for(let i=0;i<s.length;i++)t.set(i,s[i]);t.length=e.length}function md(t,e,s){let i=[],r=t.map((h,l)=>Hs(t,l,e)).reduce((h,l)=>h+l),n=0,o=0,a=0;for(;a<r;){if(r-a<s){i.push(r-a);break}n+=s;let h=Hs(t,o,e);n>h&&(n-=h,o++);let l=t[o].getWidth(n-1)===2;l&&n--;let c=l?s-1:s;i.push(c),a+=c}return i}function Hs(t,e,s){if(e===t.length-1)return t[e].getTrimmedLength();let i=!t[e].hasContent(s-1)&&t[e].getWidth(s-1)===1,r=t[e+1].getWidth(0)===2;return i&&r?s-1:s}var Ya=class Va{constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=Va._nextId++,this._onDispose=this.register(new E),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),jt(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}};Ya._nextId=1;var gd=Ya,pe={},Ht=pe.B;pe[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};pe.A={"#":""};pe.B=void 0;pe[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};pe.C=pe[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};pe.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};pe.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};pe.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};pe.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};pe.E=pe[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};pe.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};pe.H=pe[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};pe["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var no=4294967295,oo=class{constructor(t,e,s){this._hasScrollback=t,this._optionsService=e,this._bufferService=s,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=ae.clone(),this.savedCharset=Ht,this.markers=[],this._nullCell=Ge.fromCharData([0,ca,1,0]),this._whitespaceCell=Ge.fromCharData([0,Bt,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new yi,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new ro(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new gi),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new gi),this._whitespaceCell}getBlankLine(t,e){return new ws(this._bufferService.cols,this.getNullCell(t),e)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;let e=t+this._optionsService.rawOptions.scrollback;return e>no?no:e}fillViewportRows(t){if(this.lines.length===0){t===void 0&&(t=ae);let e=this._rows;for(;e--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new ro(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,e){let s=this.getNullCell(ae),i=0,r=this._getCorrectBufferLength(e);if(r>this.lines.maxLength&&(this.lines.maxLength=r),this.lines.length>0){if(this._cols<t)for(let o=0;o<this.lines.length;o++)i+=+this.lines.get(o).resize(t,s);let n=0;if(this._rows<e)for(let o=this._rows;o<e;o++)this.lines.length<e+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new ws(t,s)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new ws(t,s)));else for(let o=this._rows;o>e;o--)this.lines.length>e+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(r<this.lines.maxLength){let o=this.lines.length-r;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=r}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,e-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=e-1,this._isReflowEnabled&&(this._reflow(t,e),this._cols>t))for(let n=0;n<this.lines.length;n++)i+=+this.lines.get(n).resize(t,s);this._cols=t,this._rows=e,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let e=0;for(;this._memoryCleanupPosition<this.lines.length;)if(e+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),e>100)return!0;return t}get _isReflowEnabled(){let t=this._optionsService.rawOptions.windowsPty;return t&&t.buildNumber?this._hasScrollback&&t.backend==="conpty"&&t.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,e){this._cols!==t&&(t>this._cols?this._reflowLarger(t,e):this._reflowSmaller(t,e))}_reflowLarger(t,e){let s=this._optionsService.rawOptions.reflowCursorLine,i=fd(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(ae),s);if(i.length>0){let r=_d(this.lines,i);pd(this.lines,r.layout),this._reflowLargerAdjustViewport(t,e,r.countRemoved)}}_reflowLargerAdjustViewport(t,e,s){let i=this.getNullCell(ae),r=s;for(;r-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<e&&this.lines.push(new ws(t,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-s,0)}_reflowSmaller(t,e){let s=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(ae),r=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let a=this.lines.get(o);if(!a||!a.isWrapped&&a.getTrimmedLength()<=t)continue;let h=[a];for(;a.isWrapped&&o>0;)a=this.lines.get(--o),h.unshift(a);if(!s){let w=this.ybase+this.y;if(w>=o&&w<o+h.length)continue}let l=h[h.length-1].getTrimmedLength(),c=md(h,this._cols,t),d=c.length-h.length,u;this.ybase===0&&this.y!==this.lines.length-1?u=Math.max(0,this.y-this.lines.maxLength+d):u=Math.max(0,this.lines.length-this.lines.maxLength+d);let _=[];for(let w=0;w<d;w++){let C=this.getBlankLine(ae,!0);_.push(C)}_.length>0&&(r.push({start:o+h.length+n,newLines:_}),n+=_.length),h.push(..._);let f=c.length-1,p=c[f];p===0&&(f--,p=c[f]);let m=h.length-d-1,S=l;for(;m>=0;){let w=Math.min(S,p);if(h[f]===void 0)break;if(h[f].copyCellsFrom(h[m],S-w,p-w,w,!0),p-=w,p===0&&(f--,p=c[f]),S-=w,S===0){m--;let C=Math.max(m,0);S=Hs(h,C,this._cols)}}for(let w=0;w<h.length;w++)c[w]<t&&h[w].setCell(c[w],i);let y=d-u;for(;y-- >0;)this.ybase===0?this.y<e-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-e&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+d,this.ybase+e-1)}if(r.length>0){let o=[],a=[];for(let p=0;p<this.lines.length;p++)a.push(this.lines.get(p));let h=this.lines.length,l=h-1,c=0,d=r[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let u=0;for(let p=Math.min(this.lines.maxLength-1,h+n-1);p>=0;p--)if(d&&d.start>l+u){for(let m=d.newLines.length-1;m>=0;m--)this.lines.set(p--,d.newLines[m]);p++,o.push({index:l+1,amount:d.newLines.length}),u+=d.newLines.length,d=r[++c]}else this.lines.set(p,a[l--]);let _=0;for(let p=o.length-1;p>=0;p--)o[p].index+=_,this.lines.onInsertEmitter.fire(o[p]),_+=o[p].amount;let f=Math.max(0,h+n-this.lines.maxLength);f>0&&this.lines.onTrimEmitter.fire(f)}}translateBufferLineToString(t,e,s=0,i){let r=this.lines.get(t);return r?r.translateToString(e,s,i):""}getWrappedRangeForLine(t){let e=t,s=t;for(;e>0&&this.lines.get(e).isWrapped;)e--;for(;s+1<this.lines.length&&this.lines.get(s+1).isWrapped;)s++;return{first:e,last:s}}setupTabStops(t){for(t!=null?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(t==null&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(t==null&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].line===t&&(this.markers[e].dispose(),this.markers.splice(e--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose();this.markers.length=0,this._isClearing=!1}addMarker(t){let e=new gd(t);return this.markers.push(e),e.register(this.lines.onTrim(s=>{e.line-=s,e.line<0&&e.dispose()})),e.register(this.lines.onInsert(s=>{e.line>=s.index&&(e.line+=s.amount)})),e.register(this.lines.onDelete(s=>{e.line>=s.index&&e.line<s.index+s.amount&&e.dispose(),e.line>s.index&&(e.line-=s.amount)})),e.register(e.onDispose(()=>this._removeMarker(e))),e}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}},vd=class extends O{constructor(t,e){super(),this._optionsService=t,this._bufferService=e,this._onBufferActivate=this._register(new E),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new oo(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new oo(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(t){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(t),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(t,e){this._normal.resize(t,e),this._alt.resize(t,e),this.setupTabStops(t)}setupTabStops(t){this._normal.setupTabStops(t),this._alt.setupTabStops(t)}},ja=2,Xa=1,Or=class extends O{constructor(t){super(),this.isUserScrolling=!1,this._onResize=this._register(new E),this.onResize=this._onResize.event,this._onScroll=this._register(new E),this.onScroll=this._onScroll.event,this.cols=Math.max(t.rawOptions.cols||0,ja),this.rows=Math.max(t.rawOptions.rows||0,Xa),this.buffers=this._register(new vd(t,this)),this._register(this.buffers.onBufferActivate(e=>{this._onScroll.fire(e.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(t,e){let s=this.cols!==t,i=this.rows!==e;this.cols=t,this.rows=e,this.buffers.resize(t,e),this._onResize.fire({cols:t,rows:e,colsChanged:s,rowsChanged:i})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(t,e=!1){let s=this.buffer,i;i=this._cachedBlankLine,(!i||i.length!==this.cols||i.getFg(0)!==t.fg||i.getBg(0)!==t.bg)&&(i=s.getBlankLine(t,e),this._cachedBlankLine=i),i.isWrapped=e;let r=s.ybase+s.scrollTop,n=s.ybase+s.scrollBottom;if(s.scrollTop===0){let o=s.lines.isFull;n===s.lines.length-1?o?s.lines.recycle().copyFrom(i):s.lines.push(i.clone()):s.lines.splice(n+1,0,i.clone()),o?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{let o=n-r+1;s.lines.shiftElements(r+1,o-1,-1),s.lines.set(n,i.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(t,e){let s=this.buffer;if(t<0){if(s.ydisp===0)return;this.isUserScrolling=!0}else t+s.ydisp>=s.ybase&&(this.isUserScrolling=!1);let i=s.ydisp;s.ydisp=Math.max(Math.min(s.ydisp+t,s.ybase),0),i!==s.ydisp&&(e||this._onScroll.fire(s.ydisp))}};Or=se([R(0,Oe)],Or);var es={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:wi,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},Sd=["normal","bold","100","200","300","400","500","600","700","800","900"],wd=class extends O{constructor(t){super(),this._onOptionChange=this._register(new E),this.onOptionChange=this._onOptionChange.event;let e={...es};for(let s in t)if(s in e)try{let i=t[s];e[s]=this._sanitizeAndValidateOption(s,i)}catch(i){console.error(i)}this.rawOptions=e,this.options={...e},this._setupOptions(),this._register(J(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(t,e){return this.onOptionChange(s=>{s===t&&e(this.rawOptions[t])})}onMultipleOptionChange(t,e){return this.onOptionChange(s=>{t.indexOf(s)!==-1&&e()})}_setupOptions(){let t=s=>{if(!(s in es))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,i)=>{if(!(s in es))throw new Error(`No option with key "${s}"`);i=this._sanitizeAndValidateOption(s,i),this.rawOptions[s]!==i&&(this.rawOptions[s]=i,this._onOptionChange.fire(s))};for(let s in this.rawOptions){let i={get:t.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,i)}}_sanitizeAndValidateOption(t,e){switch(t){case"cursorStyle":if(e||(e=es[t]),!yd(e))throw new Error(`"${e}" is not a valid value for ${t}`);break;case"wordSeparator":e||(e=es[t]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=Sd.includes(e)?e:es[t];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${t} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(e*10)/10));break;case"scrollback":if(e=Math.min(e,4294967295),e<0)throw new Error(`${t} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${t} cannot be less than or equal to 0, value: ${e}`);break;case"rows":case"cols":if(!e&&e!==0)throw new Error(`${t} must be numeric, value: ${e}`);break;case"windowsPty":e=e??{};break}return e}};function yd(t){return t==="block"||t==="underline"||t==="bar"}function ys(t,e=5){if(typeof t!="object")return t;let s=Array.isArray(t)?[]:{};for(let i in t)s[i]=e<=1?t[i]:t[i]&&ys(t[i],e-1);return s}var ao=Object.freeze({insertMode:!1}),lo=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),Nr=class extends O{constructor(t,e,s){super(),this._bufferService=t,this._logService=e,this._optionsService=s,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new E),this.onData=this._onData.event,this._onUserInput=this._register(new E),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new E),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new E),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=ys(ao),this.decPrivateModes=ys(lo)}reset(){this.modes=ys(ao),this.decPrivateModes=ys(lo)}triggerDataEvent(t,e=!1){if(this._optionsService.rawOptions.disableStdin)return;let s=this._bufferService.buffer;e&&this._optionsService.rawOptions.scrollOnUserInput&&s.ybase!==s.ydisp&&this._onRequestScrollToBottom.fire(),e&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`),this._logService.trace("sending data (codes)",()=>t.split("").map(i=>i.charCodeAt(0))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`),this._logService.trace("sending binary (codes)",()=>t.split("").map(e=>e.charCodeAt(0))),this._onBinary.fire(t))}};Nr=se([R(0,Te),R(1,pa),R(2,Oe)],Nr);var ho={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:t=>t.button===4||t.action!==1?!1:(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)},VT200:{events:19,restrict:t=>t.action!==32},DRAG:{events:23,restrict:t=>!(t.action===32&&t.button===3)},ANY:{events:31,restrict:t=>!0}};function Xi(t,e){let s=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return t.button===4?(s|=64,s|=t.action):(s|=t.button&3,t.button&4&&(s|=64),t.button&8&&(s|=128),t.action===32?s|=32:t.action===0&&!e&&(s|=3)),s}var Gi=String.fromCharCode,co={DEFAULT:t=>{let e=[Xi(t,!1)+32,t.col+32,t.row+32];return e[0]>255||e[1]>255||e[2]>255?"":`\x1B[M${Gi(e[0])}${Gi(e[1])}${Gi(e[2])}`},SGR:t=>{let e=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${Xi(t,!0)};${t.col};${t.row}${e}`},SGR_PIXELS:t=>{let e=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${Xi(t,!0)};${t.x};${t.y}${e}`}},Hr=class extends O{constructor(t,e,s){super(),this._bufferService=t,this._coreService=e,this._optionsService=s,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new E),this.onProtocolChange=this._onProtocolChange.event;for(let i of Object.keys(ho))this.addProtocol(i,ho[i]);for(let i of Object.keys(co))this.addEncoding(i,co[i]);this.reset()}addProtocol(t,e){this._protocols[t]=e}addEncoding(t,e){this._encodings[t]=e}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(t){if(!this._protocols[t])throw new Error(`unknown protocol "${t}"`);this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(t){if(!this._encodings[t])throw new Error(`unknown encoding "${t}"`);this._activeEncoding=t}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(t,e,s){if(t.deltaY===0||t.shiftKey||e===void 0||s===void 0)return 0;let i=e/s,r=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(r/=i+0,Math.abs(t.deltaY)<50&&(r*=.3),this._wheelPartialScroll+=r,r=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._bufferService.rows),r}_applyScrollModifier(t,e){return e.altKey||e.ctrlKey||e.shiftKey?t*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:t*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows||t.button===4&&t.action===32||t.button===3&&t.action!==32||t.button!==4&&(t.action===2||t.action===3)||(t.col++,t.row++,t.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,t,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(t))return!1;let e=this._encodings[this._activeEncoding](t);return e&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(e):this._coreService.triggerDataEvent(e,!0)),this._lastEvent=t,!0}explainEvents(t){return{down:!!(t&1),up:!!(t&2),drag:!!(t&4),move:!!(t&8),wheel:!!(t&16)}}_equalEvents(t,e,s){if(s){if(t.x!==e.x||t.y!==e.y)return!1}else if(t.col!==e.col||t.row!==e.row)return!1;return!(t.button!==e.button||t.action!==e.action||t.ctrl!==e.ctrl||t.alt!==e.alt||t.shift!==e.shift)}};Hr=se([R(0,Te),R(1,Gt),R(2,Oe)],Hr);var Ji=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],bd=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],ue;function Cd(t,e){let s=0,i=e.length-1,r;if(t<e[0][0]||t>e[i][1])return!1;for(;i>=s;)if(r=s+i>>1,t>e[r][1])s=r+1;else if(t<e[r][0])i=r-1;else return!0;return!1}var kd=class{constructor(){if(this.version="6",!ue){ue=new Uint8Array(65536),ue.fill(1),ue[0]=0,ue.fill(0,1,32),ue.fill(0,127,160),ue.fill(2,4352,4448),ue[9001]=2,ue[9002]=2,ue.fill(2,11904,42192),ue[12351]=1,ue.fill(2,44032,55204),ue.fill(2,63744,64256),ue.fill(2,65040,65050),ue.fill(2,65072,65136),ue.fill(2,65280,65377),ue.fill(2,65504,65511);for(let t=0;t<Ji.length;++t)ue.fill(0,Ji[t][0],Ji[t][1]+1)}}wcwidth(t){return t<32?0:t<127?1:t<65536?ue[t]:Cd(t,bd)?0:t>=131072&&t<=196605||t>=196608&&t<=262141?2:1}charProperties(t,e){let s=this.wcwidth(t),i=s===0&&e!==0;if(i){let r=Wt.extractWidth(e);r===0?i=!1:r>s&&(s=r)}return Wt.createPropertyValue(0,s,i)}},Wt=class fi{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new E,this.onChange=this._onChange.event;let e=new kd;this.register(e),this._active=e.version,this._activeProvider=e}static extractShouldJoin(e){return(e&1)!==0}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,s,i=!1){return(e&16777215)<<3|(s&3)<<1|(i?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let s=0,i=0,r=e.length;for(let n=0;n<r;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=r)return s+this.wcwidth(o);let l=e.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:s+=this.wcwidth(l)}let a=this.charProperties(o,i),h=fi.extractWidth(a);fi.extractShouldJoin(a)&&(h-=fi.extractWidth(i)),s+=h,i=a}return s}charProperties(e,s){return this._activeProvider.charProperties(e,s)}},xd=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(t){this.glevel=t,this.charset=this._charsets[t]}setgCharset(t,e){this._charsets[t]=e,this.glevel===t&&(this.charset=e)}};function uo(t){var i;let e=(i=t.buffer.lines.get(t.buffer.ybase+t.buffer.y-1))==null?void 0:i.get(t.cols-1),s=t.buffer.lines.get(t.buffer.ybase+t.buffer.y);s&&e&&(s.isWrapped=e[3]!==0&&e[3]!==32)}var ds=2147483647,Ed=256,Ga=class zr{constructor(e=32,s=32){if(this.maxLength=e,this.maxSubParamsLength=s,s>Ed)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(s),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(e){let s=new zr;if(!e.length)return s;for(let i=Array.isArray(e[0])?1:0;i<e.length;++i){let r=e[i];if(Array.isArray(r))for(let n=0;n<r.length;++n)s.addSubParam(r[n]);else s.addParam(r)}return s}clone(){let e=new zr(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){let e=[];for(let s=0;s<this.length;++s){e.push(this.params[s]);let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&e.push(Array.prototype.slice.call(this._subParams,i,r))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>ds?ds:e}addSubParam(e){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>ds?ds:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(this._subParamsIdx[e]&255)-(this._subParamsIdx[e]>>8)>0}getSubParams(e){let s=this._subParamsIdx[e]>>8,i=this._subParamsIdx[e]&255;return i-s>0?this._subParams.subarray(s,i):null}getSubParamsAll(){let e={};for(let s=0;s<this.length;++s){let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&(e[s]=this._subParams.slice(i,r))}return e}addDigit(e){let s;if(this._rejectDigits||!(s=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let i=this._digitIsSub?this._subParams:this.params,r=i[s-1];i[s-1]=~r?Math.min(r*10+e,ds):e}},us=[],Bd=class{constructor(){this._state=0,this._active=us,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(t,e){this._handlers[t]===void 0&&(this._handlers[t]=[]);let s=this._handlers[t];return s.push(e),{dispose:()=>{let i=s.indexOf(e);i!==-1&&s.splice(i,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=us}reset(){if(this._state===2)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].end(!1);this._stack.paused=!1,this._active=us,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||us,!this._active.length)this._handlerFb(this._id,"START");else for(let t=this._active.length-1;t>=0;t--)this._active[t].start()}_put(t,e,s){if(!this._active.length)this._handlerFb(this._id,"PUT",Di(t,e,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(t,e,s)}start(){this.reset(),this._state=1}put(t,e,s){if(this._state!==3){if(this._state===1)for(;e<s;){let i=t[e++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&s-e>0&&this._put(t,e,s)}}end(t,e=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",t);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=e,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].end(t),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].end(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=us,this._id=-1,this._state=0}}},We=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,s,i){this._hitLimit||(this._data+=Di(e,s,i),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let s=!1;if(this._hitLimit)s=!1;else if(e&&(s=this._handler(this._data),s instanceof Promise))return s.then(i=>(this._data="",this._hitLimit=!1,i));return this._data="",this._hitLimit=!1,s}},fs=[],Pd=class{constructor(){this._handlers=Object.create(null),this._active=fs,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=fs}registerHandler(t,e){this._handlers[t]===void 0&&(this._handlers[t]=[]);let s=this._handlers[t];return s.push(e),{dispose:()=>{let i=s.indexOf(e);i!==-1&&s.splice(i,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}reset(){if(this._active.length)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].unhook(!1);this._stack.paused=!1,this._active=fs,this._ident=0}hook(t,e){if(this.reset(),this._ident=t,this._active=this._handlers[t]||fs,!this._active.length)this._handlerFb(this._ident,"HOOK",e);else for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(e)}put(t,e,s){if(!this._active.length)this._handlerFb(this._ident,"PUT",Di(t,e,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(t,e,s)}unhook(t,e=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",t);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=e,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].unhook(t),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=fs,this._ident=0}},bs=new Ga;bs.addParam(0);var fo=class{constructor(t){this._handler=t,this._data="",this._params=bs,this._hitLimit=!1}hook(t){this._params=t.length>1||t.params[0]?t.clone():bs,this._data="",this._hitLimit=!1}put(t,e,s){this._hitLimit||(this._data+=Di(t,e,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(t){let e=!1;if(this._hitLimit)e=!1;else if(t&&(e=this._handler(this._data,this._params),e instanceof Promise))return e.then(s=>(this._params=bs,this._data="",this._hitLimit=!1,s));return this._params=bs,this._data="",this._hitLimit=!1,e}},Ld=class{constructor(t){this.table=new Uint8Array(t)}setDefault(t,e){this.table.fill(t<<4|e)}add(t,e,s,i){this.table[e<<8|t]=s<<4|i}addMany(t,e,s,i){for(let r=0;r<t.length;r++)this.table[e<<8|t[r]]=s<<4|i}},qe=160,Rd=(function(){let t=new Ld(4095),e=Array.apply(null,Array(256)).map((a,h)=>h),s=(a,h)=>e.slice(a,h),i=s(32,127),r=s(0,24);r.push(25),r.push.apply(r,s(28,32));let n=s(0,14),o;t.setDefault(1,0),t.addMany(i,0,2,0);for(o in n)t.addMany([24,26,153,154],o,3,0),t.addMany(s(128,144),o,3,0),t.addMany(s(144,152),o,3,0),t.add(156,o,0,0),t.add(27,o,11,1),t.add(157,o,4,8),t.addMany([152,158,159],o,0,7),t.add(155,o,11,3),t.add(144,o,11,9);return t.addMany(r,0,3,0),t.addMany(r,1,3,1),t.add(127,1,0,1),t.addMany(r,8,0,8),t.addMany(r,3,3,3),t.add(127,3,0,3),t.addMany(r,4,3,4),t.add(127,4,0,4),t.addMany(r,6,3,6),t.addMany(r,5,3,5),t.add(127,5,0,5),t.addMany(r,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(i,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(s(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(i,7,0,7),t.addMany(r,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(s(64,127),3,7,0),t.addMany(s(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(s(48,60),4,8,4),t.addMany(s(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(s(32,64),6,0,6),t.add(127,6,0,6),t.addMany(s(64,127),6,0,0),t.addMany(s(32,48),3,9,5),t.addMany(s(32,48),5,9,5),t.addMany(s(48,64),5,0,6),t.addMany(s(64,127),5,7,0),t.addMany(s(32,48),4,9,5),t.addMany(s(32,48),1,9,2),t.addMany(s(32,48),2,9,2),t.addMany(s(48,127),2,10,0),t.addMany(s(48,80),1,10,0),t.addMany(s(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(s(96,127),1,10,0),t.add(80,1,11,9),t.addMany(r,9,0,9),t.add(127,9,0,9),t.addMany(s(28,32),9,0,9),t.addMany(s(32,48),9,9,12),t.addMany(s(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(r,11,0,11),t.addMany(s(32,128),11,0,11),t.addMany(s(28,32),11,0,11),t.addMany(r,10,0,10),t.add(127,10,0,10),t.addMany(s(28,32),10,0,10),t.addMany(s(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(s(32,48),10,9,12),t.addMany(r,12,0,12),t.add(127,12,0,12),t.addMany(s(28,32),12,0,12),t.addMany(s(32,48),12,9,12),t.addMany(s(48,64),12,0,11),t.addMany(s(64,127),12,12,13),t.addMany(s(64,127),10,12,13),t.addMany(s(64,127),9,12,13),t.addMany(r,13,13,13),t.addMany(i,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(qe,0,2,0),t.add(qe,8,5,8),t.add(qe,6,0,6),t.add(qe,11,0,11),t.add(qe,13,13,13),t})(),Ad=class extends O{constructor(t=Rd){super(),this._transitions=t,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new Ga,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,s,i)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,s)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(J(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new Bd),this._dcsParser=this._register(new Pd),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(t,e=[64,126]){let s=0;if(t.prefix){if(t.prefix.length>1)throw new Error("only one byte as prefix supported");if(s=t.prefix.charCodeAt(0),s&&60>s||s>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(t.intermediates){if(t.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let r=0;r<t.intermediates.length;++r){let n=t.intermediates.charCodeAt(r);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=n}}if(t.final.length!==1)throw new Error("final must be a single byte");let i=t.final.charCodeAt(0);if(e[0]>i||i>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return s<<=8,s|=i,s}identToString(t){let e=[];for(;t;)e.push(String.fromCharCode(t&255)),t>>=8;return e.reverse().join("")}setPrintHandler(t){this._printHandler=t}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(t,e){let s=this._identifier(t,[48,126]);this._escHandlers[s]===void 0&&(this._escHandlers[s]=[]);let i=this._escHandlers[s];return i.push(e),{dispose:()=>{let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}}clearEscHandler(t){this._escHandlers[this._identifier(t,[48,126])]&&delete this._escHandlers[this._identifier(t,[48,126])]}setEscHandlerFallback(t){this._escHandlerFb=t}setExecuteHandler(t,e){this._executeHandlers[t.charCodeAt(0)]=e}clearExecuteHandler(t){this._executeHandlers[t.charCodeAt(0)]&&delete this._executeHandlers[t.charCodeAt(0)]}setExecuteHandlerFallback(t){this._executeHandlerFb=t}registerCsiHandler(t,e){let s=this._identifier(t);this._csiHandlers[s]===void 0&&(this._csiHandlers[s]=[]);let i=this._csiHandlers[s];return i.push(e),{dispose:()=>{let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}}clearCsiHandler(t){this._csiHandlers[this._identifier(t)]&&delete this._csiHandlers[this._identifier(t)]}setCsiHandlerFallback(t){this._csiHandlerFb=t}registerDcsHandler(t,e){return this._dcsParser.registerHandler(this._identifier(t),e)}clearDcsHandler(t){this._dcsParser.clearHandler(this._identifier(t))}setDcsHandlerFallback(t){this._dcsParser.setHandlerFallback(t)}registerOscHandler(t,e){return this._oscParser.registerHandler(t,e)}clearOscHandler(t){this._oscParser.clearHandler(t)}setOscHandlerFallback(t){this._oscParser.setHandlerFallback(t)}setErrorHandler(t){this._errorHandler=t}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(t,e,s,i,r){this._parseStack.state=t,this._parseStack.handlers=e,this._parseStack.handlerPos=s,this._parseStack.transition=i,this._parseStack.chunkPos=r}parse(t,e,s){let i=0,r=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(s===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let a=this._parseStack.handlers,h=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(s===!1&&h>-1){for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 4:if(s===!1&&h>-1){for(;h>=0&&(o=a[h](),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 6:if(i=t[this._parseStack.chunkPos],o=this._dcsParser.unhook(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=t[this._parseStack.chunkPos],o=this._oscParser.end(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let a=n;a<e;++a){switch(i=t[a],r=this._transitions.table[this.currentState<<8|(i<160?i:qe)],r>>4){case 2:for(let u=a+1;;++u){if(u>=e||(i=t[u])<32||i>126&&i<qe){this._printHandler(t,a,u),a=u-1;break}if(++u>=e||(i=t[u])<32||i>126&&i<qe){this._printHandler(t,a,u),a=u-1;break}if(++u>=e||(i=t[u])<32||i>126&&i<qe){this._printHandler(t,a,u),a=u-1;break}if(++u>=e||(i=t[u])<32||i>126&&i<qe){this._printHandler(t,a,u),a=u-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:a,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let h=this._csiHandlers[this._collect<<8|i],l=h?h.length-1:-1;for(;l>=0&&(o=h[l](this._params),o!==!0);l--)if(o instanceof Promise)return this._preserveStack(3,h,l,r,a),o;l<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}while(++a<e&&(i=t[a])>47&&i<60);a--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:let c=this._escHandlers[this._collect<<8|i],d=c?c.length-1:-1;for(;d>=0&&(o=c[d](),o!==!0);d--)if(o instanceof Promise)return this._preserveStack(4,c,d,r,a),o;d<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let u=a+1;;++u)if(u>=e||(i=t[u])===24||i===26||i===27||i>127&&i<qe){this._dcsParser.put(t,a,u),a=u-1;break}break;case 14:if(o=this._dcsParser.unhook(i!==24&&i!==26),o)return this._preserveStack(6,[],0,r,a),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let u=a+1;;u++)if(u>=e||(i=t[u])<32||i>127&&i<qe){this._oscParser.put(t,a,u),a=u-1;break}break;case 6:if(o=this._oscParser.end(i!==24&&i!==26),o)return this._preserveStack(5,[],0,r,a),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=r&15}}},Dd=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,Md=/^[\da-f]+$/;function _o(t){if(!t)return;let e=t.toLowerCase();if(e.indexOf("rgb:")===0){e=e.slice(4);let s=Dd.exec(e);if(s){let i=s[1]?15:s[4]?255:s[7]?4095:65535;return[Math.round(parseInt(s[1]||s[4]||s[7]||s[10],16)/i*255),Math.round(parseInt(s[2]||s[5]||s[8]||s[11],16)/i*255),Math.round(parseInt(s[3]||s[6]||s[9]||s[12],16)/i*255)]}}else if(e.indexOf("#")===0&&(e=e.slice(1),Md.exec(e)&&[3,6,9,12].includes(e.length))){let s=e.length/3,i=[0,0,0];for(let r=0;r<3;++r){let n=parseInt(e.slice(s*r,s*r+s),16);i[r]=s===1?n<<4:s===2?n:s===3?n>>4:n>>8}return i}}function Zi(t,e){let s=t.toString(16),i=s.length<2?"0"+s:s;switch(e){case 4:return s[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}function Id(t,e=16){let[s,i,r]=t;return`rgb:${Zi(s,e)}/${Zi(i,e)}/${Zi(r,e)}`}var Td={"(":0,")":1,"*":2,"+":3,"-":1,".":2},kt=131072,po=10;function mo(t,e){if(t>24)return e.setWinLines||!1;switch(t){case 1:return!!e.restoreWin;case 2:return!!e.minimizeWin;case 3:return!!e.setWinPosition;case 4:return!!e.setWinSizePixels;case 5:return!!e.raiseWin;case 6:return!!e.lowerWin;case 7:return!!e.refreshWin;case 8:return!!e.setWinSizeChars;case 9:return!!e.maximizeWin;case 10:return!!e.fullscreenWin;case 11:return!!e.getWinState;case 13:return!!e.getWinPosition;case 14:return!!e.getWinSizePixels;case 15:return!!e.getScreenSizePixels;case 16:return!!e.getCellSizePixels;case 18:return!!e.getWinSizeChars;case 19:return!!e.getScreenSizeChars;case 20:return!!e.getIconTitle;case 21:return!!e.getWinTitle;case 22:return!!e.pushTitle;case 23:return!!e.popTitle;case 24:return!!e.setWinLines}return!1}var go=5e3,vo=0,Od=class extends O{constructor(t,e,s,i,r,n,o,a,h=new Ad){super(),this._bufferService=t,this._charsetService=e,this._coreService=s,this._logService=i,this._optionsService=r,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=a,this._parser=h,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new th,this._utf8Decoder=new sh,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=ae.clone(),this._eraseAttrDataInternal=ae.clone(),this._onRequestBell=this._register(new E),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new E),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new E),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new E),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new E),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new E),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new E),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new E),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new E),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new E),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new E),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new E),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new E),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new Fr(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(l=>this._activeBuffer=l.activeBuffer)),this._parser.setCsiHandlerFallback((l,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(l),params:c.toArray()})}),this._parser.setEscHandlerFallback(l=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(l)})}),this._parser.setExecuteHandlerFallback(l=>{this._logService.debug("Unknown EXECUTE code: ",{code:l})}),this._parser.setOscHandlerFallback((l,c,d)=>{this._logService.debug("Unknown OSC code: ",{identifier:l,action:c,data:d})}),this._parser.setDcsHandlerFallback((l,c,d)=>{c==="HOOK"&&(d=d.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(l),action:c,payload:d})}),this._parser.setPrintHandler((l,c,d)=>this.print(l,c,d)),this._parser.registerCsiHandler({final:"@"},l=>this.insertChars(l)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},l=>this.scrollLeft(l)),this._parser.registerCsiHandler({final:"A"},l=>this.cursorUp(l)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},l=>this.scrollRight(l)),this._parser.registerCsiHandler({final:"B"},l=>this.cursorDown(l)),this._parser.registerCsiHandler({final:"C"},l=>this.cursorForward(l)),this._parser.registerCsiHandler({final:"D"},l=>this.cursorBackward(l)),this._parser.registerCsiHandler({final:"E"},l=>this.cursorNextLine(l)),this._parser.registerCsiHandler({final:"F"},l=>this.cursorPrecedingLine(l)),this._parser.registerCsiHandler({final:"G"},l=>this.cursorCharAbsolute(l)),this._parser.registerCsiHandler({final:"H"},l=>this.cursorPosition(l)),this._parser.registerCsiHandler({final:"I"},l=>this.cursorForwardTab(l)),this._parser.registerCsiHandler({final:"J"},l=>this.eraseInDisplay(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},l=>this.eraseInDisplay(l,!0)),this._parser.registerCsiHandler({final:"K"},l=>this.eraseInLine(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},l=>this.eraseInLine(l,!0)),this._parser.registerCsiHandler({final:"L"},l=>this.insertLines(l)),this._parser.registerCsiHandler({final:"M"},l=>this.deleteLines(l)),this._parser.registerCsiHandler({final:"P"},l=>this.deleteChars(l)),this._parser.registerCsiHandler({final:"S"},l=>this.scrollUp(l)),this._parser.registerCsiHandler({final:"T"},l=>this.scrollDown(l)),this._parser.registerCsiHandler({final:"X"},l=>this.eraseChars(l)),this._parser.registerCsiHandler({final:"Z"},l=>this.cursorBackwardTab(l)),this._parser.registerCsiHandler({final:"`"},l=>this.charPosAbsolute(l)),this._parser.registerCsiHandler({final:"a"},l=>this.hPositionRelative(l)),this._parser.registerCsiHandler({final:"b"},l=>this.repeatPrecedingCharacter(l)),this._parser.registerCsiHandler({final:"c"},l=>this.sendDeviceAttributesPrimary(l)),this._parser.registerCsiHandler({prefix:">",final:"c"},l=>this.sendDeviceAttributesSecondary(l)),this._parser.registerCsiHandler({final:"d"},l=>this.linePosAbsolute(l)),this._parser.registerCsiHandler({final:"e"},l=>this.vPositionRelative(l)),this._parser.registerCsiHandler({final:"f"},l=>this.hVPosition(l)),this._parser.registerCsiHandler({final:"g"},l=>this.tabClear(l)),this._parser.registerCsiHandler({final:"h"},l=>this.setMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"h"},l=>this.setModePrivate(l)),this._parser.registerCsiHandler({final:"l"},l=>this.resetMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"l"},l=>this.resetModePrivate(l)),this._parser.registerCsiHandler({final:"m"},l=>this.charAttributes(l)),this._parser.registerCsiHandler({final:"n"},l=>this.deviceStatus(l)),this._parser.registerCsiHandler({prefix:"?",final:"n"},l=>this.deviceStatusPrivate(l)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},l=>this.softReset(l)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},l=>this.setCursorStyle(l)),this._parser.registerCsiHandler({final:"r"},l=>this.setScrollRegion(l)),this._parser.registerCsiHandler({final:"s"},l=>this.saveCursor(l)),this._parser.registerCsiHandler({final:"t"},l=>this.windowOptions(l)),this._parser.registerCsiHandler({final:"u"},l=>this.restoreCursor(l)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},l=>this.insertColumns(l)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},l=>this.deleteColumns(l)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},l=>this.selectProtected(l)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},l=>this.requestMode(l,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},l=>this.requestMode(l,!1)),this._parser.setExecuteHandler(g.BEL,()=>this.bell()),this._parser.setExecuteHandler(g.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(g.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(g.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(g.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(g.BS,()=>this.backspace()),this._parser.setExecuteHandler(g.HT,()=>this.tab()),this._parser.setExecuteHandler(g.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(g.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(di.IND,()=>this.index()),this._parser.setExecuteHandler(di.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(di.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new We(l=>(this.setTitle(l),this.setIconName(l),!0))),this._parser.registerOscHandler(1,new We(l=>this.setIconName(l))),this._parser.registerOscHandler(2,new We(l=>this.setTitle(l))),this._parser.registerOscHandler(4,new We(l=>this.setOrReportIndexedColor(l))),this._parser.registerOscHandler(8,new We(l=>this.setHyperlink(l))),this._parser.registerOscHandler(10,new We(l=>this.setOrReportFgColor(l))),this._parser.registerOscHandler(11,new We(l=>this.setOrReportBgColor(l))),this._parser.registerOscHandler(12,new We(l=>this.setOrReportCursorColor(l))),this._parser.registerOscHandler(104,new We(l=>this.restoreIndexedColor(l))),this._parser.registerOscHandler(110,new We(l=>this.restoreFgColor(l))),this._parser.registerOscHandler(111,new We(l=>this.restoreBgColor(l))),this._parser.registerOscHandler(112,new We(l=>this.restoreCursorColor(l))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let l in pe)this._parser.registerEscHandler({intermediates:"(",final:l},()=>this.selectCharset("("+l)),this._parser.registerEscHandler({intermediates:")",final:l},()=>this.selectCharset(")"+l)),this._parser.registerEscHandler({intermediates:"*",final:l},()=>this.selectCharset("*"+l)),this._parser.registerEscHandler({intermediates:"+",final:l},()=>this.selectCharset("+"+l)),this._parser.registerEscHandler({intermediates:"-",final:l},()=>this.selectCharset("-"+l)),this._parser.registerEscHandler({intermediates:".",final:l},()=>this.selectCharset("."+l)),this._parser.registerEscHandler({intermediates:"/",final:l},()=>this.selectCharset("/"+l));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(l=>(this._logService.error("Parsing error: ",l),l)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new fo((l,c)=>this.requestStatusString(l,c)))}getAttrData(){return this._curAttrData}_preserveStack(t,e,s,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=t,this._parseStack.cursorStartY=e,this._parseStack.decodedLength=s,this._parseStack.position=i}_logSlowResolvingAsync(t){this._logService.logLevel<=3&&Promise.race([t,new Promise((e,s)=>setTimeout(()=>s("#SLOW_TIMEOUT"),go))]).catch(e=>{if(e!=="#SLOW_TIMEOUT")throw e;console.warn(`async parser handler taking longer than ${go} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(t,e){let s,i=this._activeBuffer.x,r=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(s=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,e))return this._logSlowResolvingAsync(s),s;i=this._parseStack.cursorStartX,r=this._parseStack.cursorStartY,this._parseStack.paused=!1,t.length>kt&&(n=this._parseStack.position+kt)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof t=="string"?` "${t}"`:` "${Array.prototype.map.call(t,l=>String.fromCharCode(l)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof t=="string"?t.split("").map(l=>l.charCodeAt(0)):t),this._parseBuffer.length<t.length&&this._parseBuffer.length<kt&&(this._parseBuffer=new Uint32Array(Math.min(t.length,kt))),o||this._dirtyRowTracker.clearRange(),t.length>kt)for(let l=n;l<t.length;l+=kt){let c=l+kt<t.length?l+kt:t.length,d=typeof t=="string"?this._stringDecoder.decode(t.substring(l,c),this._parseBuffer):this._utf8Decoder.decode(t.subarray(l,c),this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,d))return this._preserveStack(i,r,d,l),this._logSlowResolvingAsync(s),s}else if(!o){let l=typeof t=="string"?this._stringDecoder.decode(t,this._parseBuffer):this._utf8Decoder.decode(t,this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,l))return this._preserveStack(i,r,l,0),this._logSlowResolvingAsync(s),s}(this._activeBuffer.x!==i||this._activeBuffer.y!==r)&&this._onCursorMove.fire();let a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(h,this._bufferService.rows-1),end:Math.min(a,this._bufferService.rows-1)})}print(t,e,s){let i,r,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,l=this._coreService.modes.insertMode,c=this._curAttrData,d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&s-e>0&&d.getWidth(this._activeBuffer.x-1)===2&&d.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let u=this._parser.precedingJoinState;for(let _=e;_<s;++_){if(i=t[_],i<127&&n){let S=n[String.fromCharCode(i)];S&&(i=S.charCodeAt(0))}let f=this._unicodeService.charProperties(i,u);r=Wt.extractWidth(f);let p=Wt.extractShouldJoin(f),m=p?Wt.extractWidth(u):0;if(u=f,o&&this._onA11yChar.fire(xt(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+r-m>a){if(h){let S=d,y=this._activeBuffer.x-m;for(this._activeBuffer.x=m,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),m>0&&d instanceof ws&&d.copyCellsFrom(S,y,0,m,!1);y<a;)S.setCellFromCodepoint(y++,0,1,c)}else if(this._activeBuffer.x=a-1,r===2)continue}if(p&&this._activeBuffer.x){let S=d.getWidth(this._activeBuffer.x-1)?1:2;d.addCodepointToCell(this._activeBuffer.x-S,i,r);for(let y=r-m;--y>=0;)d.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(l&&(d.insertCells(this._activeBuffer.x,r-m,this._activeBuffer.getNullCell(c)),d.getWidth(a-1)===2&&d.setCellFromCodepoint(a-1,0,1,c)),d.setCellFromCodepoint(this._activeBuffer.x++,i,r,c),r>0)for(;--r;)d.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=u,this._activeBuffer.x<a&&s-e>0&&d.getWidth(this._activeBuffer.x)===0&&!d.hasContent(this._activeBuffer.x)&&d.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(t,e){return t.final==="t"&&!t.prefix&&!t.intermediates?this._parser.registerCsiHandler(t,s=>mo(s.params[0],this._optionsService.rawOptions.windowOptions)?e(s):!0):this._parser.registerCsiHandler(t,e)}registerDcsHandler(t,e){return this._parser.registerDcsHandler(t,new fo(e))}registerEscHandler(t,e){return this._parser.registerEscHandler(t,e)}registerOscHandler(t,e){return this._parser.registerOscHandler(t,new We(e))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var t;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&t.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-t),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(t=this._bufferService.cols-1){this._activeBuffer.x=Math.min(t,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(t,e){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=t,this._activeBuffer.y=this._activeBuffer.scrollTop+e):(this._activeBuffer.x=t,this._activeBuffer.y=e),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(t,e){this._restrictCursor(),this._setCursor(this._activeBuffer.x+t,this._activeBuffer.y+e)}cursorUp(t){let e=this._activeBuffer.y-this._activeBuffer.scrollTop;return e>=0?this._moveCursor(0,-Math.min(e,t.params[0]||1)):this._moveCursor(0,-(t.params[0]||1)),!0}cursorDown(t){let e=this._activeBuffer.scrollBottom-this._activeBuffer.y;return e>=0?this._moveCursor(0,Math.min(e,t.params[0]||1)):this._moveCursor(0,t.params[0]||1),!0}cursorForward(t){return this._moveCursor(t.params[0]||1,0),!0}cursorBackward(t){return this._moveCursor(-(t.params[0]||1),0),!0}cursorNextLine(t){return this.cursorDown(t),this._activeBuffer.x=0,!0}cursorPrecedingLine(t){return this.cursorUp(t),this._activeBuffer.x=0,!0}cursorCharAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(t){return this._setCursor(t.length>=2?(t.params[1]||1)-1:0,(t.params[0]||1)-1),!0}charPosAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(t){return this._moveCursor(t.params[0]||1,0),!0}linePosAbsolute(t){return this._setCursor(this._activeBuffer.x,(t.params[0]||1)-1),!0}vPositionRelative(t){return this._moveCursor(0,t.params[0]||1),!0}hVPosition(t){return this.cursorPosition(t),!0}tabClear(t){let e=t.params[0];return e===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:e===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=t.params[0]||1;for(;e--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=t.params[0]||1;for(;e--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(t){let e=t.params[0];return e===1&&(this._curAttrData.bg|=536870912),(e===2||e===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(t,e,s,i=!1,r=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);n.replaceCells(e,s,this._activeBuffer.getNullCell(this._eraseAttrData()),r),i&&(n.isWrapped=!1)}_resetBufferLine(t,e=!1){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);s&&(s.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),e),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+t),s.isWrapped=!1)}eraseInDisplay(t,e=!1){var i;this._restrictCursor(this._bufferService.cols);let s;switch(t.params[0]){case 0:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,e);s<this._bufferService.rows;s++)this._resetBufferLine(s,e);this._dirtyRowTracker.markDirty(s);break;case 1:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s,0,this._activeBuffer.x+1,!0,e),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(s+1).isWrapped=!1);s--;)this._resetBufferLine(s,e);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(s=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,s-1);s--&&!((i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s))!=null&&i.getTrimmedLength()););for(;s>=0;s--)this._bufferService.scroll(this._eraseAttrData())}else{for(s=this._bufferService.rows,this._dirtyRowTracker.markDirty(s-1);s--;)this._resetBufferLine(s,e);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0));break}return!0}eraseInLine(t,e=!1){switch(this._restrictCursor(this._bufferService.cols),t.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,e);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,e);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,e);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(t){this._restrictCursor();let e=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;e--;)this._activeBuffer.lines.splice(r-1,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(t){this._restrictCursor();let e=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;e--;)this._activeBuffer.lines.splice(s,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(t){this._restrictCursor();let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return e&&(e.insertCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(t){this._restrictCursor();let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return e&&(e.deleteCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(t){let e=t.params[0]||1;for(;e--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(t){let e=t.params[0]||1;for(;e--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(ae));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let e=t.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(0,e,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let e=t.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(0,e,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let e=t.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(this._activeBuffer.x,e,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let e=t.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(this._activeBuffer.x,e,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(t){this._restrictCursor();let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return e&&(e.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(t.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(t){let e=this._parser.precedingJoinState;if(!e)return!0;let s=t.params[0]||1,i=Wt.extractWidth(e),r=this._activeBuffer.x-i,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(r),o=new Uint32Array(n.length*s),a=0;for(let l=0;l<n.length;){let c=n.codePointAt(l)||0;o[a++]=c,l+=c>65535?2:1}let h=a;for(let l=1;l<s;++l)o.copyWithin(h,0,a),h+=a;return this.print(o,0,h),!0}sendDeviceAttributesPrimary(t){return t.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(g.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(g.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(t){return t.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(g.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(g.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(t.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(g.ESC+"[>83;40003;0c")),!0}_is(t){return(this._optionsService.rawOptions.termName+"").indexOf(t)===0}setMode(t){for(let e=0;e<t.length;e++)switch(t.params[e]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(t){for(let e=0;e<t.length;e++)switch(t.params[e]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Ht),this._charsetService.setgCharset(1,Ht),this._charsetService.setgCharset(2,Ht),this._charsetService.setgCharset(3,Ht);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(t){for(let e=0;e<t.length;e++)switch(t.params[e]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(t){for(let e=0;e<t.length;e++)switch(t.params[e]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),t.params[e]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(t,e){(p=>(p[p.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",p[p.SET=1]="SET",p[p.RESET=2]="RESET",p[p.PERMANENTLY_SET=3]="PERMANENTLY_SET",p[p.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(void 0||(s={}));let i=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:a,cols:h}=this._bufferService,{active:l,alt:c}=a,d=this._optionsService.rawOptions,u=(p,m)=>(o.triggerDataEvent(`${g.ESC}[${e?"":"?"}${p};${m}$y`),!0),_=p=>p?1:2,f=t.params[0];return e?f===2?u(f,4):f===4?u(f,_(o.modes.insertMode)):f===12?u(f,3):f===20?u(f,_(d.convertEol)):u(f,0):f===1?u(f,_(i.applicationCursorKeys)):f===3?u(f,d.windowOptions.setWinLines?h===80?2:h===132?1:0:0):f===6?u(f,_(i.origin)):f===7?u(f,_(i.wraparound)):f===8?u(f,3):f===9?u(f,_(r==="X10")):f===12?u(f,_(d.cursorBlink)):f===25?u(f,_(!o.isCursorHidden)):f===45?u(f,_(i.reverseWraparound)):f===66?u(f,_(i.applicationKeypad)):f===67?u(f,4):f===1e3?u(f,_(r==="VT200")):f===1002?u(f,_(r==="DRAG")):f===1003?u(f,_(r==="ANY")):f===1004?u(f,_(i.sendFocus)):f===1005?u(f,4):f===1006?u(f,_(n==="SGR")):f===1015?u(f,4):f===1016?u(f,_(n==="SGR_PIXELS")):f===1048?u(f,1):f===47||f===1047||f===1049?u(f,_(l===c)):f===2004?u(f,_(i.bracketedPasteMode)):f===2026?u(f,_(i.synchronizedOutput)):u(f,0)}_updateAttrColor(t,e,s,i,r){return e===2?(t|=50331648,t&=-16777216,t|=Fs.fromColorRGB([s,i,r])):e===5&&(t&=-50331904,t|=33554432|s&255),t}_extractColor(t,e,s){let i=[0,0,-1,0,0,0],r=0,n=0;do{if(i[n+r]=t.params[e+n],t.hasSubParams(e+n)){let o=t.getSubParams(e+n),a=0;do i[1]===5&&(r=1),i[n+a+1+r]=o[a];while(++a<o.length&&a+n+1+r<i.length);break}if(i[1]===5&&n+r>=2||i[1]===2&&n+r>=5)break;i[1]&&(r=1)}while(++n+e<t.length&&n+r<i.length);for(let o=2;o<i.length;++o)i[o]===-1&&(i[o]=0);switch(i[0]){case 38:s.fg=this._updateAttrColor(s.fg,i[1],i[3],i[4],i[5]);break;case 48:s.bg=this._updateAttrColor(s.bg,i[1],i[3],i[4],i[5]);break;case 58:s.extended=s.extended.clone(),s.extended.underlineColor=this._updateAttrColor(s.extended.underlineColor,i[1],i[3],i[4],i[5])}return n}_processUnderline(t,e){e.extended=e.extended.clone(),(!~t||t>5)&&(t=1),e.extended.underlineStyle=t,e.fg|=268435456,t===0&&(e.fg&=-268435457),e.updateExtended()}_processSGR0(t){t.fg=ae.fg,t.bg=ae.bg,t.extended=t.extended.clone(),t.extended.underlineStyle=0,t.extended.underlineColor&=-67108864,t.updateExtended()}charAttributes(t){if(t.length===1&&t.params[0]===0)return this._processSGR0(this._curAttrData),!0;let e=t.length,s,i=this._curAttrData;for(let r=0;r<e;r++)s=t.params[r],s>=30&&s<=37?(i.fg&=-50331904,i.fg|=16777216|s-30):s>=40&&s<=47?(i.bg&=-50331904,i.bg|=16777216|s-40):s>=90&&s<=97?(i.fg&=-50331904,i.fg|=16777216|s-90|8):s>=100&&s<=107?(i.bg&=-50331904,i.bg|=16777216|s-100|8):s===0?this._processSGR0(i):s===1?i.fg|=134217728:s===3?i.bg|=67108864:s===4?(i.fg|=268435456,this._processUnderline(t.hasSubParams(r)?t.getSubParams(r)[0]:1,i)):s===5?i.fg|=536870912:s===7?i.fg|=67108864:s===8?i.fg|=1073741824:s===9?i.fg|=2147483648:s===2?i.bg|=134217728:s===21?this._processUnderline(2,i):s===22?(i.fg&=-134217729,i.bg&=-134217729):s===23?i.bg&=-67108865:s===24?(i.fg&=-268435457,this._processUnderline(0,i)):s===25?i.fg&=-536870913:s===27?i.fg&=-67108865:s===28?i.fg&=-1073741825:s===29?i.fg&=2147483647:s===39?(i.fg&=-67108864,i.fg|=ae.fg&16777215):s===49?(i.bg&=-67108864,i.bg|=ae.bg&16777215):s===38||s===48||s===58?r+=this._extractColor(t,r,i):s===53?i.bg|=1073741824:s===55?i.bg&=-1073741825:s===59?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):s===100?(i.fg&=-67108864,i.fg|=ae.fg&16777215,i.bg&=-67108864,i.bg|=ae.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",s);return!0}deviceStatus(t){switch(t.params[0]){case 5:this._coreService.triggerDataEvent(`${g.ESC}[0n`);break;case 6:let e=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${g.ESC}[${e};${s}R`);break}return!0}deviceStatusPrivate(t){switch(t.params[0]){case 6:let e=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${g.ESC}[?${e};${s}R`);break}return!0}softReset(t){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=ae.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(t){let e=t.length===0?1:t.params[0];if(e===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(e){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let s=e%2===1;this._coreService.decPrivateModes.cursorBlink=s}return!0}setScrollRegion(t){let e=t.params[0]||1,s;return(t.length<2||(s=t.params[1])>this._bufferService.rows||s===0)&&(s=this._bufferService.rows),s>e&&(this._activeBuffer.scrollTop=e-1,this._activeBuffer.scrollBottom=s-1,this._setCursor(0,0)),!0}windowOptions(t){if(!mo(t.params[0],this._optionsService.rawOptions.windowOptions))return!0;let e=t.length>1?t.params[1]:0;switch(t.params[0]){case 14:e!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${g.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(e===0||e===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>po&&this._windowTitleStack.shift()),(e===0||e===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>po&&this._iconNameStack.shift());break;case 23:(e===0||e===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(e===0||e===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(t){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(t){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(t){return this._windowTitle=t,this._onTitleChange.fire(t),!0}setIconName(t){return this._iconName=t,!0}setOrReportIndexedColor(t){let e=[],s=t.split(";");for(;s.length>1;){let i=s.shift(),r=s.shift();if(/^\d+$/.exec(i)){let n=parseInt(i);if(So(n))if(r==="?")e.push({type:0,index:n});else{let o=_o(r);o&&e.push({type:1,index:n,color:o})}}}return e.length&&this._onColor.fire(e),!0}setHyperlink(t){let e=t.indexOf(";");if(e===-1)return!0;let s=t.slice(0,e).trim(),i=t.slice(e+1);return i?this._createHyperlink(s,i):s.trim()?!1:this._finishHyperlink()}_createHyperlink(t,e){this._getCurrentLinkId()&&this._finishHyperlink();let s=t.split(":"),i,r=s.findIndex(n=>n.startsWith("id="));return r!==-1&&(i=s[r].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:e}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(t,e){let s=t.split(";");for(let i=0;i<s.length&&!(e>=this._specialColors.length);++i,++e)if(s[i]==="?")this._onColor.fire([{type:0,index:this._specialColors[e]}]);else{let r=_o(s[i]);r&&this._onColor.fire([{type:1,index:this._specialColors[e],color:r}])}return!0}setOrReportFgColor(t){return this._setOrReportSpecialColor(t,0)}setOrReportBgColor(t){return this._setOrReportSpecialColor(t,1)}setOrReportCursorColor(t){return this._setOrReportSpecialColor(t,2)}restoreIndexedColor(t){if(!t)return this._onColor.fire([{type:2}]),!0;let e=[],s=t.split(";");for(let i=0;i<s.length;++i)if(/^\d+$/.exec(s[i])){let r=parseInt(s[i]);So(r)&&e.push({type:2,index:r})}return e.length&&this._onColor.fire(e),!0}restoreFgColor(t){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(t){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(t){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Ht),!0}selectCharset(t){return t.length!==2?(this.selectDefaultCharset(),!0):(t[0]==="/"||this._charsetService.setgCharset(Td[t[0]],pe[t[1]]||Ht),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let t=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,t,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=ae.clone(),this._eraseAttrDataInternal=ae.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(t){return this._charsetService.setgLevel(t),!0}screenAlignmentPattern(){let t=new Ge;t.content=1<<22|69,t.fg=this._curAttrData.fg,t.bg=this._curAttrData.bg,this._setCursor(0,0);for(let e=0;e<this._bufferService.rows;++e){let s=this._activeBuffer.ybase+this._activeBuffer.y+e,i=this._activeBuffer.lines.get(s);i&&(i.fill(t),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(t,e){let s=o=>(this._coreService.triggerDataEvent(`${g.ESC}${o}${g.ESC}\\`),!0),i=this._bufferService.buffer,r=this._optionsService.rawOptions;return s(t==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:t==='"p'?'P1$r61;1"p':t==="r"?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:t==="m"?"P1$r0m":t===" q"?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(t,e){this._dirtyRowTracker.markRangeDirty(t,e)}},Fr=class{constructor(t){this._bufferService=t,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(t){t<this.start?this.start=t:t>this.end&&(this.end=t)}markRangeDirty(t,e){t>e&&(vo=t,t=e,e=vo),t<this.start&&(this.start=t),e>this.end&&(this.end=e)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};Fr=se([R(0,Te)],Fr);function So(t){return 0<=t&&t<256}var Nd=5e7,wo=12,Hd=50,zd=class extends O{constructor(t){super(),this._action=t,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new E),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(t,e){if(e!==void 0&&this._syncCalls>e){this._syncCalls=0;return}if(this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let s;for(;s=this._writeBuffer.shift();){this._action(s);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(t,e){if(this._pendingData>Nd)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(e),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(e)}_innerWrite(t=0,e=!0){let s=t||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],r=this._action(i,e);if(r){let o=a=>performance.now()-s>=wo?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(s,a);r.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=i.length,performance.now()-s>=wo)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>Hd&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},Wr=class{constructor(t){this._bufferService=t,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(t){let e=this._bufferService.buffer;if(t.id===void 0){let a=e.addMarker(e.ybase+e.y),h={data:t,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(h,a)),this._dataByLinkId.set(h.id,h),h.id}let s=t,i=this._getEntryIdKey(s),r=this._entriesWithId.get(i);if(r)return this.addLineToLink(r.id,e.ybase+e.y),r.id;let n=e.addMarker(e.ybase+e.y),o={id:this._nextId++,key:this._getEntryIdKey(s),data:s,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(t,e){let s=this._dataByLinkId.get(t);if(s&&s.lines.every(i=>i.line!==e)){let i=this._bufferService.buffer.addMarker(e);s.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(s,i))}}getLinkData(t){var e;return(e=this._dataByLinkId.get(t))==null?void 0:e.data}_getEntryIdKey(t){return`${t.id};;${t.uri}`}_removeMarkerFromLink(t,e){let s=t.lines.indexOf(e);s!==-1&&(t.lines.splice(s,1),t.lines.length===0&&(t.data.id!==void 0&&this._entriesWithId.delete(t.key),this._dataByLinkId.delete(t.id)))}};Wr=se([R(0,Te)],Wr);var yo=!1,Fd=class extends O{constructor(t){super(),this._windowsWrappingHeuristics=this._register(new rs),this._onBinary=this._register(new E),this.onBinary=this._onBinary.event,this._onData=this._register(new E),this.onData=this._onData.event,this._onLineFeed=this._register(new E),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new E),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new E),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new E),this._instantiationService=new cd,this.optionsService=this._register(new wd(t)),this._instantiationService.setService(Oe,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(Or)),this._instantiationService.setService(Te,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(Tr)),this._instantiationService.setService(pa,this._logService),this.coreService=this._register(this._instantiationService.createInstance(Nr)),this._instantiationService.setService(Gt,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(Hr)),this._instantiationService.setService(_a,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(Wt)),this._instantiationService.setService(oh,this.unicodeService),this._charsetService=this._instantiationService.createInstance(xd),this._instantiationService.setService(nh,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(Wr),this._instantiationService.setService(ma,this._oscLinkService),this._inputHandler=this._register(new Od(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(Pe.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(Pe.forward(this._bufferService.onResize,this._onResize)),this._register(Pe.forward(this.coreService.onData,this._onData)),this._register(Pe.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new zd((e,s)=>this._inputHandler.parse(e,s))),this._register(Pe.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new E),this._onScroll.event(t=>{var e;(e=this._onScrollApi)==null||e.fire(t.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(t){for(let e in t)this.optionsService.options[e]=t[e]}write(t,e){this._writeBuffer.write(t,e)}writeSync(t,e){this._logService.logLevel<=3&&!yo&&(this._logService.warn("writeSync is unreliable and will be removed soon."),yo=!0),this._writeBuffer.writeSync(t,e)}input(t,e=!0){this.coreService.triggerDataEvent(t,e)}resize(t,e){isNaN(t)||isNaN(e)||(t=Math.max(t,ja),e=Math.max(e,Xa),this._bufferService.resize(t,e))}scroll(t,e=!1){this._bufferService.scroll(t,e)}scrollLines(t,e){this._bufferService.scrollLines(t,e)}scrollPages(t){this.scrollLines(t*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(t){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(t){let e=t-this._bufferService.buffer.ydisp;e!==0&&this.scrollLines(e)}registerEscHandler(t,e){return this._inputHandler.registerEscHandler(t,e)}registerDcsHandler(t,e){return this._inputHandler.registerDcsHandler(t,e)}registerCsiHandler(t,e){return this._inputHandler.registerCsiHandler(t,e)}registerOscHandler(t,e){return this._inputHandler.registerOscHandler(t,e)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let t=!1,e=this.optionsService.rawOptions.windowsPty;e&&e.buildNumber!==void 0&&e.buildNumber!==void 0?t=e.backend==="conpty"&&e.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(t=!0),t?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let t=[];t.push(this.onLineFeed(uo.bind(null,this._bufferService))),t.push(this.registerCsiHandler({final:"H"},()=>(uo(this._bufferService),!1))),this._windowsWrappingHeuristics.value=J(()=>{for(let e of t)e.dispose()})}}},Wd={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function $d(t,e,s,i){var o;let r={type:0,cancel:!1,key:void 0},n=(t.shiftKey?1:0)|(t.altKey?2:0)|(t.ctrlKey?4:0)|(t.metaKey?8:0);switch(t.keyCode){case 0:t.key==="UIKeyInputUpArrow"?e?r.key=g.ESC+"OA":r.key=g.ESC+"[A":t.key==="UIKeyInputLeftArrow"?e?r.key=g.ESC+"OD":r.key=g.ESC+"[D":t.key==="UIKeyInputRightArrow"?e?r.key=g.ESC+"OC":r.key=g.ESC+"[C":t.key==="UIKeyInputDownArrow"&&(e?r.key=g.ESC+"OB":r.key=g.ESC+"[B");break;case 8:r.key=t.ctrlKey?"\b":g.DEL,t.altKey&&(r.key=g.ESC+r.key);break;case 9:if(t.shiftKey){r.key=g.ESC+"[Z";break}r.key=g.HT,r.cancel=!0;break;case 13:r.key=t.altKey?g.ESC+g.CR:g.CR,r.cancel=!0;break;case 27:r.key=g.ESC,t.altKey&&(r.key=g.ESC+g.ESC),r.cancel=!0;break;case 37:if(t.metaKey)break;n?r.key=g.ESC+"[1;"+(n+1)+"D":e?r.key=g.ESC+"OD":r.key=g.ESC+"[D";break;case 39:if(t.metaKey)break;n?r.key=g.ESC+"[1;"+(n+1)+"C":e?r.key=g.ESC+"OC":r.key=g.ESC+"[C";break;case 38:if(t.metaKey)break;n?r.key=g.ESC+"[1;"+(n+1)+"A":e?r.key=g.ESC+"OA":r.key=g.ESC+"[A";break;case 40:if(t.metaKey)break;n?r.key=g.ESC+"[1;"+(n+1)+"B":e?r.key=g.ESC+"OB":r.key=g.ESC+"[B";break;case 45:!t.shiftKey&&!t.ctrlKey&&(r.key=g.ESC+"[2~");break;case 46:n?r.key=g.ESC+"[3;"+(n+1)+"~":r.key=g.ESC+"[3~";break;case 36:n?r.key=g.ESC+"[1;"+(n+1)+"H":e?r.key=g.ESC+"OH":r.key=g.ESC+"[H";break;case 35:n?r.key=g.ESC+"[1;"+(n+1)+"F":e?r.key=g.ESC+"OF":r.key=g.ESC+"[F";break;case 33:t.shiftKey?r.type=2:t.ctrlKey?r.key=g.ESC+"[5;"+(n+1)+"~":r.key=g.ESC+"[5~";break;case 34:t.shiftKey?r.type=3:t.ctrlKey?r.key=g.ESC+"[6;"+(n+1)+"~":r.key=g.ESC+"[6~";break;case 112:n?r.key=g.ESC+"[1;"+(n+1)+"P":r.key=g.ESC+"OP";break;case 113:n?r.key=g.ESC+"[1;"+(n+1)+"Q":r.key=g.ESC+"OQ";break;case 114:n?r.key=g.ESC+"[1;"+(n+1)+"R":r.key=g.ESC+"OR";break;case 115:n?r.key=g.ESC+"[1;"+(n+1)+"S":r.key=g.ESC+"OS";break;case 116:n?r.key=g.ESC+"[15;"+(n+1)+"~":r.key=g.ESC+"[15~";break;case 117:n?r.key=g.ESC+"[17;"+(n+1)+"~":r.key=g.ESC+"[17~";break;case 118:n?r.key=g.ESC+"[18;"+(n+1)+"~":r.key=g.ESC+"[18~";break;case 119:n?r.key=g.ESC+"[19;"+(n+1)+"~":r.key=g.ESC+"[19~";break;case 120:n?r.key=g.ESC+"[20;"+(n+1)+"~":r.key=g.ESC+"[20~";break;case 121:n?r.key=g.ESC+"[21;"+(n+1)+"~":r.key=g.ESC+"[21~";break;case 122:n?r.key=g.ESC+"[23;"+(n+1)+"~":r.key=g.ESC+"[23~";break;case 123:n?r.key=g.ESC+"[24;"+(n+1)+"~":r.key=g.ESC+"[24~";break;default:if(t.ctrlKey&&!t.shiftKey&&!t.altKey&&!t.metaKey)t.keyCode>=65&&t.keyCode<=90?r.key=String.fromCharCode(t.keyCode-64):t.keyCode===32?r.key=g.NUL:t.keyCode>=51&&t.keyCode<=55?r.key=String.fromCharCode(t.keyCode-51+27):t.keyCode===56?r.key=g.DEL:t.keyCode===219?r.key=g.ESC:t.keyCode===220?r.key=g.FS:t.keyCode===221&&(r.key=g.GS);else if((!s||i)&&t.altKey&&!t.metaKey){let a=(o=Wd[t.keyCode])==null?void 0:o[t.shiftKey?1:0];if(a)r.key=g.ESC+a;else if(t.keyCode>=65&&t.keyCode<=90){let h=t.ctrlKey?t.keyCode-64:t.keyCode+32,l=String.fromCharCode(h);t.shiftKey&&(l=l.toUpperCase()),r.key=g.ESC+l}else if(t.keyCode===32)r.key=g.ESC+(t.ctrlKey?g.NUL:" ");else if(t.key==="Dead"&&t.code.startsWith("Key")){let h=t.code.slice(3,4);t.shiftKey||(h=h.toLowerCase()),r.key=g.ESC+h,r.cancel=!0}}else s&&!t.altKey&&!t.ctrlKey&&!t.shiftKey&&t.metaKey?t.keyCode===65&&(r.type=1):t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.keyCode>=48&&t.key.length===1?r.key=t.key:t.key&&t.ctrlKey&&(t.key==="_"&&(r.key=g.US),t.key==="@"&&(r.key=g.NUL));break}return r}var ne=0,Ud=class{constructor(t){this._getKey=t,this._array=[],this._insertedValues=[],this._flushInsertedTask=new yi,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new yi,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(t){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(t)}_flushInserted(){let t=this._insertedValues.sort((r,n)=>this._getKey(r)-this._getKey(n)),e=0,s=0,i=new Array(this._array.length+this._insertedValues.length);for(let r=0;r<i.length;r++)s>=this._array.length||this._getKey(t[e])<=this._getKey(this._array[s])?(i[r]=t[e],e++):i[r]=this._array[s++];this._array=i,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(t){if(this._flushCleanupInserted(),this._array.length===0)return!1;let e=this._getKey(t);if(e===void 0||(ne=this._search(e),ne===-1)||this._getKey(this._array[ne])!==e)return!1;do if(this._array[ne]===t)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(ne),!0;while(++ne<this._array.length&&this._getKey(this._array[ne])===e);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let t=this._deletedIndices.sort((r,n)=>r-n),e=0,s=new Array(this._array.length-t.length),i=0;for(let r=0;r<this._array.length;r++)t[e]===r?e++:s[i++]=this._array[r];this._array=s,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(ne=this._search(t),!(ne<0||ne>=this._array.length)&&this._getKey(this._array[ne])===t))do yield this._array[ne];while(++ne<this._array.length&&this._getKey(this._array[ne])===t)}forEachByKey(t,e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(ne=this._search(t),!(ne<0||ne>=this._array.length)&&this._getKey(this._array[ne])===t))do e(this._array[ne]);while(++ne<this._array.length&&this._getKey(this._array[ne])===t)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(t){let e=0,s=this._array.length-1;for(;s>=e;){let i=e+s>>1,r=this._getKey(this._array[i]);if(r>t)s=i-1;else if(r<t)e=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===t;)i--;return i}}return e}},Qi=0,bo=0,Kd=class extends O{constructor(){super(),this._decorations=new Ud(t=>t==null?void 0:t.marker.line),this._onDecorationRegistered=this._register(new E),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new E),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(J(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(t){if(t.marker.isDisposed)return;let e=new qd(t);if(e){let s=e.marker.onDispose(()=>e.dispose()),i=e.onDispose(()=>{i.dispose(),e&&(this._decorations.delete(e)&&this._onDecorationRemoved.fire(e),s.dispose())});this._decorations.insert(e),this._onDecorationRegistered.fire(e)}return e}reset(){for(let t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,e,s){let i=0,r=0;for(let n of this._decorations.getKeyIterator(e))i=n.options.x??0,r=i+(n.options.width??1),t>=i&&t<r&&(!s||(n.options.layer??"bottom")===s)&&(yield n)}forEachDecorationAtCell(t,e,s,i){this._decorations.forEachByKey(e,r=>{Qi=r.options.x??0,bo=Qi+(r.options.width??1),t>=Qi&&t<bo&&(!s||(r.options.layer??"bottom")===s)&&i(r)})}},qd=class extends Lt{constructor(t){super(),this.options=t,this.onRenderEmitter=this.add(new E),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new E),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=Q.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=Q.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},Yd=1e3,Vd=class{constructor(t,e=Yd){this._renderCallback=t,this._debounceThresholdMS=e,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(t,e,s){this._rowCount=s,t=t!==void 0?t:0,e=e!==void 0?e:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,t):t,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,e):e;let i=performance.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){let r=i-this._lastRefreshMs,n=this._debounceThresholdMS-r;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let t=Math.max(this._rowStart,0),e=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,e)}},Co=20,bi=class extends O{constructor(e,s,i,r){super(),this._terminal=e,this._coreBrowserService=i,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let n=this._coreBrowserService.mainDocument;this._accessibilityContainer=n.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=n.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let o=0;o<this._terminal.rows;o++)this._rowElements[o]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[o]);if(this._topBoundaryFocusListener=o=>this._handleBoundaryFocus(o,0),this._bottomBoundaryFocusListener=o=>this._handleBoundaryFocus(o,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=n.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new Vd(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(o=>this._handleResize(o.rows))),this._register(this._terminal.onRender(o=>this._refreshRows(o.start,o.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(o=>this._handleChar(o))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(o=>this._handleTab(o))),this._register(this._terminal.onKey(o=>this._handleKey(o.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(M(n,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(J(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let s=0;s<e;s++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<Co+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===Co+1&&(this._liveRegion.textContent+=ar.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,s){this._liveRegionDebouncer.refresh(e,s,this._terminal.rows)}_renderRows(e,s){let i=this._terminal.buffer,r=i.lines.length.toString();for(let n=e;n<=s;n++){let o=i.lines.get(i.ydisp+n),a=[],h=(o==null?void 0:o.translateToString(!0,void 0,void 0,a))||"",l=(i.ydisp+n+1).toString(),c=this._rowElements[n];c&&(h.length===0?(c.textContent="",this._rowColumns.set(c,[0,1])):(c.textContent=h,this._rowColumns.set(c,a)),c.setAttribute("aria-posinset",l),c.setAttribute("aria-setsize",r),this._alignRowWidth(c))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,s){let i=e.target,r=this._rowElements[s===0?1:this._rowElements.length-2],n=i.getAttribute("aria-posinset"),o=s===0?"1":`${this._terminal.buffer.lines.length}`;if(n===o||e.relatedTarget!==r)return;let a,h;if(s===0?(a=i,h=this._rowElements.pop(),this._rowContainer.removeChild(h)):(a=this._rowElements.shift(),h=i,this._rowContainer.removeChild(a)),a.removeEventListener("focus",this._topBoundaryFocusListener),h.removeEventListener("focus",this._bottomBoundaryFocusListener),s===0){let l=this._createAccessibilityTreeNode();this._rowElements.unshift(l),this._rowContainer.insertAdjacentElement("afterbegin",l)}else{let l=this._createAccessibilityTreeNode();this._rowElements.push(l),this._rowContainer.appendChild(l)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(s===0?-1:1),this._rowElements[s===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var h;if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let s={node:e.anchorNode,offset:e.anchorOffset},i={node:e.focusNode,offset:e.focusOffset};if((s.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||s.node===i.node&&s.offset>i.offset)&&([s,i]=[i,s]),s.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(s={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(s.node))return;let r=this._rowElements.slice(-1)[0];if(i.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(i={node:r,offset:((h=r.textContent)==null?void 0:h.length)??0}),!this._rowContainer.contains(i.node))return;let n=({node:l,offset:c})=>{let d=l instanceof Text?l.parentNode:l,u=parseInt(d==null?void 0:d.getAttribute("aria-posinset"),10)-1;if(isNaN(u))return console.warn("row is invalid. Race condition?"),null;let _=this._rowColumns.get(d);if(!_)return console.warn("columns is null. Race condition?"),null;let f=c<_.length?_[c]:_.slice(-1)[0]+1;return f>=this._terminal.cols&&(++u,f=0),{row:u,column:f}},o=n(s),a=n(i);if(!(!o||!a)){if(o.row>a.row||o.row===a.row&&o.column>=a.column)throw new Error("invalid range");this._terminal.select(o.column,o.row,(a.row-o.row)*this._terminal.cols-o.column+a.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let s=this._rowContainer.children.length;s<this._terminal.rows;s++)this._rowElements[s]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[s]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){var n,o;e.style.transform="";let s=e.getBoundingClientRect().width,i=(o=(n=this._rowColumns.get(e))==null?void 0:n.slice(-1))==null?void 0:o[0];if(!i)return;let r=i*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${r/s})`}};bi=se([R(1,tn),R(2,wt),R(3,yt)],bi);var $r=class extends O{constructor(t,e,s,i,r){super(),this._element=t,this._mouseService=e,this._renderService=s,this._bufferService=i,this._linkProviderService=r,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new E),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new E),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(J(()=>{var n;jt(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,(n=this._activeProviderReplies)==null||n.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(M(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(M(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(M(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(M(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(t){this._lastMouseEvent=t;let e=this._positionFromMouseEvent(t,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;let s=t.composedPath();for(let i=0;i<s.length;i++){let r=s[i];if(r.classList.contains("xterm"))break;if(r.classList.contains("xterm-hover"))return}(!this._lastBufferCell||e.x!==this._lastBufferCell.x||e.y!==this._lastBufferCell.y)&&(this._handleHover(e),this._lastBufferCell=e)}_handleHover(t){if(this._activeLine!==t.y||this._wasResized){this._clearCurrentLink(),this._askForLink(t,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,t)||(this._clearCurrentLink(),this._askForLink(t,!0))}_askForLink(t,e){var i,r;(!this._activeProviderReplies||!e)&&((i=this._activeProviderReplies)==null||i.forEach(n=>{n==null||n.forEach(o=>{o.link.dispose&&o.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=t.y);let s=!1;for(let[n,o]of this._linkProviderService.linkProviders.entries())e?(r=this._activeProviderReplies)!=null&&r.get(n)&&(s=this._checkLinkProviderResult(n,t,s)):o.provideLinks(t.y,a=>{var l,c;if(this._isMouseOut)return;let h=a==null?void 0:a.map(d=>({link:d}));(l=this._activeProviderReplies)==null||l.set(n,h),s=this._checkLinkProviderResult(n,t,s),((c=this._activeProviderReplies)==null?void 0:c.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(t.y,this._activeProviderReplies)})}_removeIntersectingLinks(t,e){let s=new Set;for(let i=0;i<e.size;i++){let r=e.get(i);if(r)for(let n=0;n<r.length;n++){let o=r[n],a=o.link.range.start.y<t?0:o.link.range.start.x,h=o.link.range.end.y>t?this._bufferService.cols:o.link.range.end.x;for(let l=a;l<=h;l++){if(s.has(l)){r.splice(n--,1);break}s.add(l)}}}}_checkLinkProviderResult(t,e,s){var n;if(!this._activeProviderReplies)return s;let i=this._activeProviderReplies.get(t),r=!1;for(let o=0;o<t;o++)(!this._activeProviderReplies.has(o)||this._activeProviderReplies.get(o))&&(r=!0);if(!r&&i){let o=i.find(a=>this._linkAtPosition(a.link,e));o&&(s=!0,this._handleNewLink(o))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!s)for(let o=0;o<this._activeProviderReplies.size;o++){let a=(n=this._activeProviderReplies.get(o))==null?void 0:n.find(h=>this._linkAtPosition(h.link,e));if(a){s=!0,this._handleNewLink(a);break}}return s}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(t){if(!this._currentLink)return;let e=this._positionFromMouseEvent(t,this._element,this._mouseService);e&&this._mouseDownLink&&jd(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(t,this._currentLink.link.text)}_clearCurrentLink(t,e){!this._currentLink||!this._lastMouseEvent||(!t||!e||this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,jt(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(t){if(!this._lastMouseEvent)return;let e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(t.link,e)&&(this._currentLink=t,this._currentLink.state={decorations:{underline:t.link.decorations===void 0?!0:t.link.decorations.underline,pointerCursor:t.link.decorations===void 0?!0:t.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,t.link,this._lastMouseEvent),t.link.decorations={},Object.defineProperties(t.link.decorations,{pointerCursor:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.pointerCursor},set:s=>{var i;(i=this._currentLink)!=null&&i.state&&this._currentLink.state.decorations.pointerCursor!==s&&(this._currentLink.state.decorations.pointerCursor=s,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",s))}},underline:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.underline},set:s=>{var i,r,n;(i=this._currentLink)!=null&&i.state&&((n=(r=this._currentLink)==null?void 0:r.state)==null?void 0:n.decorations.underline)!==s&&(this._currentLink.state.decorations.underline=s,this._currentLink.state.isHovered&&this._fireUnderlineEvent(t.link,s))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(s=>{if(!this._currentLink)return;let i=s.start===0?0:s.start+1+this._bufferService.buffer.ydisp,r=this._bufferService.buffer.ydisp+1+s.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=r&&(this._clearCurrentLink(i,r),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(t,e,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&t.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(s,e.text)}_fireUnderlineEvent(t,e){let s=t.range,i=this._bufferService.buffer.ydisp,r=this._createLinkUnderlineEvent(s.start.x-1,s.start.y-i-1,s.end.x,s.end.y-i-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(r)}_linkLeave(t,e,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&t.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(s,e.text)}_linkAtPosition(t,e){let s=t.range.start.y*this._bufferService.cols+t.range.start.x,i=t.range.end.y*this._bufferService.cols+t.range.end.x,r=e.y*this._bufferService.cols+e.x;return s<=r&&r<=i}_positionFromMouseEvent(t,e,s){let i=s.getCoords(t,e,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(t,e,s,i,r){return{x1:t,y1:e,x2:s,y2:i,cols:this._bufferService.cols,fg:r}}};$r=se([R(1,sn),R(2,yt),R(3,Te),R(4,va)],$r);function jd(t,e){return t.text===e.text&&t.range.start.x===e.range.start.x&&t.range.start.y===e.range.start.y&&t.range.end.x===e.range.end.x&&t.range.end.y===e.range.end.y}var Xd=class extends Fd{constructor(t={}){super(t),this._linkifier=this._register(new rs),this.browser=Na,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new rs),this._onCursorMove=this._register(new E),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new E),this.onKey=this._onKey.event,this._onRender=this._register(new E),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new E),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new E),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new E),this.onBell=this._onBell.event,this._onFocus=this._register(new E),this._onBlur=this._register(new E),this._onA11yCharEmitter=this._register(new E),this._onA11yTabEmitter=this._register(new E),this._onWillOpen=this._register(new E),this._setup(),this._decorationService=this._instantiationService.createInstance(Kd),this._instantiationService.setService(Ws,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Hc),this._instantiationService.setService(va,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(hr)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(e=>this.refresh((e==null?void 0:e.start)??0,(e==null?void 0:e.end)??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(e=>this._reportWindowsOptions(e))),this._register(this._inputHandler.onColor(e=>this._handleColorEvent(e))),this._register(Pe.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(Pe.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(Pe.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(Pe.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(e=>this._afterResize(e.cols,e.rows))),this._register(J(()=>{var e,s;this._customKeyEventHandler=void 0,(s=(e=this.element)==null?void 0:e.parentNode)==null||s.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(t){if(this._themeService)for(let e of t){let s,i="";switch(e.index){case 256:s="foreground",i="10";break;case 257:s="background",i="11";break;case 258:s="cursor",i="12";break;default:s="ansi",i="4;"+e.index}switch(e.type){case 0:let r=V.toColorRGB(s==="ansi"?this._themeService.colors.ansi[e.index]:this._themeService.colors[s]);this.coreService.triggerDataEvent(`${g.ESC}]${i};${Id(r)}${Ta.ST}`);break;case 1:if(s==="ansi")this._themeService.modifyColors(n=>n.ansi[e.index]=le.toColor(...e.color));else{let n=s;this._themeService.modifyColors(o=>o[n]=le.toColor(...e.color))}break;case 2:this._themeService.restoreColor(e.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(t){t?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(bi,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(t){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(g.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var t;return(t=this.textarea)==null?void 0:t.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(g.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let t=this.buffer.ybase+this.buffer.y,e=this.buffer.lines.get(t);if(!e)return;let s=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,r=e.getWidth(s),n=this._renderService.dimensions.css.cell.width*r,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=s*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(M(this.element,"copy",e=>{this.hasSelection()&&Ql(e,this._selectionService)}));let t=e=>eh(e,this.textarea,this.coreService,this.optionsService);this._register(M(this.textarea,"paste",t)),this._register(M(this.element,"paste",t)),Ha?this._register(M(this.element,"mousedown",e=>{e.button===2&&Dn(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(M(this.element,"contextmenu",e=>{Dn(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),dn&&this._register(M(this.element,"auxclick",e=>{e.button===1&&ha(e,this.textarea,this.screenElement)}))}_bindKeys(){this._register(M(this.textarea,"keyup",t=>this._keyUp(t),!0)),this._register(M(this.textarea,"keydown",t=>this._keyDown(t),!0)),this._register(M(this.textarea,"keypress",t=>this._keyPress(t),!0)),this._register(M(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(M(this.textarea,"compositionupdate",t=>this._compositionHelper.compositionupdate(t))),this._register(M(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(M(this.textarea,"input",t=>this._inputEvent(t),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(t){var r;if(!t)throw new Error("Terminal requires a parent element.");if(t.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((r=this.element)==null?void 0:r.ownerDocument.defaultView)&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=t.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),t.appendChild(this.element);let e=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),e.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(M(this.screenElement,"mousemove",n=>this.updateCursorStyle(n))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),e.appendChild(this.screenElement);let s=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",or.get()),Wa||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>s.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(Oc,this.textarea,t.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(wt,this._coreBrowserService),this._register(M(this.textarea,"focus",n=>this._handleTextAreaFocus(n))),this._register(M(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(Rr,this._document,this._helperContainer),this._instantiationService.setService(Mi,this._charSizeService),this._themeService=this._instantiationService.createInstance(Ir),this._instantiationService.setService(os,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(Si),this._instantiationService.setService(ga,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(Dr,this.rows,this.screenElement)),this._instantiationService.setService(yt,this._renderService),this._register(this._renderService.onRenderedViewportChange(n=>this._onRender.fire(n))),this.onResize(n=>this._renderService.resize(n.cols,n.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Br,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(Ar),this._instantiationService.setService(sn,this._mouseService);let i=this._linkifier.value=this._register(this._instantiationService.createInstance($r,this.screenElement));this.element.appendChild(e);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(xr,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(n=>{super.scrollLines(n,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(Mr,this.element,this.screenElement,i)),this._instantiationService.setService(lh,this._selectionService),this._register(this._selectionService.onRequestScrollLines(n=>this.scrollLines(n.amount,n.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(n=>this._renderService.handleSelectionChanged(n.start,n.end,n.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(n=>{this.textarea.value=n,this.textarea.focus(),this.textarea.select()})),this._register(Pe.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{var n;this._selectionService.refresh(),(n=this._viewport)==null||n.queueSync()})),this._register(this._instantiationService.createInstance(Er,this.screenElement)),this._register(M(this.element,"mousedown",n=>this._selectionService.handleMouseDown(n))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(bi,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",n=>this._handleScreenReaderModeOptionChange(n))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(vi,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",n=>{!this._overviewRulerRenderer&&n&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(vi,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(Lr,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let t=this,e=this.element;function s(n){var l,c,d,u,_;let o=t._mouseService.getMouseReportCoords(n,t.screenElement);if(!o)return!1;let a,h;switch(n.overrideType||n.type){case"mousemove":h=32,n.buttons===void 0?(a=3,n.button!==void 0&&(a=n.button<3?n.button:3)):a=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":h=0,a=n.button<3?n.button:3;break;case"mousedown":h=1,a=n.button<3?n.button:3;break;case"wheel":if(t._customWheelEventHandler&&t._customWheelEventHandler(n)===!1)return!1;let f=n.deltaY;if(f===0||t.coreMouseService.consumeWheelEvent(n,(u=(d=(c=(l=t._renderService)==null?void 0:l.dimensions)==null?void 0:c.device)==null?void 0:d.cell)==null?void 0:u.height,(_=t._coreBrowserService)==null?void 0:_.dpr)===0)return!1;h=f<0?0:1,a=4;break;default:return!1}return h===void 0||a===void 0||a>4?!1:t.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:a,action:h,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:n=>(s(n),n.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(n)),wheel:n=>(s(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&s(n)},mousemove:n=>{n.buttons||s(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?i.mousemove||(e.addEventListener("mousemove",r.mousemove),i.mousemove=r.mousemove):(e.removeEventListener("mousemove",i.mousemove),i.mousemove=null),n&16?i.wheel||(e.addEventListener("wheel",r.wheel,{passive:!1}),i.wheel=r.wheel):(e.removeEventListener("wheel",i.wheel),i.wheel=null),n&2?i.mouseup||(i.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),i.mouseup=null),n&4?i.mousedrag||(i.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(M(e,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return s(n),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(n)})),this._register(M(e,"wheel",n=>{var o,a,h,l,c;if(!i.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(t.coreMouseService.consumeWheelEvent(n,(l=(h=(a=(o=t._renderService)==null?void 0:o.dimensions)==null?void 0:a.device)==null?void 0:h.cell)==null?void 0:l.height,(c=t._coreBrowserService)==null?void 0:c.dpr)===0)return this.cancel(n,!0);let d=g.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(d,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(t,e){var s;(s=this._renderService)==null||s.refreshRows(t,e)}updateCursorStyle(t){var e;(e=this._selectionService)!=null&&e.shouldColumnSelect(t)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(t,e){this._viewport?this._viewport.scrollLines(t):super.scrollLines(t,e),this.refresh(0,this.rows-1)}scrollPages(t){this.scrollLines(t*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(t){t&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(t){let e=t-this._bufferService.buffer.ydisp;e!==0&&this.scrollLines(e)}paste(t){la(t,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(t){this._customKeyEventHandler=t}attachCustomWheelEventHandler(t){this._customWheelEventHandler=t}registerLinkProvider(t){return this._linkProviderService.registerLinkProvider(t)}registerCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let e=this._characterJoinerService.register(t);return this.refresh(0,this.rows-1),e}deregisterCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(t)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(t){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+t)}registerDecoration(t){return this._decorationService.registerDecoration(t)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(t,e,s){this._selectionService.setSelection(t,e,s)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var t;(t=this._selectionService)==null||t.clearSelection()}selectAll(){var t;(t=this._selectionService)==null||t.selectAll()}selectLines(t,e){var s;(s=this._selectionService)==null||s.selectLines(t,e)}_keyDown(t){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(t)===!1)return!1;let e=this.browser.isMac&&this.options.macOptionIsMeta&&t.altKey;if(!e&&!this._compositionHelper.keydown(t))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!e&&(t.key==="Dead"||t.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let s=$d(t,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(t),s.type===3||s.type===2){let i=this.rows-1;return this.scrollLines(s.type===2?-i:i),this.cancel(t,!0)}if(s.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,t)||(s.cancel&&this.cancel(t,!0),!s.key)||t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.key.length===1&&t.key.charCodeAt(0)>=65&&t.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((s.key===g.ETX||s.key===g.CR)&&(this.textarea.value=""),this._onKey.fire({key:s.key,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(s.key,!0),!this.optionsService.rawOptions.screenReaderMode||t.altKey||t.ctrlKey)return this.cancel(t,!0);this._keyDownHandled=!0}_isThirdLevelShift(t,e){let s=t.isMac&&!this.options.macOptionIsMeta&&e.altKey&&!e.ctrlKey&&!e.metaKey||t.isWindows&&e.altKey&&e.ctrlKey&&!e.metaKey||t.isWindows&&e.getModifierState("AltGraph");return e.type==="keypress"?s:s&&(!e.keyCode||e.keyCode>47)}_keyUp(t){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(t)===!1)&&(Gd(t)||this.focus(),this.updateCursorStyle(t),this._keyPressHandled=!1)}_keyPress(t){let e;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(t)===!1)return!1;if(this.cancel(t),t.charCode)e=t.charCode;else if(t.which===null||t.which===void 0)e=t.keyCode;else if(t.which!==0&&t.charCode!==0)e=t.which;else return!1;return!e||(t.altKey||t.ctrlKey||t.metaKey)&&!this._isThirdLevelShift(this.browser,t)?!1:(e=String.fromCharCode(e),this._onKey.fire({key:e,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(e,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(t){if(t.data&&t.inputType==="insertText"&&(!t.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let e=t.data;return this.coreService.triggerDataEvent(e,!0),this.cancel(t),!0}return!1}resize(t,e){if(t===this.cols&&e===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(t,e)}_afterResize(t,e){var s;(s=this._charSizeService)==null||s.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let t=1;t<this.rows;t++)this.buffer.lines.push(this.buffer.getBlankLine(ae));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){var e;this.options.rows=this.rows,this.options.cols=this.cols;let t=this._customKeyEventHandler;this._setup(),super.reset(),(e=this._selectionService)==null||e.reset(),this._decorationService.reset(),this._customKeyEventHandler=t,this.refresh(0,this.rows-1)}clearTextureAtlas(){var t;(t=this._renderService)==null||t.clearTextureAtlas()}_reportFocus(){var t;(t=this.element)!=null&&t.classList.contains("focus")?this.coreService.triggerDataEvent(g.ESC+"[I"):this.coreService.triggerDataEvent(g.ESC+"[O")}_reportWindowsOptions(t){if(this._renderService)switch(t){case 0:let e=this._renderService.dimensions.css.canvas.width.toFixed(0),s=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${g.ESC}[4;${s};${e}t`);break;case 1:let i=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${g.ESC}[6;${r};${i}t`);break}}cancel(t,e){if(!(!this.options.cancelEvents&&!e))return t.preventDefault(),t.stopPropagation(),!1}};function Gd(t){return t.keyCode===16||t.keyCode===17||t.keyCode===18}var Jd=class{constructor(){this._addons=[]}dispose(){for(let t=this._addons.length-1;t>=0;t--)this._addons[t].instance.dispose()}loadAddon(t,e){let s={instance:e,dispose:e.dispose,isDisposed:!1};this._addons.push(s),e.dispose=()=>this._wrappedAddonDispose(s),e.activate(t)}_wrappedAddonDispose(t){if(t.isDisposed)return;let e=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===t){e=s;break}if(e===-1)throw new Error("Could not dispose an addon that has not been loaded");t.isDisposed=!0,t.dispose.apply(t.instance),this._addons.splice(e,1)}},Zd=class{constructor(t){this._line=t}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(t,e){if(!(t<0||t>=this._line.length))return e?(this._line.loadCell(t,e),e):this._line.loadCell(t,new Ge)}translateToString(t,e,s){return this._line.translateToString(t,e,s)}},ko=class{constructor(t,e){this._buffer=t,this.type=e}init(t){return this._buffer=t,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(t){let e=this._buffer.lines.get(t);if(e)return new Zd(e)}getNullCell(){return new Ge}},Qd=class extends O{constructor(t){super(),this._core=t,this._onBufferChange=this._register(new E),this.onBufferChange=this._onBufferChange.event,this._normal=new ko(this._core.buffers.normal,"normal"),this._alternate=new ko(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},eu=class{constructor(t){this._core=t}registerCsiHandler(t,e){return this._core.registerCsiHandler(t,s=>e(s.toArray()))}addCsiHandler(t,e){return this.registerCsiHandler(t,e)}registerDcsHandler(t,e){return this._core.registerDcsHandler(t,(s,i)=>e(s,i.toArray()))}addDcsHandler(t,e){return this.registerDcsHandler(t,e)}registerEscHandler(t,e){return this._core.registerEscHandler(t,e)}addEscHandler(t,e){return this.registerEscHandler(t,e)}registerOscHandler(t,e){return this._core.registerOscHandler(t,e)}addOscHandler(t,e){return this.registerOscHandler(t,e)}},tu=class{constructor(t){this._core=t}register(t){this._core.unicodeService.register(t)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(t){this._core.unicodeService.activeVersion=t}},su=["cols","rows"],rt=0,iu=class extends O{constructor(t){super(),this._core=this._register(new Xd(t)),this._addonManager=this._register(new Jd),this._publicOptions={...this._core.options};let e=i=>this._core.options[i],s=(i,r)=>{this._checkReadonlyOptions(i),this._core.options[i]=r};for(let i in this._core.options){let r={get:e.bind(this,i),set:s.bind(this,i)};Object.defineProperty(this._publicOptions,i,r)}}_checkReadonlyOptions(t){if(su.includes(t))throw new Error(`Option "${t}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new eu(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new tu(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new Qd(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let t=this._core.coreService.decPrivateModes,e="none";switch(this._core.coreMouseService.activeProtocol){case"X10":e="x10";break;case"VT200":e="vt200";break;case"DRAG":e="drag";break;case"ANY":e="any";break}return{applicationCursorKeysMode:t.applicationCursorKeys,applicationKeypadMode:t.applicationKeypad,bracketedPasteMode:t.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:e,originMode:t.origin,reverseWraparoundMode:t.reverseWraparound,sendFocusMode:t.sendFocus,synchronizedOutputMode:t.synchronizedOutput,wraparoundMode:t.wraparound}}get options(){return this._publicOptions}set options(t){for(let e in t)this._publicOptions[e]=t[e]}blur(){this._core.blur()}focus(){this._core.focus()}input(t,e=!0){this._core.input(t,e)}resize(t,e){this._verifyIntegers(t,e),this._core.resize(t,e)}open(t){this._core.open(t)}attachCustomKeyEventHandler(t){this._core.attachCustomKeyEventHandler(t)}attachCustomWheelEventHandler(t){this._core.attachCustomWheelEventHandler(t)}registerLinkProvider(t){return this._core.registerLinkProvider(t)}registerCharacterJoiner(t){return this._checkProposedApi(),this._core.registerCharacterJoiner(t)}deregisterCharacterJoiner(t){this._checkProposedApi(),this._core.deregisterCharacterJoiner(t)}registerMarker(t=0){return this._verifyIntegers(t),this._core.registerMarker(t)}registerDecoration(t){return this._checkProposedApi(),this._verifyPositiveIntegers(t.x??0,t.width??0,t.height??0),this._core.registerDecoration(t)}hasSelection(){return this._core.hasSelection()}select(t,e,s){this._verifyIntegers(t,e,s),this._core.select(t,e,s)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(t,e){this._verifyIntegers(t,e),this._core.selectLines(t,e)}dispose(){super.dispose()}scrollLines(t){this._verifyIntegers(t),this._core.scrollLines(t)}scrollPages(t){this._verifyIntegers(t),this._core.scrollPages(t)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(t){this._verifyIntegers(t),this._core.scrollToLine(t)}clear(){this._core.clear()}write(t,e){this._core.write(t,e)}writeln(t,e){this._core.write(t),this._core.write(`\r
`,e)}paste(t){this._core.paste(t)}refresh(t,e){this._verifyIntegers(t,e),this._core.refresh(t,e)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(t){this._addonManager.loadAddon(this,t)}static get strings(){return{get promptLabel(){return or.get()},set promptLabel(t){or.set(t)},get tooMuchOutput(){return ar.get()},set tooMuchOutput(t){ar.set(t)}}}_verifyIntegers(...t){for(rt of t)if(rt===1/0||isNaN(rt)||rt%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...t){for(rt of t)if(rt&&(rt===1/0||isNaN(rt)||rt%1!==0||rt<0))throw new Error("This API only accepts positive integers")}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var ru=2,nu=1,ou=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let s=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(s._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){var u;if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let s=this._terminal.options.scrollback===0?0:((u=this._terminal.options.overviewRuler)==null?void 0:u.width)||14,i=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(i.getPropertyValue("height")),n=Math.max(0,parseInt(i.getPropertyValue("width"))),o=window.getComputedStyle(this._terminal.element),a={top:parseInt(o.getPropertyValue("padding-top")),bottom:parseInt(o.getPropertyValue("padding-bottom")),right:parseInt(o.getPropertyValue("padding-right")),left:parseInt(o.getPropertyValue("padding-left"))},h=a.top+a.bottom,l=a.right+a.left,c=r-h,d=n-l-s;return{cols:Math.max(ru,Math.floor(d/e.css.cell.width)),rows:Math.max(nu,Math.floor(c/e.css.cell.height))}}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var ye=0,be=0,Ce=0,te=0,De;(t=>{function e(r,n,o,a){return a!==void 0?`#${Ot(r)}${Ot(n)}${Ot(o)}${Ot(a)}`:`#${Ot(r)}${Ot(n)}${Ot(o)}`}t.toCss=e;function s(r,n,o,a=255){return(r<<24|n<<16|o<<8|a)>>>0}t.toRgba=s;function i(r,n,o,a){return{css:t.toCss(r,n,o,a),rgba:t.toRgba(r,n,o,a)}}t.toColor=i})(De||(De={}));var au;(t=>{function e(h,l){if(te=(l.rgba&255)/255,te===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,d=l.rgba>>16&255,u=l.rgba>>8&255,_=h.rgba>>24&255,f=h.rgba>>16&255,p=h.rgba>>8&255;ye=_+Math.round((c-_)*te),be=f+Math.round((d-f)*te),Ce=p+Math.round((u-p)*te);let m=De.toCss(ye,be,Ce),S=De.toRgba(ye,be,Ce);return{css:m,rgba:S}}t.blend=e;function s(h){return(h.rgba&255)===255}t.isOpaque=s;function i(h,l,c){let d=_i.ensureContrastRatio(h.rgba,l.rgba,c);if(d)return De.toColor(d>>24&255,d>>16&255,d>>8&255)}t.ensureContrastRatio=i;function r(h){let l=(h.rgba|255)>>>0;return[ye,be,Ce]=_i.toChannels(l),{css:De.toCss(ye,be,Ce),rgba:l}}t.opaque=r;function n(h,l){return te=Math.round(l*255),[ye,be,Ce]=_i.toChannels(h.rgba),{css:De.toCss(ye,be,Ce,te),rgba:De.toRgba(ye,be,Ce,te)}}t.opacity=n;function o(h,l){return te=h.rgba&255,n(h,te*l/255)}t.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}t.toColorRGB=a})(au||(au={}));var Ee;(t=>{let e,s;try{let r=document.createElement("canvas");r.width=1,r.height=1;let n=r.getContext("2d",{willReadFrequently:!0});n&&(e=n,e.globalCompositeOperation="copy",s=e.createLinearGradient(0,0,1,1))}catch{}function i(r){if(r.match(/#[\da-f]{3,8}/i))switch(r.length){case 4:return ye=parseInt(r.slice(1,2).repeat(2),16),be=parseInt(r.slice(2,3).repeat(2),16),Ce=parseInt(r.slice(3,4).repeat(2),16),De.toColor(ye,be,Ce);case 5:return ye=parseInt(r.slice(1,2).repeat(2),16),be=parseInt(r.slice(2,3).repeat(2),16),Ce=parseInt(r.slice(3,4).repeat(2),16),te=parseInt(r.slice(4,5).repeat(2),16),De.toColor(ye,be,Ce,te);case 7:return{css:r,rgba:(parseInt(r.slice(1),16)<<8|255)>>>0};case 9:return{css:r,rgba:parseInt(r.slice(1),16)>>>0}}let n=r.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return ye=parseInt(n[1]),be=parseInt(n[2]),Ce=parseInt(n[3]),te=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),De.toColor(ye,be,Ce,te);if(!e||!s)throw new Error("css.toColor: Unsupported css format");if(e.fillStyle=s,e.fillStyle=r,typeof e.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(e.fillRect(0,0,1,1),[ye,be,Ce,te]=e.getImageData(0,0,1,1).data,te!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:De.toRgba(ye,be,Ce,te),css:r}}t.toColor=i})(Ee||(Ee={}));var Ie;(t=>{function e(i){return s(i>>16&255,i>>8&255,i&255)}t.relativeLuminance=e;function s(i,r,n){let o=i/255,a=r/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),d=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+d*.0722}t.relativeLuminance2=s})(Ie||(Ie={}));var _i;(t=>{function e(o,a){if(te=(a&255)/255,te===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,d=o>>24&255,u=o>>16&255,_=o>>8&255;return ye=d+Math.round((h-d)*te),be=u+Math.round((l-u)*te),Ce=_+Math.round((c-_)*te),De.toRgba(ye,be,Ce)}t.blend=e;function s(o,a,h){let l=Ie.relativeLuminance(o>>8),c=Ie.relativeLuminance(a>>8);if(ut(l,c)<h){if(c<l){let _=i(o,a,h),f=ut(l,Ie.relativeLuminance(_>>8));if(f<h){let p=r(o,a,h),m=ut(l,Ie.relativeLuminance(p>>8));return f>m?_:p}return _}let d=r(o,a,h),u=ut(l,Ie.relativeLuminance(d>>8));if(u<h){let _=i(o,a,h),f=ut(l,Ie.relativeLuminance(_>>8));return u>f?d:_}return d}}t.ensureContrastRatio=s;function i(o,a,h){let l=o>>24&255,c=o>>16&255,d=o>>8&255,u=a>>24&255,_=a>>16&255,f=a>>8&255,p=ut(Ie.relativeLuminance2(u,_,f),Ie.relativeLuminance2(l,c,d));for(;p<h&&(u>0||_>0||f>0);)u-=Math.max(0,Math.ceil(u*.1)),_-=Math.max(0,Math.ceil(_*.1)),f-=Math.max(0,Math.ceil(f*.1)),p=ut(Ie.relativeLuminance2(u,_,f),Ie.relativeLuminance2(l,c,d));return(u<<24|_<<16|f<<8|255)>>>0}t.reduceLuminance=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,d=o>>8&255,u=a>>24&255,_=a>>16&255,f=a>>8&255,p=ut(Ie.relativeLuminance2(u,_,f),Ie.relativeLuminance2(l,c,d));for(;p<h&&(u<255||_<255||f<255);)u=Math.min(255,u+Math.ceil((255-u)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),f=Math.min(255,f+Math.ceil((255-f)*.1)),p=ut(Ie.relativeLuminance2(u,_,f),Ie.relativeLuminance2(l,c,d));return(u<<24|_<<16|f<<8|255)>>>0}t.increaseLuminance=r;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}t.toChannels=n})(_i||(_i={}));function Ot(t){let e=t.toString(16);return e.length<2?"0"+e:e}function ut(t,e){return t<e?(e+.05)/(t+.05):(t+.05)/(e+.05)}var lu=Object.freeze((()=>{let t=[Ee.toColor("#2e3436"),Ee.toColor("#cc0000"),Ee.toColor("#4e9a06"),Ee.toColor("#c4a000"),Ee.toColor("#3465a4"),Ee.toColor("#75507b"),Ee.toColor("#06989a"),Ee.toColor("#d3d7cf"),Ee.toColor("#555753"),Ee.toColor("#ef2929"),Ee.toColor("#8ae234"),Ee.toColor("#fce94f"),Ee.toColor("#729fcf"),Ee.toColor("#ad7fa8"),Ee.toColor("#34e2e2"),Ee.toColor("#eeeeec")],e=[0,95,135,175,215,255];for(let s=0;s<216;s++){let i=e[s/36%6|0],r=e[s/6%6|0],n=e[s%6];t.push({css:De.toCss(i,r,n),rgba:De.toRgba(i,r,n)})}for(let s=0;s<24;s++){let i=8+s*10;t.push({css:De.toCss(i,i,i),rgba:De.toRgba(i,i,i)})}return t})());function xo(t,e,s){return Math.max(e,Math.min(t,s))}function hu(t){switch(t){case"&":return"&amp;";case"<":return"&lt;"}return t}var Ja=class{constructor(e){this._buffer=e}serialize(e,s){let i=this._buffer.getNullCell(),r=this._buffer.getNullCell(),n=i,o=e.start.y,a=e.end.y,h=e.start.x,l=e.end.x;this._beforeSerialize(a-o,o,a);for(let c=o;c<=a;c++){let d=this._buffer.getLine(c);if(d){let u=c===e.start.y?h:0,_=c===e.end.y?l:d.length;for(let f=u;f<_;f++){let p=d.getCell(f,n===i?r:i);if(!p){console.warn(`Can't get cell at row=${c}, col=${f}`);continue}this._nextCell(p,n,c,f),n=p}}this._rowEnd(c,c===a)}return this._afterSerialize(),this._serializeString(s)}_nextCell(e,s,i,r){}_rowEnd(e,s){}_beforeSerialize(e,s,i){}_afterSerialize(){}_serializeString(e){return""}};function Za(t,e){return t.getFgColorMode()===e.getFgColorMode()&&t.getFgColor()===e.getFgColor()}function _t(t,e){return t.getBgColorMode()===e.getBgColorMode()&&t.getBgColor()===e.getBgColor()}function Qa(t,e){return t.isInverse()===e.isInverse()&&t.isBold()===e.isBold()&&t.isUnderline()===e.isUnderline()&&t.isOverline()===e.isOverline()&&t.isBlink()===e.isBlink()&&t.isInvisible()===e.isInvisible()&&t.isItalic()===e.isItalic()&&t.isDim()===e.isDim()&&t.isStrikethrough()===e.isStrikethrough()}var cu=class extends Ja{constructor(e,s){super(e),this._terminal=s,this._rowIndex=0,this._allRows=new Array,this._allRowSeparators=new Array,this._currentRow="",this._nullCellCount=0,this._cursorStyle=this._buffer.getNullCell(),this._cursorStyleRow=0,this._cursorStyleCol=0,this._backgroundCell=this._buffer.getNullCell(),this._firstRow=0,this._lastCursorRow=0,this._lastCursorCol=0,this._lastContentCursorRow=0,this._lastContentCursorCol=0,this._thisRowLastChar=this._buffer.getNullCell(),this._thisRowLastSecondChar=this._buffer.getNullCell(),this._nextRowFirstChar=this._buffer.getNullCell()}_beforeSerialize(e,s,i){this._allRows=new Array(e),this._lastContentCursorRow=s,this._lastCursorRow=s,this._firstRow=s}_rowEnd(e,s){var r;this._nullCellCount>0&&!_t(this._cursorStyle,this._backgroundCell)&&(this._currentRow+=`\x1B[${this._nullCellCount}X`);let i="";if(!s){e-this._firstRow>=this._terminal.rows&&((r=this._buffer.getLine(this._cursorStyleRow))==null||r.getCell(this._cursorStyleCol,this._backgroundCell));let n=this._buffer.getLine(e),o=this._buffer.getLine(e+1);if(!o.isWrapped)i=`\r
`,this._lastCursorRow=e+1,this._lastCursorCol=0;else{i="";let a=n.getCell(n.length-1,this._thisRowLastChar),h=n.getCell(n.length-2,this._thisRowLastSecondChar),l=o.getCell(0,this._nextRowFirstChar),c=l.getWidth()>1,d=!1;(l.getChars()&&c?this._nullCellCount<=1:this._nullCellCount<=0)&&((a.getChars()||a.getWidth()===0)&&_t(a,l)&&(d=!0),c&&(h.getChars()||h.getWidth()===0)&&_t(a,l)&&_t(h,l)&&(d=!0)),d||(i="-".repeat(this._nullCellCount+1),i+="\x1B[1D\x1B[1X",this._nullCellCount>0&&(i+="\x1B[A",i+=`\x1B[${n.length-this._nullCellCount}C`,i+=`\x1B[${this._nullCellCount}X`,i+=`\x1B[${n.length-this._nullCellCount}D`,i+="\x1B[B"),this._lastContentCursorRow=e+1,this._lastContentCursorCol=0,this._lastCursorRow=e+1,this._lastCursorCol=0)}}this._allRows[this._rowIndex]=this._currentRow,this._allRowSeparators[this._rowIndex++]=i,this._currentRow="",this._nullCellCount=0}_diffStyle(e,s){let i=[],r=!Za(e,s),n=!_t(e,s),o=!Qa(e,s);if(r||n||o)if(e.isAttributeDefault())s.isAttributeDefault()||i.push(0);else{if(r){let a=e.getFgColor();e.isFgRGB()?i.push(38,2,a>>>16&255,a>>>8&255,a&255):e.isFgPalette()?a>=16?i.push(38,5,a):i.push(a&8?90+(a&7):30+(a&7)):i.push(39)}if(n){let a=e.getBgColor();e.isBgRGB()?i.push(48,2,a>>>16&255,a>>>8&255,a&255):e.isBgPalette()?a>=16?i.push(48,5,a):i.push(a&8?100+(a&7):40+(a&7)):i.push(49)}o&&(e.isInverse()!==s.isInverse()&&i.push(e.isInverse()?7:27),e.isBold()!==s.isBold()&&i.push(e.isBold()?1:22),e.isUnderline()!==s.isUnderline()&&i.push(e.isUnderline()?4:24),e.isOverline()!==s.isOverline()&&i.push(e.isOverline()?53:55),e.isBlink()!==s.isBlink()&&i.push(e.isBlink()?5:25),e.isInvisible()!==s.isInvisible()&&i.push(e.isInvisible()?8:28),e.isItalic()!==s.isItalic()&&i.push(e.isItalic()?3:23),e.isDim()!==s.isDim()&&i.push(e.isDim()?2:22),e.isStrikethrough()!==s.isStrikethrough()&&i.push(e.isStrikethrough()?9:29))}return i}_nextCell(e,s,i,r){if(e.getWidth()===0)return;let n=e.getChars()==="",o=this._diffStyle(e,this._cursorStyle);if(n?!_t(this._cursorStyle,e):o.length>0){this._nullCellCount>0&&(_t(this._cursorStyle,this._backgroundCell)||(this._currentRow+=`\x1B[${this._nullCellCount}X`),this._currentRow+=`\x1B[${this._nullCellCount}C`,this._nullCellCount=0),this._lastContentCursorRow=this._lastCursorRow=i,this._lastContentCursorCol=this._lastCursorCol=r,this._currentRow+=`\x1B[${o.join(";")}m`;let a=this._buffer.getLine(i);a!==void 0&&(a.getCell(r,this._cursorStyle),this._cursorStyleRow=i,this._cursorStyleCol=r)}n?this._nullCellCount+=e.getWidth():(this._nullCellCount>0&&(_t(this._cursorStyle,this._backgroundCell)?this._currentRow+=`\x1B[${this._nullCellCount}C`:(this._currentRow+=`\x1B[${this._nullCellCount}X`,this._currentRow+=`\x1B[${this._nullCellCount}C`),this._nullCellCount=0),this._currentRow+=e.getChars(),this._lastContentCursorRow=this._lastCursorRow=i,this._lastContentCursorCol=this._lastCursorCol=r+e.getWidth())}_serializeString(e){let s=this._allRows.length;this._buffer.length-this._firstRow<=this._terminal.rows&&(s=this._lastContentCursorRow+1-this._firstRow,this._lastCursorCol=this._lastContentCursorCol,this._lastCursorRow=this._lastContentCursorRow);let i="";for(let o=0;o<s;o++)i+=this._allRows[o],o+1<s&&(i+=this._allRowSeparators[o]);if(!e){let o=this._buffer.baseY+this._buffer.cursorY,a=this._buffer.cursorX,h=o!==this._lastCursorRow||a!==this._lastCursorCol,l=c=>{c>0?i+=`\x1B[${c}C`:c<0&&(i+=`\x1B[${-c}D`)};h&&((c=>{c>0?i+=`\x1B[${c}B`:c<0&&(i+=`\x1B[${-c}A`)})(o-this._lastCursorRow),l(a-this._lastCursorCol))}let r=this._terminal._core._inputHandler._curAttrData,n=this._diffStyle(r,this._cursorStyle);return n.length>0&&(i+=`\x1B[${n.join(";")}m`),i}},du=class{activate(e){this._terminal=e}_serializeBufferByScrollback(e,s,i){let r=s.length,n=i===void 0?r:xo(i+e.rows,0,r);return this._serializeBufferByRange(e,s,{start:r-n,end:r-1},!1)}_serializeBufferByRange(e,s,i,r){return new cu(s,e).serialize({start:{x:0,y:typeof i.start=="number"?i.start:i.start.line},end:{x:e.cols,y:typeof i.end=="number"?i.end:i.end.line}},r)}_serializeBufferAsHTML(e,s){var h;let i=e.buffer.active,r=new uu(i,e,s),n=s.onlySelection??!1,o=s.range;if(o)return r.serialize({start:{x:o.startCol,y:(o.startLine,o.startLine)},end:{x:e.cols,y:(o.endLine,o.endLine)}});if(!n){let l=i.length,c=s.scrollback,d=c===void 0?l:xo(c+e.rows,0,l);return r.serialize({start:{x:0,y:l-d},end:{x:e.cols,y:l-1}})}let a=(h=this._terminal)==null?void 0:h.getSelectionPosition();return a!==void 0?r.serialize({start:{x:a.start.x,y:a.start.y},end:{x:a.end.x,y:a.end.y}}):""}_serializeModes(e){let s="",i=e.modes;if(i.applicationCursorKeysMode&&(s+="\x1B[?1h"),i.applicationKeypadMode&&(s+="\x1B[?66h"),i.bracketedPasteMode&&(s+="\x1B[?2004h"),i.insertMode&&(s+="\x1B[4h"),i.originMode&&(s+="\x1B[?6h"),i.reverseWraparoundMode&&(s+="\x1B[?45h"),i.sendFocusMode&&(s+="\x1B[?1004h"),i.wraparoundMode===!1&&(s+="\x1B[?7l"),i.mouseTrackingMode!=="none")switch(i.mouseTrackingMode){case"x10":s+="\x1B[?9h";break;case"vt200":s+="\x1B[?1000h";break;case"drag":s+="\x1B[?1002h";break;case"any":s+="\x1B[?1003h";break}return s}serialize(e){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let s=e!=null&&e.range?this._serializeBufferByRange(this._terminal,this._terminal.buffer.normal,e.range,!0):this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.normal,e==null?void 0:e.scrollback);if(!(e!=null&&e.excludeAltBuffer)&&this._terminal.buffer.active.type==="alternate"){let i=this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.alternate,void 0);s+=`\x1B[?1049h\x1B[H${i}`}return e!=null&&e.excludeModes||(s+=this._serializeModes(this._terminal)),s}serializeAsHTML(e){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._serializeBufferAsHTML(this._terminal,e||{})}dispose(){}},uu=class extends Ja{constructor(e,s,i){super(e),this._terminal=s,this._options=i,this._currentRow="",this._htmlContent="",s._core._themeService?this._ansiColors=s._core._themeService.colors.ansi:this._ansiColors=lu}_padStart(e,s,i){return s=s>>0,i=i??" ",e.length>s?e:(s-=e.length,s>i.length&&(i+=i.repeat(s/i.length)),i.slice(0,s)+e)}_beforeSerialize(e,s,i){var a,h;this._htmlContent+="<html><body><!--StartFragment--><pre>";let r="#000000",n="#ffffff";(this._options.includeGlobalBackground??!1)&&(r=((a=this._terminal.options.theme)==null?void 0:a.foreground)??"#ffffff",n=((h=this._terminal.options.theme)==null?void 0:h.background)??"#000000");let o=[];o.push("color: "+r+";"),o.push("background-color: "+n+";"),o.push("font-family: "+this._terminal.options.fontFamily+";"),o.push("font-size: "+this._terminal.options.fontSize+"px;"),this._htmlContent+="<div style='"+o.join(" ")+"'>"}_afterSerialize(){this._htmlContent+="</div>",this._htmlContent+="</pre><!--EndFragment--></body></html>"}_rowEnd(e,s){this._htmlContent+="<div><span>"+this._currentRow+"</span></div>",this._currentRow=""}_getHexColor(e,s){let i=s?e.getFgColor():e.getBgColor();if(s?e.isFgRGB():e.isBgRGB())return"#"+[i>>16&255,i>>8&255,i&255].map(r=>this._padStart(r.toString(16),2,"0")).join("");if(s?e.isFgPalette():e.isBgPalette())return this._ansiColors[i].css}_diffStyle(e,s){let i=[],r=!Za(e,s),n=!_t(e,s),o=!Qa(e,s);if(r||n||o){let a=this._getHexColor(e,!0);a&&i.push("color: "+a+";");let h=this._getHexColor(e,!1);return h&&i.push("background-color: "+h+";"),e.isInverse()&&i.push("color: #000000; background-color: #BFBFBF;"),e.isBold()&&i.push("font-weight: bold;"),e.isUnderline()&&e.isOverline()?i.push("text-decoration: overline underline;"):e.isUnderline()?i.push("text-decoration: underline;"):e.isOverline()&&i.push("text-decoration: overline;"),e.isBlink()&&i.push("text-decoration: blink;"),e.isInvisible()&&i.push("visibility: hidden;"),e.isItalic()&&i.push("font-style: italic;"),e.isDim()&&i.push("opacity: 0.5;"),e.isStrikethrough()&&i.push("text-decoration: line-through;"),i}}_nextCell(e,s,i,r){if(e.getWidth()===0)return;let n=e.getChars()==="",o=this._diffStyle(e,s);o&&(this._currentRow+=o.length===0?"</span><span>":"</span><span style='"+o.join(" ")+"'>"),n?this._currentRow+=" ":this._currentRow+=hu(e.getChars())}_serializeString(){return this._htmlContent}};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function el(t,e=""){if(!Number.isSafeInteger(t)||t<0){const s=e&&`"${e}" `;throw new Error(`${s}expected integer >= 0, got ${t}`)}}function xs(t,e,s=""){const i=fu(t),r=t==null?void 0:t.length,n=e!==void 0;if(!i||n&&r!==e){const o=s&&`"${s}" `,a=n?` of length ${e}`:"",h=i?`length=${r}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+h)}return t}const tl=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",_u=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function pu(t){if(xs(t),tl)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=_u[t[s]];return e}const ft={_0:48,_9:57,A:65,F:70,a:97,f:102};function Eo(t){if(t>=ft._0&&t<=ft._9)return t-ft._0;if(t>=ft.A&&t<=ft.F)return t-(ft.A-10);if(t>=ft.a&&t<=ft.f)return t-(ft.a-10)}function mu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(tl)return Uint8Array.fromHex(t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(s);for(let r=0,n=0;r<s;r++,n+=2){const o=Eo(t.charCodeAt(n)),a=Eo(t.charCodeAt(n+1));if(o===void 0||a===void 0){const h=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+h+'" at index '+n)}i[r]=o*16+a}return i}function gu(t=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(e==null?void 0:e.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sl=BigInt(0);function vu(t){if(typeof t=="bigint"){if(!pi(t))throw new Error("positive bigint expected, got "+t)}else el(t);return t}function Su(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?sl:BigInt("0x"+t)}function Bo(t){return Su(pu(Ur(xs(t)).reverse()))}function wu(t,e){el(e),t=vu(t);const s=mu(t.toString(16).padStart(e*2,"0"));if(s.length!==e)throw new Error("number too large");return s}function yu(t,e){return wu(t,e).reverse()}function Ur(t){return Uint8Array.from(t)}const pi=t=>typeof t=="bigint"&&sl<=t;function bu(t,e,s){return pi(t)&&pi(e)&&pi(s)&&e<=t&&t<s}function Po(t,e,s,i){if(!bu(e,s,i))throw new Error("expected valid "+t+": "+s+" <= n < "+i+", got "+e)}function Cu(t,e={},s={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(n,o,a){const h=t[n];if(a&&h===void 0)return;const l=typeof h;if(l!==o||h===null)throw new Error(`param "${n}" is invalid: expected ${o}, got ${l}`)}const r=(n,o)=>Object.entries(n).forEach(([a,h])=>i(a,h,o));r(e,!1),r(s,!0)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const il=BigInt(0);function rl(t,e){const s=t%e;return s>=il?s:e+s}function Ze(t,e,s){let i=t;for(;e-- >il;)i*=i,i%=s;return i}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ku(t,e){return function(i){const r=t(i);return{secretKey:r,publicKey:e(r)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _s=BigInt(0),ts=BigInt(1),Zs=BigInt(2);function xu(t){return Cu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Eu(t){const e=xu(t),{P:s,type:i,adjustScalarBytes:r,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const h=o||gu,l=a?255:448,c=a?32:56,d=BigInt(a?9:5),u=BigInt(a?121665:39081),_=a?Zs**BigInt(254):Zs**BigInt(447),f=a?BigInt(8)*Zs**BigInt(251)-ts:BigInt(4)*Zs**BigInt(445)-ts,p=_+f+ts,m=b=>rl(b,s),S=y(d);function y(b){return yu(m(b),c)}function w(b){const k=Ur(xs(b,c,"uCoordinate"));return a&&(k[31]&=127),m(Bo(k))}function C(b){return Bo(r(Ur(xs(b,c,"scalar"))))}function L(b,k){const B=xe(w(k),C(b));if(B===_s)throw new Error("invalid private or public key received");return y(B)}function A(b){return L(b,S)}const z=A,j=L;function W(b,k,B){const D=m(b*(k-B));return k=m(k-D),B=m(B+D),{x_2:k,x_3:B}}function xe(b,k){Po("u",b,_s,s),Po("scalar",k,_,p);const B=k,D=b;let x=ts,I=_s,N=b,Y=ts,X=_s;for(let re=BigInt(l-1);re>=_s;re--){const Le=B>>re&ts;X^=Le,{x_2:x,x_3:N}=W(X,x,N),{x_2:I,x_3:Y}=W(X,I,Y),X=Le;const ce=x+I,Ne=m(ce*ce),tt=x-I,H=m(tt*tt),Re=Ne-H,It=N+Y,st=N-Y,$=m(st*ce),Zt=m(It*tt),Pn=$+Zt,Ln=$-Zt;N=m(Pn*Pn),Y=m(D*m(Ln*Ln)),x=m(Ne*H),I=m(Re*(Ne+m(u*Re)))}({x_2:x,x_3:N}=W(X,x,N)),{x_2:I,x_3:Y}=W(X,I,Y);const ie=n(I);return m(x*ie)}const F={secretKey:c,publicKey:c,seed:c},P=(b=h(c))=>(xs(b,F.seed,"seed"),b),v={randomSecretKey:P};return Object.freeze({keygen:ku(P,z),getSharedSecret:j,getPublicKey:z,scalarMult:L,scalarMultBase:A,utils:v,GuBytes:S.slice(),lengths:F})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bu=BigInt(1),Lo=BigInt(2),Pu=BigInt(3),Lu=BigInt(5);BigInt(8);const nl=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed");function Ru(t){const e=BigInt(10),s=BigInt(20),i=BigInt(40),r=BigInt(80),n=nl,a=t*t%n*t%n,h=Ze(a,Lo,n)*a%n,l=Ze(h,Bu,n)*t%n,c=Ze(l,Lu,n)*l%n,d=Ze(c,e,n)*c%n,u=Ze(d,s,n)*d%n,_=Ze(u,i,n)*u%n,f=Ze(_,r,n)*_%n,p=Ze(f,r,n)*_%n,m=Ze(p,e,n)*c%n;return{pow_p_5_8:Ze(m,Lo,n)*t%n,b2:a}}function Au(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const zs=(()=>{const t=nl;return Eu({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:s,b2:i}=Ru(e);return rl(Ze(s,Pu,t)*i,t)},adjustScalarBytes:Au})})();var Du=Object.defineProperty,Qs=(t,e,s)=>((i,r,n)=>r in i?Du(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s);class pt extends Error{constructor(e={}){super(e.message),Qs(this,"exceptionId"),Qs(this,"message"),Qs(this,"source"),Qs(this,"type"),this.message=e.message??"",this.source=e.source,this.type=this.constructor.name,this.exceptionId=e.exceptionId}}class q extends pt{}class Mu extends pt{}class fe extends pt{}const _e=t=>{typeof t!="string"?t&&typeof t.toString=="function"?console.warn(`[nlux] ${t.toString()}`):console.warn("[nlux]"):console.warn(`[nlux] ${t}`)},Ro=[],Kr=t=>{Ro.includes(t)||(Ro.push(t),_e(t))},ol=class mi{static register(e){const s=e.__compId;s?mi.componentDefs.get(s)===void 0&&(e.__renderer&&e.__updater?mi.componentDefs.set(s,{id:s,model:e,render:e.__renderer,update:e.__updater}):_e(`Component with id "${s}" missing renderer or updater`)):_e("Component definition missing valid id")}static retrieve(e){const s=mi.componentDefs.get(e);if(s)return s;_e(`Component with id "${e}" not registered`)}};ol.componentDefs=new Map;let Oi=ol;const Ao={version:"{versions.nlux}",[btoa("sectionsRegistered")]:!1},at=t=>{const e=requestAnimationFrame((()=>{t()}));return()=>{cancelAnimationFrame(e)}},ns=t=>{t.replaceChildren()},Ve=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return(t=="x"?e:3&e|8).toString(16)}));class Xe{constructor(e,s){this.subComponentElementIds=new Map,this.subComponents=new Map,this.__context=null,this.__destroyed=!1,this.__status="unmounted",this.actionsOnDomReady=[],this.compEventGetter=o=>{if(this.destroyed)return()=>{};const a=this.rendererEventListeners.get(o);if(!a)throw new pt({source:this.constructor.name,message:`Unable to call renderer event "${o}" because no matching event listener was found. Make sure that the event listener is registered using @CompEventListener() decorator in the component model class, and use class methods instead of arrow function attributes.`});return a};const i=Object.getPrototypeOf(this).constructor.__compId;if(!i)throw new q({source:this.constructor.name,message:"Unable to instantiate component: missing compId in implementation. Component should be annotated using @Model() to set compId before iy can be instantiated."});if(this.def=Oi.retrieve(i)??null,!this.def)throw new q({source:this.constructor.name,message:`Unable to instantiate component "${i}" because it's not registered. Component should be registered using CompRegistry.register(ComponentClass) before instantiating a component.`});this.__instanceId=Ve(),this.__destroyed=!1,this.__context=e,this.renderedDom=null,this.renderingRoot=null,this.props=s;const r=s?Object.entries(s):[];this.elementProps=new Map(r),this.rendererEventListeners=new Map;const n=this.constructor.__compEventListeners;n&&n.forEach(((o,a)=>{o.forEach((h=>{const l=Object.getPrototypeOf(this)[h];typeof l=="function"?this.addRendererEventListener(a,l.bind(this)):_e(`Unable to set event listener "${a}" because method "${h}" cannot be found on component "${this.constructor.name} at runtime!"`)}))})),this.rendererProps=Object.freeze(s)}get destroyed(){return this.__destroyed}get id(){return this.__instanceId}get rendered(){return this.renderedDom!==null}get root(){return this.throwIfDestroyed(),this.renderedDom&&this.renderingRoot?this.renderingRoot:null}get status(){return this.__status}get context(){if(!this.__context)throw new q({source:this.constructor.name,message:"Unable to get context because it's not set"});return this.__context}destroy(){this.destroyComponent()}destroyListItemComponent(){this.destroyComponent(!0)}getProp(e){return this.throwIfDestroyed(),this.elementProps.get(e)??null}render(e,s){var o;if(!this.def)return;if(this.destroyed)return void _e(`Unable to render component "${(o=this.def)==null?void 0:o.id}" because it is already destroyed`);if(this.rendered||this.renderedDom)return void _e(`Unable to render component "${this.def.id}" because it is already rendered`);const i=document.createDocumentFragment(),r=Object.getPrototypeOf(this).constructor.__compId,n=this.executeRenderer(i);if(!n)throw new pt({source:this.constructor.name,message:`Unable to render component "${r}" because renderer returned null`});this.renderedDom=n;for(const[,a]of this.subComponents){const h=this.getSubComponentPortal(a.id);h&&this.mountSubComponentToPortal(a.id,h)}at((()=>{this.destroyed||(s?e.insertBefore(i,s):e.append(i),this.renderingRoot=e)}))}updateSubComponent(e,s,i){this.throwIfDestroyed();const r=this.subComponents.get(e);r&&!r.destroyed&&r.setProp(s,i)}addSubComponent(e,s,i){if(this.throwIfDestroyed(),this.subComponents.has(e))throw new q({source:this.constructor.name,message:`Unable to add sub-component "${e}" because it already exists`});if(this.subComponents.set(e,s),i&&this.subComponentElementIds.set(e,i),this.renderedDom){const r=this.getSubComponentPortal(e);r&&this.mountSubComponentToPortal(e,r)}}executeDomAction(e,...s){if(this.throwIfDestroyed(),!this.renderedDom)return void this.actionsOnDomReady.push((()=>this.executeDomAction(e,...s)));if(!this.renderingRoot)throw new pt({source:this.constructor.name,message:"Unable to execute DOM action because renderingRoot is not set"});const i=this.renderedDom.actions[e];if(!i)throw new pt({source:this.constructor.name,message:`Unable to execute DOM action "${String(e)}" because it does not exist`});return at((()=>i(...s)))}executeRenderer(e){var r;const s=(r=this.def)==null?void 0:r.render;if(!s)return null;if(this.renderingRoot)throw new pt({source:this.constructor.name,message:"Unable to render component because renderingRoot is already set"});const i=s({appendToRoot:n=>{e.append(n),this.runDomActionsQueue()},compEvent:this.compEventGetter,props:this.rendererProps,context:this.context});return i&&(this.renderingRoot=e),i}removeSubComponent(e){this.throwIfDestroyed(),at((()=>{const s=this.subComponents.get(e);s&&(s.renderingRoot=null,s.destroy(),this.subComponents.delete(e))}))}runDomActionsQueue(){if(this.actionsOnDomReady.length>0&&this.rendered){const e=this.actionsOnDomReady;this.actionsOnDomReady=[];for(const s of e)at((()=>s()))}}setProp(e,s){this.destroyed?_e(`Unable to set prop "${String(e)}" because component "${this.constructor.name}" is destroyed`):this.elementProps.has(e)?(this.schedulePropUpdate(e,this.elementProps.get(e),s),this.props=Object.freeze(Object.fromEntries(this.elementProps)),this.elementProps.set(e,s)):_e(`Unable to set prop "${String(e)}" because it does not exist in the component props`)}throwIfDestroyed(){if(this.__destroyed)throw new q({source:this.constructor.name,message:"Unable to call method on destroyed component"})}addRendererEventListener(e,s){if(this.throwIfDestroyed(),this.rendererEventListeners.has(e))throw new q({source:this.constructor.name,message:`Unable to add event listener to rendererEvents "${e}" because it already exists`});this.rendererEventListeners.set(e,s)}destroyComponent(e=!1){if(this.throwIfDestroyed(),this.subComponents.forEach((s=>{s.destroy()})),this.renderedDom){this.renderedDom.elements&&(this.renderedDom.elements=void 0),this.renderedDom.actions&&(this.renderedDom.actions=void 0),this.renderedDom.onDestroy&&this.renderedDom.onDestroy();const s=this.renderingRoot;at((()=>{var i;if(s)if(s instanceof DocumentFragment)for(;s.firstChild;)s.removeChild(s.firstChild);else e?(i=s.parentElement)==null||i.removeChild(s):ns(s)})),this.renderedDom=null,this.renderingRoot=null}this.__destroyed=!0,this.__context=null,this.props=void 0,this.elementProps.clear(),this.rendererEventListeners.clear(),this.subComponents.clear()}getSubComponentPortal(e){var n;const s=this.subComponents.get(e),i=this.subComponentElementIds.get(e);if(!s||!i)return null;const r=((n=this.renderedDom)==null?void 0:n.elements)[i];return r instanceof HTMLElement?r:null}mountSubComponentToPortal(e,s){const i=this.subComponents.get(e);i==null||i.render(s)}schedulePropUpdate(e,s,i){var a;if(!this.renderedDom||!((a=this.def)!=null&&a.update))return;const r=this.renderedDom,n=this.renderingRoot,o=this.def.update;n&&at((()=>{o({propName:e,currentValue:s,newValue:i,dom:{root:n,elements:r.elements,actions:r.actions},updateSubComponent:this.updateSubComponent})}))}}Xe.__compEventListeners=null,Xe.__compId=null,Xe.__renderer=null,Xe.__updater=null;const Mt=(t,e,s)=>i=>{i.__compId=t,i.__renderer=e,i.__updater=s},et=t=>(e,s)=>{const i=e;if(typeof i.constructor!="function")throw new q({source:"CallbackFor",message:"@CallbackFor can only be used on methods of a class!"});i.constructor.hasOwnProperty("__compEventListeners")&&i.constructor.__compEventListeners!==null||(i.constructor.__compEventListeners=new Map);const r=i.constructor.__compEventListeners,n=r.get(t);n?n.push(s):r.set(t,[s])},al=(t,e)=>{const s=document.createElement("div");if(s.classList.add("nlux-comp-avatarContainer"),t){const i=document.createElement("div");i.classList.add("nlux-comp-avatarPicture"),i.style.backgroundImage=`url("${encodeURI(t)}")`,s.append(i)}return s},un="nlux-comp-avatar",fn=t=>{const e=document.createElement("div");return e.classList.add(un),t.avatar||t.name?(t.name&&(e.title=t.name),t.avatar&&t.avatar instanceof HTMLElement?(e.append(t.avatar.cloneNode(!0)),e):(e.append(al(t.avatar)),e)):e},ei={received:"nlux_msg_received",sent:"nlux_msg_sent"},ll=(t,e)=>{Object.keys(ei).forEach((s=>{t.classList.remove(ei[s])})),ei[e]&&t.classList.add(ei[e])},Cs={streaming:"nlux_msg_streaming",complete:"nlux_msg_complete"},hl=(t,e)=>{Object.keys(Cs).forEach((s=>{t.classList.remove(Cs[s])})),Cs[e]&&t.classList.add(Cs[e])},Do=t=>{if(!(t instanceof HTMLButtonElement)||t.dataset.clickListenerSet==="true")return;let e=!1;const s=t.nextElementSibling;t.addEventListener("click",(()=>{if(e||!s)return;const i=s.innerText;navigator.clipboard.writeText(i??""),e=!0,t.classList.add("clicked"),setTimeout((()=>{e=!1,t.classList.remove("clicked")}),1e3)})),t.dataset.clickListenerSet="true"},cl=t=>{const e="nlux-comp-copyButton";t instanceof HTMLButtonElement&&t.classList.contains(e)?Do(t):t.querySelectorAll(`.${e}`).forEach(Do)};function Iu(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Jt={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Mo(t){Jt=t}var Tu=Object.defineProperty,dl=(t,e,s)=>((i,r,n)=>r in i?Tu(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s);class Es{constructor(e){dl(this,"options"),this.options=e||Jt}postprocess(e){return e}preprocess(e){return e}processAllTokens(e){return e}}dl(Es,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));const ul=/[&<>"']/,Ou=new RegExp(ul.source,"g"),fl=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Nu=new RegExp(fl.source,"g"),Hu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Io=t=>Hu[t];function $e(t,e){if(e){if(ul.test(t))return t.replace(Ou,Io)}else if(fl.test(t))return t.replace(Nu,Io);return t}const zu=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Fu(t){return t.replace(zu,((e,s)=>(s=s.toLowerCase())==="colon"?":":s.charAt(0)==="#"?s.charAt(1)==="x"?String.fromCharCode(parseInt(s.substring(2),16)):String.fromCharCode(+s.substring(1)):""))}const Wu=/(^|[^\[])\^/g;function K(t,e){let s=typeof t=="string"?t:t.source;e=e||"";const i={replace:(r,n)=>{let o=typeof n=="string"?n:n.source;return o=o.replace(Wu,"$1"),s=s.replace(r,o),i},getRegex:()=>new RegExp(s,e)};return i}function To(t){try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const Bs={exec:()=>null};function Oo(t,e){const s=t.replace(/\|/g,((r,n,o)=>{let a=!1,h=n;for(;--h>=0&&o[h]==="\\";)a=!a;return a?"|":" |"})).split(/ \|/);let i=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;i<s.length;i++)s[i]=s[i].trim().replace(/\\\|/g,"|");return s}function ti(t,e,s){const i=t.length;if(i===0)return"";let r=0;for(;r<i&&!(t.charAt(i-r-1)!==e||s);)r++;return t.slice(0,i-r)}const Ks=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,_l=/(?:[*+-]|\d{1,9}[.)])/,pl=K(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,_l).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),_n=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,pn=/(?!\s*\])(?:\\.|[^\[\]\\])+/,$u=K(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",pn).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Uu=K(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,_l).getRegex(),Ni="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",mn=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Ku=K("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",mn).replace("tag",Ni).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),No=K(_n).replace("hr",Ks).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex(),gn={blockquote:K(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",No).getRegex(),code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,def:$u,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:Ks,html:Ku,lheading:pl,list:Uu,newline:/^(?: *(?:\n|$))+/,paragraph:No,table:Bs,text:/^[^\n]+/},Ho=K("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ks).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex(),qu={...gn,table:Ho,paragraph:K(_n).replace("hr",Ks).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ho).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex()},Yu={...gn,html:K(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",mn).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Bs,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:K(_n).replace("hr",Ks).replace("heading",` *#{1,6} *[^
]`).replace("lheading",pl).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ml=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,gl=/^( {2,}|\\)\n(?!\s*$)/,qs="\\p{P}\\p{S}",Vu=K(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,qs).getRegex(),ju=K(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,qs).getRegex(),Xu=K("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,qs).getRegex(),Gu=K("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,qs).getRegex(),Ju=K(/\\([punct])/,"gu").replace(/punct/g,qs).getRegex(),Zu=K(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qu=K(mn).replace("(?:-->|$)","-->").getRegex(),ef=K("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qu).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ci=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,tf=K(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Ci).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),zo=K(/^!?\[(label)\]\[(ref)\]/).replace("label",Ci).replace("ref",pn).getRegex(),Fo=K(/^!?\[(ref)\](?:\[\])?/).replace("ref",pn).getRegex(),vn={_backpedal:Bs,anyPunctuation:Ju,autolink:Zu,blockSkip:/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,br:gl,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Bs,emStrongLDelim:ju,emStrongRDelimAst:Xu,emStrongRDelimUnd:Gu,escape:ml,link:tf,nolink:Fo,punctuation:Vu,reflink:zo,reflinkSearch:K("reflink|nolink(?!\\()","g").replace("reflink",zo).replace("nolink",Fo).getRegex(),tag:ef,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Bs},sf={...vn,link:K(/^!?\[(label)\]\((.*?)\)/).replace("label",Ci).getRegex(),reflink:K(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ci).getRegex()},qr={...vn,escape:K(ml).replace("])","~|])").getRegex(),url:K(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},rf={...qr,br:K(gl).replace("{2,}","*").getRegex(),text:K(qr.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},si={normal:gn,gfm:qu,pedantic:Yu},ps={normal:vn,gfm:qr,breaks:rf,pedantic:sf};var nf=Object.defineProperty,er=(t,e,s)=>((i,r,n)=>r in i?nf(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s);function Wo(t,e,s,i){const r=e.href,n=e.title?$e(e.title):null,o=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){i.state.inLink=!0;const a={type:"link",raw:s,href:r,title:n,text:o,tokens:i.inlineTokens(o)};return i.state.inLink=!1,a}return{type:"image",raw:s,href:r,title:n,text:$e(o)}}class ki{constructor(e){er(this,"lexer"),er(this,"options"),er(this,"rules"),this.options=e||Jt}autolink(e){const s=this.rules.inline.autolink.exec(e);if(s){let i,r;return s[2]==="@"?(i=$e(s[1]),r="mailto:"+i):(i=$e(s[1]),r=i),{type:"link",raw:s[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}blockquote(e){const s=this.rules.block.blockquote.exec(e);if(s){let i=s[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);i=ti(i.replace(/^ *>[ \t]?/gm,""),`
`);const r=this.lexer.state.top;this.lexer.state.top=!0;const n=this.lexer.blockTokens(i);return this.lexer.state.top=r,{type:"blockquote",raw:s[0],tokens:n,text:i}}}br(e){const s=this.rules.inline.br.exec(e);if(s)return{type:"br",raw:s[0]}}code(e){const s=this.rules.block.code.exec(e);if(s){const i=s[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:s[0],codeBlockStyle:"indented",text:this.options.pedantic?i:ti(i,`
`)}}}codespan(e){const s=this.rules.inline.code.exec(e);if(s){let i=s[2].replace(/\n/g," ");const r=/[^ ]/.test(i),n=/^ /.test(i)&&/ $/.test(i);return r&&n&&(i=i.substring(1,i.length-1)),i=$e(i,!0),{type:"codespan",raw:s[0],text:i}}}def(e){const s=this.rules.block.def.exec(e);if(s){const i=s[1].toLowerCase().replace(/\s+/g," "),r=s[2]?s[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=s[3]?s[3].substring(1,s[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):s[3];return{type:"def",tag:i,raw:s[0],href:r,title:n}}}del(e){const s=this.rules.inline.del.exec(e);if(s)return{type:"del",raw:s[0],text:s[2],tokens:this.lexer.inlineTokens(s[2])}}emStrong(e,s,i=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(r&&!(r[3]&&i.match(/[\p{L}\p{N}]/u))&&(!(r[1]||r[2])||!i||this.rules.inline.punctuation.exec(i))){const n=[...r[0]].length-1;let o,a,h=n,l=0;const c=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,s=s.slice(-1*e.length+n);(r=c.exec(s))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(a=[...o].length,r[3]||r[4]){h+=a;continue}if((r[5]||r[6])&&n%3&&!((n+a)%3)){l+=a;continue}if(h-=a,h>0)continue;a=Math.min(a,a+h+l);const d=[...r[0]][0].length,u=e.slice(0,n+r.index+d+a);if(Math.min(n,a)%2){const f=u.slice(1,-1);return{type:"em",raw:u,text:f,tokens:this.lexer.inlineTokens(f)}}const _=u.slice(2,-2);return{type:"strong",raw:u,text:_,tokens:this.lexer.inlineTokens(_)}}}}escape(e){const s=this.rules.inline.escape.exec(e);if(s)return{type:"escape",raw:s[0],text:$e(s[1])}}fences(e){const s=this.rules.block.fences.exec(e);if(s){const i=s[0],r=(function(n,o){const a=n.match(/^(\s+)(?:```)/);if(a===null)return o;const h=a[1];return o.split(`
`).map((l=>{const c=l.match(/^\s+/);if(c===null)return l;const[d]=c;return d.length>=h.length?l.slice(h.length):l})).join(`
`)})(i,s[3]||"");return{type:"code",raw:i,lang:s[2]?s[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):s[2],text:r}}}heading(e){const s=this.rules.block.heading.exec(e);if(s){let i=s[2].trim();if(/#$/.test(i)){const r=ti(i,"#");this.options.pedantic?i=r.trim():r&&!/ $/.test(r)||(i=r.trim())}return{type:"heading",raw:s[0],depth:s[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const s=this.rules.block.hr.exec(e);if(s)return{type:"hr",raw:s[0]}}html(e){const s=this.rules.block.html.exec(e);if(s)return{type:"html",block:!0,raw:s[0],pre:s[1]==="pre"||s[1]==="script"||s[1]==="style",text:s[0]}}inlineText(e){const s=this.rules.inline.text.exec(e);if(s){let i;return i=this.lexer.state.inRawBlock?s[0]:$e(s[0]),{type:"text",raw:s[0],text:i}}}lheading(e){const s=this.rules.block.lheading.exec(e);if(s)return{type:"heading",raw:s[0],depth:s[2].charAt(0)==="="?1:2,text:s[1],tokens:this.lexer.inline(s[1])}}link(e){const s=this.rules.inline.link.exec(e);if(s){const i=s[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const o=ti(i.slice(0,-1),"\\");if((i.length-o.length)%2==0)return}else{const o=(function(a,h){if(a.indexOf(h[1])===-1)return-1;let l=0;for(let c=0;c<a.length;c++)if(a[c]==="\\")c++;else if(a[c]===h[0])l++;else if(a[c]===h[1]&&(l--,l<0))return c;return-1})(s[2],"()");if(o>-1){const a=(s[0].indexOf("!")===0?5:4)+s[1].length+o;s[2]=s[2].substring(0,o),s[0]=s[0].substring(0,a).trim(),s[3]=""}}let r=s[2],n="";if(this.options.pedantic){const o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);o&&(r=o[1],n=o[3])}else n=s[3]?s[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(r=this.options.pedantic&&!/>$/.test(i)?r.slice(1):r.slice(1,-1)),Wo(s,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},s[0],this.lexer)}}list(e){let s=this.rules.block.list.exec(e);if(s){let i=s[1].trim();const r=i.length>1,n={type:"list",raw:"",ordered:r,start:r?+i.slice(0,-1):"",loose:!1,items:[]};i=r?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=r?i:"[*+-]");const o=new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a="",h="",l=!1;for(;e;){let c=!1;if(!(s=o.exec(e))||this.rules.block.hr.test(e))break;a=s[0],e=e.substring(a.length);let d=s[2].split(`
`,1)[0].replace(/^\t+/,(S=>" ".repeat(3*S.length))),u=e.split(`
`,1)[0],_=0;this.options.pedantic?(_=2,h=d.trimStart()):(_=s[2].search(/[^ ]/),_=_>4?1:_,h=d.slice(_),_+=s[1].length);let f=!1;if(!d&&/^ *$/.test(u)&&(a+=u+`
`,e=e.substring(u.length+1),c=!0),!c){const S=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),y=new RegExp(`^ {0,${Math.min(3,_-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),w=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:\`\`\`|~~~)`),C=new RegExp(`^ {0,${Math.min(3,_-1)}}#`);for(;e;){const L=e.split(`
`,1)[0];if(u=L,this.options.pedantic&&(u=u.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),w.test(u)||C.test(u)||S.test(u)||y.test(e))break;if(u.search(/[^ ]/)>=_||!u.trim())h+=`
`+u.slice(_);else{if(f||d.search(/[^ ]/)>=4||w.test(d)||C.test(d)||y.test(d))break;h+=`
`+u}f||u.trim()||(f=!0),a+=L+`
`,e=e.substring(L.length+1),d=u.slice(_)}}n.loose||(l?n.loose=!0:/\n *\n *$/.test(a)&&(l=!0));let p,m=null;this.options.gfm&&(m=/^\[[ xX]\] /.exec(h),m&&(p=m[0]!=="[ ] ",h=h.replace(/^\[[ xX]\] +/,""))),n.items.push({type:"list_item",raw:a,task:!!m,checked:p,loose:!1,text:h,tokens:[]}),n.raw+=a}n.items[n.items.length-1].raw=a.trimEnd(),n.items[n.items.length-1].text=h.trimEnd(),n.raw=n.raw.trimEnd();for(let c=0;c<n.items.length;c++)if(this.lexer.state.top=!1,n.items[c].tokens=this.lexer.blockTokens(n.items[c].text,[]),!n.loose){const d=n.items[c].tokens.filter((_=>_.type==="space")),u=d.length>0&&d.some((_=>/\n.*\n/.test(_.raw)));n.loose=u}if(n.loose)for(let c=0;c<n.items.length;c++)n.items[c].loose=!0;return n}}paragraph(e){const s=this.rules.block.paragraph.exec(e);if(s){const i=s[1].charAt(s[1].length-1)===`
`?s[1].slice(0,-1):s[1];return{type:"paragraph",raw:s[0],text:i,tokens:this.lexer.inline(i)}}}reflink(e,s){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){const r=s[(i[2]||i[1]).replace(/\s+/g," ").toLowerCase()];if(!r){const n=i[0].charAt(0);return{type:"text",raw:n,text:n}}return Wo(i,r,i[0],this.lexer)}}space(e){const s=this.rules.block.newline.exec(e);if(s&&s[0].length>0)return{type:"space",raw:s[0]}}table(e){const s=this.rules.block.table.exec(e);if(!s||!/[:|]/.test(s[2]))return;const i=Oo(s[1]),r=s[2].replace(/^\||\| *$/g,"").split("|"),n=s[3]&&s[3].trim()?s[3].replace(/\n[ \t]*$/,"").split(`
`):[],o={type:"table",raw:s[0],header:[],align:[],rows:[]};if(i.length===r.length){for(const a of r)/^ *-+: *$/.test(a)?o.align.push("right"):/^ *:-+: *$/.test(a)?o.align.push("center"):/^ *:-+ *$/.test(a)?o.align.push("left"):o.align.push(null);for(const a of i)o.header.push({text:a,tokens:this.lexer.inline(a)});for(const a of n)o.rows.push(Oo(a,o.header.length).map((h=>({text:h,tokens:this.lexer.inline(h)}))));return o}}tag(e){const s=this.rules.inline.tag.exec(e);if(s)return!this.lexer.state.inLink&&/^<a /i.test(s[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(s[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(s[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(s[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:s[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:s[0]}}text(e){const s=this.rules.block.text.exec(e);if(s)return{type:"text",raw:s[0],text:s[0],tokens:this.lexer.inline(s[0])}}url(e){var i;let s;if(s=this.rules.inline.url.exec(e)){let r,n;if(s[2]==="@")r=$e(s[0]),n="mailto:"+r;else{let o;do o=s[0],s[0]=((i=this.rules.inline._backpedal.exec(s[0]))==null?void 0:i[0])??"";while(o!==s[0]);r=$e(s[0]),n=s[1]==="www."?"http://"+s[0]:s[0]}return{type:"link",raw:s[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}}var of=Object.defineProperty,ms=(t,e,s)=>((i,r,n)=>r in i?of(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s);class gt{constructor(e){ms(this,"options"),ms(this,"state"),ms(this,"tokens"),ms(this,"inlineQueue"),ms(this,"tokenizer"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Jt,this.options.tokenizer=this.options.tokenizer||new ki,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const s={block:si.normal,inline:ps.normal};this.options.pedantic?(s.block=si.pedantic,s.inline=ps.pedantic):this.options.gfm&&(s.block=si.gfm,this.options.breaks?s.inline=ps.breaks:s.inline=ps.gfm),this.tokenizer.rules=s}static get rules(){return{block:si,inline:ps}}static lex(e,s){return new gt(s).lex(e)}static lexInline(e,s){return new gt(s).inlineTokens(e)}blockTokens(e,s=[]){let i,r,n,o;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,((a,h,l)=>h+"    ".repeat(l.length)));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((a=>!!(i=a.call({lexer:this},e,s))&&(e=e.substring(i.raw.length),s.push(i),!0)))))if(i=this.tokenizer.space(e))e=e.substring(i.raw.length),i.raw.length===1&&s.length>0?s[s.length-1].raw+=`
`:s.push(i);else if(i=this.tokenizer.code(e))e=e.substring(i.raw.length),r=s[s.length-1],!r||r.type!=="paragraph"&&r.type!=="text"?s.push(i):(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(i=this.tokenizer.fences(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.heading(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.hr(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.blockquote(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.list(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.html(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.def(e))e=e.substring(i.raw.length),r=s[s.length-1],!r||r.type!=="paragraph"&&r.type!=="text"?this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title}):(r.raw+=`
`+i.raw,r.text+=`
`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(i=this.tokenizer.table(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.lheading(e))e=e.substring(i.raw.length),s.push(i);else{if(n=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const h=e.slice(1);let l;this.options.extensions.startBlock.forEach((c=>{l=c.call({lexer:this},h),typeof l=="number"&&l>=0&&(a=Math.min(a,l))})),a<1/0&&a>=0&&(n=e.substring(0,a+1))}if(this.state.top&&(i=this.tokenizer.paragraph(n)))r=s[s.length-1],o&&r.type==="paragraph"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):s.push(i),o=n.length!==e.length,e=e.substring(i.raw.length);else if(i=this.tokenizer.text(e))e=e.substring(i.raw.length),r=s[s.length-1],r&&r.type==="text"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):s.push(i);else if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}throw new Error(a)}}return this.state.top=!0,s}inline(e,s=[]){return this.inlineQueue.push({src:e,tokens:s}),s}inlineTokens(e,s=[]){let i,r,n,o,a,h,l=e;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)c.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(l))!=null;)l=l.slice(0,o.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(a||(h=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((c=>!!(i=c.call({lexer:this},e,s))&&(e=e.substring(i.raw.length),s.push(i),!0)))))if(i=this.tokenizer.escape(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.tag(e))e=e.substring(i.raw.length),r=s[s.length-1],r&&i.type==="text"&&r.type==="text"?(r.raw+=i.raw,r.text+=i.text):s.push(i);else if(i=this.tokenizer.link(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(i.raw.length),r=s[s.length-1],r&&i.type==="text"&&r.type==="text"?(r.raw+=i.raw,r.text+=i.text):s.push(i);else if(i=this.tokenizer.emStrong(e,l,h))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.codespan(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.br(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.del(e))e=e.substring(i.raw.length),s.push(i);else if(i=this.tokenizer.autolink(e))e=e.substring(i.raw.length),s.push(i);else if(this.state.inLink||!(i=this.tokenizer.url(e))){if(n=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const d=e.slice(1);let u;this.options.extensions.startInline.forEach((_=>{u=_.call({lexer:this},d),typeof u=="number"&&u>=0&&(c=Math.min(c,u))})),c<1/0&&c>=0&&(n=e.substring(0,c+1))}if(i=this.tokenizer.inlineText(n))e=e.substring(i.raw.length),i.raw.slice(-1)!=="_"&&(h=i.raw.slice(-1)),a=!0,r=s[s.length-1],r&&r.type==="text"?(r.raw+=i.raw,r.text+=i.text):s.push(i);else if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}throw new Error(c)}}else e=e.substring(i.raw.length),s.push(i);return s}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let s=0;s<this.inlineQueue.length;s++){const i=this.inlineQueue[s];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}}var af=Object.defineProperty,lf=(t,e,s)=>((i,r,n)=>r in i?af(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,e+"",s);class xi{constructor(e){lf(this,"options"),this.options=e||Jt}blockquote(e){return`<blockquote>
${e}</blockquote>
`}br(){return"<br>"}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}code(e,s,i){var n;const r=(n=(s||"").match(/^\S*/))==null?void 0:n[0];return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="language-'+$e(r)+'">'+(i?e:$e(e,!0))+`</code></pre>
`:"<pre><code>"+(i?e:$e(e,!0))+`</code></pre>
`}codespan(e){return`<code>${e}</code>`}del(e){return`<del>${e}</del>`}em(e){return`<em>${e}</em>`}heading(e,s,i){return`<h${s}>${e}</h${s}>
`}hr(){return`<hr>
`}html(e,s){return e}image(e,s,i){const r=To(e);if(r===null)return i;let n=`<img src="${e=r}" alt="${i}"`;return s&&(n+=` title="${s}"`),n+=">",n}link(e,s,i){const r=To(e);if(r===null)return i;let n='<a href="'+(e=r)+'"';return s&&(n+=' title="'+s+'"'),n+=">"+i+"</a>",n}list(e,s,i){const r=s?"ol":"ul";return"<"+r+(s&&i!==1?' start="'+i+'"':"")+`>
`+e+"</"+r+`>
`}listitem(e,s,i){return`<li>${e}</li>
`}paragraph(e){return`<p>${e}</p>
`}strong(e){return`<strong>${e}</strong>`}table(e,s){return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+s+`</table>
`}tablecell(e,s){const i=s.header?"th":"td";return(s.align?`<${i} align="${s.align}">`:`<${i}>`)+e+`</${i}>
`}tablerow(e){return`<tr>
${e}</tr>
`}text(e){return e}}class Sn{br(){return""}codespan(e){return e}del(e){return e}em(e){return e}html(e){return e}image(e,s,i){return""+i}link(e,s,i){return""+i}strong(e){return e}text(e){return e}}var hf=Object.defineProperty,tr=(t,e,s)=>((i,r,n)=>r in i?hf(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s);class vt{constructor(e){tr(this,"options"),tr(this,"renderer"),tr(this,"textRenderer"),this.options=e||Jt,this.options.renderer=this.options.renderer||new xi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Sn}static parse(e,s){return new vt(s).parse(e)}static parseInline(e,s){return new vt(s).parseInline(e)}parse(e,s=!0){let i="";for(let r=0;r<e.length;r++){const n=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){const o=n,a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){i+=a||"";continue}}switch(n.type){case"space":continue;case"hr":i+=this.renderer.hr();continue;case"heading":{const o=n;i+=this.renderer.heading(this.parseInline(o.tokens),o.depth,Fu(this.parseInline(o.tokens,this.textRenderer)));continue}case"code":{const o=n;i+=this.renderer.code(o.text,o.lang,!!o.escaped);continue}case"table":{const o=n;let a="",h="";for(let c=0;c<o.header.length;c++)h+=this.renderer.tablecell(this.parseInline(o.header[c].tokens),{header:!0,align:o.align[c]});a+=this.renderer.tablerow(h);let l="";for(let c=0;c<o.rows.length;c++){const d=o.rows[c];h="";for(let u=0;u<d.length;u++)h+=this.renderer.tablecell(this.parseInline(d[u].tokens),{header:!1,align:o.align[u]});l+=this.renderer.tablerow(h)}i+=this.renderer.table(a,l);continue}case"blockquote":{const o=n,a=this.parse(o.tokens);i+=this.renderer.blockquote(a);continue}case"list":{const o=n,a=o.ordered,h=o.start,l=o.loose;let c="";for(let d=0;d<o.items.length;d++){const u=o.items[d],_=u.checked,f=u.task;let p="";if(u.task){const m=this.renderer.checkbox(!!_);l?u.tokens.length>0&&u.tokens[0].type==="paragraph"?(u.tokens[0].text=m+" "+u.tokens[0].text,u.tokens[0].tokens&&u.tokens[0].tokens.length>0&&u.tokens[0].tokens[0].type==="text"&&(u.tokens[0].tokens[0].text=m+" "+u.tokens[0].tokens[0].text)):u.tokens.unshift({type:"text",text:m+" "}):p+=m+" "}p+=this.parse(u.tokens,l),c+=this.renderer.listitem(p,f,!!_)}i+=this.renderer.list(c,a,h);continue}case"html":{const o=n;i+=this.renderer.html(o.text,o.block);continue}case"paragraph":{const o=n;i+=this.renderer.paragraph(this.parseInline(o.tokens));continue}case"text":{let o=n,a=o.tokens?this.parseInline(o.tokens):o.text;for(;r+1<e.length&&e[r+1].type==="text";)o=e[++r],a+=`
`+(o.tokens?this.parseInline(o.tokens):o.text);i+=s?this.renderer.paragraph(a):a;continue}default:{const o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return i}parseInline(e,s){s=s||this.renderer;let i="";for(let r=0;r<e.length;r++){const n=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){const o=this.options.extensions.renderers[n.type].call({parser:this},n);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)){i+=o||"";continue}}switch(n.type){case"escape":{const o=n;i+=s.text(o.text);break}case"html":{const o=n;i+=s.html(o.text);break}case"link":{const o=n;i+=s.link(o.href,o.title,this.parseInline(o.tokens,s));break}case"image":{const o=n;i+=s.image(o.href,o.title,o.text);break}case"strong":{const o=n;i+=s.strong(this.parseInline(o.tokens,s));break}case"em":{const o=n;i+=s.em(this.parseInline(o.tokens,s));break}case"codespan":{const o=n;i+=s.codespan(o.text);break}case"br":i+=s.br();break;case"del":{const o=n;i+=s.del(this.parseInline(o.tokens,s));break}case"text":{const o=n;i+=s.text(o.text);break}default:{const o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return i}}var Ps,$o,Yr,cf=Object.defineProperty,vl=t=>{throw TypeError(t)},nt=(t,e,s)=>((i,r,n)=>r in i?cf(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n)(t,typeof e!="symbol"?e+"":e,s),Vr=(t,e,s)=>(((i,r,n)=>{r.has(i)||vl("Cannot "+n)})(t,e,"access private method"),s);Ps=new WeakSet,$o=function(t,e){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const i="<p>An error occurred:</p><pre>"+$e(s.message+"",!0)+"</pre>";return e?Promise.resolve(i):i}if(e)return Promise.reject(s);throw s}},Yr=function(t,e){return(s,i)=>{const r={...i},n={...this.defaults,...r};this.defaults.async===!0&&r.async===!1&&(n.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),n.async=!0);const o=Vr(this,Ps,$o).call(this,!!n.silent,!!n.async);if(s==null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(n.hooks&&(n.hooks.options=n),n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(s):s).then((a=>t(a,n))).then((a=>n.hooks?n.hooks.processAllTokens(a):a)).then((a=>n.walkTokens?Promise.all(this.walkTokens(a,n.walkTokens)).then((()=>a)):a)).then((a=>e(a,n))).then((a=>n.hooks?n.hooks.postprocess(a):a)).catch(o);try{n.hooks&&(s=n.hooks.preprocess(s));let a=t(s,n);n.hooks&&(a=n.hooks.processAllTokens(a)),n.walkTokens&&this.walkTokens(a,n.walkTokens);let h=e(a,n);return n.hooks&&(h=n.hooks.postprocess(h)),h}catch(a){return o(a)}}};const zt=new class{constructor(...t){var e,s,i;e=this,(s=Ps).has(e)?vl("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,i),nt(this,"Hooks",Es),nt(this,"Lexer",gt),nt(this,"Parser",vt),nt(this,"Renderer",xi),nt(this,"TextRenderer",Sn),nt(this,"Tokenizer",ki),nt(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),nt(this,"options",this.setOptions),nt(this,"parse",Vr(this,Ps,Yr).call(this,gt.lex,vt.parse)),nt(this,"parseInline",Vr(this,Ps,Yr).call(this,gt.lexInline,vt.parseInline)),this.use(...t)}lexer(t,e){return gt.lex(t,e??this.defaults)}parser(t,e){return vt.parse(t,e??this.defaults)}setOptions(t){return this.defaults={...this.defaults,...t},this}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach((s=>{const i={...s};if(i.async=this.defaults.async||i.async||!1,s.extensions&&(s.extensions.forEach((r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const n=e.renderers[r.name];e.renderers[r.name]=n?function(...o){let a=r.renderer.apply(this,o);return a===!1&&(a=n.apply(this,o)),a}:r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const n=e[r.level];n?n.unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(e.childTokens[r.name]=r.childTokens)})),i.extensions=e),s.renderer){const r=this.defaults.renderer||new xi(this.defaults);for(const n in s.renderer){if(!(n in r))throw new Error(`renderer '${n}' does not exist`);if(n==="options")continue;const o=n,a=s.renderer[o],h=r[o];r[o]=(...l)=>{let c=a.apply(r,l);return c===!1&&(c=h.apply(r,l)),c||""}}i.renderer=r}if(s.tokenizer){const r=this.defaults.tokenizer||new ki(this.defaults);for(const n in s.tokenizer){if(!(n in r))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const o=n,a=s.tokenizer[o],h=r[o];r[o]=(...l)=>{let c=a.apply(r,l);return c===!1&&(c=h.apply(r,l)),c}}i.tokenizer=r}if(s.hooks){const r=this.defaults.hooks||new Es;for(const n in s.hooks){if(!(n in r))throw new Error(`hook '${n}' does not exist`);if(n==="options")continue;const o=n,a=s.hooks[o],h=r[o];Es.passThroughHooks.has(n)?r[o]=l=>{if(this.defaults.async)return Promise.resolve(a.call(r,l)).then((d=>h.call(r,d)));const c=a.call(r,l);return h.call(r,c)}:r[o]=(...l)=>{let c=a.apply(r,l);return c===!1&&(c=h.apply(r,l)),c}}i.hooks=r}if(s.walkTokens){const r=this.defaults.walkTokens,n=s.walkTokens;i.walkTokens=function(o){let a=[];return a.push(n.call(this,o)),r&&(a=a.concat(r.call(this,o))),a}}this.defaults={...this.defaults,...i}})),this}walkTokens(t,e){var i,r;let s=[];for(const n of t)switch(s=s.concat(e.call(this,n)),n.type){case"table":{const o=n;for(const a of o.header)s=s.concat(this.walkTokens(a.tokens,e));for(const a of o.rows)for(const h of a)s=s.concat(this.walkTokens(h.tokens,e));break}case"list":{const o=n;s=s.concat(this.walkTokens(o.items,e));break}default:{const o=n;(r=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&r[o.type]?this.defaults.extensions.childTokens[o.type].forEach((a=>{const h=o[a].flat(1/0);s=s.concat(this.walkTokens(h,e))})):o.tokens&&(s=s.concat(this.walkTokens(o.tokens,e)))}}return s}};function G(t,e){return zt.parse(t,e)}G.options=G.setOptions=function(t){return zt.setOptions(t),G.defaults=zt.defaults,Mo(G.defaults),G},G.getDefaults=Iu,G.defaults=Jt,G.use=function(...t){return zt.use(...t),G.defaults=zt.defaults,Mo(G.defaults),G},G.walkTokens=function(t,e){return zt.walkTokens(t,e)},G.parseInline=zt.parseInline,G.Parser=vt,G.parser=vt.parse,G.Renderer=xi,G.TextRenderer=Sn,G.Lexer=gt,G.lexer=gt.lex,G.Tokenizer=ki,G.Hooks=Es,G.parse=G;const Sl=(t,e)=>{const{showCodeBlockCopyButton:s,markdownLinkTarget:i,syntaxHighlighter:r,htmlSanitizer:n}=e||{},o=G(t,{async:!1,breaks:!0});if(typeof o!="string")throw new Error("Markdown parsing failed");const a=document.createElement("div");return a.innerHTML=n?n(o):o,a.querySelectorAll("pre").forEach((h=>{const l=document.createElement("div");l.className="code-block";const c=h.querySelector("code");if(!c){const f=h.innerHTML;return l.innerHTML=n?n(f):f,void h.replaceWith(l)}let d;for(let f=0;f<c.classList.length;f++){const p=c.classList[f];if(p.startsWith("language-")){d=p.slice(9);break}}const u=document.createElement("pre"),_="<div>"+c.innerHTML+"</div>";if(u.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(_):_,d&&(u.setAttribute("data-language",d),r)){const f="<div>"+r.createHighlighter()(c.textContent||"",d)+"</div>";u.innerHTML=n?n(f):f,u.className="highlighter-dark"}ns(l),l.appendChild(u),h.replaceWith(l)})),s!==!1&&a.querySelectorAll(".code-block").forEach((h=>{var u;if(!h.querySelector("pre")||(u=h.previousElementSibling)!=null&&u.classList.contains("nlux-comp-copyButton"))return;const l="Copy code block to clipboard",c=document.createElement("button");c.classList.add("nlux-comp-copyButton"),c.setAttribute("aria-label",l),c.setAttribute("title",l);const d=document.createElement("span");d.classList.add("icon-copy"),c.appendChild(d),h.appendChild(c)})),i!=="self"&&a.querySelectorAll("a").forEach((h=>{h.setAttribute("target","_blank")})),a.innerHTML},wl=(t,e="text",s)=>{if(e==="markdown"){const i=document.createElement("div"),r=Sl(t,s);i.innerHTML=s!=null&&s.htmlSanitizer?s.htmlSanitizer(r):r,cl(i);const n=document.createDocumentFragment();for(;i.firstChild;)n.appendChild(i.firstChild);return n}return document.createTextNode(t)},yl="nlux-comp-message",ii={received:"nlux-comp-chatItem--received",sent:"nlux-comp-chatItem--sent"},bl=(t,e)=>{Object.keys(ii).forEach((s=>{t.classList.remove(ii[s])})),ii[e]&&t.classList.add(ii[e])},ri={bubbles:"nlux-comp-chatItem--bubblesLayout",list:"nlux-comp-chatItem--listLayout"},Cl=(t,e)=>{Object.keys(ri).forEach((s=>{t.classList.remove(ri[s])})),ri[e]&&t.classList.add(ri[e])},kl="nlux-comp-chatItem-participantInfo",xl="nlux-comp-chatItem-participantName",df=t=>{const e=document.createElement("div");e.classList.add("nlux-comp-chatItem");const s={direction:t.direction,status:t.status};let i;if(t.avatar!==void 0){const o={name:t.name,avatar:t.avatar};i=fn(o)}const r=document.createElement("span");r.classList.add(xl),r.textContent=t.name;{const o=document.createElement("div");o.classList.add(kl),i!==void 0&&o.append(i),o.append(r),e.append(o)}bl(e,t.direction),Cl(e,t.layout);const n=(o=>{const a=document.createElement("div");a.classList.add(yl);const h=o.status?o.status:"complete";return hl(a,h),ll(a,o.direction),a})(s);return e.append(n),e},Uo=(t,e,s)=>{if(e.name!==s.name&&typeof s.avatar=="string"){const i=s.name&&s.name.length>0?s.name[0].toUpperCase():"",r=t.querySelector("* > .nlux-comp-avatarContainer > .avtr_ltr");r==null||r.replaceChildren(i)}},El=(t,e,s)=>{e.avatar===s.avatar&&e.name===s.name||(e.avatar!==s.avatar&&((i,r,n)=>{if(r.avatar!==n.avatar)if(typeof n.avatar=="string"&&typeof r.avatar=="string"){const o=i.querySelector("* > .nlux-comp-avatarContainer > .nlux-comp-avatarPicture");o!==null&&(o.style.backgroundImage=`url("${encodeURI(n.avatar)}")`)}else if(typeof n.avatar=="string"){const o=al(n.avatar);i.replaceChildren(o)}else n.avatar?i.replaceChildren(n.avatar.cloneNode(!0)):ns(i)})(t,e,s),s.name?e.name!==s.name&&(t.title=s.name,Uo(t,e,s)):(t.title="",Uo(t,e,s)))},uf=(t,e,s)=>{if(e.message===s.message&&e.status===s.status&&e.direction===s.direction||!s||!s.hasOwnProperty("message")&&!s.hasOwnProperty("status")&&!s.hasOwnProperty("direction"))return;e.direction!==s.direction&&ll(t,s.direction);const i=s.status;if(e.status!==i)return hl(t,s.status),void((r,n,o)=>{const a=o.status;if(a!=="streaming"&&a==="complete"){const h=o.message?o.message:"",l=document.createTextNode(h);r.classList.add(Cs[a]),ns(r),r.append(l)}})(t,0,s);i==="complete"&&(e.message===s.message&&e.format===s.format||((r,n,o)=>{n.message===o.message&&n.format===o.format||(ns(r),r.append(wl(o.message??"",o.format,{htmlSanitizer:o.htmlSanitizer})))})(t,e,s))},ff=(t,e)=>{let s=!1;const{onComplete:i}=e||{},r=[],n=(e!=null&&e.skipStreamingAnimation?"timeout":"animationFrame")=="timeout"?d=>setTimeout(d,0):d=>requestAnimationFrame(d),o=document.createElement("div");o.classList.add("md-in-progress"),t.append(o);const a=()=>{for(;o.firstChild;){const d=o.firstChild;d instanceof HTMLElement&&cl(d),o.before(d)}},h=!(e!=null&&e.skipStreamingAnimation)&&(e!=null&&e.streamingAnimationSpeed)&&e.streamingAnimationSpeed>=0?e.streamingAnimationSpeed:e!=null&&e.skipStreamingAnimation?0:8,l={timeSinceLastProcessing:new Date().getTime(),currentMarkdown:"",previousHtml:void 0};let c=setInterval((()=>{const d=new Date().getTime(),u=(e==null?void 0:e.waitTimeBeforeStreamCompletion)!=="never";if(r.length===0&&u){const f=typeof(e==null?void 0:e.waitTimeBeforeStreamCompletion)=="number"?e.waitTimeBeforeStreamCompletion:2e3;return void((s||d-l.timeSinceLastProcessing>f)&&(s=!0,c&&(clearInterval(c),c=void 0),a(),o.remove(),i==null?void 0:i()))}l.timeSinceLastProcessing=d;const _=r.shift();_!==void 0&&typeof _=="string"&&n((()=>{const f=l.currentMarkdown+_,p=Sl(f,e).trim();if(typeof p!="string")return l.currentMarkdown=l.currentMarkdown.slice(0,-_.length),void _e("Markdown parsing failed");if(l.previousHtml&&p.length>l.previousHtml.length&&p.startsWith(l.previousHtml)){a();const m=p.slice(l.previousHtml.length).trim();o.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(m):m,l.currentMarkdown=_,l.previousHtml=void 0}else o.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(p):p,l.currentMarkdown=f,l.previousHtml=p}))}),h);return{next:d=>{if(s)_e("Stream is already complete. No more chunks can be added");else for(const u of d)r.push(u)},complete:()=>{r.push(`
`),s=!0},cancel:()=>{c&&(clearInterval(c),c=void 0),s=!0,o.remove()},error:()=>{s=!0}}},Ko="dom/getElement";var _f=Object.defineProperty,pf=Object.getOwnPropertyDescriptor,qo=(t,e,s,i)=>{for(var r,n=i>1?void 0:i?pf(e,s):e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=(i?r(e,s,n):r(n))||n);return i&&n&&_f(e,s,n),n};let Ls=class extends Xe{constructor(t,e){super(t,e),this.serverResponse=[],this.stringContent="",e.domProps.message!==void 0&&(this.stringContent=e.domProps.message)}addChunk(t,e){this.throwIfDestroyed(),this.executeDomAction("processStreamedChunk",t),typeof t=="string"&&(this.stringContent+=t),this.serverResponse.push(e)}commitChunks(){this.throwIfDestroyed(),this.executeDomAction("commitStreamedChunks")}getChatSegmentItem(){return this.getProp("domProps").direction==="received"?{uid:this.props.uid,participantRole:"assistant",content:this.getItemContent(),contentType:"text",serverResponse:this.serverResponse,status:"complete",dataTransferMode:"batch",time:new Date}:{uid:this.props.uid,participantRole:"user",content:this.getItemContent(),contentType:"text",status:"complete",time:new Date}}getItemContent(){return this.aiMessageContent??this.stringContent}updateDomProps(t){const e=this.getProp("domProps"),s={...e,...t};this.setProp("domProps",s),this.executeDomAction("updateDomProps",e,s)}updateMarkdownStreamRenderer(t,e){if(this.setProp(t,e),t==="syntaxHighlighter"){const s=e;this.executeDomAction("updateMarkdownStreamRenderer",{syntaxHighlighter:s})}if(t==="htmlSanitizer"){const s=e;this.executeDomAction("updateMarkdownStreamRenderer",{htmlSanitizer:s})}}onMarkdownStreamComplete(t){this.context.emit("messageRendered",{uid:this.props.uid})}};qo([et("markdown-stream-complete")],Ls.prototype,"onMarkdownStreamComplete",1),Ls=qo([Mt("chatItem",(({props:t,appendToRoot:e,compEvent:s})=>{const i=df({...t.domProps,htmlSanitizer:t.htmlSanitizer}),r=((c,d)=>{const u=c.querySelector(d);if(!u)throw new fe({source:Ko,message:`Could not find element with query "${d}". Make sure the query provided matches an element that exists in the root element.`});if(!(u instanceof HTMLElement))throw new fe({source:Ko,message:`Element with query "${d}" is not a valid HTMLElement.`});return u})(i,".nlux-comp-message");if(!r)throw new Error("Message container not found");const n=document.createElement("div");n.classList.add("nlux-markdownStream-root");const o=document.createElement("div");if(o.classList.add("nlux-markdown-container"),o.setAttribute("nlux-message-id",t.uid),n.append(o),r.append(n),t.domProps.message){const c=wl(t.domProps.message??"","markdown",{markdownLinkTarget:t.markdownLinkTarget,syntaxHighlighter:t.syntaxHighlighter,htmlSanitizer:t.htmlSanitizer});o.append(c)}let a;e(i);let h={...t};const l=c=>((d,u)=>{const _=ff(d,{syntaxHighlighter:u==null?void 0:u.syntaxHighlighter,htmlSanitizer:u==null?void 0:u.htmlSanitizer,markdownLinkTarget:u==null?void 0:u.markdownLinkTarget,showCodeBlockCopyButton:u==null?void 0:u.showCodeBlockCopyButton,skipStreamingAnimation:u==null?void 0:u.skipStreamingAnimation,streamingAnimationSpeed:u==null?void 0:u.streamingAnimationSpeed,waitTimeBeforeStreamCompletion:u==null?void 0:u.waitTimeBeforeStreamCompletion,onComplete:u==null?void 0:u.onComplete});return{next(f){_.next(f)},complete(){_.complete()}}})(o,{syntaxHighlighter:c.syntaxHighlighter,htmlSanitizer:c.htmlSanitizer,markdownLinkTarget:c.markdownLinkTarget,showCodeBlockCopyButton:c.showCodeBlockCopyButton,skipStreamingAnimation:c.skipStreamingAnimation,streamingAnimationSpeed:c.streamingAnimationSpeed,onComplete:()=>s("markdown-stream-complete")});return{elements:{chatItemContainer:i},actions:{focus:()=>{i.focus()},processStreamedChunk:c=>{a||(a=l(h)),a.next(c)},commitStreamedChunks:()=>{a&&a.complete()},updateMarkdownStreamRenderer:c=>{h={...h,...c},l(h)},updateDomProps:(c,d)=>{((u,_,f)=>{if((_.direction!==f.direction||_.layout!==f.layout||_.status!==f.status||_.message!==f.message||_.name!==f.name||_.avatar!==f.avatar)&&f&&(f.hasOwnProperty("direction")||f.hasOwnProperty("layout")||f.hasOwnProperty("status")||f.hasOwnProperty("message")||f.hasOwnProperty("loader")||f.hasOwnProperty("name")||f.hasOwnProperty("avatar"))){if(_.direction!==f.direction&&bl(u,f.direction),_.layout!==f.layout&&Cl(u,f.layout),_.direction!==f.direction||_.status!==f.status||_.message!==f.message){const p=u.querySelector(`.${yl}`);p&&uf(p,{direction:_.direction,status:_.status,message:_.message,htmlSanitizer:_.htmlSanitizer},{direction:f.direction,status:f.status,message:f.message,htmlSanitizer:_.htmlSanitizer})}if(_.name!==f.name||_.avatar!==f.avatar){const p=u.querySelector(`.${un}`);if(!f.name&&!f.avatar)return void(p==null?void 0:p.remove());if(p)El(p,{name:_.name,avatar:_.avatar},{name:f.name,avatar:f.avatar});else if(f.name!==void 0||f.avatar!==void 0){const m={name:f.name,avatar:f.avatar},S=fn(m),y=u.querySelector(`.${kl}`);y&&y.prepend(S)}}if(_.name!==f.name){const p=u.querySelector(`.${xl}`);p&&(p.textContent=f.name||"")}}})(i,c,d)}},onDestroy:()=>{i.remove(),a=void 0}}}),(({propName:t,newValue:e,dom:s})=>{var i;switch(t){case"markdownLinkTarget":case"skipStreamingAnimation":case"syntaxHighlighter":case"htmlSanitizer":case"showCodeBlockCopyButton":case"streamingAnimationSpeed":(i=s.actions)==null||i.updateMarkdownStreamRenderer({[t]:e})}}))],Ls);const mf=(t,e)=>{let s,i=e,r=t,n=!0;const o=((p,m)=>{let S=!1;if(typeof p!="function")throw new pt({source:"x/throttle",message:"Callback must be a function"});return(...y)=>{S||(p.apply(void 0,y),S=!0,setTimeout((function(){S=!1}),m))}})((p=>{let m,S;return y=>{const w=y.target;if(!(w instanceof HTMLElement))return;const{scrollTop:C,clientHeight:L,scrollHeight:A}=w,z=A-30,j=Math.ceil(C+L)>=z,W=m===void 0||S===void 0?void 0:C>m&&S===A?"down":C<m&&S===A?"up":void 0;S=A,m=C,p({scrolledToBottom:j,scrollDirection:W})}})((({scrolledToBottom:p,scrollDirection:m})=>{n?m==="up"&&(n=!1):m==="down"&&p&&(n=!0)})),50),a=p=>{p.addEventListener("scroll",o)},h=p=>{p==null||p.removeEventListener("scroll",o)},l=p=>{(s==null?void 0:s.uid)===p&&(c==null||c.disconnect(),d==null||d.disconnect(),s=void 0,c=void 0,d=void 0)};let c,d;const u=()=>{r==null||r.scrollTo({top:5e4,behavior:"instant"})},_=()=>{r&&i&&n&&u()},f=()=>{_()};return a(r),{updateConversationContainer:p=>{h(r),a(p),r=p},updateProps:({autoScroll:p})=>{i=p},handleNewChatSegmentAdded:(p,m)=>{s&&(c==null||c.disconnect(),d==null||d.disconnect()),s={uid:p,container:m},c=new ResizeObserver(_),c.observe(m),d=new MutationObserver(f),d.observe(m,{childList:!0,subtree:!0,characterData:!0}),i&&u()},handleChatSegmentRemoved:p=>l(p),handleChatSegmentComplete:p=>l(p),destroy:()=>{s&&(l(s.uid),s=void 0),h(r),r=void 0}}},Rt=t=>{var i;const e=typeof t=="function"?t.__compId:void 0;if(!e)throw new Error("Invalid compClass! Component should be registered before using");const s=(i=Oi.retrieve(e))==null?void 0:i.model;if(!s||typeof s!="function")throw new Error(`Component "${e}" is not registered`);return{withContext:r=>({create:()=>new s(r,{}),withProps:n=>({create:()=>new s(r,n)})})}},Bl=t=>{const e=["adapter","events"],s=Object.keys(t).filter((r=>!e.includes(r))),i={};for(let r=0;r<s.length;r++){const n=s[r];i[n]=t[n]}return i},Pl=()=>{const t=document.createElement("div");t.classList.add("nlux-comp-messageLoader");const e=document.createElement("span");e.classList.add("spinning-loader");const s=document.createElement("div");return s.classList.add("nlux-comp-loaderContainer"),s.appendChild(e),t.appendChild(s),t},sr={typing:"nlux-composer--typing","submitting-prompt":"nlux-composer--submitting","submitting-conversation-starter":"nlux-composer--submitting",waiting:"nlux-composer--waiting"},Ll=(t,e)=>{Object.keys(sr).forEach((s=>{t.classList.remove(sr[s])})),t.classList.add(sr[e])},gf=t=>{const e=document.createElement("div");e.classList.add("nlux-comp-composer");const s=document.createElement("textarea");s.placeholder=t.placeholder??"",s.value=t.message??"",t.autoFocus&&(s.autofocus=!0);const i=document.createElement("button");return i.append((()=>{const r=document.createElement("div");r.classList.add("nlux-comp-sendIcon");const n=document.createElement("div");return n.classList.add("nlux-comp-sendIcon-container"),r.appendChild(n),r})()),i.append(Pl()),e.append(s),e.append(i),Ll(e,t.status),t.status!=="submitting-conversation-starter"&&t.status!=="submitting-prompt"||(s.disabled=!0,i.disabled=!0),t.status==="waiting"&&(i.disabled=!0),t.status==="typing"&&(i.disabled=t.disableSubmitButton??s.value===""),e},Ei=(t,e)=>{let s=!1;const i=e?t.querySelector(e):t,r=i instanceof HTMLElement?i:void 0;if(!r)throw new fe({source:"dom/listenTo",message:`Could not find element with query "${e}". Make sure the query provided matches an element that exists in the root element.`});const n=new Map,o=new Map,a=()=>{r&&(n.forEach(((l,c)=>{r.removeEventListener(c,l)})),n.clear(),o.clear())},h={on:(l,c)=>{if(!c||!r)return h;if(!n.has(l)){const d=u=>{var _;(_=o.get(l))==null||_.forEach((f=>f(u)))};n.set(l,d),r.addEventListener(l,d)}return o.has(l)||o.set(l,new Set),o.get(l).add(c),h},get:()=>{if(s)throw new Error("listenTo().get() can only be used once!");return s=!0,[r,a]}};return h},Yo=t=>{t.style.height="auto",t.style.height=`${t.scrollHeight}px`};var vf=Object.defineProperty,Sf=Object.getOwnPropertyDescriptor,gs=(t,e,s,i)=>{for(var r,n=i>1?void 0:i?Sf(e,s):e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=(i?r(e,s,n):r(n))||n);return i&&n&&vf(e,s,n),n};let Et=class extends Xe{constructor(t,{props:e,eventListeners:s}){super(t,e),this.userEventListeners=s}focusTextInput(){this.executeDomAction("focusTextInput")}handleCommandEnterKeyPressed(t){var s;((s=this.getProp("domCompProps"))==null?void 0:s.submitShortcut)==="CommandEnter"&&(this.handleSendButtonClick(),t==null||t.preventDefault())}handleEnterKeyPressed(t){var s;const e=(s=this.getProp("domCompProps"))==null?void 0:s.submitShortcut;e&&(e!=="Enter"||t!=null&&t.isComposing)||(this.handleSendButtonClick(),t==null||t.preventDefault())}handleSendButtonClick(){var i;const t=this.getProp("domCompProps");if(t!=null&&t.disableSubmitButton||!(t==null?void 0:t.message))return;const s=(i=this.userEventListeners)==null?void 0:i.onSubmit;s&&s()}handleTextChange(t){var i;const e=(i=this.userEventListeners)==null?void 0:i.onTextUpdated;e&&e(t);const s=this.getProp("domCompProps");this.setDomProps({...s,message:t})}handleTextInputUpdated(t){const e=t.target;e instanceof HTMLTextAreaElement&&this.handleTextChange(e.value)}setDomProps(t){this.setProp("domCompProps",t)}};gs([et("command-enter-key-pressed")],Et.prototype,"handleCommandEnterKeyPressed",1),gs([et("enter-key-pressed")],Et.prototype,"handleEnterKeyPressed",1),gs([et("send-message-clicked")],Et.prototype,"handleSendButtonClick",1),gs([et("text-updated")],Et.prototype,"handleTextInputUpdated",1),Et=gs([Mt("composer",(({appendToRoot:t,props:e,compEvent:s})=>{const i=gf(e.domCompProps);t(i);const[r,n]=Ei(i,":scope > textarea").on("input",s("text-updated")).on("keydown",(c=>{const d=c.key==="Enter"&&!c.isComposing,u=c.altKey||c.ctrlKey||c.metaKey||c.shiftKey;if(d&&!u)return void s("enter-key-pressed")(c);const _=c.getModifierState("Meta")&&c.key==="Enter",f=c.getModifierState("Control")&&c.key==="Enter";(_||f)&&s("command-enter-key-pressed")(c)})).get(),[o,a]=Ei(i,":scope > button").on("click",s("send-message-clicked")).get();if(!(o instanceof HTMLButtonElement))throw new Error("Expected a button element");if(!(r instanceof HTMLTextAreaElement))throw new fe({source:(h="composer",l="render",`#${h}/${l}`),message:"Expected a textarea element"});var h,l;return{elements:{root:i,textInput:r,sendButton:o},actions:{focusTextInput:()=>at((()=>{r.focus(),r.setSelectionRange(r.value.length,r.value.length)}))},onDestroy:()=>{n(),a()}}}),(({propName:t,currentValue:e,newValue:s,dom:i})=>{var r;t==="domCompProps"&&((r=i.elements)!=null&&r.root)&&((n,o,a)=>{if(o.status===a.status&&o.message===a.message&&o.placeholder===a.placeholder&&o.autoFocus===a.autoFocus&&o.disableSubmitButton===a.disableSubmitButton)return;const h=n.querySelector("* > textarea");if(o.status!==a.status)return Ll(n,a.status),((l,c,d)=>{if(c.status===d.status)return;const u=l.querySelector("* > textarea");d.status!=="typing"&&d.status!=="waiting"||!u.disabled?d.status!=="submitting-prompt"&&d.status!=="submitting-conversation-starter"||u.disabled||(u.disabled=!0):u.disabled=!1;const _=l.querySelector("* > button");if(d.status==="typing"){const f=(c.disableSubmitButton!==d.disableSubmitButton?d.disableSubmitButton:c.disableSubmitButton)??u.value==="";_.disabled!==f&&(_.disabled=f)}else d.status!=="waiting"&&d.status!=="submitting-prompt"&&d.status!=="submitting-conversation-starter"||_.disabled||(_.disabled=!0);c.placeholder!==d.placeholder&&(u.placeholder=d.placeholder??""),c.message!==d.message&&(u.value=d.message??""),c.autoFocus!==d.autoFocus&&(u.autofocus=d.autoFocus??!1)})(n,o,a),void Yo(h);if(o.placeholder!==a.placeholder&&(h.placeholder=a.placeholder??""),o.autoFocus!==a.autoFocus&&(h.autofocus=a.autoFocus??!1),o.message!==a.message&&(h.value=a.message??"",Yo(h)),o.status==="typing"){const l=n.querySelector("* > button"),c=(o.disableSubmitButton!==a.disableSubmitButton?a.disableSubmitButton:o.disableSubmitButton)??h.value==="";l.disabled!==c&&(l.disabled=c)}})(i.elements.root,e,s)}))],Et);const Vo=t=>{const e="nlux-chatSegment";return t==="complete"?`${e} nlux-chatSegment--complete`:t==="error"?`${e} nlux-chatSegment--error`:`${e} nlux-chatSegment--active`},ni=(t,e)=>{var s,i;return t==="assistant"?((s=e==null?void 0:e.assistant)==null?void 0:s.name)??"Assistant":t==="user"?((i=e==null?void 0:e.user)==null?void 0:i.name)??"User":""},Rl="bubbles",jo=t=>t??Rl;var wf=Object.defineProperty,yf=Object.getOwnPropertyDescriptor,oi=(t,e,s,i)=>{for(var r,n=i>1?void 0:i?yf(e,s):e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=(i?r(e,s,n):r(n))||n);return i&&n&&wf(e,s,n),n};let Ft=class extends Xe{constructor(t,e){super(t,e),this.chatItemCompIdsByIndex=[],this.chatItemComponentsById=new Map}addChatItem(t){var i,r;if(this.throwIfDestroyed(),this.chatItemComponentsById.has(t.uid))throw new Error(`CompChatSegment: chat item with id "${t.uid}" already exists`);const e=((n,o,a,h)=>{const l=o??Rl;if(n.participantRole==="assistant"){const d=n.status==="complete"?"complete":"streaming";return n.dataTransferMode==="stream"?{status:d,layout:l,direction:"received",name:ni("assistant",{assistant:h}),avatar:h==null?void 0:h.avatar}:n.status==="complete"?{status:d,layout:l,direction:"received",name:ni("assistant",{assistant:h}),avatar:h==null?void 0:h.avatar,message:(c=n.content,typeof c=="string"?c:typeof c=="object"?`${c}`:c==null?"":typeof c.toString=="function"?c.toString():JSON.stringify(c))}:{status:d,layout:l,direction:"received",name:ni("assistant",{assistant:h}),avatar:h==null?void 0:h.avatar}}var c;return{status:"complete",layout:l,direction:"sent",message:n.content,name:ni("user",{user:a}),avatar:a==null?void 0:a.avatar}})(t,this.getProp("conversationLayout"),this.getProp("userPersona"),this.getProp("assistantPersona"));if(!e)throw new Error(`CompChatSegment: chat item with id "${t.uid}" has invalid props`);const s=Rt(Ls).withContext(this.context).withProps({uid:t.uid,domProps:e,markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed")}).create();this.chatItemComponentsById.set(t.uid,s),this.chatItemCompIdsByIndex.push(t.uid),this.rendered&&((r=(i=this.renderedDom)==null?void 0:i.elements)!=null&&r.chatSegmentContainer?s.render(this.renderedDom.elements.chatSegmentContainer,this.renderedDom.elements.loaderContainer):Kr("CompChatSegment: chatSegmentContainer is not available"))}addChunk(t,e,s){if(this.destroyed)return;const i=this.chatItemComponentsById.get(t);if(!i)throw new Error(`CompChatSegment: chat item with id "${t}" not found`);i.addChunk(e,s)}complete(){this.throwIfDestroyed(),this.chatItemComponentsById.forEach((t=>t.commitChunks())),this.setProp("status","complete")}destroy(){this.chatItemComponentsById.forEach((t=>t.destroy())),this.chatItemComponentsById.clear(),this.chatItemCompIdsByIndex=[],super.destroy()}getChatItems(){return this.chatItemCompIdsByIndex.map((t=>this.chatItemComponentsById.get(t))).filter((t=>!!t))}onLoaderShown(t){var e;(e=this.renderedDom)!=null&&e.elements&&(this.renderedDom.elements.loaderContainer=t)}setAssistantPersona(t){this.setProp("assistantPersona",t);const e={name:t==null?void 0:t.name,avatar:t==null?void 0:t.avatar};this.chatItemComponentsById.forEach((s=>{s.getChatSegmentItem().participantRole==="assistant"&&s.updateDomProps(e)}))}setLayout(t){this.setProp("conversationLayout",t),this.chatItemComponentsById.forEach((e=>{e.updateDomProps({layout:t})}))}setUserPersona(t){this.setProp("userPersona",t);const e={name:t==null?void 0:t.name,avatar:t==null?void 0:t.avatar};this.chatItemComponentsById.forEach((s=>{s.getChatSegmentItem().participantRole==="user"&&s.updateDomProps(e)}))}updateMarkdownStreamRenderer(t,e){this.setProp(t,e)}setProp(t,e){super.setProp(t,e),t!=="markdownLinkTarget"&&t!=="syntaxHighlighter"&&t!=="htmlSanitizer"&&t!=="skipStreamingAnimation"&&t!=="streamingAnimationSpeed"||this.chatItemComponentsById.forEach((s=>{s.updateMarkdownStreamRenderer(t,e)}))}onChatSegmentReady(){at((()=>{var e,s,i,r;if(!((s=(e=this.renderedDom)==null?void 0:e.elements)!=null&&s.chatSegmentContainer))return;const t=(r=(i=this.renderedDom)==null?void 0:i.elements)==null?void 0:r.chatSegmentContainer;this.chatItemComponentsById.forEach((n=>{n.rendered||n.render(t)}))}))}onLoaderHidden(){var t;(t=this.renderedDom)!=null&&t.elements&&(this.renderedDom.elements.loaderContainer=void 0)}};oi([et("loader-shown")],Ft.prototype,"onLoaderShown",1),oi([et("chat-segment-ready")],Ft.prototype,"onChatSegmentReady",1),oi([et("loader-hidden")],Ft.prototype,"onLoaderHidden",1),Ft=oi([Mt("chatSegment",(({props:t,compEvent:e,appendToRoot:s})=>{let i;const r=document.createElement("div");r.className=Vo(t.status);const n=()=>{if(!i){i=document.createElement("div"),i.className="nlux-chatSegment-loader-container";const o=Pl();i.appendChild(o),r.appendChild(i),e("loader-shown")(i)}};return t.status==="active"&&n(),s(r),e("chat-segment-ready")(),{elements:{chatSegmentContainer:r,loaderContainer:i},actions:{showLoader:n,hideLoader:()=>{i&&(i.remove(),i=void 0,e("loader-hidden")())}},onDestroy:()=>{r.remove()}}}),(({propName:t,newValue:e,dom:s})=>{var i,r,n;if(t==="status"){const o=(i=s.elements)==null?void 0:i.chatSegmentContainer;if(!o)return;const a=e;o.className=Vo(a),a==="active"?(r=s.actions)==null||r.showLoader():(n=s.actions)==null||n.hideLoader()}}))],Ft);let Bi=class extends Xe{constructor(t,e){super(t,e),this.chatSegmentCompIdsByIndex=[],this.chatSegmentComponentsById=new Map,e.messages&&e.messages.length>0&&this.addChatSegment("complete",e.messages)}addChatItem(t,e){const s=this.chatSegmentComponentsById.get(t);if(!s)throw new Error(`CompConversation: chat segment with id "${t}" not found`);s.destroyed?Kr(`CompConversation: chat segment with id "${t}" is destroyed and cannot be used`):s.addChatItem(e)}addChatSegment(t="active",e){this.throwIfDestroyed();const s=Ve(),i=Rt(Ft).withContext(this.context).withProps({uid:s,status:t,conversationLayout:this.getProp("conversationLayout"),userPersona:this.getProp("userPersona"),assistantPersona:this.getProp("assistantPersona"),markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed")}).create();if(e)for(const n of e)n.role==="assistant"?i.addChatItem({uid:Ve(),participantRole:"assistant",time:new Date,dataTransferMode:"batch",status:"complete",content:n.message,serverResponse:n.serverResponse,contentType:"text"}):n.role==="user"&&i.addChatItem({uid:Ve(),participantRole:"user",time:new Date,status:"complete",content:n.message,contentType:"text"});this.chatSegmentComponentsById.set(s,i),this.chatSegmentCompIdsByIndex.push(s);const r=i.id;return this.addSubComponent(r,i,"segmentsContainer"),this.notifyAboutSegmentCountChange(this.chatSegmentCompIdsByIndex.length),s}addChunk(t,e,s,i){const r=this.chatSegmentComponentsById.get(t);if(!r)throw new Error(`CompConversation: chat segment with id "${t}" not found`);r.addChunk(e,s,i)}completeChatSegment(t){const e=this.chatSegmentComponentsById.get(t);if(!e)throw new Error(`CompConversation: chat segment with id "${t}" not found`);e.destroyed||e.complete()}getChatSegmentContainer(t){const e=this.chatSegmentComponentsById.get(t);if((e==null?void 0:e.root)instanceof HTMLElement)return e.root}getConversationContentForAdapter(t="max"){if(typeof t=="number"&&t<0)return void Kr(`Invalid value provided for 'historyPayloadSize' : "${t}"! Value must be a positive integer or 'max'.`);if(t===0)return;const e=(s=>{const i=[];return s.forEach((r=>{r.items.forEach((n=>{if(n.status==="complete"){if(n.participantRole==="assistant")i.push({role:"assistant",message:n.content});else if(n.participantRole==="user")return i.push({role:"user",message:n.content})}}))})),i})(this.chatSegmentCompIdsByIndex.map((s=>this.chatSegmentComponentsById.get(s))).filter((s=>s!==void 0)).map((s=>({uid:s.id,status:"complete",items:s.getChatItems().map((i=>i.getChatSegmentItem()))}))));return t==="max"?e:e.slice(-t)}removeChatSegment(t){const e=this.chatSegmentComponentsById.get(t);if(!e)return;const s=e.id;this.subComponents.has(s)&&this.removeSubComponent(s),this.chatSegmentComponentsById.delete(e.id);const i=this.chatSegmentCompIdsByIndex.indexOf(t);i>=0&&this.chatSegmentCompIdsByIndex.splice(i,1),this.notifyAboutSegmentCountChange(this.chatSegmentCompIdsByIndex.length)}setAssistantPersona(t){this.setProp("assistantPersona",t),this.chatSegmentComponentsById.forEach((e=>{e.setAssistantPersona(t)}))}setConversationLayout(t){this.setProp("conversationLayout",t),this.chatSegmentComponentsById.forEach((e=>{e.setLayout(t)}))}setUserPersona(t){this.setProp("userPersona",t),this.chatSegmentComponentsById.forEach((e=>{e.setUserPersona(t)}))}updateMarkdownStreamRenderer(t,e){this.setProp(t,e)}setProp(t,e){if(super.setProp(t,e),t==="markdownLinkTarget"||t==="syntaxHighlighter"||t==="htmlSanitizer"||t==="skipStreamingAnimation"||t==="streamingAnimationSpeed"||t==="showCodeBlockCopyButton"){const s=t,i=e;this.chatSegmentComponentsById.forEach((r=>{r.updateMarkdownStreamRenderer(s,i)}))}}notifyAboutSegmentCountChange(t){const e=this.getProp("onSegmentCountChange");e&&e(t)}};Bi=((t,e,s,i)=>{for(var r,n=e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=r(n)||n);return n})([Mt("conversation",(({appendToRoot:t})=>{const e=document.createElement("div");return e.classList.add("nlux-chatSegments-container"),t(e),{elements:{segmentsContainer:e},actions:{}}}),(()=>{}))],Bi);var bf=Object.defineProperty,Cf=Object.getOwnPropertyDescriptor,Xo=(t,e,s,i)=>{for(var r,n=i>1?void 0:i?Cf(e,s):e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=(i?r(e,s,n):r(n))||n);return i&&n&&bf(e,s,n),n};let Rs=class extends Xe{constructor(t,e){super(t,e),this.updateConversationStarters=s=>{}}conversationStarterClicked(t){this.getProp("onConversationStarterSelected")(t)}};Xo([et("conversation-starter-selected")],Rs.prototype,"conversationStarterClicked",1),Rs=Xo([Mt("conversationStarters",(({appendToRoot:t,props:e,compEvent:s})=>{const i=(n=>{const o=document.createElement("div");return o.classList.add("nlux-comp-conversationStarters"),n.forEach(((a,h)=>{const l=document.createElement("button");l.classList.add("nlux-comp-conversationStarter");let c=document.createElement("div");a.icon&&(typeof a.icon=="string"?(c=document.createElement("img"),c.setAttribute("src",a.icon),c.setAttribute("width","16px")):(c.className="nlux-comp-conversationStarter-icon-container",c.appendChild(a.icon)));const d=document.createElement("span");d.classList.add("nlux-comp-conversationStarter-prompt"),d.textContent=a.label??a.prompt,l.appendChild(c),l.appendChild(d),o.appendChild(l)})),o})(e.conversationStarters);t(i);let r=[];return e.conversationStarters.forEach(((n,o)=>{const[a,h]=Ei(i,`:scope > :nth-child(${o+1})`).on("click",(()=>{s("conversation-starter-selected")(n)})).get();r.push(h)})),{elements:{},actions:{},onDestroy:()=>{r.forEach((n=>n())),r=[],i.remove()}}}),(({})=>{}))],Rs);const Go="nlux-comp-welcomeMessage-text",Al=(t,e)=>{const s=t.querySelector(`.${Go}`);if(e!==""&&e!==void 0)if(s)s.textContent=e;else{const i=document.createElement("div");i.classList.add(Go),i.textContent=e,t.appendChild(i)}else s==null||s.remove()},Dl="nlux-comp-welcomeMessage-personaName",jr=t=>{const e=document.createElement("div");e.classList.add("nlux-comp-welcomeMessage");const s=fn({name:t.name,avatar:t.avatar});e.append(s);const i=document.createElement("div"),r=document.createTextNode(t.name);return i.append(r),i.classList.add(Dl),e.append(i),Al(e,t.message),e},Jo=()=>jr({name:"",avatar:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAABGdBTUEAALGPC/xhBQAACklpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/stRzjPAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAJcEhZcwAAewgAAHsIAXgkHaEAABj0SURBVHic7Z13vBxV2ce/Z29ugEQMEAICQUBAkBqqlCiRKqC0gApKE14poh8VUCmihv4SCB2CVAtFQBR9UZpCaMIL0ouAGIIEQgsJya27e/zjmb117+yUc+bM7J7v53Nys3dnzjx3dn9z2nOeR2mt8Xg89Sm5NsDjyTNeIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCKNsVdwzY4Ktqgej+v6RHwpQ8lqr2jFD3q+9UAPrGHDcwN8F6JD3hr1m0LHjgYnAWsAqwGrA8sDKwNLAOGAMsCTQPuDkMtANdAALgUXAPOBtYC4wB5gNvI5m7gBLhxjOiK8VwMAdpQOPrf1eD31PD/5dcJwa8lr+P+D4Ie8pCxtZ249/z3id1gTSoowHNgEmBWUDNGsBYy1eswy8BrwIPAs8BTyBiMeTEi+QdCwFfA6YAmwLbAaMHf7Ytsoo4NNB2XPA758GHgHuB2bBwFbGExUvkPisAOwK7ALsAKyQrR4is3FQjgR6EaH8CfgL8E+HdhUKL5BoLAHsBUwFdkczxq05sWkHdgwKiFhuBm7DtyyheIGEsyFwMHCA0nol18YYZLugnAfcAlwD3OPUopziBVKf3dEcCXzJtSGWGQ0cEJTHgV8A1wI9Dm3KFX4dZDD7A48iffVmF8dQNgdmAv8CTkCmoFseLxDhq8CTaH09Wm+J1rRwmYjWZyBC+TEy/mpZWl0gOwEPorkRzaT+BS1f0ExAcybwKvCtNDe5yLSqQNYAbkZzF5ptc/BlzHOZiGYm0vXcKukNLyqtKJD9gRdB7+v6m1ewsiXoR4CTE931gtJKAvkEcAua69Es4f77VthyKuLOsk3cD6CItIpADgReRjM1B1+wZigbo3kIOCPm51A4mn0dZDRwFVp/w7UhTcoJyETHQYizZNPRzALZXMGNwJquDWlyNgeeAw5DFhmbimYVyBHA5WjXZrQMJcRdZUvgaMe2GKUZBXIZWh/p2ogW5SjEf20v4H23ppiheQSiWBL4E5odXJvS4kxGNm7tiuxJKTTNIpBV0PwNWNu1IR4AVkKmgr8I3OnWlHTYE8iwfdqGGD6uWA/0LGS7qydf/AX4BvAb14YkxZ5AqtZqFkSAWwctR0s71OWcXwPLAhe7NiQJ1gSiKnamkHTf0qaaDDxg5SIe01yErEmd59qQuBR1DLI1WntxFItzkX7F+Y7tiEURXU0mAQ+5NsKTiBnIGlVhKFYLolgDzcPYmwLw2Ody4EPgJsd2RMKeQLThMYji42j+riQWlafY3Ai8hWaWa0MaYVEgButSgOYBJCaVpzn4G7AWmn+7NiSMYnSxNLcBG7k2w2OUEjKWXJ0cR1HJdxdLRho/Q3x7PM3HSsDdwHZ5dSzNexdrd+CnRmry5JXPA+eiOda1IfXIcxdrRTS3uzbCkwk/QMKh5u7zznMX6y7ys07TDTwJvAC8gkxTdiIxb5dGIqtvCHyWfD908sxtwIqA+SQfKcjrh3kG+RiU3wr8DvgrkrimEasAOyN74L9g0a5mpATcgWy6yg1Km16vCOg9bdlkJyq2AB4zakx8LgQuQPFaorPllu4AnIL0sT3ROREJWBeb9pPnm7bFpkCWSXimmovMbrjgLuBYFM+JKQlr0YP+fwzirOeJjP400pWNRfvJHxq3xJ43bzLdzQBnaQaO04pzLXixXKy0noUExF7VdOVNyu+QMZ1z7A2C48daWg/N9xzEeOpGxg3n2roVwDPARmieyUFMqyKUDYDvxD7PAnmZJQL4rYNrfoCkKbvb6lWkUfoQ2AIRi6cRmguBZVybYXFHYQxJK74JrG/Nlvp8BGyGUrMzvGYPmm1Av4qEQvWEcxWaqS4NyMM07yh05tsxe4FtUBmkShZHSyT3BgCLgc+h+Sf5asHzyD7AlmjtbFYzDwuF15O1C7tSnwee6/vijrK4vaQKDN9+/CqyK/JRexduGn4PrOzq4m4H6dL/38+aDfX5X+Dvfa+0li9wnC5hFJSITpUrUvfwTE6PAd81e9GmZCXgOFcXt7YOUj7l41EOewAJNJYVz1JvhV4H/7S3oUeV+lu/NA2LVqieClSrfWIZgUfJ2epxDukAxgHlsINGTVto/MIWW5C6T82BZXM0kzOePtwtdHqwtwrlavqlkJJClatSH6qRTfvlYFo172UMmh81/E5ZwGUXa3rGySm/D/o/oTe3qlFdZekShT/1R6ZNich6ysHdbXgj5qD12TlI3pn3ciKattBbaQFrAlHhZX0F2zU4xlzRvAicH3oTNX0th+pJ2IoooKIpdVZQOrh2NULRnKA0CzO7H8UsYxR8O+wYG7hqQX6eaRMNBygNkYpSqN4qqrsCpRi3XQFKUeqsyKBfqThPNQ0cl4OuTN7LSVRhxGIBFwuFy6MyXfy5AQmkHAvVXUGPLolIosxwlRSqqwK9gbDi94l/Afwcd46aRWAFYE80f8jqgi4WquL72KRrPY6JbaECtKbUUZaWoNF4pKRQZY3qLMvJye09PgdP6byXE8I/DLO4WCj8trVrDmc6Wn2Q7FQFPRXU4l70Um2hhwHQ0SstTRs1YSbhN8DZyMYrT30+i+zgfDmLi2XdguxKdmkKysApqR5XJYVa3CuD9lEj3KpSCdVZ7h+zJBdHjT+mrqH5OSqrC2U9SD86w6b4TDSdqetpK6E6yjJ1O6qEbh9QlmiDSlXeL5VM2X1dDroxeS8Ho1HDfm+BLMP+LIuE8cmCHpShHN4KEUFXBb0UlDrL/X9bSUFZB+MUI1cD+DuapxE3HE99at+lP9m+UJZjkP2wN109lIuArtS1aEQEo0qU3u/qdx3RA94f3UZ13GgRibmcKGcjTpyekTmQDARizRerctyYob/6K9lF+hiPbIZKR5uCKqiPumWMoZT8TiHiCFoXVElEMrpNumIm0HyAPCk99elA7k9f2NK26R3GL5LVIH05shPHLzEljrKm9GGXiGNUqV8c0P+zTZwbSx92oxb3BouLqaZ6ay3UL1L/Dc3NGCRJqFUsBm0Y1DLtYes6wy/M6anO14gYequoBd39r8MIFgbVRz3Sooxtly5musb5YuCHqWpofqZiORpjVi3IbhldZxaal1M9uUvB+seCbqmxLeKwSclYRXWUUYuClqTWFUvGG0gYIs/IHASMtXmBLGaxSsCO1q4zmNNSnd2mpOVY2CNf7ji+WDVGlaBLnBX12HZx8EouknOQiCue+jyI5YmfLGaxtiCbweabpIlO0iZOiiwMxnxJxDGgLrrK4q84ph10NalI7kH+Lr+yPpw7Ucr6GCSLhcLtM1o8ujDxuUoG5OqjQBxRu1VhtJVQnRXZX5J0b4kwIwcLc3krj5DBAB2yGYN8LoNraGBmorMCb93Sop7+1yZQoEsKtbgsriqlxDNbM7HmzF1I3gCmZHUx212sNsS5zDa3AgtinzVQHBUtU7YmCcYxalEP+mPt0F5Kspi4CHFiPNCscYVkIRIMvAcN8gTB6ijEdhdrPTTLZdDkxu+GBDaqjl5xFzHVcgwlqLa0qBd6ddKW5MwcdGtcl/mI+83sure5104ja3sWaxNr9ffzGoqHY59VKqG6yqjuqt24WNDfUnX0Uh07WkQTxHOIyItoHgK2tWVizqkAW1EaIA5N315b1V016eYzCIuRFTVoJtmrP0BxOTrOF1ye4qqnIhucbLUcQwkcG1VHL3rMKLEj3kPvdCTBTCuyA6iX++5XTRwaiR5TrprvHgfYTn9gP4S95ur+PlMEFBK9pKPc/zoralPJXRX0Um2oeE+9PwNzgE/aMS63HKPh/mEPFI3cv4rF7jH2u1jrWqtf+APwfuSjg8AKqm/3X5bqCCgp8e1qU0kG7afSWj5aN6G4pO6nVNVSLM/D2pzFmghMtFY/gFKXRD5WB0+anir0OBIH9LVYqrOMVu3yAVc1kZoyxVVoPR2JMtjsvIlSX6vbOdBBy5HBR2hTf2tYrBs089D67khBx6rBzawEgeEcaaOPUuBG31Vm0JRaoyJ7E9I5YxYBzUJgu4afZwbYnOZdzeq0H1wZ41gg6NpUcC8QkDvfq2UGRsWa+p2BpisH0662ygfApsC/6t63kUMwrTDSG2mwGZt3ouVQlDMjH6tA9VZkHSIkQEnmlIDuqtgWhBqKUMpoPS0HoUBtlPlonUQce6D1LTY+IpuDdJsOdg8iLgeNCWat6DYQlNo0NXtqrUh09/izgROBj1myzAWdwBYoXq/7blWH3ZvrgCVsGGWzizXeYvcqRkYqJb5Q8t/8URu091Ti3IMqmhNz0B0y+ZluS1jLUR3x3IPRLIO2EyfL5iyWrRx8H4G6OdKRqraQpNM+ClZFgpWtDiyP7HlfEom99T4wF3gJeE7si4kCKuIuodtV1FX2i9CcBKwY+3p5Q7ELWj0JBGIZ0lSMHDehDbg0+P9oG6bZzFG4jKV6f43Wjdega12r3sTi2BHYE/FG3pBaLeFdoPlI9+92xIFyfuSrlZBZthLo6AHo/gfLW04z4BDCdk6GBxU5A9mbzoCfRrEW1YTD214C1jFer2JD5EndmLIeeUpwYCyrvp9qLBK175vAZ1JaugC4EjgXrd8C+r/0mvofvAZKSJariCjNw8DW6Ux1g4afopgmr4Z/SCr8u7kcgxeJ53Jlxfi412YXy4ai/4FWjcVRaz3izZcfjdanYK7LMg44FjgamAac1fCMwIlRlXWchcz90Xp2Qhtdcp1Salq/BgaLQdXrag1m6HqQlS6WzUH6khYGchdGOjCeONZDciVegmZFCwPQpYAzkVyEjVulmrgrVSJOjb4O/Mz5IDtemQUcgtaoEYr8bSOePwHNkUN+Z+Vhb3Ml3bSiO9HcEOkDiJ6x9lDgeWq5Em0hdm2JdA2/2vD42nTvyDM3Q8vPySjauQFepVGMtMafxU/q/M7Kd9nmOohpg69hQBS9kOs2RlqWc9CZpxcuATcis2LTGx6tNTH6iLshX748Mx/YhjBH/8af3xJIt3UoVibxXeQHSYbiVGN1aW4H/WVj9cXnHMTT+fCGR0YXyb9A7wnZZV+KySsodgb1LlBfCHqkNwZxJhn6Q7jIMJWE69G8Ham70Zg7AJfiqHEYkadoo3buuZ1sExRF5U0k/NPs8MMafoAfA75vwqCo2BRIxWBd6QLC9fN7JIlPXvgycJnhOi9FotvnhbeBzYAFouOQCYfGhInfyqZ0mwJpPF6IxqPAiwbq+SWy8Jc3jgS+Y7jO75KP9An/RuISzDNUX1jrYfKB3IdNgXQaquenBuo4j3yHzbkQ2MpwnV9HwgW54lFgEtKCmGB3wteoyoauMwibAllsoI5XgDtT1nEsGfdbE3IX5j1SvwFcYLjOKPwKEfxCg3U2mnE01WMZhE2BmMhmcnLK8/chynRqPlga8d8yzfeQblwWaCTt9kGG612dxtEUew1fE7ArkPdSnv8f4Lcpzt8CO184m+yORA40zUyku/OQhbpr3IF4JUSPExCdKDNzprr0g7ApkHdSnv+DFOeuBNyf8vqusNUlehqYDByBhA8yxYPIbNzuiMu/DQ6LcExLCeQ1INqej+G0Aw8DS6W4vksmIW7strgCWBNZpLwvYR2vI+GHvoBsB7CZTHNvoqXPiL8PJwI294P8J8W5ab4g9yF91iJzGeKSYuVDR2Z8rgrK2siXfAuki7QyMh6qBUjtQB52s4EngVnIDJVN77WBRJ0Cf9fGxfMokPuRjLhJuBXx9Sk6bci44YAMrvVKUK4e8Luao6nG0uA3IqsQPfnrXBsG2OxizU54XtL1iiuQWatmYX+yCN1an56guBQHwLdiHFt/P3tKbArkNeLf4FOIGq1kMNOx2293xTWuDXBMY2fOfl6zYYBNgcwnnvv1C5DIY/cMZDGwGdmMfPmOZckUZDwUFSszaLa9eeMYnSTn3HnACQnOKxKXuzbAEXH80+Yhfl/GsS2QZyIety/xu1anUwwXkrR8EvGraiXGIdO7UXmWAnrzAjwV4ZgTib/iPSU4r1U4z7UBGXMg8XYIPm3LENsCeaLB+6cjO8TisAytl2lpBeINWIvOUTGP/4cVK7AvkDcYeXbheJI5I/6V4q6Sp+EM1wZkxKbIgmUcHrNhCGSz5XZogs1XgZ1I5mV7A9kkBs0jE4jmk1R04m4ZnoPFYBVZCOTR4OdLSKuxDnBPgnpmAF8zZVRBMbX1OK+MRhZI4zDLhiE1bLqa1LgJmc1K84eciexraHU+gQxgf+XaEEscSPzuc1K3pEhk0YK8SzpxnAz82JAtzUAzp2BLMm2fpDcSmbyH/TmQZKvrzcyqNJfPWY1JwPoxz3meZK5JkcmzQL6ERCLxDOds1wZYIEmUyz8at2IIeRXIXmTwxxeYtYCdXRthkKVJ5tpvJS/hQPIokKOA21wbUQDOcW2AQY4gfmzdN2i8EJ2avAnkMvpTannC2Qg7AR5ckKR7lSagR2TyIpDtkdQAWYWnaRaaYSyyD8mSFl1n2pB6uBbIpsje63uJP4PhkeBsm7s2IiVJImc+j3jwWieLhcKhrI3sG/8KktPCk44ZSNCFIrIt0lWMy0zThoyEC4HcgOyU85hhMtISW/NotUiSLmIVuNawHSPioot1rYNrNjs2ohnaZiOkBYnL9dgLhzQMFwK5BLNBjT0yFpns2oiYJI0gmenEhAuBaNxEHG92MuuXG2ATGgejrsdjyGxnZriaxZpOdpH5WoX1kImPIpBUzJkH6HAlkIW0brQOm1zs2oAIfBEJcxqXl7Hs2l4Pl+sgJjJHeQYzAZjm2ogGXJnwPCexz1wK5F2KOfuSd36CpH/IIyci8Xbj8hJ2I8iPiOuV9JMcX79ZudG1AXWYQPLNXseYNCQOrgWygNYI/pY1n0cy3eaJPyc8707EFckJrgUCcD7iW+MxywXILr08cDXJvSf2NWlIXPIgEJBsrB7z/J9rAxBv3UMTnns8sMigLbHJi0CeonkjdbhkZdzmSl+d5IlU55CDDMV5EQhIfg8riRhbnAOQHXtZsyTwQIrz9zNlSBryJJBukmeX8oRzOdmnpnsAmJjw3KuwGE40DnkSCEhznHS2wxPOfcCnMrxW0o1cH5CjbGF5EwjIrEW3ayOakHYkDGzSp3oUPg48AmyXoo69yJGfXh4F0kG85Cme6CyPbKxa00LdmyHbYLdKUce5pBu3GCePAgHpZnk3FDtMQBLOTDFY57HA40g2rKQ8T7LoJlbJq0BA3Asy2ZjfgowF/gb8KGU9OyHpLdJOx+qgrtyRZ4EA7Ijk6/bY4SzgIeQ+R2UMkobiXuAuYGsDduwBvGWgHuO4CNoQh3eQ/QOZ7wNoIbYB7gYeRIKxPYBkjF0MLAGMR+JWbYhET9kNSQlnip/hyFM3CkprSxMGh8SNJBnKMcBFJiv0hLIAcfFYElgWez2NWzC5IHit+e9y3rtYNS6mGLvlmoVxyL6N8dj7jjxBTlbLwyiKQEASy//OtREeI8yhIHGFiyQQgKlYzknnsc6HyFpJh2M7IlE0gYCs0j7u2ghPIjqBz5LTGat6FFEgIFOLT7o2whOLbkQcL7s2JA5FFUgZudn/79oQTySqyOdVuIXfogoEoBe56fe7NsTTkMMR95bCUWSBgLgoTAF+79YMTwhzgGtcG5GUogukxt5I+jZP/rCax9w2zSIQgKOBH7o2wjMMp0EX0tJMAgHJ/LoX3sExT6zu2oA0NJtAAP4AbIBESvG4J0mKtdzQjAIBeAXJQXGFa0M8rI6EHyokzSqQGkcgQekWuzakxVnPtQFJaXaBgAROWwfpenncsIFrA5LSCgIBeBMZvB+Gz4/oAi+QgnA18GkkYrgnOz7j2oCktJpAAOYh23gPBd5wbEursC4Sl6twtKJAalwLrI1kZPLdLrssB6zl2ogktLJAQFywT0MCqZ1FwVd9c866rg1IQqsLpMZ7SIrhNZEkmPPcmtOUFHLB0AtkMO8g2Xc/BXwbCSzQClSwvwW2kGshXiD16QAuRSKUb4+MVz5yaZAl7gC+DqwBrIbs1DwBO6kHxlio0zpFiYuVB8YjEQD3BnYBRrs1JzGPALche2heCTlucySC4lTMOBxegu1stRbiYnmBJGMlYGckZOcU7KYUSMsiZNflX5C9GS8lqGNP4CtBSRqNczIS5tQeXiC5pA3Z+jsZCWezKdJdccX7wDNILpCHkODSHxiqe1Xgm4hQ4owp7iVe/N9keIEUhvWBjZF4tusgawCfRCIWmqILeB2YDfwTCYjwNPAC2Thn7oDkP9wLWecYiReALTOxyQuk0IxDumYrBz+XRRLajEeCRI9GVptLyF77XmTjVw8SbO09pCWYB8wF3kZm3VwzDhHJVMTnanlkVuwtxKXneCQKjX0KJRCPpwnw07weTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwheIB5PCF4gHk8IXiAeTwj/Ba/47FkhCYEqAAAAAElFTkSuQmCC"});let Pi=class extends Xe{constructor(t,e){super(t,e),this.setConversationStarters(e.conversationStarters)}setAssistantPersona(t){this.setProp("assistantPersona",t),this.executeDomAction("updateAssistantPersona",t)}setConversationStarters(t){var e;if(t||this.conversationStartersComp){if(t&&!this.conversationStartersComp){const s=this.getProp("onConversationStarterSelected");return this.conversationStartersComp=Rt(Rs).withContext(this.context).withProps({conversationStarters:t,onConversationStarterSelected:s}).create(),void this.addSubComponent(this.conversationStartersComp.id,this.conversationStartersComp,"conversationStartersContainer")}!t&&this.conversationStartersComp?(this.removeSubComponent(this.conversationStartersComp.id),this.conversationStartersComp=void 0):(e=this.conversationStartersComp)==null||e.updateConversationStarters(t)}}setShowGreeting(t){this.setProp("showGreeting",t),this.executeDomAction("resetGreeting",t)}resetConversationStarters(){const t=this.getProp("conversationStarters");this.setConversationStarters(t)}};Pi=((t,e,s,i)=>{for(var r,n=e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=r(n)||n);return n})([Mt("launchPad",(({appendToRoot:t,props:e})=>{const s={assistantPersona:e.assistantPersona,conversationStarters:e.conversationStarters,showGreeting:e.showGreeting!==!1};let i;if(s.showGreeting)if(e.assistantPersona){const o=e.assistantPersona;i=jr({name:o.name,avatar:o.avatar,message:o.tagline})}else i=Jo();i&&(t(i),s.greetingElement=i);const r=document.createElement("div");r.classList.add("nlux-conversationStarters-container"),t(r);const n=(o=!0)=>{s.showGreeting=o,s.greetingElement&&(s.greetingElement.remove(),s.greetingElement=void 0),o&&(s.greetingElement=s.assistantPersona?jr({name:s.assistantPersona.name,avatar:s.assistantPersona.avatar,message:s.assistantPersona.tagline}):Jo(),s.greetingElement&&r.insertAdjacentElement("beforebegin",s.greetingElement))};return{elements:{conversationStartersContainer:r},actions:{resetGreeting:(o=!0)=>{n(o)},updateAssistantPersona:o=>{const a=s.assistantPersona;s.assistantPersona=o,(a||o)&&s.showGreeting&&(o&&a?((h,l,c)=>{if(l.message!==c.message||l.name!==c.name||l.avatar!==c.avatar){if(l.message!==c.message&&Al(h,c.message),l.name!==c.name){const d=h.querySelector(`.${Dl}`);if(d){const u=document.createTextNode(c.name);d.replaceChildren(u)}}if(l.avatar!==c.avatar||l.name!==c.name){const d=h.querySelector(`.${un}`);d&&El(d,{name:l.name,avatar:l.avatar},{name:c.name,avatar:c.avatar})}}})(s.greetingElement,{name:a==null?void 0:a.name,avatar:a==null?void 0:a.avatar,message:a==null?void 0:a.tagline},{name:o.name,avatar:o.avatar,message:o.tagline}):n())}},onDestroy:()=>{var o;(o=s.greetingElement)==null||o.remove(),r.remove()}}}),(({})=>{}))],Pi);const Xr=t=>{if(typeof t!="object"||t===null)return!1;const e=t;return(typeof e.streamText=="function"||typeof e.batchText=="function")&&["stream","batch"].includes(e.dataTransferMode)&&typeof e.id=="string"&&typeof e.info=="object"&&e.info!==null&&typeof e.preProcessAiBatchedMessage=="function"&&typeof e.preProcessAiStreamedChunk=="function"};var oa;const kf=typeof navigator<"u"&&((oa=navigator==null?void 0:navigator.userAgent)!=null&&oa.includes("Safari"))?100:1,me=(t,e=kf)=>{setTimeout((()=>{t()}),e)},xf=(t,e,s,i,r,n,o,a,h)=>new Promise((l=>{const c=Ve(),d=[],u=[];let _=!1,f=!1,p=!1;const m=Xr(s),S={next:y=>{if(f||p)return;let w,C;if(m){const L=y,A=s.preProcessAiStreamedChunk(L,i);A!=null&&(w=A,C=L,d.push(w),u.push(C))}else w=y,d.push(w);w!=null?(_||_||(_=!0,me((()=>{r.forEach((L=>{L({uid:c,status:"streaming",time:new Date,participantRole:"assistant",dataTransferMode:"stream"})}))}))),me((()=>{o.forEach((L=>{L({chunk:w,messageId:c,serverResponse:C})}))}))):_e("Adapter returned an undefined or null value from streamText. This chunk will be ignored.")},complete:()=>{f||p||(p=!0,me((()=>{const y={uid:c,status:"complete",content:d,contentType:"text",serverResponse:void 0,time:new Date,participantRole:"assistant",dataTransferMode:"stream"};n.forEach((w=>{w(y)})),l()})),me((()=>{const y={uid:t,status:"complete",items:[e,{uid:c,status:"complete",contentType:"text",content:d,serverResponse:u,time:new Date,participantRole:"assistant",dataTransferMode:"stream"}]};a.forEach((w=>{w(y)}))})))},error:y=>{f||p||(f=!0,me((()=>{h.forEach((w=>{w("failed-to-stream-content",y)})),l()})))}};s.streamText(e.content,S,i)})),Ef=(t,e,s)=>{if(!t)return(()=>{const y=new Set,w=Ve(),C={uid:w,status:"complete",items:[]};return me((()=>{y.forEach((L=>{L(C)})),y.clear()})),{segment:C,observable:{on:(L,A)=>{L==="complete"&&y.add(A)},removeListener:(L,A)=>{y.delete(A)},destroy:()=>{y.clear()},get segmentId(){return w}},dataTransferMode:"batch"}})();const i=e;if(i.streamText===void 0&&i.batchText===void 0&&i.streamServerComponent===void 0)return(y=>{const w=new Set,C=Ve(),L={uid:C,status:"error",items:[]};return me((()=>{w.forEach((A=>A(y))),w.clear()})),{segment:L,dataTransferMode:"stream",observable:{on:(A,z)=>{A==="error"&&w.add(z)},removeListener:(A,z)=>{w.delete(z)},destroy:()=>{w.clear()},get segmentId(){return C}}}})("no-data-transfer-mode-supported");const r=Ve(),n=(y=>({uid:Ve(),time:new Date,status:"complete",participantRole:"user",content:y,contentType:"text"}))(t);let o,a,h,l,c,d,u=new Set,_=new Set,f=new Set;me((()=>{u!=null&&u.size&&(u.forEach((y=>{y(n)})),u.clear(),u=void 0)}));const p=(y=>{const w=[],C=y,L=y;(C==null?void 0:C.streamText)===void 0&&(L==null?void 0:L.streamServerComponent)===void 0||w.push("stream"),(C==null?void 0:C.batchText)!==void 0&&w.push("batch");const A=Xr(y)?y:void 0,z=(A==null?void 0:A.dataTransferMode)??void 0,j=w.length===1?w[0]:"stream";return z??j})(e);(y=>"streamServerComponent"in y?"server-component":"text")(e)==="server-component"?(h=new Set,a=new Set,((y,w,C,L,A,z,j,W)=>new Promise(((xe,F)=>{try{const P=w.content,v=Ve(),b="assistant",k="streaming",B=new Date,D="stream";let x,I;const N=()=>{me((()=>{z.forEach((ie=>{x&&I&&ie({...x,content:I,status:"complete"})}))}),20);const X={uid:y,status:"complete",items:[w,x]};me((()=>{j.forEach((ie=>{ie(X)})),xe()}),20)},Y=()=>{W.forEach((X=>{X("failed-to-stream-server-component",new Error("Failed to load content"))}))};I=C.streamServerComponent(P,L,{onServerComponentReceived:N,onError:Y}),x={uid:v,content:I,contentType:"server-component",participantRole:b,status:k,time:B,dataTransferMode:D},me((()=>{A.forEach((X=>{X(x)}))}),10)}catch(P){_e(P);const v=P instanceof Error?P:typeof P=="string"?new Error(P):new Error("Unknown error");me((()=>{W.forEach((b=>b("failed-to-load-content",v)))}))}})))(r,n,e,s,a,h,_,f).finally((()=>{me((()=>S()))}))):p==="batch"?(o=new Set,(async(y,w,C,L,A,z,j)=>{try{const W=w.content,xe=Xr(C)?C:void 0,F=xe!==void 0,P=Ve(),v="assistant",b="complete",k=new Date,B="batch";let D;if(F){const N=await xe.batchText(W,L),Y=xe.preProcessAiBatchedMessage(N,L);Y!=null&&(D={uid:P,content:Y,contentType:"text",serverResponse:N,participantRole:v,status:b,time:k,dataTransferMode:B})}else D={uid:P,content:await C.batchText(W,L),contentType:"text",serverResponse:void 0,participantRole:v,status:b,time:k,dataTransferMode:B};if(!D)throw new Error("Response from adapter was undefined or cannot be processed");const x=D;me((()=>{A.forEach((N=>{N(x)}))}));const I={uid:y,status:"complete",items:[w,D]};me((()=>{z.forEach((N=>{N(I)}))}))}catch(W){_e(W);const xe=W instanceof Error?W:typeof W=="string"?new Error(W):new Error("Unknown error");me((()=>{j.forEach((F=>F("failed-to-load-content",xe)))}))}})(r,n,e,s,o,_,f).finally((()=>{me((()=>S()))}))):(l=new Set,c=new Set,d=new Set,xf(r,n,e,s,l,c,d,_,f).finally((()=>{me((()=>S()))})));const S=()=>{u==null||u.clear(),u=void 0,o==null||o.clear(),o=void 0,a==null||a.clear(),a=void 0,h==null||h.clear(),h=void 0,l==null||l.clear(),l=void 0,c==null||c.clear(),c=void 0,d==null||d.clear(),d=void 0,_==null||_.clear(),_=void 0,f==null||f.clear(),f=void 0};return{segment:{status:"active",uid:r,items:[]},dataTransferMode:p,observable:{get segmentId(){return r},on:(y,w)=>{y==="userMessageReceived"&&u?u.add(w):y==="aiMessageReceived"&&o?o.add(w):y==="aiServerComponentStreamStarted"&&a?a.add(w):y==="aiServerComponentStreamed"&&h?h.add(w):y==="aiMessageStreamStarted"&&l?l.add(w):y==="aiMessageStreamed"&&c?c.add(w):y==="aiChunkReceived"&&d?d.add(w):y==="complete"&&_?_.add(w):y==="error"&&f&&f.add(w)},removeListener:(y,w)=>{y!=="userMessageReceived"?y!=="aiMessageReceived"?y!=="aiMessageStreamStarted"?y!=="aiMessageStreamed"?y!=="aiChunkReceived"?y!=="complete"?y!=="error"||(f==null||f.delete(w)):_==null||_.delete(w):d==null||d.delete(w):c==null||c.delete(w):l==null||l.delete(w):o==null||o.delete(w):u==null||u.delete(w)},destroy:()=>S()}}},Ml={"data-transfer-mode-not-supported":"Requested data transfer mode is not supported","no-data-transfer-mode-supported":"Adapter does not support any valid data transfer modes","connection-error":"Connection error","invalid-credentials":"Invalid credentials","invalid-api-key":"Invalid API key","http-server-side-error":"HTTP server side error","http-client-side-error":"HTTP client side error","failed-to-load-content":"Failed to load content","failed-to-stream-content":"Failed to stream content","failed-to-stream-server-component":"Failed to stream server component","failed-to-render-content":"Failed to display content"},Gr=(t,e)=>t!==void 0&&t.length>0||e!==void 0&&e>0?"active":"starting";var Bf=Object.defineProperty,Pf=Object.getOwnPropertyDescriptor,ir=(t,e,s,i)=>{for(var r,n=i>1?void 0:i?Pf(e,s):e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=(i?r(e,s,n):r(n))||n);return i&&n&&Bf(e,s,n),n};let is=class extends Xe{constructor(t,{conversationLayout:e,autoScroll:s,streamingAnimationSpeed:i,visible:r=!0,composer:n,assistantPersona:o,userPersona:a,showGreeting:h,conversationStarters:l,initialConversationContent:c,syntaxHighlighter:d,htmlSanitizer:u,markdownLinkTarget:_,showCodeBlockCopyButton:f,skipStreamingAnimation:p}){if(super(t,{conversationLayout:e,visible:r,autoScroll:s,streamingAnimationSpeed:i,assistantPersona:o,userPersona:a,conversationStarters:l,showGreeting:h,initialConversationContent:c,composer:n,syntaxHighlighter:d,htmlSanitizer:u,markdownLinkTarget:_,showCodeBlockCopyButton:f,skipStreamingAnimation:p}),this.handleConversationStarterClick=m=>{this.composer.setDomProps({status:"submitting-conversation-starter"}),this.composer.handleTextChange(m.prompt),this.composer.handleSendButtonClick()},this.handleSegmentCountChange=m=>{var y,w;if(this.segmentCount===m)return;this.segmentCount=m;const S=Gr(this.getProp("initialConversationContent")||void 0,this.segmentCount);this.chatRoomStatus!==S&&(this.chatRoomStatus=S,this.executeDomAction("updateChatRoomStatus",this.chatRoomStatus),this.chatRoomStatus==="active"?(y=this.launchPad)!=null&&y.id&&(this.removeSubComponent((w=this.launchPad)==null?void 0:w.id),this.launchPad=void 0):this.addLaunchPad(this.getProp("showGreeting")??!0,this.getProp("assistantPersona"),this.getProp("conversationStarters"),this.handleConversationStarterClick))},this.prompt="",this.segmentCount=c&&c.length>0?1:0,this.chatRoomStatus=Gr(c,this.segmentCount),this.chatRoomStatus==="starting"&&this.addLaunchPad(h,o,l,this.handleConversationStarterClick),this.addConversation(o,a,c),this.addComposer(n==null?void 0:n.placeholder,n==null?void 0:n.autoFocus,n==null?void 0:n.disableSubmitButton,n==null?void 0:n.submitShortcut),!this.conversation||!this.composer)throw new Error("Chat room not initialized  An error occurred while initializing key components.")}getConversationContentForAdapter(t="max"){return this.conversation.getConversationContentForAdapter(t)}hide(){this.setProp("visible",!1)}messagesContainerClicked(){var t;(t=this.composer)==null||t.focusTextInput()}onChatRoomReady(){at((()=>{var e,s;const t=(s=(e=this.renderedDom)==null?void 0:e.elements)==null?void 0:s.conversationContainer;if(t instanceof HTMLElement){this.autoScrollController=mf(t,this.getProp("autoScroll")??!0);let i=0;const r=20,n=()=>{t.scrollHeight>t.clientHeight&&(t.scrollTo({behavior:"smooth",top:5e4}),clearInterval(o))},o=setInterval((()=>{i>=r?clearInterval(o):(n(),i++)}),10)}this.context.emit("ready",{aiChatProps:Bl(this.context.aiChatProps)})}))}setProps(t){var e,s,i,r,n,o,a;if(t.hasOwnProperty("autoScroll")){const h=t.autoScroll;(e=this.autoScrollController)==null||e.updateProps({autoScroll:h})}if(t.hasOwnProperty("conversationLayout")&&((s=this.conversation)==null||s.setConversationLayout(t.conversationLayout)),t.hasOwnProperty("syntaxHighlighter")&&this.setProp("syntaxHighlighter",t.syntaxHighlighter),t.hasOwnProperty("htmlSanitizer")&&this.setProp("htmlSanitizer",t.htmlSanitizer),t.hasOwnProperty("markdownLinkTarget")&&this.setProp("markdownLinkTarget",t.markdownLinkTarget),t.hasOwnProperty("skipStreamingAnimation")&&this.setProp("skipStreamingAnimation",t.skipStreamingAnimation),t.hasOwnProperty("streamingAnimationSpeed")&&this.setProp("streamingAnimationSpeed",t.streamingAnimationSpeed),t.hasOwnProperty("assistantPersona")&&((i=this.conversation)==null||i.setAssistantPersona(t.assistantPersona??void 0),(r=this.launchPad)==null||r.setAssistantPersona(t.assistantPersona??void 0)),t.hasOwnProperty("userPersona")&&((n=this.conversation)==null||n.setUserPersona(t.userPersona??void 0)),t.hasOwnProperty("showGreeting")&&((o=this.launchPad)==null||o.setShowGreeting(t.showGreeting??!0)),t.hasOwnProperty("conversationStarters")&&((a=this.launchPad)==null||a.setConversationStarters(t.conversationStarters)),t.hasOwnProperty("composer")&&this.composer){const h={...this.composer.getProp("domCompProps"),...t.composer};this.composer.setDomProps(h)}}show(){this.setProp("visible",!0)}setProp(t,e){if(super.setProp(t,e),t==="markdownLinkTarget"||t==="syntaxHighlighter"||t==="htmlSanitizer"||t==="skipStreamingAnimation"||t==="streamingAnimationSpeed"){const s=t,i=e;this.conversation.updateMarkdownStreamRenderer(s,i)}}addComposer(t,e,s,i){this.composer=Rt(Et).withContext(this.context).withProps({props:{domCompProps:{status:"typing",placeholder:t,autoFocus:e,disableSubmitButton:s,submitShortcut:i}},eventListeners:{onTextUpdated:r=>this.handleComposerTextChange(r),onSubmit:()=>this.handleComposerSubmit()}}).create(),this.addSubComponent(this.composer.id,this.composer,"composerContainer")}addConversation(t,e,s){this.conversation=Rt(Bi).withContext(this.context).withProps({assistantPersona:t,userPersona:e,messages:s,conversationLayout:this.getProp("conversationLayout"),markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),onSegmentCountChange:this.handleSegmentCountChange}).create(),this.addSubComponent(this.conversation.id,this.conversation,"conversationContainer")}addLaunchPad(t,e,s,i){this.launchPad=Rt(Pi).withContext(this.context).withProps({showGreeting:t,assistantPersona:e,conversationStarters:s,onConversationStarterSelected:i}).create(),this.addSubComponent(this.launchPad.id,this.launchPad,"launchPadContainer")}handleComposerSubmit(){const t=this.props.composer;(({context:e,composerInstance:s,conversation:i,autoScrollController:r,messageToSend:n,resetComposer:o,setComposerAsWaiting:a})=>()=>{var l,c;const h=i.addChatSegment();try{const d=s.getProp("domCompProps");s.setDomProps({...d,status:"submitting-prompt"});const u={aiChatProps:e.aiChatProps,conversationHistory:i.getConversationContentForAdapter((c=(l=e.aiChatProps)==null?void 0:l.conversationOptions)==null?void 0:c.historyPayloadSize)},_=Ef(n,e.adapter,u);_.observable.on("error",((f,p)=>{i.removeChatSegment(h),r==null||r.handleChatSegmentRemoved(h),o(!1),e.exception(f),e.emit("error",{errorId:f,message:Ml[f],errorObject:p})})),_.observable.on("userMessageReceived",(f=>{i.addChatItem(h,f),e.emit("messageSent",{uid:f.uid,message:f.content}),at((()=>{if(r){const p=i.getChatSegmentContainer(h);p&&r.handleNewChatSegmentAdded(h,p)}}))})),_.dataTransferMode==="batch"?_.observable.on("aiMessageReceived",(f=>{const p=typeof f.content=="string",m={...f,content:p?"":f.content};i.addChatItem(h,m),p&&i.addChunk(h,m.uid,f.content,f.serverResponse),i.completeChatSegment(h),e.emit("messageReceived",{uid:f.uid,message:f.content}),o(!0)})):(_.observable.on("aiMessageStreamStarted",(f=>{i.addChatItem(h,f),a(),e.emit("messageStreamStarted",{uid:f.uid})})),_.observable.on("aiChunkReceived",(f=>{const{messageId:p,chunk:m,serverResponse:S}=f;i.addChunk(h,p,m,S)})),_.observable.on("aiMessageStreamed",(f=>{f.status==="complete"&&e.emit("messageReceived",{uid:f.uid,message:f.content})})),_.observable.on("aiServerComponentStreamStarted",(f=>{i.addChatItem(h,f),a(),e.emit("messageStreamStarted",{uid:f.uid})})),_.observable.on("aiServerComponentStreamed",(f=>{f.status==="complete"&&e.emit("messageReceived",{uid:f.uid,message:f.content})})),_.observable.on("complete",(()=>{i.completeChatSegment(h),o(!1)})))}catch(d){_e(d),o(!1)}})({context:this.context,composerInstance:this.composer,conversation:this.conversation,messageToSend:this.prompt,autoScrollController:this.autoScrollController,resetComposer:e=>{this.destroyed||this.resetComposer(e,t==null?void 0:t.autoFocus)},setComposerAsWaiting:()=>{this.destroyed||this.composer.setDomProps({status:"waiting"})}})()}handleComposerTextChange(t){this.prompt=t}resetComposer(t=!1,e=!1){if(!this.composer)return;const s={...this.composer.getProp("domCompProps"),status:"typing"};t&&(s.message=""),this.composer.setDomProps(s),e&&this.composer.focusTextInput()}};ir([et("conversation-container-clicked")],is.prototype,"messagesContainerClicked",1),ir([et("chat-room-ready")],is.prototype,"onChatRoomReady",1),is=ir([Mt("chatRoom",(({appendToRoot:t,compEvent:e,props:s})=>{const i=document.createElement("div");i.classList.add("nlux-conversation-container");const r=document.createElement("div");r.classList.add("nlux-composer-container");const n=document.createElement("div");n.classList.add("nlux-launchPad-container");const o=document.createDocumentFragment();o.appendChild(n),o.appendChild(i),o.appendChild(r);const a=s.visible??!0,h=document.createElement("div"),l=u=>{h.classList.remove("nlux-chatRoom-starting"),h.classList.remove("nlux-chatRoom-active"),h.classList.add(`nlux-chatRoom-${u}`)};h.classList.add("nlux-chatRoom-container"),l(Gr(s.initialConversationContent)),h.append(o),h.style.display=a?"":"none";const[c,d]=Ei(h,":scope > .nlux-conversation-container").on("click",e("conversation-container-clicked")).get();return t(h),e("chat-room-ready")(),{elements:{composerContainer:r,conversationContainer:i,launchPadContainer:n},actions:{updateChatRoomStatus:u=>{l(u)}},onDestroy:()=>{d()}}}),(({propName:t,newValue:e,dom:{elements:s}})=>{}))],is);const Lf=t=>{const e=new Set;let s=!1,i=null,r=null;const n=()=>{if(s||e.size===0)return;s=!0;const a=e.values().next().value;e.delete(a),i=(({message:h})=>{const l=document.createElement("div");l.classList.add("nlux-comp-exceptionItem");const c=document.createElement("span");return c.classList.add("nlux-comp-exp_itm_msg"),c.append(document.createTextNode(h)),l.append(c),l})(a),t.append(i),r=setTimeout(o,3e3)},o=()=>{i==null||i.classList.add("nlux-comp-exceptionItem--hiding"),r=setTimeout((()=>{s=!1,i==null||i.remove(),i=null,n()}),500)};return{displayException:a=>{e.add({message:a}),s||n()},destroy:()=>{e.clear(),i==null||i.remove(),r&&clearTimeout(r)}}};let Li=class extends Xe{constructor(t,e){super(t,e)}destroy(){super.destroy()}showAlert(t,e){this.executeDomAction("displayException",e)}};Li=((t,e,s,i)=>{for(var r,n=e,o=t.length-1;o>=0;o--)(r=t[o])&&(n=r(n)||n);return n})([Mt("exceptionsBox",(({props:t,appendToRoot:e})=>{const s=(()=>{const r=document.createElement("div");return r.classList.add("nlux-comp-exceptionBox"),r})();e(s);let i=Lf(s);return{elements:{root:s},actions:{displayException:r=>{i==null||i.displayException(r)}},onDestroy:()=>{i==null||i.destroy(),s.remove(),i=void 0}}}),(()=>{}))],Li);const Rf=()=>{const t=(()=>{if(typeof window>"u")return;const s=window;return typeof s.NLUX=="object"&&typeof s.NLUX.version=="string"?s.NLUX:(s.NLUX=Ao,Ao)})(),e=btoa("sectionsRegistered");t&&t[e]===!0||(Object.entries({chatRoom:is,launchPad:Pi,conversation:Bi,composer:Et,conversationStarters:Rs,chatSegment:Ft,chatItem:Ls,exceptionsBox:Li}).forEach((([,s])=>{Oi.register(s)})),typeof t=="object"&&(t[e]=!0))};class Af{constructor(){this.emit=(e,...s)=>{var i;this.eventListeners.has(e)&&((i=this.eventListeners.get(e))==null||i.forEach((r=>{typeof r=="function"&&r(...s)})))},this.on=(e,s)=>{var i;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(i=this.eventListeners.get(e))==null||i.add(s)},this.removeAllEventListeners=e=>this.eventListeners.delete(e),this.removeAllEventListenersForAllEvent=()=>this.eventListeners.clear(),this.removeEventListener=(e,s)=>{var i,r;this.eventListeners.has(e)&&((i=this.eventListeners.get(e))==null||i.delete(s),(r=this.eventListeners.get(e))!=null&&r.size||this.eventListeners.delete(e))},this.updateEventListeners=e=>{const s=Object.keys(e);for(const i of s)this.eventListeners.set(i,new Set([e[i]]))},this.eventListeners=new Map}}class Df{constructor(e,s,i,r=null){if(this.chatRoom=null,this.exceptionsBox=null,this.isDestroyed=!1,this.isMounted=!1,this.rootCompId=null,this.rootElement=null,this.theClassName=null,this.theComposerOptions={},this.theConversationOptions={},this.theDisplayOptions={},this.theInitialConversationContent=null,this.theMessageOptions={},this.thePersonasOptions={},!s)throw new fe({source:this.constructor.name,message:"Root component ID is not a valid component name"});this.__context=e,this.rootElement=i,this.rootElementInitialClassName=i.className,this.rootCompId=s,this.chatRoom=null,this.theClassName=(r==null?void 0:r.className)??null,this.theDisplayOptions=(r==null?void 0:r.displayOptions)??{},this.theConversationOptions=(r==null?void 0:r.conversationOptions)??{},this.theMessageOptions=(r==null?void 0:r.messageOptions)??{},this.theInitialConversationContent=(r==null?void 0:r.initialConversation)??null,this.theComposerOptions=(r==null?void 0:r.composerOptions)??{},this.thePersonasOptions=(r==null?void 0:r.personaOptions)??{}}get className(){return this.theClassName??void 0}get colorScheme(){return this.theDisplayOptions.colorScheme}get context(){return this.__context}get mounted(){return this.isMounted}get themeId(){return this.theDisplayOptions.themeId}destroy(){this.mounted&&this.unmount(),this.chatRoom&&this.chatRoom.destroy(),this.rootElement=null,this.rootElementInitialClassName=null,this.rootCompId=null,this.chatRoom=null,this.isMounted=!1,this.isDestroyed=!0,this.theDisplayOptions={},this.theConversationOptions={},this.theComposerOptions={}}hide(){var e;if(!this.mounted)throw new fe({source:this.constructor.name,message:"Renderer is not mounted and cannot be hidden"});(e=this.chatRoom)==null||e.hide()}mount(){var i,r,n,o,a,h,l,c,d,u,_,f,p,m;if(this.isDestroyed)throw new fe({source:this.constructor.name,message:"Renderer is destroyed and cannot be mounted"});if(!this.rootCompId||!this.rootElement)throw new fe({source:this.constructor.name,message:"Root component or root class is not set"});let e=null,s=null;try{if(this.rootCompId!=="chatRoom")throw new fe({source:this.constructor.name,message:"Root component is not a chat room"});if(e=Rt(is).withContext(this.context).withProps({visible:!0,conversationLayout:jo(this.theConversationOptions.layout),assistantPersona:((i=this.thePersonasOptions)==null?void 0:i.assistant)??void 0,userPersona:((r=this.thePersonasOptions)==null?void 0:r.user)??void 0,conversationStarters:((n=this.theConversationOptions)==null?void 0:n.conversationStarters)??void 0,showGreeting:(o=this.theConversationOptions)==null?void 0:o.showWelcomeMessage,initialConversationContent:this.theInitialConversationContent??void 0,autoScroll:(a=this.theConversationOptions)==null?void 0:a.autoScroll,syntaxHighlighter:this.context.syntaxHighlighter,htmlSanitizer:this.context.htmlSanitizer,markdownLinkTarget:(h=this.theMessageOptions)==null?void 0:h.markdownLinkTarget,showCodeBlockCopyButton:(l=this.theMessageOptions)==null?void 0:l.showCodeBlockCopyButton,streamingAnimationSpeed:(c=this.theMessageOptions)==null?void 0:c.streamingAnimationSpeed,skipStreamingAnimation:(d=this.theMessageOptions)==null?void 0:d.skipStreamingAnimation,composer:{placeholder:(u=this.theComposerOptions)==null?void 0:u.placeholder,autoFocus:(_=this.theComposerOptions)==null?void 0:_.autoFocus,disableSubmitButton:(f=this.theComposerOptions)==null?void 0:f.disableSubmitButton,submitShortcut:(p=this.theComposerOptions)==null?void 0:p.submitShortcut}}).create(),((m=Oi.retrieve("exceptionsBox"))==null?void 0:m.model)?s=Rt(Li).withContext(this.context).create():_e("Exception alert component is not registered! No exceptions will be shown."),!e)throw new fe({source:this.constructor.name,message:"Root component failed to instantiate"});if(this.setRootElementClassNames(),this.setRoomElementDimensions(this.theDisplayOptions),s&&s.render(this.rootElement),e.render(this.rootElement),e&&!e.rendered)throw this.rootElement.className=this.rootElementInitialClassName||"",new fe({source:this.constructor.name,message:"Root component did not render"});this.chatRoom=e,this.exceptionsBox=s??null,this.isMounted=!0}catch(S){this.rootElement.className=this.rootElementInitialClassName||"",this.renderEx("failed-to-render-content",(S==null?void 0:S.toString())??"Unknown error")}}renderEx(e,s){var i;if(!this.mounted)throw _e("Renderer is not mounted and cannot render exceptions"),new fe({source:this.constructor.name,message:s});(i=this.exceptionsBox)==null||i.showAlert(e,s)}show(){var e;if(!this.mounted)throw new fe({source:this.constructor.name,message:"Renderer is not mounted and cannot be shown"});(e=this.chatRoom)==null||e.show()}unmount(){var e;if(this.isDestroyed)_e("Renderer is destroyed and cannot be unmounted");else{if(!this.chatRoom||!this.rootElement)throw new fe({source:this.constructor.name,message:"Root component or root element is not set"});this.context.emit("preDestroy",{aiChatProps:Bl(this.context.aiChatProps),conversationHistory:this.chatRoom.getConversationContentForAdapter((e=this.context.aiChatProps.conversationOptions)==null?void 0:e.historyPayloadSize)??[]}),this.exceptionsBox&&this.exceptionsBox.destroy(),this.chatRoom.destroy(),this.rootElement&&(ns(this.rootElement),this.rootElement.className=this.rootElementInitialClassName||""),this.chatRoom=null,this.exceptionsBox=null,this.isMounted=!1}}updateProps(e){var n,o,a,h,l,c,d,u,_,f,p,m,S,y,w,C,L,A,z,j,W,xe,F,P,v,b,k,B,D,x,I,N,Y,X,ie,re,Le,ce,Ne,tt;e.hasOwnProperty("adapter")&&e.adapter&&this.context.update({adapter:e.adapter});let s=!1;e.hasOwnProperty("className")&&e.className!==this.className&&(this.theClassName=e.className??null,s=!0);let i=!1,r=!1;if(e.hasOwnProperty("displayOptions")){const H={};if(((n=e.displayOptions)==null?void 0:n.themeId)!==this.theDisplayOptions.themeId&&(H.themeId=(o=e.displayOptions)==null?void 0:o.themeId,i=!0),((a=e.displayOptions)==null?void 0:a.colorScheme)!==this.theDisplayOptions.colorScheme&&(H.colorScheme=(h=e.displayOptions)==null?void 0:h.colorScheme,r=!0),((l=e.displayOptions)==null?void 0:l.height)!==this.theDisplayOptions.height&&(H.height=(c=e.displayOptions)==null?void 0:c.height),((d=e.displayOptions)==null?void 0:d.width)!==this.theDisplayOptions.width&&(H.width=(u=e.displayOptions)==null?void 0:u.width),Object.keys(H).length>0){const Re={...this.theDisplayOptions,...H};this.theDisplayOptions=Re,this.setRoomElementDimensions(Re)}}if((i||r||s)&&this.setRootElementClassNames(),e.hasOwnProperty("conversationOptions")){const H={},Re={};((_=e.conversationOptions)==null?void 0:_.layout)!==this.theConversationOptions.layout&&(H.layout=(f=e.conversationOptions)==null?void 0:f.layout,Re.conversationLayout=jo((p=e.conversationOptions)==null?void 0:p.layout)),((m=e.conversationOptions)==null?void 0:m.autoScroll)!==this.theConversationOptions.autoScroll&&(H.autoScroll=(S=e.conversationOptions)==null?void 0:S.autoScroll,Re.autoScroll=(y=e.conversationOptions)==null?void 0:y.autoScroll),((w=e.conversationOptions)==null?void 0:w.showWelcomeMessage)!==this.theConversationOptions.showWelcomeMessage&&(H.showWelcomeMessage=(C=e.conversationOptions)==null?void 0:C.showWelcomeMessage,Re.showGreeting=(L=e.conversationOptions)==null?void 0:L.showWelcomeMessage),((A=e.conversationOptions)==null?void 0:A.conversationStarters)!==this.theConversationOptions.conversationStarters&&(H.conversationStarters=(z=e.conversationOptions)==null?void 0:z.conversationStarters,Re.conversationStarters=(j=e.conversationOptions)==null?void 0:j.conversationStarters),Object.keys(H).length>0&&(this.theConversationOptions={...this.theConversationOptions,...H},(W=this.chatRoom)==null||W.setProps(Re))}if(e.hasOwnProperty("messageOptions")&&(this.theMessageOptions=e.messageOptions??{},(b=this.chatRoom)==null||b.setProps({streamingAnimationSpeed:((xe=e.messageOptions)==null?void 0:xe.streamingAnimationSpeed)??void 0,markdownLinkTarget:((F=e.messageOptions)==null?void 0:F.markdownLinkTarget)??void 0,syntaxHighlighter:(P=e.messageOptions)==null?void 0:P.syntaxHighlighter,htmlSanitizer:(v=e.messageOptions)==null?void 0:v.htmlSanitizer}),this.context.update({syntaxHighlighter:(k=e.messageOptions)==null?void 0:k.syntaxHighlighter,htmlSanitizer:(B=e.messageOptions)==null?void 0:B.htmlSanitizer})),e.hasOwnProperty("composerOptions")){const H={};(D=e.composerOptions)!=null&&D.hasOwnProperty("placeholder")&&e.composerOptions.placeholder!==this.theComposerOptions.placeholder&&(H.placeholder=e.composerOptions.placeholder),(x=e.composerOptions)!=null&&x.hasOwnProperty("autoFocus")&&e.composerOptions.autoFocus!==this.theComposerOptions.autoFocus&&(H.autoFocus=e.composerOptions.autoFocus),(I=e.composerOptions)!=null&&I.hasOwnProperty("disableSubmitButton")&&e.composerOptions.disableSubmitButton!==this.theComposerOptions.disableSubmitButton&&(H.disableSubmitButton=e.composerOptions.disableSubmitButton),(N=e.composerOptions)!=null&&N.hasOwnProperty("submitShortcut")&&e.composerOptions.submitShortcut!==this.theComposerOptions.submitShortcut&&(H.submitShortcut=e.composerOptions.submitShortcut),Object.keys(H).length>0&&(this.theComposerOptions={...this.theComposerOptions,...H},(Y=this.chatRoom)==null||Y.setProps({composer:this.theComposerOptions}))}if(e.hasOwnProperty("personaOptions")){const H={};((X=e.personaOptions)==null?void 0:X.assistant)!==((ie=this.thePersonasOptions)==null?void 0:ie.assistant)&&(H.assistantPersona=((re=e.personaOptions)==null?void 0:re.assistant)??void 0),((Le=e.personaOptions)==null?void 0:Le.user)!==((ce=this.thePersonasOptions)==null?void 0:ce.user)&&(H.userPersona=((Ne=e.personaOptions)==null?void 0:Ne.user)??void 0),this.thePersonasOptions={...this.thePersonasOptions,...e.personaOptions},(tt=this.chatRoom)==null||tt.setProps(H)}}setRoomElementDimensions(e){this.rootElement&&(e.hasOwnProperty("width")&&(this.rootElement.style.width=typeof e.width=="number"?`${e.width}px`:typeof e.width=="string"?e.width:""),e.hasOwnProperty("height")&&(this.rootElement.style.height=typeof e.height=="number"?`${e.height}px`:typeof e.height=="string"?e.height:""))}setRootElementClassNames(){var s;if(!this.rootElement)return;const e=(i=>{const r=["nlux-AiChat-root"],n=`nlux-theme-${i.themeId||"nova"}`;return r.push(n),i.className&&r.push(i.className),r})({themeId:this.themeId,className:this.className});this.rootElement.className="",this.rootElement.classList.add(...e),this.rootElement.dataset.colorScheme=this.colorScheme!=="auto"&&this.colorScheme?this.colorScheme:typeof globalThis!==void 0&&globalThis.matchMedia&&((s=globalThis.matchMedia("(prefers-color-scheme: dark)"))!=null&&s.matches)?"dark":"light"}}class Mf{constructor(e,s){this.eventManager=new Af,this.nluxInstanceId=Ve(),this.renderException=i=>{if(!this.mounted||!this.renderer)return null;const r=Ml[i];if(!r)return _e(`Exception with id '${i}' is not defined`),null;this.renderer.renderEx(i,r)},this.renderer=null,this.rootCompId="chatRoom",this.rootElement=e,this.internalProps=s}get mounted(){var e;return(e=this.renderer)==null?void 0:e.mounted}hide(){var e;this.mounted&&((e=this.renderer)==null||e.hide())}mount(){if(this.mounted)return;const e=((s,i,r)=>{const n={...s,update:o=>{Object.assign(n,o)},emit:(o,...a)=>{r(o,...a)},get aiChatProps(){return i()}};return n})({instanceId:this.nluxInstanceId,exception:this.renderException,adapter:this.internalProps.adapter,syntaxHighlighter:this.internalProps.messageOptions.syntaxHighlighter,htmlSanitizer:this.internalProps.messageOptions.htmlSanitizer},(()=>this.getUpdatedAiChatPropsFromInternalProps(this.internalProps)),this.eventManager.emit);this.renderer=new Df(e,this.rootCompId,this.rootElement,this.internalProps),this.renderer.mount()}on(e,s){this.eventManager.on(e,s)}removeAllEventListeners(e){this.eventManager.removeAllEventListeners(e)}removeAllEventListenersForAllEvent(){this.eventManager.removeAllEventListenersForAllEvent()}removeEventListener(e,s){this.eventManager.removeEventListener(e,s)}show(){var e;this.mounted&&((e=this.renderer)==null||e.show())}unmount(){var e;this.mounted&&((e=this.renderer)==null||e.unmount(),this.renderer=null)}updateProps(e){var s;(s=this.renderer)==null||s.updateProps(e),this.internalProps={...this.internalProps,...e},e.events&&(this.internalProps.events=e.events,this.eventManager.updateEventListeners(e.events))}getUpdatedAiChatPropsFromInternalProps(e){const s={...e};for(const i of Object.keys(s))(s[i]===void 0||s[i]===null||typeof s[i]=="object"&&Object.keys(s[i]).length===0)&&delete s[i];return s}}class If{constructor(){this.theAdapter=null,this.theAdapterBuilder=null,this.theAdapterType=null,this.theClassName=null,this.theComposerOptions=null,this.theConversationOptions=null,this.theDisplayOptions=null,this.theInitialConversation=null,this.theMessageOptions=null,this.thePersonasOptions=null,this.aiChatStatus="idle",this.controller=null,this.unregisteredEventListeners=new Map}get status(){return this.aiChatStatus}get isIdle(){return this.status==="idle"}hide(){if(!this.controller)throw new fe({source:this.constructor.name,message:"Unable to hide. nlux is not mounted."});this.controller.hide()}mount(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to create nlux instance. nlux is already or was previously mounted. You can only mount a nlux instance once, when the status is `idle`."});const s=this.theAdapter&&this.theAdapterType==="instance"?this.theAdapter:this.theAdapterType==="builder"&&this.theAdapterBuilder?this.theAdapterBuilder.create():null;if(!s)throw new Mu({source:this.constructor.name,message:"Unable to create nlux instance. ChatAdapter is not properly set. You should call `withAdapter(adapter)` method before mounting nlux."});Rf();const i=document.createElement("div");e.appendChild(i);const r=new Mf(i,{adapter:s,className:this.theClassName??void 0,initialConversation:this.theInitialConversation??void 0,messageOptions:this.theMessageOptions??{},displayOptions:this.theDisplayOptions??{},conversationOptions:this.theConversationOptions??{},composerOptions:this.theComposerOptions??{},personaOptions:this.thePersonasOptions??{}});for(const[n,o]of this.unregisteredEventListeners.entries())for(const a of o)r.on(n,a);if(r.mount(),!r.mounted)throw new fe({source:this.constructor.name,message:"AiChat root component did not render."});this.aiChatStatus="mounted",this.controller=r,this.unregisteredEventListeners.clear()}on(e,s){var i;if(this.status==="unmounted")throw new q({source:this.constructor.name,message:"Unable to add event listener. nlux was previously unmounted."});return this.controller?(this.controller.on(e,s),this):(this.unregisteredEventListeners.has(e)||this.unregisteredEventListeners.set(e,new Set),(i=this.unregisteredEventListeners.get(e))==null||i.add(s),this)}removeAllEventListeners(e){var s,i;(s=this.controller)==null||s.removeAllEventListeners(e),(i=this.unregisteredEventListeners.get(e))==null||i.clear()}removeEventListener(e,s){var i,r;(i=this.controller)==null||i.removeEventListener(e,s),(r=this.unregisteredEventListeners.get(e))==null||r.delete(s)}show(){if(!this.controller)throw new fe({source:this.constructor.name,message:"Unable to show. nlux is not mounted."});this.controller.show()}unmount(){if(this.controller){if(this.controller.unmount(),this.controller.mounted)throw new fe({source:this.constructor.name,message:"Unable to unmount. Root component did not unmount."});this.controller=null,this.unregisteredEventListeners.clear(),this.aiChatStatus="unmounted"}}updateProps(e){if(!this.controller)throw new fe({source:this.constructor.name,message:"Unable to update props. nlux is not mounted."});if(e.hasOwnProperty("adapter")&&(this.theAdapter=e.adapter??null),e.hasOwnProperty("events")){this.clearEventListeners();for(const[s,i]of Object.entries(e.events??{}))this.on(s,i)}e.hasOwnProperty("className")&&(this.theClassName=e.className??null),e.hasOwnProperty("displayOptions")&&(this.theDisplayOptions=e.displayOptions??null),e.hasOwnProperty("composerOptions")&&(this.theComposerOptions=e.composerOptions??null),e.hasOwnProperty("personaOptions")&&(this.thePersonasOptions=e.personaOptions??null),e.hasOwnProperty("conversationOptions")&&(this.theConversationOptions=e.conversationOptions??null),e.hasOwnProperty("messageOptions")&&(this.theMessageOptions=e.messageOptions??null),this.controller.updateProps(e)}withAdapter(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set adapter. nlux is already or was previously mounted. You can only set the adapter once, when the status is `idle`."});if(this.theAdapterBuilder||this.theAdapter)throw new q({source:this.constructor.name,message:"Unable to change config. A adapter or adapter builder was already set."});if(typeof e!="object"||e===null)throw new q({source:this.constructor.name,message:"Unable to set adapter. Invalid adapter or adapter-builder type."});const s=e;if(typeof s.create=="function")return this.theAdapterType="builder",this.theAdapterBuilder=s,this;if(typeof s.batchText=="function"||typeof s.streamText=="function")return this.theAdapterType="instance",this.theAdapter=s,this;throw new q({source:this.constructor.name,message:"Unable to set adapter. Invalid adapter or adapter-builder implementation! When an `ChatAdapterBuilder` is provided, it must implement either `create()` method that returns an ChatAdapter instance. When an ChatAdapter instance is provided, must implement `batchText()` and/or `streamText()` methods. None of the above were found."})}withClassName(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set class name. nlux is already or was previously mounted. You can only set the class name once, when the status is `idle`."});if(this.theClassName)throw new q({source:this.constructor.name,message:"Unable to change config. A class name was already set."});return this.theClassName=e,this}withComposerOptions(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set composer options. nlux is already or was previously mounted. You can only set the composer options once, when the status is `idle`."});if(this.theComposerOptions)throw new q({source:this.constructor.name,message:"Unable to change config. Composer options were already set."});return this.theComposerOptions={...e},this}withConversationOptions(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set conversation options. nlux is already or was previously mounted. You can only set the conversation options once, when the status is `idle`."});if(this.theConversationOptions)throw new q({source:this.constructor.name,message:"Unable to change config. Conversation options were already set."});return this.theConversationOptions={...e},this}withDisplayOptions(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set display options. nlux is already or was previously mounted. You can only set the display options once, when the status is `idle`."});if(this.theDisplayOptions)throw new q({source:this.constructor.name,message:"Unable to change config. Display options were already set."});return this.theDisplayOptions={...e},this}withInitialConversation(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set initial conversation. nlux is already or was previously mounted. You can only set the initial conversation once, when the status is `idle`."});if(this.theInitialConversation)throw new q({source:this.constructor.name,message:"Unable to change config. Conversation history was already set."});return this.theInitialConversation=[...e],this}withMessageOptions(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set message options. nlux is already or was previously mounted. You can only set the message options once, when the status is `idle`."});if(this.theMessageOptions)throw new q({source:this.constructor.name,message:"Unable to change config. Message options were already set."});return this.theMessageOptions={...e},this}withPersonaOptions(e){if(!this.isIdle)throw new q({source:this.constructor.name,message:"Unable to set persona options. nlux is already or was previously mounted. You can only set the persona options once, when the status is `idle`."});if(this.thePersonasOptions)throw new q({source:this.constructor.name,message:"Unable to change config. Personas were already set."});return this.thePersonasOptions={...e},this}clearEventListeners(){var e;(e=this.controller)==null||e.removeAllEventListenersForAllEvent(),this.unregisteredEventListeners.clear()}}const Tf=()=>new If;let he=null,je=null,oe=null,At=null,Ri=null,Zo=null,As=!1,Ds=!1,Qo=null,St=null,Dt=null,Ms=[],ze=null,Vt=null,Qe=null,$t=null;const Of=document.getElementById("user-info"),wn=document.getElementById("home-section"),ea=document.getElementById("sessions-list"),rr=document.getElementById("empty-state"),Hi=document.getElementById("terminal-section"),Nf=document.getElementById("terminal-container"),Ye=document.getElementById("pty-status"),Hf=document.getElementById("back-btn"),Is=document.getElementById("disconnect-btn"),zi=document.getElementById("chat-section"),Ut=document.getElementById("chat-container"),Pt=document.getElementById("chat-status"),zf=document.getElementById("chat-back-btn"),Fi=document.getElementById("chat-delete-btn"),Ff=document.getElementById("header-buttons"),Il=document.getElementById("header-term-btn"),Wf=document.getElementById("header-term-toggle"),$f=document.getElementById("header-term-menu"),Tl=document.getElementById("header-chat-btn"),Uf=document.getElementById("header-chat-toggle"),Kf=document.getElementById("header-chat-menu"),Ol=document.getElementById("launch-term-btn"),qf=document.getElementById("launch-term-toggle"),Yf=document.getElementById("launch-term-menu"),Nl=document.getElementById("launch-chat-btn"),Vf=document.getElementById("launch-chat-toggle"),jf=document.getElementById("launch-chat-menu");async function Xf(){try{var t=await fetch("/api/app/me");if(t.status===401){window.location.href="/login?next=/app/";return}Qo=await t.json(),Of.textContent=Qo.display_name||"user"}catch{window.location.href="/login?next=/app/";return}Hf.addEventListener("click",nr),Is.addEventListener("click",a_),zf.addEventListener("click",nr),Fi.addEventListener("click",function(){if(Vt){var e=yn().filter(function(s){return s.id!==Vt});bn(e),fetch("/api/app/sessions/"+Vt,{method:"DELETE"}),xn(),nr()}}),Ol.addEventListener("click",function(){Qr(Jr())}),Il.addEventListener("click",function(){Qr(Jr())}),Nl.addEventListener("click",function(){en(Zr())}),Tl.addEventListener("click",function(){en(Zr())}),[qf,Wf].forEach(function(e){e.addEventListener("click",function(s){s.stopPropagation(),Ts(),e.parentElement.querySelector(".split-menu").classList.toggle("open")})}),[Vf,Uf].forEach(function(e){e.addEventListener("click",function(s){s.stopPropagation(),Ts(),e.parentElement.querySelector(".split-menu").classList.toggle("open")})}),document.addEventListener("click",Ts),document.querySelectorAll(".mod-key").forEach(function(e){e.addEventListener("click",function(s){s.preventDefault();var i=e.dataset.key;i==="ctrl"?(As=!As,e.classList.toggle("active",As)):i==="alt"?(Ds=!Ds,e.classList.toggle("active",Ds)):i==="esc"?Kt("\x1B"):i==="tab"&&Kt("	");var r=e.dataset.seq;r===""&&Kt("\x1B[A"),r===""&&Kt("\x1B[B"),oe&&oe.focus()})}),window.addEventListener("resize",function(){oe&&At&&At.fit()}),t_(),Ai(),setInterval(Ai,1e4)}var Hl="wt_sessions",zl="wt_last_term_agent",Fl="wt_last_chat_agent";function Jr(){try{return localStorage.getItem(zl)||"claude"}catch{return"claude"}}function Gf(t){try{localStorage.setItem(zl,t)}catch{}}function Zr(){try{return localStorage.getItem(Fl)||"claude"}catch{return"claude"}}function Jf(t){try{localStorage.setItem(Fl,t)}catch{}}function Ts(){document.querySelectorAll(".split-menu").forEach(function(t){t.classList.remove("open")})}function yn(){try{var t=localStorage.getItem(Hl);return t?JSON.parse(t):[]}catch{return[]}}function bn(t){try{localStorage.setItem(Hl,JSON.stringify(t))}catch{}}function ta(t,e){var s=t.length>0;if(rr.style.display=s?"none":"",Ff.style.display=e.length>0?"":"none",!s){ea.innerHTML="",e.length===0?rr.querySelector(".launch-buttons").style.display="none":rr.querySelector(".launch-buttons").style.display="";return}var i=t.map(function(r){var n=r.status==="active",o=r.kind||"terminal",a=o==="chat",h=n?"active":"detached",l=n?"live":"detached";(a?"chat":"terminal")+""+(r.agent||"unknown");var c=r.id.substring(0,8),d=a?'<span class="session-kind chat">chat</span>':'<span class="session-kind term">term</span>',u;return a?u=`<button class="btn-sm btn-primary" onclick="window._openChat('`+r.id+"', '"+qt(r.agent||"claude")+`')">open</button>`:n?u=`<button class="btn-sm" onclick="window._viewSession('`+r.id+`')">view</button>`:u=`<button class="btn-sm btn-primary" onclick="window._reattachSession('`+r.id+`')">reconnect</button>`,'<div class="session-card '+h+'"><div class="session-info">'+d+'<span class="session-agent">'+qt(r.agent||"unknown")+'</span><span class="session-id">'+qt(c)+'</span><span class="session-status '+h+'">'+l+'</span></div><div class="session-actions">'+u+`<button class="btn-sm btn-danger" onclick="window._deleteSession('`+r.id+`')">delete</button></div></div>`}).join("");ea.innerHTML=i}async function Ai(){if(Hi.style.display==="none"&&zi.style.display==="none"){var t=yn();t.length>0&&ta(t,Ms.length>0?[1]:[]);var e=[],s=[];try{var[i,r]=await Promise.all([fetch("/api/app/sessions"),fetch("/api/app/wings")]);i.ok&&(e=await i.json()||[]),r.ok&&(s=await r.json()||[])}catch(o){console.error("load home:",o);return}bn(e),Ms=[];var n={};(s||[]).forEach(function(o){(o.agents||[]).forEach(function(a){n[a]||(n[a]=!0,Ms.push({agent:a,wingId:o.id}))})}),Zf(),ta(e,s)}}function Cn(){var t=Jr(),e=Zr(),s=Wl(t),i=$l(e);Ol.textContent=s,Il.textContent=s,Nl.textContent=i,Tl.textContent=i}function Zf(){var t=Ms.length>0?Ms.map(function(e){return e.agent}):["claude","ollama"];Cn(),[Yf,$f].forEach(function(e){e.innerHTML=t.map(function(s){return'<div class="split-menu-item" data-agent="'+qt(s)+'">'+qt(Wl(s))+"</div>"}).join(""),e.querySelectorAll(".split-menu-item").forEach(function(s){s.addEventListener("click",function(i){i.stopPropagation(),Ts(),Qr(s.dataset.agent)})})}),[jf,Kf].forEach(function(e){e.innerHTML=t.map(function(s){return'<div class="split-menu-item" data-agent="'+qt(s)+'">'+qt($l(s))+"</div>"}).join(""),e.querySelectorAll(".split-menu-item").forEach(function(s){s.addEventListener("click",function(i){i.stopPropagation(),Ts(),en(s.dataset.agent)})})})}function Wl(t){return t+" terminal"}function $l(t){return t+" chat"}function Qr(t){Gf(t),Cn(),kn(),o_(t)}function nr(){wn.style.display="",Hi.style.display="none",zi.style.display="none",xn(),Ai()}function kn(){wn.style.display="none",Hi.style.display="",zi.style.display="none",xn(),oe&&At&&(At.fit(),oe.focus())}function Ul(){wn.style.display="none",Hi.style.display="none",zi.style.display=""}window._viewSession=function(t){kn(),jl(t)};window._reattachSession=function(t){kn(),jl(t)};window._openChat=function(t,e){Ul(),Qf(t,e)};window._deleteSession=function(t){var e=yn().filter(function(s){return s.id!==t});bn(e),ql(t),fetch("/api/app/sessions/"+t,{method:"DELETE"}).then(function(){Ai()})};function en(t){Jf(t),Cn(),Ul(),Pt.textContent="connecting...",Fi.style.display="none";var e=location.protocol==="https:"?"wss:":"ws:",s=e+"//"+location.host+"/ws/pty";ze=new WebSocket(s),ze.onopen=function(){Pt.textContent="starting chat...",ze.send(JSON.stringify({type:"chat.start",agent:t}))},Kl(ze,t)}function Qf(t,e){Pt.textContent="loading...",Fi.style.display="none";var s=location.protocol==="https:"?"wss:":"ws:",i=s+"//"+location.host+"/ws/pty";ze=new WebSocket(i),ze.onopen=function(){Pt.textContent="loading history...",ze.send(JSON.stringify({type:"chat.start",session_id:t,agent:e}))},Kl(ze,e)}var ai=null;function Kl(t,e,s){ai=null,t.onmessage=function(i){var r=JSON.parse(i.data);switch(r.type){case"chat.history":ai=(r.messages||[]).map(function(n){return{role:n.role,message:n.content}});break;case"chat.started":Vt=r.session_id,Pt.textContent=r.agent+" chat",Fi.style.display="",e_(e,ai),ai=null;break;case"chat.chunk":Qe&&Qe.next(r.text);break;case"chat.done":Qe&&(Qe.complete(),Qe=null),Ut.classList.remove("thinking");break;case"error":Pt.textContent=r.message,Ut.classList.remove("thinking"),Qe&&(Qe.error(new Error(r.message)),Qe=null);break}},t.onclose=function(){Pt.textContent="disconnected",Qe=null},t.onerror=function(){Pt.textContent="connection error"}}function e_(t,e){$t&&($t.unmount(),$t=null),Ut.innerHTML="";var s={streamText:function(r,n){Qe=n,Ut.classList.add("thinking"),ze&&ze.readyState===WebSocket.OPEN&&Vt?ze.send(JSON.stringify({type:"chat.message",session_id:Vt,content:r})):(Ut.classList.remove("thinking"),n.error(new Error("not connected")))}},i=Tf().withAdapter(s).withDisplayOptions({colorScheme:"dark",height:"100%",width:"100%"}).withConversationOptions({historyPayloadSize:0,layout:"bubbles"}).withComposerOptions({placeholder:"message "+t+"...",autoFocus:!0}).withPersonaOptions({assistant:{name:t,avatar:"https://ui-avatars.com/api/?name="+t.charAt(0).toUpperCase()+"&background=e94560&color=fff&size=32"}}).withMessageOptions({waitTimeBeforeStreamCompletion:"never"});e&&e.length>0&&(i=i.withInitialConversation(e)),i.mount(Ut),$t=i}function xn(){$t&&($t.unmount(),$t=null),ze&&(ze.close(),ze=null),Vt=null,Qe=null,Ut.innerHTML=""}function t_(){oe=new iu({cursorBlink:!0,fontSize:14,fontFamily:"'SF Mono', 'Fira Code', 'Cascadia Code', monospace",theme:{background:"#1a1a2e",foreground:"#eee",cursor:"#e94560",selectionBackground:"#0f3460"},allowProposedApi:!0}),At=new ou,Ri=new du,oe.loadAddon(At),oe.loadAddon(Ri),oe.open(Nf),At.fit(),oe.onData(function(t){if(As&&(As=!1,document.querySelector('[data-key="ctrl"]').classList.remove("active"),t.length===1)){var e=t.toUpperCase().charCodeAt(0)-64;if(e>=0&&e<=31){Kt(String.fromCharCode(e));return}}if(Ds){Ds=!1,document.querySelector('[data-key="alt"]').classList.remove("active"),Kt("\x1B"+t);return}Kt(t)})}var En="wt_termbuf_";function sa(){!je||!Ri||(clearTimeout(Zo),Zo=setTimeout(function(){try{var t=Ri.serialize();t.length>2e5&&(t=t.slice(-2e5)),localStorage.setItem(En+je,t)}catch{}},500))}function s_(t){try{var e=localStorage.getItem(En+t);e&&oe&&oe.write(e)}catch{}}function ql(t){try{localStorage.removeItem(En+t)}catch{}}function Kt(t){!he||he.readyState!==WebSocket.OPEN||!je||r_(t).then(function(e){he.send(JSON.stringify({type:"pty.input",session_id:je,data:e}))})}function Yl(t){return Uint8Array.from(atob(t),function(e){return e.charCodeAt(0)})}function Bn(t){for(var e="",s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}async function i_(t){if(!Dt)return null;var e=Yl(t),s=zs.getSharedSecret(Dt,e),i=new Uint8Array(32),r=await crypto.subtle.importKey("raw",s,"HKDF",!1,["deriveKey"]),n=new TextEncoder;return crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:i,info:n.encode("wt-pty")},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function r_(t){if(!St)return btoa(unescape(encodeURIComponent(t)));var e=new TextEncoder,s=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},St,e.encode(t)),r=new Uint8Array(s.length+i.byteLength);return r.set(s),r.set(new Uint8Array(i),s.length),Bn(r)}async function n_(t){if(!St){for(var e=atob(t),s=new Uint8Array(e.length),i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return s}var r=Yl(t),n=r.slice(0,12),o=r.slice(12),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},St,o);return new Uint8Array(a)}function Vl(t,e){t.onmessage=function(s){var i=JSON.parse(s.data);switch(i.type){case"pty.started":je=i.session_id,i.public_key?i_(i.public_key).then(function(r){St=r,Ye.textContent=i.agent+(r?" (encrypted)":" (live)")}).catch(function(){Ye.textContent=i.agent+" (live)"}):Ye.textContent=i.agent+" (live)",Is.style.display="",e||oe.clear(),oe.focus(),oe.onResize(function(r){he&&he.readyState===WebSocket.OPEN&&je&&he.send(JSON.stringify({type:"pty.resize",session_id:je,cols:r.cols,rows:r.rows}))}),At.fit();break;case"pty.output":n_(i.data).then(function(r){oe.write(r),sa()}).catch(function(r){console.error("decrypt error:",r);for(var n=atob(i.data),o=new Uint8Array(n.length),a=0;a<n.length;a++)o[a]=n.charCodeAt(a);oe.write(o),sa()});break;case"pty.exited":Ye.textContent="exited (code "+i.exit_code+")",i.session_id&&ql(i.session_id),je=null,St=null,Dt=null,Is.style.display="none",oe.writeln(`\r
\x1B[1;31m--- session ended ---\x1B[0m`);break;case"error":Ye.textContent=i.message;break}},t.onclose=function(){Ye.textContent="disconnected",je=null,Is.style.display="none"},t.onerror=function(){Ye.textContent="connection error"}}function o_(t){var e=location.protocol==="https:"?"wss:":"ws:",s=e+"//"+location.host+"/ws/pty";Ye.textContent="connecting...",Dt=zs.utils.randomSecretKey();var i=zs.getPublicKey(Dt),r=Bn(i);St=null,he=new WebSocket(s),he.onopen=function(){Ye.textContent="starting "+t+"...",he.send(JSON.stringify({type:"pty.start",agent:t,cols:oe.cols,rows:oe.rows,public_key:r}))},Vl(he,!1)}function jl(t){var e=location.protocol==="https:"?"wss:":"ws:",s=e+"//"+location.host+"/ws/pty";oe.clear(),s_(t),Ye.textContent="reconnecting...",Dt=zs.utils.randomSecretKey();var i=zs.getPublicKey(Dt),r=Bn(i);St=null,he=new WebSocket(s),he.onopen=function(){Ye.textContent="reattaching...",he.send(JSON.stringify({type:"pty.attach",session_id:t,public_key:r}))},Vl(he,!0)}function a_(){he&&he.readyState===WebSocket.OPEN&&je&&he.send(JSON.stringify({type:"pty.kill",session_id:je})),he&&(he.close(),he=null),je=null,St=null,Dt=null,Is.style.display="none",Ye.textContent="disconnected"}function qt(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").catch(function(){});Xf();
