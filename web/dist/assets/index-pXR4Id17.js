(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();let g=localStorage.getItem("wt_token"),a=localStorage.getItem("wt_device_id"),u=[],m=null,i=null;const v=document.getElementById("connection-status"),E=document.getElementById("login-section"),l=document.getElementById("login-form"),d=document.getElementById("login-pending"),b=document.getElementById("user-code"),k=document.getElementById("submit-section"),_=document.getElementById("task-form"),I=document.getElementById("task-input"),S=document.getElementById("status-section");document.getElementById("pending-count");document.getElementById("running-count");document.getElementById("tokens-today");const T=document.getElementById("timeline-section"),y=document.getElementById("timeline-list"),w=document.getElementById("thread-section"),f=document.getElementById("thread-content");function O(){a||(a=crypto.randomUUID(),localStorage.setItem("wt_device_id",a)),g?L():B(),l.addEventListener("submit",function(e){e.preventDefault(),P()}),_.addEventListener("submit",function(e){e.preventDefault();const t=I.value.trim();t&&(M(t),I.value="")})}function B(){E.style.display="",l.style.display="",d.style.display="none",k.style.display="none",S.style.display="none",T.style.display="none",w.style.display="none"}function L(){E.style.display="none",k.style.display="",S.style.display="",T.style.display="",w.style.display="",N("connected"),C(),h()}function N(e){v.textContent=e,v.className=e}function H(e,t){u.unshift({id:e,what:t,status:"pending",output:"",error:"",timestamp:Date.now()}),C()}function M(e){const t=crypto.randomUUID();H(t,e),m=t,h()}function C(){if(y.innerHTML="",u.length===0){y.innerHTML='<div class="timeline-item"><span class="task-what" style="color:var(--text-dim)">no tasks yet</span></div>';return}for(const e of u){const t=document.createElement("div");t.className="timeline-item "+e.status,t.setAttribute("data-id",e.id);const o=document.createElement("span");o.className="task-what",o.textContent=e.what;const r=document.createElement("span");r.className="task-status",r.textContent=e.status,t.appendChild(o),t.appendChild(r),t.addEventListener("click",()=>{m=e.id,h()}),y.appendChild(t)}}function h(){if(!m){f.innerHTML='<span class="empty">select a task to view details</span>';return}const e=u.find(o=>o.id===m);if(!e){f.innerHTML='<span class="empty">task not found</span>';return}let t="<pre>";t+="task: "+c(e.what)+`
`,t+="status: "+c(e.status)+`
`,e.progress&&(t+="progress: "+e.progress+`%
`),e.output&&(t+=`
--- output ---
`+c(e.output)),e.error&&(t+=`
--- error ---
`+c(e.error)),t+="</pre>",f.innerHTML=t}function P(){l.style.display="none",d.style.display="",fetch("/auth/device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_id:a})}).then(e=>e.json()).then(e=>{if(e.error){l.style.display="",d.style.display="none";return}b.textContent=e.user_code,x(e.device_code,e.interval||5)}).catch(()=>{l.style.display="",d.style.display="none"})}function x(e,t){i&&clearInterval(i),i=setInterval(()=>{fetch("/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_code:e})}).then(o=>o.json()).then(o=>{o.token&&(clearInterval(i),i=null,g=o.token,localStorage.setItem("wt_token",g),L()),o.error&&o.error!=="authorization_pending"&&(clearInterval(i),i=null,B())}).catch(()=>{})},t*1e3)}function c(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").catch(()=>{});O();
