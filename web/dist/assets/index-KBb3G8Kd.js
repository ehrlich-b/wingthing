(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let d=localStorage.getItem("wt_token"),m=localStorage.getItem("wt_device_id"),i=[],a=null,c=null;const I=document.getElementById("connection-status"),T=document.getElementById("login-section"),f=document.getElementById("login-form"),p=document.getElementById("login-pending"),O=document.getElementById("user-code"),C=document.getElementById("submit-section"),N=document.getElementById("task-form"),k=document.getElementById("task-input"),w=document.getElementById("status-section"),x=document.getElementById("pending-count"),P=document.getElementById("running-count");document.getElementById("tokens-today");const B=document.getElementById("timeline-section"),h=document.getElementById("timeline-list"),L=document.getElementById("thread-section"),v=document.getElementById("thread-content");function j(){m||(m=crypto.randomUUID(),localStorage.setItem("wt_device_id",m)),d?(S(),l(),setInterval(l,1e4)):E(),f.addEventListener("submit",function(e){e.preventDefault(),F()}),N.addEventListener("submit",function(e){e.preventDefault();var t=k.value.trim();t&&(M(t),k.value="")})}function E(){T.style.display="",f.style.display="",p.style.display="none",C.style.display="none",w.style.display="none",B.style.display="none",L.style.display="none"}function S(){T.style.display="none",C.style.display="",w.style.display="",B.style.display="",L.style.display="",A("connected")}function A(e){I.textContent=e,I.className=e}function _(e,t,n){var r={method:e,headers:{Authorization:"Bearer "+d,"Content-Type":"application/json"}};return n&&(r.body=JSON.stringify(n)),fetch(t,r).then(function(o){if(o.status===401)throw d=null,localStorage.removeItem("wt_token"),E(),new Error("unauthorized");return o.json()})}function l(){_("GET","/api/tasks").then(function(e){Array.isArray(e)&&(i=e,b(),H(),a&&y())}).catch(function(){})}function H(){for(var e=0,t=0,n=0;n<i.length;n++)i[n].status==="pending"&&e++,i[n].status==="running"&&t++;x.textContent=e,P.textContent=t}function M(e){_("POST","/api/tasks",{prompt:e}).then(function(t){t.task_id&&(a=t.task_id,l(),D(t.task_id))}).catch(function(t){console.error("submit error:",t)})}function D(e){var t=new EventSource("/api/tasks/"+e+"/stream?token="+encodeURIComponent(d)),n="";t.onmessage=function(r){n+=r.data;for(var o=0;o<i.length;o++)if(i[o].id===e){i[o].output=n,i[o].status="running";break}a===e&&y()},t.addEventListener("done",function(r){t.close();for(var o=0;o<i.length;o++)if(i[o].id===e){i[o].status=r.data;break}b(),a===e&&y(),setTimeout(l,500)}),t.onerror=function(){t.close(),setTimeout(l,1e3)}}function b(){if(h.innerHTML="",i.length===0){h.innerHTML='<div class="timeline-item"><span class="task-what" style="color:var(--text-dim)">no tasks yet</span></div>';return}for(var e=0;e<i.length;e++){var t=i[e],n=document.createElement("div");n.className="timeline-item "+t.status,n.setAttribute("data-id",t.id);var r=document.createElement("span");r.className="task-what",r.textContent=t.prompt||t.skill||t.id;var o=document.createElement("span");o.className="task-status",o.textContent=t.status,n.appendChild(r),n.appendChild(o),n.addEventListener("click",(function(s){return function(){a=s,y()}})(t.id)),h.appendChild(n)}}function y(){if(!a){v.innerHTML='<span class="empty">select a task to view details</span>';return}for(var e=null,t=0;t<i.length;t++)if(i[t].id===a){e=i[t];break}if(!e){v.innerHTML='<span class="empty">task not found</span>';return}var n="<pre>";n+="task: "+u(e.prompt||e.skill||e.id)+`
`,n+="status: "+u(e.status)+`
`,e.agent&&(n+="agent: "+u(e.agent)+`
`),e.wing_id&&(n+="wing: "+u(e.wing_id)+`
`),e.output&&(n+=`
--- output ---
`+u(e.output)),e.error&&(n+=`
--- error ---
`+u(e.error)),n+="</pre>",v.innerHTML=n}function F(){f.style.display="none",p.style.display="",fetch("/auth/device",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_id:m})}).then(function(e){return e.json()}).then(function(e){if(e.error){f.style.display="",p.style.display="none";return}O.textContent=e.user_code,z(e.device_code,e.interval||5)}).catch(function(){f.style.display="",p.style.display="none"})}function z(e,t){c&&clearInterval(c),c=setInterval(function(){fetch("/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_code:e})}).then(function(n){return n.json()}).then(function(n){n.token&&(clearInterval(c),c=null,d=n.token,localStorage.setItem("wt_token",d),S(),l(),setInterval(l,1e4)),n.error&&n.error!=="authorization_pending"&&(clearInterval(c),c=null,E())}).catch(function(){})},t*1e3)}function u(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").catch(function(){});j();
