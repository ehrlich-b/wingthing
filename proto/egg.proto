syntax = "proto3";
package egg;
option go_package = "github.com/ehrlich-b/wingthing/internal/egg/pb";

service Egg {
    rpc Kill(KillRequest) returns (KillResponse);
    rpc Resize(ResizeRequest) returns (ResizeResponse);
    rpc Session(stream SessionMsg) returns (stream SessionMsg);
    rpc Status(StatusRequest) returns (StatusResponse);
}

message StatusRequest {}
message StatusResponse {
    string session_id = 1;
    string agent = 2;
    int64 buffer_bytes = 3;
    int64 total_written = 4;
    int64 total_trimmed = 5;
    int32 readers = 6;
    int64 uptime_seconds = 7;
    string rendered_config = 8;
}

message KillRequest { string session_id = 1; }
message KillResponse {}

message ResizeRequest {
    string session_id = 1;
    uint32 rows = 2;
    uint32 cols = 3;
}
message ResizeResponse {}

message SessionMsg {
    string session_id = 1;
    oneof payload {
        bytes output = 2;
        bytes input = 3;
        Resize resize = 4;
        int32 exit_code = 5;
        bool attach = 6;
        bool detach = 7;
    }
}

message Resize {
    uint32 rows = 1;
    uint32 cols = 2;
}
